(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-22e7c7a4"],{"0921":function(e,t,s){"use strict";var i=s("3115"),a=s("025e"),n=(s("5bc0"),s("c320")),r=s("9d47"),o=s("21bc"),l=s("0af5"),d=s("a2e1"),h=s("5eee"),c=s("a2c7"),p=s("256f"),u=s("480c"),m=s("3e6b"),g=s("5831"),w=s("d0e9"),f=(s("1399"),s("0417")),y=s("3900");class v{constructor(){this.createHtml(),this.loading=0,this.loaded=0}addLoading(){this.loading++,this.update()}addLoaded(){this.loaded++,this.update()}update(){var e=(this.loaded/this.loading*100).toFixed(1)+"%";this.label.innerText="Loading Tiles ("+e+")",this.progressBarInner.style.width=e,this.loading===this.loaded&&(this.loading=0,this.loaded=0),this.el.style.opacity=this.show()?1:0}show(){return this.loading>0&&this.loaded<=this.loading}createHtml(){this.el=document.createElement("div"),this.el.className="ol-unselectable ol-progress-control",this.progressBar=document.createElement("div"),this.progressBar.className="progress-bar",this.progressBarInner=document.createElement("div"),this.progressBarInner.className="progress-bar-inner",this.progressBar.appendChild(this.progressBarInner),this.label=document.createElement("div"),this.label.className="progress-label",this.el.appendChild(this.progressBar),this.el.appendChild(this.label)}getControl(){var e=new y["a"]({element:this.el});return e}}var b,L,x={mixins:[i["a"]],props:{id:{type:String,required:!0},center:{type:Array,default:()=>[0,0]},zoom:{type:Number,default:1},show:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},removableLayers:{type:Boolean,default:!1}},data(){return{map:null,baseLayer:null,osm:null,progress:null}},watch:{show(){this.showMap()}},mounted(){this.showMap()},methods:{showMap(){this.show&&this.$nextTick(this.renderMap)},createMap(e=!1){if(null!==this.map)return this.map.updateSize(),void this.map.render();this.progress=new v,this.osm=new w["a"],this.baseLayer=new u["a"]({source:this.trackTileProgress(this.osm),baseLayer:!0,title:"OpenStreetMap",noSwitcherDelete:!0});var t=[new n["a"],new r["a"],this.progress.getControl()];e&&t.push(new f["a"]({trash:this.removableLayers}));var s={target:this.id,layers:[this.baseLayer],view:new c["a"]({center:Object(p["d"])([this.center[1],this.center[0]]),zoom:this.zoom})};this.editable?s.controls=Object(o["a"])().extend(t):(s.interactions=[],s.controls=t),this.map=new h["a"](s),this.listen("windowResized",this.updateMapSize)},onShow(){this.listen("windowResized",this.updateMapSize)},onHide(){this.unlisten("windowResized")},renderMap(){this.createMap()},async updateMapSize(){this.map&&(await this.$nextTick(),this.map.updateSize())},getVisibleLayers(){let e=[],t=this.map.getLayers().getArray();for(let s of t)s.get("userLayer")&&s.getVisible()&&e.push(s);return e},addGeoJson(e){var t={};a["a"].detectGeoJson(e)&&(t.features=(new d["a"]).readFeatures(e,{featureProjection:this.osm.getProjection()}));var s=new g["a"](t),i=new m["a"]({title:"GeoJSON",source:s});this.map.addLayer(i);var n=s.getExtent();return Object(l["G"])(n)||this.map.getView().fit(n),i},trackTileProgress(e){return e.on("tileloadstart",()=>{this.progress.addLoading()}),e.on("tileloadend",()=>{this.progress.addLoaded()}),e.on("tileloaderror",()=>{this.progress.addLoaded()}),e}}},M=x,S=s("2877"),C=Object(S["a"])(M,b,L,!1,null,null,null);t["a"]=C.exports},2930:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{staticClass:"modal",style:{"z-index":e.zIndex},on:{mousedown:e.backgroundClose}},[s("div",{ref:"container",staticClass:"modal-container",style:e.style},[s("header",{staticClass:"modal-header",on:{mousedown:function(t){return t.preventDefault(),t.stopPropagation(),e.startMove.apply(null,arguments)}}},[e._t("header",(function(){return[s("h2",[e._v(e._s(e.title))]),s("span",{staticClass:"close",on:{click:e.close}},[s("i",{staticClass:"fa fa-times",attrs:{"aria-hidden":"true"}})])]}))],2),s("main",{staticClass:"modal-content"},[e._t("default")],2),s("footer",{staticClass:"modal-footer"},[e._t("footer")],2)])])},a=[],n=s("3115"),r=s("025e"),o={name:"Modal",mixins:[n["a"]],props:{title:{type:String,default:null},minWidth:{type:String,default:"30%"},maxWidth:{type:String,default:"85%"},minHeight:{type:String,default:"auto"},show:{type:Boolean,default:!0}},data(){return{zIndex:1e3,position:null,dragPosition:null}},computed:{...r["a"].mapState("editor",["hightestModalZIndex"]),style(){let e={"min-width":this.minWidth,"max-width":this.maxWidth,"min-height":this.minHeight};return Array.isArray(this.position)&&(e.position="absolute",e.left=this.position[0]+"px",e.top=this.position[1]+"px"),e}},watch:{show:{immediate:!0,handler(e){e?this.open():this.close()}}},methods:{...r["a"].mapMutations("editor",["openModal","closeModal"]),open(){this.openModal(),this.zIndex=this.hightestModalZIndex,window.addEventListener("keydown",this.escCloseListener),this.$emit("shown")},close(){window.removeEventListener("keydown",this.escCloseListener),this.closeModal(),this.$emit("closed")},startMove(e){this.dragPosition=[e.clientX,e.clientY],document.addEventListener("mousemove",this.move),document.addEventListener("mouseup",this.stopMove)},stopMove(){document.removeEventListener("mousemove",this.move),document.removeEventListener("mouseup",this.stopMove)},move(e){e.preventDefault(),this.position=[this.$refs.container.offsetLeft-(this.dragPosition[0]-e.clientX),this.$refs.container.offsetTop-(this.dragPosition[1]-e.clientY)],this.dragPosition=[e.clientX,e.clientY]},escCloseListener(e){if("Escape"==e.key)return this.close(),e.preventDefault(),e.stopPropagation(),!1},backgroundClose(e){e.target===this.$el&&this.close()}}},l=o,d=(s("8781"),s("2877")),h=Object(d["a"])(l,i,a,!1,null,null,null);t["a"]=h.exports},"2f8f":function(e,t,s){"use strict";s("af41")},"6b1e":function(e,t,s){},8295:function(e,t,s){"use strict";s.r(t);var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("Modal",{attrs:{title:e.collection.id},on:{closed:function(t){return e.$emit("closed")}}},[s("div",{staticClass:"docgen"},[s("Collection",{attrs:{data:e.collection},scopedSlots:e._u([{key:"spatial-extents",fn:function(t){return[s("MapViewer",{staticClass:"map",attrs:{id:"collectionMap",show:e.showMap,extents:t.extents}})]}}])}),e.currentItems?s("section",[s("Items",{attrs:{items:e.currentItems},scopedSlots:e._u([{key:"item-location",fn:function(e){return[s("MapViewer",{attrs:{id:String(Date.now()),geoJson:e.geometry}})]}}],null,!1,3894742568)}),s("div",{staticClass:"pagination"},[s("button",{attrs:{title:"Previous page",disabled:!e.hasPrevItems},on:{click:function(t){return e.paginate(-1)}}},[s("i",{staticClass:"fas fa-arrow-left"}),e._v(" Previous Page")]),s("button",{attrs:{title:"Next page",disabled:!e.hasNextItems},on:{click:function(t){return e.paginate(1)}}},[e._v("Next Page "),s("i",{staticClass:"fas fa-arrow-right"})])])],1):e._e()],1)])},a=[],n=s("a5c1"),r=s("2930"),o=s("47ed"),l=s("025e"),d={name:"CollectionModal",components:{MapViewer:n["a"],Modal:r["a"],Collection:o["default"],Items:()=>s.e("chunk-27a37ce8").then(s.bind(null,"d25f"))},data(){return{showMap:!1,items:[],itemsPage:0,itemsIterator:null}},props:{collection:{type:Object}},computed:{...l["a"].mapState(["connection"]),...l["a"].mapGetters(["supports"]),bbox(){try{return this.collection.extent.spatial.bbox[0]}catch(e){return null}},currentItems(){return this.items.length>=this.itemsPage?this.items[this.itemsPage]:null},hasPrevItems(){return this.itemsPage>0},hasNextItems(){return this.itemsPage<this.items.length-1}},async mounted(){this.$nextTick(()=>{this.showMap=!0}),this.supports("listCollectionItems")&&(await this.nextItems(),this.nextItems())},methods:{async paginate(e){if(e>0)await this.nextItems();else if(0===this.itemsPage&&e<0)return;this.itemsPage+=e},async nextItems(){this.itemsIterator||(this.itemsIterator=await this.connection.listCollectionItems(this.collection.id));let e=await this.itemsIterator.next();e&&e.value&&!e.done&&this.items.push(e.value)}}},h=d,c=(s("2f8f"),s("2877")),p=Object(c["a"])(h,i,a,!1,null,null,null);t["default"]=p.exports},8781:function(e,t,s){"use strict";s("6b1e")},"90b4":function(e,t,s){},"991b":function(e,t,s){"use strict";s("90b4")},a5c1:function(e,t,s){"use strict";var i=function(){var e=this,t=e.$createElement,s=e._self._c||t;return s("div",{attrs:{id:e.id}})},a=[],n=s("0921"),r=s("025e"),o=s("e300"),l=s("4cdf"),d=s("9c78"),h=s("5bc3"),c=s("256f"),p=s("480c"),u=s("6cf3"),m=s("3e6b"),g=s("5831"),w=s("2ef1"),f=s("2278"),y=s("d510"),v=(s("7505"),s("cfd3")),b=(s("6601"),s("457f")),L={name:"MapViewer",mixins:[n["a"]],props:{extents:{type:Array,default:()=>null},geoJson:{type:Object,default:()=>null}},data(){return{WMTSCapabilities:{},swipe:{control:null,left:null,right:null},timeline:null}},methods:{renderMap(){let e=Array.isArray(this.extents)&&this.extents.length>0;if(this.createMap(!e),e)for(let i of this.extents){var t=r["a"].extentToBBox(i);this.addRectangle(t.west,t.east,t.north,t.south)}r["a"].isObject(this.geoJson)&&(this.geoJsonLayer=this.addGeoJson(this.geoJson));let s=this.map.getLayers();s.on("add",()=>this.toggleSwipeControl()),s.on("remove",()=>this.toggleSwipeControl()),this.$listeners&&this.$listeners.drop&&(this.map.getViewport().addEventListener("dragover",e=>e.preventDefault()),this.map.getViewport().addEventListener("drop",this.$listeners.drop))},addRectangle(e,t,s,i){let a=[...Object(c["d"])([e,i]),...Object(c["d"])([t,s])],n=new m["a"]({title:"Extent",displayInLayerSwitcher:!1,source:new g["a"]({features:[new l["a"](Object(h["c"])(a))],wrapX:!1})});this.map.addLayer(n),this.map.getView().fit(a)},async showWebService(e){switch(e.type.toLowerCase()){case"xyz":this.updateXYZLayer(e);break;case"wmts":await this.updateWMTSLayer(e);break;default:r["a"].error(this,"Sorry, the service type is not supported by the map.")}},toggleSwipeControl(){var e=this.getVisibleLayers();2===e.length?(null===this.swipe.control&&(this.swipe.control=new v["a"],this.map.addControl(this.swipe.control)),this.swipe.left!==e[0]&&(this.swipe.control.addLayer(e[0]),this.swipe.left=e[0]),this.swipe.right!==e[1]&&(this.swipe.control.addLayer(e[1],!0),this.swipe.right=e[1])):(this.map.removeControl(this.swipe.control),this.swipe.control=null,this.swipe.left=null,this.swipe.right=null)},addLayerToMap(e){e.set("userLayer",!0),this.map.addLayer(e),e.on("change",()=>this.toggleSwipeControl()),e.on("change:visible",()=>this.toggleSwipeControl()),e.on("change:zIndex",()=>this.toggleSwipeControl())},removeLayerFromMap(e){let t=this.getLayerFromMap(e);t&&this.map.removeLayer(t)},getLayerFromMap(e){let t=this.map.getLayers().getArray();for(let s of t)if(s.get("id")===e)return s;return null},updateGeoTiffLayer(e,t=null){var s=new p["a"]({id:e,title:t||"GeoTiff",source:new u["a"]({url:"http://tiles.rdnt.io/tiles?url="+encodeURIComponent(e),crossOrigin:"anonymous"})});return this.addLayerToMap(s),s},async addCollection(e){let t=r["a"].getPreviewLinkFromSTAC(e);t||r["a"].error(this,"No visualizations found for collection");let s,i={id:e.id,url:t.href,title:e.title||e.id};switch(this.map.getLayers().forEach(e=>{e.get("previewLayer")&&e.get("id")!==i.id&&this.map.removeLayer(e)}),t.rel.toLowerCase()){case"xyz":s=this.updateXYZLayer(i);break;case"wmts":let e=[];t["wmts:layer"]&&e.push(t["wmts:layer"]),s=await this.updateWMTSLayer(i,e);break;default:return void r["a"].error(this,"Sorry, the service type is not supported by the map.")}s.set("previewLayer",!0);try{let t=r["a"].extentToBBox(e.extent.spatial.bbox[0]),i=[...Object(c["d"])([t.west,t.south]),...Object(c["d"])([t.east,t.north])],a=new m["a"]({title:"Extent",noSwitcherDelete:!0,source:new g["a"]({features:[new l["a"](Object(h["c"])(i))],wrapX:!1})}),n=a.getStyle();"function"===typeof n&&(n=n()[0]),n.setFill(null),s.getLayers().push(a),this.map.getView().fit(i)}catch(a){console.log(a)}},getWMTSTimes(e,t){const s=e.Contents.Layer||[];let i=s.find(e=>e.Identifier==t);if(!i||!i.Dimension)return[];let a=i.Dimension.find(e=>"TIME"===e.Identifier);return a?a.Value.sort():[]},async updateWMTSLayer(e,t=[],s,i="Service"){if(this.removeLayerFromMap(e.id),!this.WMTSCapabilities[e.url]){let t=new URL(e.url);t.searchParams.set("service","wmts"),t.searchParams.set("request","GetCapabilities");let s=await axios.get(t.toString(),{responseType:"text"});var a=new f["a"];this.WMTSCapabilities[e.url]=a.read(s.data)}let n=this.WMTSCapabilities[e.url],l=null,h=null,c=null,u=null,m=r["a"].getResourceTitle(e,i),g=new o["a"];for(let o of t){let e=Object(y["b"])(n,{layer:o,matrixSet:"EPSG:3857"});c||(c=new Date(e.dimensions.TIME));let t=this.getWMTSTimes(n,o);if(t.length){let e=new Date(t[0]),s=new Date(t[t.length-1]);(!l||e<l)&&(l=e),(!h||s>h)&&(h=s)}s&&(r["a"].isObject(e.dimensions)||(e.dimensions={}),e.dimensions.time=s),u=new y["a"](e);var w=new p["a"]({title:m,source:this.trackTileProgress(u),noSwitcherDelete:!0});g.push(w)}if(l&&h){let e;this.timeline=new b["a"]({className:"ol-pointer",graduation:"day",minDate:l,maxDate:h}),this.timeline.on("scroll",(function(t){!t.date||t.date>h||t.date<l||(e&&window.clearTimeout(e),e=window.setTimeout(()=>{try{let e=t.date.toISOString().substr(0,10);u.updateDimensions({TIME:e});let s=document.getElementsByClassName("timeline-date-label");s[0].innerText=e,s[0].disabled=!0}catch(s){console.log(s)}e=null},500))})),this.map.addControl(this.timeline),this.timeline.addButton({className:"timeline-date-label",title:`The date that is shown on the map for the collection '${m}'`,html:"No date"}),this.timeline.setDate(c)}let v=new d["a"]({id:e.id,title:m,layers:g});return this.addLayerToMap(v),this.timeline&&this.map.getLayers().on("remove",e=>{e.element===v&&(this.map.removeControl(this.timeline),this.timeline=null)}),v},updateXYZLayer(e,t="Service"){this.removeLayerFromMap(e.id);let s=r["a"].replaceParam(e.url,"__editorSessionId",(new Date).getTime()).replace(/%7B/g,"{").replace(/%7D/g,"}"),i=r["a"].getResourceTitle(e,t),a=new p["a"]({title:i,source:this.trackTileProgress(new w["a"]({url:s})),noSwitcherDelete:!0}),n=new d["a"]({id:e.id,title:i,layers:[a]});return this.addLayerToMap(n),n}}},x=L,M=(s("991b"),s("2877")),S=Object(M["a"])(x,i,a,!1,null,null,null);t["a"]=S.exports},af41:function(e,t,s){}}]);
//# sourceMappingURL=chunk-22e7c7a4.c5a98974.js.map