(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-2dc2e4e7"],{"0265":function(e,t,a){},1416:function(e,t,a){},"1e9c":function(e,t,a){"use strict";a("0265")},"2d6d":function(e,t,a){"use strict";a("4ed6")},"2e68":function(e,t,a){"use strict";a("ffc9")},"330e":function(e,t,a){"use strict";var i,s,n=a("025e"),r=a("3115"),o=a("0af5"),l=a("06f8"),h=a("a2e1"),d=a("2ce2"),c=a("3e6b"),u=a("5831"),p={mixins:[r["a"]],methods:{addGeoJson(e,t=!1,a="GeoJSON",i=!0){let s;s=e instanceof u["a"]?e:this.createGeoJsonSource(e,this.map.getView().getProjection());let n=new c["a"]({title:a,source:s});!i&&this.removeLayerFill&&this.removeLayerFill(n),this.map.addLayer(n);let r=s.getExtent();if(Object(o["G"])(r)||this.map.getView().fit(r,this.getFitOptions()),t){var h=new d["a"]({hitTolerance:5,multi:!1,condition:l["m"],layers:[n]});h.on("select",this.onSelect),this.map.addInteraction(h)}return n},onSelect(e){if(e.selected.length>0){let t=e.selected[0],a=n["a"].omitFromObject(t.getProperties(),["geometry"]),i=t.getId()||"Feature Properties";this.emit("showDataModal",a,i)}},createGeoJsonSource(e,t){let a=[];return n["a"].detectGeoJson(e)&&(a=(new h["a"]).readFeatures(e,{featureProjection:t})),new u["a"]({features:a,wrapX:!1})}}},m=p,g=a("2877"),f=Object(g["a"])(m,i,s,!1,null,null,null);t["a"]=f.exports},4749:function(e,t,a){"use strict";var i=function(){var e=this,t=e.$createElement,a=e._self._c||t;return e.texts.length>0?a("div",{staticClass:"ol-unselectable ol-control value",class:{pointer:e.texts.length>1},on:{click:e.toggle}},[e._v(" "+e._s(e.current)+" ")]):e._e()},s=[],n=a("96a2"),r={name:"TextControl",mixins:[n["a"]],data(){return{i:0}},computed:{texts(){return Array.isArray(this.text)?this.text:"string"===typeof this.text&&this.text.length>0?[this.text]:[]},current(){return 0===this.texts.length?"":this.texts[this.i%this.text.length]}},props:{text:{text:[String,Array],default:""}},methods:{toggle(){this.i++}}},o=r,l=(a("2d6d"),a("2877")),h=Object(l["a"])(o,i,s,!1,null,"fe2bcd86",null);t["a"]=h.exports},"4bc5":function(e,t,a){"use strict";var i=a("3115"),s=a("025e"),n=(a("5bc0"),a("c320")),r=a("9d47"),o=a("21bc"),l=a("5eee"),h=a("a2c7"),d=a("256f"),c=a("f5dd"),u=a("601e"),p=a("480c"),m=a("2ef1"),g=(a("1399"),a("0417")),f=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:e.show,expression:"show"}],staticClass:"ol-unselectable ol-progress-control"},[a("div",{staticClass:"progress-bar"},[a("div",{staticClass:"progress-bar-inner",style:{width:e.percent}})]),a("div",{staticClass:"progress-label"},[e._v(e._s(e.label))])])},y=[],w=a("96a2"),b={name:"ProgressControl",mixins:[w["a"]],data(){return{loading:0,loaded:0}},computed:{show(){return this.loading>0&&this.loaded<=this.loading},percent(){return(this.loaded/this.loading*100).toFixed(1)+"%"},label(){return"Loading Tiles ("+this.percent+")"}},methods:{addLoading(){this.loading++,this.update()},addLoaded(){this.loaded++,this.update()},update(){this.loading===this.loaded&&(this.loading=0,this.loaded=0),this.loading===this.loaded&&(this.loading=0,this.loaded=0)}}},v=b,x=(a("2e68"),a("2877")),S=Object(x["a"])(v,f,y,!1,null,"1da4d958",null),L=S.exports;let T=1;var C,M,j={components:{ProgressControl:L},mixins:[i["a"]],props:{show:{type:Boolean,default:!0},editable:{type:Boolean,default:!0},removableLayers:{type:Boolean,default:!1}},data(){return{map:null,id:"map_"+T++}},watch:{async show(){await this.showMap()}},computed:{...s["a"].mapState(["userLocation","locationZoom"])},async mounted(){await this.showMap()},methods:{async showMap(){this.show&&(await this.$nextTick(),await this.renderMap())},async createMap(e="EPSG:3857"){let t,a={showFullExtent:!0};if("string"===typeof e?a.projection=await u["a"].get(e):e instanceof c["a"]?a.projection=e:e instanceof h["a"]?t=e:s["a"].isObject(e)&&(a=e),t||(t=new h["a"](a),t.getCenter()||t.setCenter(Object(d["j"])([this.userLocation[1],this.userLocation[0]],t.getProjection())),t.getZoom()||t.setZoom(this.locationZoom)),null!==this.map)return this.map.updateSize(),void this.map.render();var i=[new n["a"],new r["a"]],p={target:this.id,view:t};this.editable?p.controls=Object(o["a"])().extend(i):(p.interactions=[],p.controls=i),this.map=new l["a"](p),this.listen("windowResized",this.updateMapSize);let m=this.map.getLayers();m.on("add",e=>{let t=e.element,a=t.get("events");for(let i in a)this.map.on(i,a[i])}),m.on("remove",e=>{let t=e.element,a=t.get("events");for(let i in a)this.map.un(i,a[i])})},addLayerSwitcher(){this.map.addControl(new g["a"]({trash:this.removableLayers}))},addBasemaps(){let e={opaque:!0,attributionsCollapsible:!1,wrapX:!1},t=[];if(Array.isArray(this.$config.basemaps)){let a=!1;for(let i of this.$config.basemaps){let s=new m["a"](Object.assign({},e,i)),n=new p["a"]({source:this.trackTileProgress(s),baseLayer:!0,title:i.title,noSwitcherDelete:!0,visible:!a});t.push(n),this.map.addLayer(n),a=!0}}return t},onShow(){this.listen("windowResized",this.updateMapSize)},onHide(){this.unlisten("windowResized")},async renderMap(){await this.createMap(),this.addBasemaps()},async updateMapSize(){this.map&&(await this.$nextTick(),this.map.updateSize())},addLayerToMap(e){e.set("userLayer",!0),this.map.addLayer(e)},removeLayerFromMap(e){let t=this.getLayerFromMap(e);t&&this.map.removeLayer(t)},getLayerFromMap(e){let t=this.map.getLayers().getArray();for(let a of t)if(a.get("id")===e)return a;return null},getVisibleLayers(){let e=[],t=this.map.getLayers().getArray();for(let a of t)a.get("userLayer")&&a.getVisible()&&e.push(a);return e},getFitOptions(e=25){let t={};var a=this.map.getSize();return t.padding=a&&e>0?[a[0]*e/100,a[1]*e/100,a[0]*e/100,a[1]*e/100]:[30,30,30,30],t},trackTileProgress(e){return this.$refs.progress&&(e.on("tileloadstart",()=>{this.$refs.progress.addLoading()}),e.on("tileloadend",()=>{this.$refs.progress.addLoaded()}),e.on("tileloaderror",()=>{this.$refs.progress.addLoaded()})),e},fromLonLat(e){return Object(d["j"])(e,this.map.getView().getProjection())}}},G=j,_=Object(x["a"])(G,C,M,!1,null,null,null);t["a"]=_.exports},"4ed6":function(e,t,a){},"5ee8":function(e,t,a){},6253:function(e,t,a){"use strict";a("5ee8")},"63a9":function(e,t,a){"use strict";a("1416")},9115:function(e,t,a){"use strict";a.r(t);var i,s,n,r,o=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{staticClass:"map-viewer",attrs:{id:e.id}},[a("ProgressControl",{ref:"progress",attrs:{map:e.map}}),e.textControlText?a("TextControl",{attrs:{text:e.textControlText}}):e._e(),e.isGeoTiff&&!e.colorMap?a("ChannelControl",{attrs:{bands:e.bands},on:{update:e.updateGeoTiffStyle}}):e._e(),e.loading?a("div",{staticClass:"map-loading"},[a("i",{staticClass:"fas fa-spinner fa-spin"}),a("span",[e._v("Loading map...")])]):e._e()],1)},l=[],h=(a("d9e2"),a("025e")),d=a("57f6"),c=a("e979"),u=a("f032"),p=a("4749"),m=function(){var e=this,t=e.$createElement,a=e._self._c||t;return a("div",{directives:[{name:"show",rawName:"v-show",value:e.channels.length>0,expression:"channels.length > 0"}],staticClass:"ol-unselectable ol-control channels"},[a("table",[a("thead",[a("tr",[e.isGray?e._e():a("th",[e._v("Channel")]),e.isGray?e._e():a("th",[e._v("Band")]),a("th",[e._v("Min")]),a("th",[e._v("Max")])])]),a("tbody",e._l(e.channels,(function(t,i){return a("tr",{key:i},[e.isGray?e._e():a("th",[e._v(e._s(e.labels[i]))]),e.isGray?e._e():a("td",[a("select",{directives:[{name:"model",rawName:"v-model.number",value:t.id,expression:"channel.id",modifiers:{number:!0}}],on:{change:function(a){var i=Array.prototype.filter.call(a.target.options,(function(e){return e.selected})).map((function(t){var a="_value"in t?t._value:t.value;return e._n(a)}));e.$set(t,"id",a.target.multiple?i:i[0])}}},e._l(e.bands,(function(t){return a("option",{key:t.id,domProps:{value:t.id}},[e._v(e._s(t.name||t.id))])})),0)]),a("td",[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.min,expression:"channel.min",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:t.min},on:{input:function(a){a.target.composing||e.$set(t,"min",e._n(a.target.value))},blur:function(t){return e.$forceUpdate()}}})]),a("td",[a("input",{directives:[{name:"model",rawName:"v-model.number",value:t.max,expression:"channel.max",modifiers:{number:!0}}],attrs:{type:"number",required:""},domProps:{value:t.max},on:{input:function(a){a.target.composing||e.$set(t,"max",e._n(a.target.value))},blur:function(t){return e.$forceUpdate()}}})])])})),0)])])},g=[],f=a("96a2"),y={name:"ChannelControl",mixins:[f["a"]],props:{bands:{type:Array,default:()=>[]}},computed:{isGray(){return 1===this.bands.length},labels(){return this.isGray?["Grayscale"]:["Red","Green","Blue"]}},data(){return{channels:[]}},watch:{bands:{immediate:!0,handler(){this.channels=this.bands.slice(0,3).map(e=>Object.assign({},e)),2===this.channels.length&&this.channels.push(Object.assign({},this.channels[1]))}},channels:{deep:!0,handler(){this.channels.filter(e=>this.isValid(e.min)&&this.isValid(e.max)).length>0&&this.$emit("update","channels",this.channels)}}},methods:{isValid(e){return"number"===typeof e}}},w=y,b=(a("6253"),a("2877")),v=Object(b["a"])(w,m,g,!1,null,null,null),x=v.exports,S=a("3dcb"),L=a("d89f"),T={components:{ChannelControl:x,TextControl:p["a"]},data(){return{textControlText:"Pixel Value: -",hasStyle:!1,layer:null,source:null,colorMap:null,noData:[],channels:[],bands:[]}},computed:{glStyleVars(){let e={};for(let t in this.channels){let a=this.channels[t];e[t+"band"]=a.id,e[t+"min"]=a.min,e[t+"max"]=a.max}return e}},methods:{getBandVar(e){return["band",["var",e+"band"]]},getFormula(e){let t=["var",e+"min"],a=["var",e+"max"],i=this.getBandVar(e),s=["*",["/",["-",i,t],["-",a,t]],255];return["clamp",s,0,255]},getNoDataFormula(){let e=["band",this.bands.length+1];return["case",["==",e,0],0,1]},async addGeoTiff(e,t="GeoTiff"){this.bands=e.getBands(),this.colorMap=e.getColorMap(),this.noData=e.getNoData(),this.source=new L["a"]({interpolate:!1,normalize:!1,convertToRGB:e.convertToRGB,sources:[{url:e.getUrl(),nodata:this.noData[0]}]}),this.layer=new S["a"]({id:e.getUrl(),title:t,source:this.source,cacheSize:2048}),this.layer.set("events",{pointermove:e=>{let t=this.layer.getData(e.pixel),a=h["a"].displayRGBA(t,this.noData,this.noData.length>0),i="Pixel Value: "+a;this.textControlText=[i,`${i} @ ${e.coordinate.map(e=>String(e.toFixed(6)).replace(/0+$/,"")).join(", ")}`]}}),this.addLayerToMap(this.layer);let a=e.getExtent();return a&&this.map.getView().fit(a,this.getFitOptions(10)),this.colorMap&&this.setStyle(),this.source},updateGeoTiffStyle(e,t){switch(e){case"channels":this.channels=t;break}this.setStyle()},setStyle(){if(this.layer)if(this.hasStyle)this.layer.updateStyleVariables(this.glStyleVars);else{let e=[];if(this.colorMap)e.push("palette"),e.push(["band",1]),e.push(this.colorMap);else{if(0===this.channels.length)return null;if(1===this.channels.length){e.push("color");let t=this.getFormula(0);e.push(t),e.push(t),e.push(t),this.noData.length>0&&e.push(this.getNoDataFormula())}else e.push("color"),e.push(this.getFormula(0)),e.push(this.getFormula(1)),e.push(this.getFormula(2)),this.noData.length>0&&e.push(this.getNoDataFormula())}let t={variables:this.glStyleVars,color:e};this.layer.setStyle(t),this.hasStyle=!0}}}},C=T,M=Object(b["a"])(C,i,s,!1,null,null,null),j=M.exports,G=a("4bc5"),_=a("e300"),D=a("9c78"),O=a("480c"),F=a("2ef1"),P=a("2278"),V=a("d510"),$=(a("6601"),a("457f")),E={data(){return{WMTSCapabilities:{},timeline:null}},methods:{async addWebService(e){switch(e.type.toLowerCase()){case"xyz":return this.updateXYZLayer(e);case"wmts":return await this.updateWMTSLayer(e);default:return h["a"].error(this,"Sorry, this web service type is not supported."),null}},getWMTSTimes(e,t){const a=e.Contents.Layer||[];let i=a.find(e=>e.Identifier==t);if(!i||!i.Dimension)return[];let s=i.Dimension.find(e=>"TIME"===e.Identifier);return s?s.Value.sort():[]},async initWMTSLayer(e){if(!this.WMTSCapabilities[e.url])try{let a=new URL(e.url);a.searchParams.set("service","wmts"),a.searchParams.set("request","GetCapabilities");let i=await axios.get(a.toString(),{responseType:"text"});var t=new P["a"];this.WMTSCapabilities[e.url]=t.read(i.data)}catch(error){h["a"].exception(this,error,"WMTS Discovery failed")}return this.WMTSCapabilities[e.url]},async updateWMTSLayer(e,t="Service"){let a=e.attributes||{},i=await this.initWMTSLayer(e);i||h["a"].exception(this,error,"WMTS Discovery failed");let s,n=null,r=null,o=null,l=null,d=h["a"].getResourceTitle(e,t),c=new _["a"];Array.isArray(a.layers)?s=a.layers:Array.isArray(i.Contents.Layer)&&(s=layers.map(e=>e.Identifier));for(let m of s){if(!m)continue;let t=Object(V["b"])(i,{layer:m,matrixSet:"EPSG:3857"});o||(o=new Date(t.dimensions.TIME));let s=this.getWMTSTimes(i,m);if(s.length){let e=new Date(s[0]),t=new Date(s[s.length-1]);(!n||e<n)&&(n=e),(!r||t>r)&&(r=t)}h["a"].isObject(a.dimensions)&&Object.assign(t.dimensions,e.attributes.dimensions),l=new V["a"](t);var u=new O["a"]({title:d,source:this.trackTileProgress(l),noSwitcherDelete:!0});c.push(u)}if(n&&r){let e;this.timeline=new $["a"]({className:"ol-pointer",graduation:"day",minDate:n,maxDate:r}),this.timeline.on("scroll",(function(t){!t.date||t.date>r||t.date<n||(e&&window.clearTimeout(e),e=window.setTimeout(()=>{try{let e=t.date.toISOString().substr(0,10);l.updateDimensions({TIME:e});let a=document.getElementsByClassName("timeline-date-label");a[0].innerText=e,a[0].disabled=!0}catch(error){console.log(error)}e=null},500))})),this.map.addControl(this.timeline),this.timeline.addButton({className:"timeline-date-label",title:`The date that is shown on the map for the collection '${d}'`,html:"No date"}),this.timeline.setDate(o)}let p=new D["b"]({id:e.id,title:d,layers:c});return p.on("change:visible",()=>{this.timeline&&this.timeline.element&&(this.timeline.element.style.display=p.getVisible()?"block":"none")}),this.addLayerToMap(p),this.timeline&&this.map.getLayers().on("remove",e=>{e.element===p&&(this.map.removeControl(this.timeline),this.timeline=null)}),p},updateXYZLayer(e,t="Service"){let a=h["a"].replaceParam(e.url,"__editorSessionId",(new Date).getTime()).replace(/%7B/g,"{").replace(/%7D/g,"}"),i=h["a"].getResourceTitle(e,t),s=new O["a"]({title:i,source:this.trackTileProgress(new F["a"]({url:a})),noSwitcherDelete:!0}),n=new D["b"]({id:e.id,title:i,layers:[s]});return this.addLayerToMap(n),n}}},B=E,W=Object(b["a"])(B,n,r,!1,null,null,null),A=W.exports,k=a("2b70"),N=a("4cdf"),J=a("5bc3"),z=a("3e6b"),R=a("5831"),I={name:"MapViewer",mixins:[u["a"],j,G["a"],A],props:{data:{}},data(){return{loading:!0}},computed:{...h["a"].mapState(["connection"]),isWebService(){return this.data instanceof k["Service"]&&"string"===typeof this.data.type},isGeoTiff(){return this.data instanceof d["a"]},isGeoJson(){return this.data instanceof c["a"]&&this.data.isGeoJson}},methods:{async renderMap(){try{let e,t;if(this.isGeoJson)t=await this.data.getData(this.connection);else if(this.isGeoTiff){t=await this.data.getData(this.connection);let a=t.getProjection();a&&(e=a)}else{if(!this.isWebService||!h["a"].isMapServiceSupported(this.data.type))throw new Error("Sorry, the given data can't be shown on a web map.");if("wmts"===this.data.type.toLowerCase()){await this.initWMTSLayer(this.data)}}if(await this.createMap(e),this.addLayerSwitcher(),this.isGeoJson)this.addBasemaps(),this.addGeoJson(t,!0);else if(this.isGeoTiff){let e=this.map.getView().getProjection();(e.basemap||["EPSG:3857","EPSG:4326"].includes(e.getCode()))&&this.addBasemaps();let a=this.data.getContext();a&&this.addExtent(a,!1),this.addGeoTiff(t)}else this.isWebService&&h["a"].isMapServiceSupported(this.data.type)&&(this.addBasemaps(),this.addWebService(this.data));this.$listeners&&this.$listeners.drop&&(this.map.getViewport().addEventListener("dragover",e=>e.preventDefault()),this.map.getViewport().addEventListener("drop",this.$listeners.drop))}catch(error){h["a"].exception(this,error)}this.loading=!1},async addCollection(){let e=this.showWebService(this.data);try{let t=service.attributes.bbox,a=[...this.fromLonLat([t.west,t.south]),...this.fromLonLat([t.east,t.north])],i=new z["a"]({title:"Extent",noSwitcherDelete:!0,source:new R["a"]({features:[new N["a"](Object(J["c"])(a))],projection:"EPSG:4326",wrapX:!1})});this.removeLayerFill(i),e.getLayers().push(i),this.map.getView().fit(a,this.getFitOptions(10))}catch(error){console.log(error)}}}},X=I,Z=(a("63a9"),a("1e9c"),Object(b["a"])(X,o,l,!1,null,null,null));t["default"]=Z.exports},"96a2":function(e,t,a){"use strict";var i,s,n=a("3900"),r={props:{map:{type:Object}},data(){return{control:null}},mounted(){this.control=new n["a"]({element:this.$el})},watch:{map(e){e&&this.map.addControl(this.control)}},methods:{getControl(){return this.control}}},o=r,l=a("2877"),h=Object(l["a"])(o,i,s,!1,null,null,null);t["a"]=h.exports},f032:function(e,t,a){"use strict";var i,s,n=a("330e"),r=a("025e"),o=a("4cdf"),l=a("5bc3"),h=a("3e6b"),d=a("5831"),c={mixins:[n["a"]],methods:{async addExtent(e,t=!0){let a=null;a=r["a"].isObject(e)?"Collection"===e.type?e.extent.spatial.bbox.map(e=>r["a"].extentToBBox(e)):"Feature"!==e.type||e.geometry||e.bbox?e:null:e,Array.isArray(a)&&a.length>0?this.addRectangles(a,t):a&&this.addGeoJson(a,!1,"Footprint",t)},addRectangles(e,t=!0){let a=this.map.getView().getProjection(),i=e.map(e=>{let t=Object(l["c"])([e.west,e.south,e.east,e.north]).transform("EPSG:4326",a);return new o["a"](t)}),s=new d["a"]({features:i,projection:a,wrapX:!1}),n=new h["a"]({title:"Bounding Boxes",displayInLayerSwitcher:!1,source:s});return t||this.removeLayerFill(n),this.map.addLayer(n),this.map.getView().fit(s.getExtent(),this.getFitOptions()),n},removeLayerFill(e){let t=e.getStyle();"function"===typeof t&&(t=t()[0]),t.setFill(null)}}},u=c,p=a("2877"),m=Object(p["a"])(u,i,s,!1,null,null,null);t["a"]=m.exports},ffc9:function(e,t,a){}}]);
//# sourceMappingURL=chunk-2dc2e4e7.d53f28c7.js.map