{"version":3,"sources":["webpack:///./node_modules/ol-ext/control/LayerSwitcher.js","webpack:///./node_modules/ol/CollectionEventType.js","webpack:///./node_modules/ol/Feature.js","webpack:///./node_modules/ol-ext/util/input/Base.js","webpack:///./node_modules/ol-ext/util/input/Checkbox.js","webpack:///./node_modules/ol-ext/util/input/Switch.js","webpack:///./node_modules/ol-ext/util/input/Radio.js","webpack:///./node_modules/ol-ext/util/element.js","webpack:///./node_modules/ol/AssertionError.js","webpack:///./node_modules/ol-ext/util/ext.js","webpack:///./node_modules/ol-ext/control/Toggle.js","webpack:///./node_modules/ol-ext/control/TextButton.js","webpack:///./node_modules/ol-ext/interaction/Delete.js","webpack:///./node_modules/ol-ext/geom/GeomUtils.js","webpack:///./node_modules/ol-ext/style/defaultStyle.js","webpack:///./node_modules/ol-ext/interaction/Offset.js","webpack:///./node_modules/ol-ext/geom/LineStringSplitAt.js","webpack:///./node_modules/ol-ext/interaction/Split.js","webpack:///./node_modules/ol-ext/interaction/Transform.js","webpack:///./node_modules/ol-ext/interaction/ModifyFeature.js","webpack:///./node_modules/ol-ext/interaction/DrawRegular.js","webpack:///./node_modules/ol-ext/interaction/DrawHole.js","webpack:///./node_modules/ol-ext/control/EditBar.js","webpack:///./node_modules/ol-ext/source/Vector.js","webpack:///./node_modules/ol-ext/interaction/UndoRedo.js","webpack:///./node_modules/ol/Disposable.js","webpack:///./node_modules/ol/Collection.js","webpack:///./node_modules/ol-ext/control/Button.js","webpack:///./node_modules/ol-ext/control/Bar.js"],"names":["ol_control_LayerSwitcher","options","element","self","this","dcount","show_progress","oninfo","onextent","hasextent","extent","hastrash","trash","reordering","_layers","_layerGroup","layerGroup","getLayers","onchangeCheck","displayInLayerSwitcher","target","create","className","switcherClass","collapsed","classList","add","button","type","parent","addEventListener","e","toggle","dispatchEvent","contains","preventDefault","overflow","mouseover","remove","minibar","noScroll","topv","click","botv","_noScroll","panel_","panelContainer_","html","addListener","Math","max","min","wheelDelta","detail","stopPropagation","header_","call","set","drawDelay","selection","setTimeout","mbar","scrollDiv","mousewheel","vertical","on","refresh","bind","prototype","tip","up","down","info","plus","layer","get","setMap","map","drawPanel","_listener","i","moveend","viewChange","size","change","getLayerGroup","show","hide","isOpen","setHeader","setHTML","dir","hidden","setStyle","height","h","outerHeight","hp","dh","offsetTop","top","li","querySelectorAll","lh","getStyle","round","_setLayerForLI","listeners","push","setLayerOpacity","setLayerVisibility","key","querySelector","style","left","getOpacity","checked","getVisible","_clearLayerForLI","forEach","l","_getLayerForLI","testLayerVisibility","getPanel","getMap","drawPanel_","dragging_","scrollTop","drawList","switchLayerVisibility","layers","setVisible","res","getView","getResolution","zoom","getZoom","getMaxResolution","getMinResolution","getMinZoom","getMaxZoom","ex0","getExtent","ex","calculateExtent","getSize","dragOrdering_","pageY","dragElt","group","elt","currentTarget","parentNode","start","panel","pageY0","touches","length","changedTouches","stop","drop","isSelected","getSelection","collection","getArray","removeAt","j","insertAt","selectLayer","removeListener","document","move","abs","innerHTML","position","offsetLeft","opacity","width","outerWidth","offsetRect","elementFromPoint","clientX","clientY","tagName","dragOpacity_","x","pageX","delta","nextElementSibling","setOpacity","ul","setVisibility","onInfo","zoomExtent","fit","removeLayer","getLength","createLi","_selectedLayer","layer_buttons","d","label","title","unselectable","userSelect","nb","p","setprogress_","layerswitcher_progress","op","offsetX","ul2","getLayerClass","getFeatures","silent","item","loaded","loading","draw","toFixed","getSource","ADD","REMOVE","__extends","extendStatics","b","Object","setPrototypeOf","__proto__","Array","hasOwnProperty","TypeError","String","__","constructor","Feature","_super","opt_geometryOrProperties","_this","once","un","id_","undefined","geometryName_","style_","styleFunction_","geometryChangeKey_","addChangeListener","handleGeometryChanged_","geometry","setGeometry","properties","setProperties","clone","hasProperties","getProperties","setGeometryName","getGeometryName","getGeometry","getId","getStyleFunction","handleGeometryChange_","changed","CHANGE","opt_style","createStyleFunction","setId","id","name","removeChangeListener","obj","styles_1","isArray","window","ol","ext","input","ol_ext_input_Base","ol_Object","tout","createElement","setAttribute","step","appendChild","disabled","val","value","display","clearTimeout","_listenDrag","cback","handle","moving","listen","removeEventListener","setValue","v","Event","getValue","getInputElement","ol_ext_input_Checkbox","Element","trim","insertBefore","after","createTextNode","isChecked","ol_ext_input_Switch","ol_ext_input_Radio","ol_ext_element","attr","test","innerText","text","opt","assign","eventType","fn","useCapture","split","el","st","s","styleProp","defaultView","ownerDocument","getComputedStyle","replace","toLowerCase","getPropertyValue","currentStyle","str","letter","toUpperCase","oldLeft","oldRsLeft","runtimeStyle","pixelLeft","parseInt","offsetHeight","offsetWidth","rect","getBoundingClientRect","pageYOffset","documentElement","body","pageXOffset","scrollLeft","bottom","right","offset","getOffset","r","offsetParent","fixed","gleft","gtop","getRect","scale","isbar","scrollContainer","scrollbar","pos","speed","dt","onmove","page","scroll","updateCounter","updateMinibar","updateMinibarDelay","pheight","clientHeight","scrollHeight","onPointerDown","Date","onPointerMove","onPointerUp","animate","to","init","onMouseWheel","eventName","event","CustomEvent","createEvent","initCustomEvent","AssertionError","code","path","message","Error","ol_ext_inherits","child","inherits","NodeList","removeChild","ol_control_Toggle","interaction_","interaction","setActive","active","getActive","toggleFn","onToggle","handleClick","autoActivate","bar","setSubBar","setDisable","disable","removeInteraction","subbar_","removeControl","addInteraction","addControl","getSubBar","setTarget","getDisable","oldValue","setInteraction","getInteraction","ol_control_TextButton","ol_interaction_Delete","clear","delete","selected","_getSources","sources","concat","features","delFeatures","source","f","removeFeature","ol_extent_intersection","ol_coordinate_dist2d","p1","p2","dx","dy","sqrt","ol_coordinate_equal","ol_coordinate_offsetCoords","coords","mi","mi1","li1","ri","ri1","si","si1","Xi1","Yi1","p0","N","isClosed","pop","ol_coordinate_findSegment","pt","index","segment","d0","v0","d1","v1","splitX","pts","splice","splitY","y","polygon","poly","getType","geom","getCoordinates","g","c","ol_coordinate_sampleAt","dl","sampleAt","line","result","lines","mpoly","a","intersection","resolution","ol_extent","getCenter","getRadius","simplify","hasout","ring","console","warn","ol_style_Style_defaultStyle","white","blue","defaultEditStyle","stroke","color","image","radius","fill","edit","fillColor","ol_interaction_Offset","handleDownEvent","handleDownEvent_","handleDragEvent","handleDragEvent_","handleMoveEvent","handleMoveEvent_","handleUpEvent","handleUpEvent_","_filter","filter","features_","layers_","duplicate","source_","_style","previousCursor_","getFeatureAtPixel_","forEachFeatureAtPixel","pixel","feature","current","typeGeom","getClosestPoint","coordinate","frameState","viewState","hit","coordinates","geomType","hitTolerance","current_","currentStyle_","originalEvent","ctrlKey","addFeature","_modifystart","seg","v2","getTargetElement","cursor","splitAt","tol","k","getFirstCoordinate","getLastCoordinate","c0","ci","d2","ol_interaction_Split","handleEvent","snapDistance_","snapDistance","tolerance_","tolerance","cursor_","setSources","sources_","filterSplit_","sketchStyle","featureStyle","overlayLayer_","useSpatialIndex","_sketch_","getSources","unshift","getClosestFeature","fi","getClosestFeatureToCoordinate","gi","di","coord","getNearestCoord","getPixelFromCoordinate","link","dm","Number","MAX_VALUE","evt","tosplit","original","linkGeometry","ol_interaction_Transform","selection_","handles_","wrapX","_handleEvent","condition","addFn_","addCondition","setPointRadius","pointRadius","translateFeature","translate","translateBBox","stretch","rotate","keepAspectRatio","shiftKey","modifyCenter","metaKey","noFlip","enableRotatedTransform","keepRectangle","drawSketch_","setDefaultStyle","projectVectorOnVector","displacement_vector","base","countVector","end","movePoint","point","displacementVector","Cursors","oldMap","targetElement","select","isTouch","getViewport","pointStroke","strokedash","lineDash","fill0","pointFill","circle","displacement","points","setDisplacement","getAnchor","bigpt","angle","PI","smallpt","createStyle","img","olstyle","im","getImage","setScale","tx","getText","setOffsetX","found","bbox_","constraint","option","some","getGeometryRotateToZero_","origGeom","viewRotation","getRotation","rotGeom","_isRectangle","center","slice","extendExt","ptRadius","_pointRadius","ispt_","center_","getCoordinateFromPixel","iscircle_","addFeatures","indexOf","watchFeatures_","setSelection","_featureListeners","isUpdating_","sel","mode_","opt_","constraint_","coordinate_","pixel_","geoms_","rotatedGeoms_","rotExtent","extent_","rotatedExtent_","rotate0","angle_","atan2","setCenter","pt0","ispt","setCenterAndRadius","deltaX","deltaY","extentCoordinates","downCoordinate","dragCoordinate","downPoint","dragPoint","scx","scy","centerPoint","applyTransform","g1","g2","dim","pointArray","pointA","pointB","pointC","pointD","pointA1","projectedVector","nextIndex","coordsToChange","includes","projectedLeft","projectedRight","default","oldgeom","oldgeoms","ol_interaction_ModifyFeature","dragging","modifying","_deleteCondition","pixelTolerance","_condition","deleteCondition","_insertVertexCondition","insertVertexCondition","setFilter","currentFeature","deselected","dist","lstring","getLineStrings","lring","getLinearRings","getPolygons","getGeometries","getArcs","arcs","coord1","coord2","node","shift","c1","nbpt","closed","typeg","error","getFeaturesInExtent","_modifiedFeatures","_removePoint","getModifiedFeatures","removePoint","_getModification","geoms","setGeometries","setCoordinates","setArcCoordinates","getCurrentFeature","ol_interaction_DrawRegular","squaredClickTolerance_","clickTolerance","maxCircleCoordinates_","maxCircleCoordinates","conditionFn_","squareFn_","squareCondition","centeredFn_","centerCondition","canRotate_","canRotate","geometryName","setSides","sides","defaultStyle","sketch_","handleEvent_","reset","started_","sides_","getSides","startAngle","3","4","getGeom_","coord_","dmax","centerPx","square_","centered_","coordPx_","hasrotation","sc","sign","t","feature_","drawPoint_","noclear","_eventTime","downPx_","start_","_longTouch","lastEvent","end_","upPx_","finishDrawing","startCoordinate","square","centered","ol_interaction_DrawHole","_select","geometryFn","geomFn","geometryFunction","_geometryFn","_features","featureFilter","_startDrawing","_finishDrawing","removeLastPoint","_feature","getPolygon","_polygon","_current","intersectsCoordinate","_polygonIndex","layerFilter","hole","pi","newGeom","appendLinearRing","appendPolygon","lastOKCoord","ol_control_EditBar","interactions","toggleOne","_source","_interactions","_setSelectInteraction","edition","_setEditInteraction","_setModifyInteraction","Delete","ModifySelect","_getTitle","selectCtrl","sbar","del","mapBrowserEvent","Info","Select","getControls","DrawPoint","pedit","DrawLine","nbpts","ledit","controls","UndoDraw","FinishDraw","DrawPolygon","_setDrawPolygon","DrawHole","DrawRegular","ptsLabel","circleLabel","regular","div","textContent","ctrl","fedit","Transform","transform","Split","Offset","opt_fast","ol_interaction_UndoRedo","_undoStack","_redoStack","_undo","_redo","level","_level","view","action","_reduce","_doShift","_doClear","_block","_record","_defs","define","undoFn","redoFn","undo","redo","setMaxLength","setMaxSize","getStack","prop","custom","_mapListener","blockStart","blockEnd","_watchSources","_watchInteractions","_sourceListener","getVectorLayers","vectors","_onAddRemove","_interactionListener","getInteractions","_onInteraction","setattributestart","newp","oldp","newProperties","oldProperties","rotatestart","translatestart","scalestart","modifystart","m","oldGeom","beforesplit","deletestart","aftersplit","deleteend","_handleDo","unset","hasUndo","hasRedo","Disposable","disposed","dispose","disposeInternal","Property","LENGTH","CollectionEvent","opt_element","opt_index","Collection","opt_array","opt_options","unique_","unique","array_","ii","assertUnique_","updateLength_","extend","arr","array","elem","n","prev","setAt","opt_except","ol_control_Button","bt","button_","evtFunction","firstElementChild","setTitle","setHtml","getButtonElement","ol_control_Bar","classes","apply","autoDeactivate","controls_","setPosition","onActivateControl_","deactivateControls","except","getActiveControls","sb","ctrls","getControlsByName","control"],"mappings":"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","file":"js/chunk-d5a1c680.f077ed34.js","sourcesContent":["/*\tCopyright (c) 2015 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\nimport ol_control_Control from 'ol/control/Control'\r\nimport ol_layer_Tile from 'ol/layer/Tile'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_layer_VectorTile from 'ol/layer/VectorTile'\r\n// ol < 6 compatibility VectorImage is not defined\r\n// import ol_layer_VectorImage from 'ol/layer/VectorImage'\r\nimport ol_layer_Image from 'ol/layer/Image'\r\nimport ol_layer_Heatmap from 'ol/layer/Heatmap'\r\nimport {intersects as ol_extent_intersects} from 'ol/extent'\r\n\r\nimport ol_ext_element from '../util/element'\r\n\r\n/** Layer Switcher Control.\r\n * @fires select\r\n * @fires drawlist\r\n * @fires toggle\r\n * @fires reorder-start\r\n * @fires reorder-end\r\n * @fires layer:visible\r\n * @fires layer:opacity\r\n * \r\n * @constructor\r\n * @extends {ol_control_Control}\r\n * @param {Object=} options\r\n *  @param {boolean} options.selection enable layer selection when click on the title\r\n *  @param {function} options.displayInLayerSwitcher function that takes a layer and return a boolean if the layer is displayed in the switcher, default test the displayInLayerSwitcher layer attribute\r\n *  @param {boolean} options.show_progress show a progress bar on tile layers, default false\r\n *  @param {boolean} options.mouseover show the panel on mouseover, default false\r\n *  @param {boolean} options.reordering allow layer reordering, default true\r\n *  @param {boolean} options.trash add a trash button to delete the layer, default false\r\n *  @param {function} options.oninfo callback on click on info button, if none no info button is shown DEPRECATED: use on(info) instead\r\n *  @param {boolean} options.extent add an extent button to zoom to the extent of the layer\r\n *  @param {function} options.onextent callback when click on extent, default fits view to extent\r\n *  @param {number} options.drawDelay delay in ms to redraw the layer (usefull to prevent flickering when manipulating the layers)\r\n *  @param {boolean} options.collapsed collapse the layerswitcher at beginning, default true\r\n *  @param {ol.layer.Group} options.layerGroup a layer group to display in the switcher, default display all layers of the map\r\n *  @param {boolean} options.noScroll prevent handle scrolling, default false\r\n *  @param {function} options.onchangeCheck optional callback on click on checkbox, you can call this method for doing operations after check/uncheck a layer\r\n *\r\n * Layers attributes that control the switcher\r\n *\t- allwaysOnTop {boolean} true to force layer stay on top of the others while reordering, default false\r\n *\t- displayInLayerSwitcher {boolean} display the layer in switcher, default true\r\n *\t- noSwitcherDelete {boolean} to prevent layer deletion (w. trash option = true), default false\r\n */\r\nvar ol_control_LayerSwitcher = function(options) {\r\n  options = options || {};\r\n  var self = this;\r\n  this.dcount = 0;\r\n  this.show_progress = options.show_progress;\r\n  this.oninfo = (typeof (options.oninfo) == \"function\" ? options.oninfo: null);\r\n  this.onextent = (typeof (options.onextent) == \"function\" ? options.onextent: null);\r\n  this.hasextent = options.extent || options.onextent;\r\n  this.hastrash = options.trash;\r\n  this.reordering = (options.reordering!==false);\r\n  this._layers = [];\r\n  this._layerGroup = (options.layerGroup && options.layerGroup.getLayers) ? options.layerGroup : null;\r\n  this.onchangeCheck = (typeof (options.onchangeCheck) == \"function\" ? options.onchangeCheck : null);\r\n\r\n  // displayInLayerSwitcher\r\n  if (typeof(options.displayInLayerSwitcher) === 'function') {\r\n    this.displayInLayerSwitcher = options.displayInLayerSwitcher;\r\n  }\r\n\r\n  var element;\r\n  if (options.target) {\r\n    element = ol_ext_element.create('DIV', {\r\n      className: options.switcherClass || \"ol-layerswitcher\"\r\n    });\r\n  } else {\r\n    element = ol_ext_element.create('DIV', {\r\n      className: (options.switcherClass || \"ol-layerswitcher\") +' ol-unselectable ol-control'\r\n    });\r\n    if (options.collapsed !== false) element.classList.add('ol-collapsed'); \r\n    else element.classList.add('ol-forceopen'); \r\n  \r\n    this.button = ol_ext_element.create('BUTTON', {\r\n      type: 'button',\r\n      parent: element\r\n    });\r\n    this.button.addEventListener('touchstart', function(e){\r\n      element.classList.toggle('ol-forceopen');\r\n      element.classList.add('ol-collapsed');\r\n      self.dispatchEvent({ type: 'toggle', collapsed: element.classList.contains('ol-collapsed') });\r\n      e.preventDefault(); \r\n      self.overflow();\r\n    });\r\n    this.button.addEventListener('click', function() {\r\n      element.classList.toggle('ol-forceopen');\r\n      element.classList.add('ol-collapsed'); \r\n      self.dispatchEvent({ type: 'toggle', collapsed: !element.classList.contains('ol-forceopen') });\r\n      self.overflow();\r\n    });\r\n\r\n    if (options.mouseover) {\r\n      element.addEventListener ('mouseleave', function(){ \r\n        element.classList.add(\"ol-collapsed\"); \r\n        self.dispatchEvent({ type: 'toggle', collapsed: true });\r\n      });\r\n      element.addEventListener ('mouseover', function(){ \r\n        element.classList.remove(\"ol-collapsed\"); \r\n        self.dispatchEvent({ type: 'toggle', collapsed: false });\r\n      });\r\n    }\r\n\r\n    if (options.minibar) options.noScroll = true;\r\n    if (!options.noScroll) {\r\n      this.topv = ol_ext_element.create('DIV', {\r\n        className: 'ol-switchertopdiv',\r\n        parent: element,\r\n        click: function() {\r\n          self.overflow(\"+50%\");\r\n        }\r\n      });\r\n\r\n      this.botv = ol_ext_element.create('DIV', {\r\n        className: 'ol-switcherbottomdiv',\r\n        parent: element,\r\n        click: function() {\r\n          self.overflow(\"-50%\");\r\n        }\r\n      });\r\n    }\r\n    this._noScroll = options.noScroll;\r\n  }\r\n\r\n  this.panel_ = ol_ext_element.create ('UL', {\r\n    className: 'panel',\r\n  });\r\n  this.panelContainer_ = ol_ext_element.create ('DIV', {\r\n    className: 'panel-container',\r\n    html: this.panel_,\r\n    parent: element\r\n  });\r\n  // Handle mousewheel\r\n  if (!options.target && !options.noScroll) {\r\n    ol_ext_element.addListener (this.panel_, 'mousewheel DOMMouseScroll onmousewheel', function(e) {\r\n      if (self.overflow(Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail))))) {\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n      }\r\n    });\r\n  }\r\n\r\n  this.header_ = ol_ext_element.create('LI', {\r\n    className: 'ol-header',\r\n    parent: this.panel_\r\n  });\r\n\r\n  ol_control_Control.call (this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  this.set('drawDelay',options.drawDelay||0);\r\n  this.set('selection', options.selection);\r\n\r\n  if (options.minibar) {\r\n    // Wait init complete (for child classes)\r\n    setTimeout(function() {\r\n      var mbar = ol_ext_element.scrollDiv(this.panelContainer_, {\r\n        mousewheel: true, \r\n        vertical: true, \r\n        minibar: true\r\n      });\r\n      this.on(['drawlist', 'toggle'], function() {\r\n        mbar.refresh();\r\n      })\r\n    }.bind(this));\r\n  }\r\n};\r\nol_ext_inherits(ol_control_LayerSwitcher, ol_control_Control);\r\n\r\n/** List of tips for internationalization purposes\r\n*/\r\nol_control_LayerSwitcher.prototype.tip = {\r\n  up: \"up/down\",\r\n  down: \"down\",\r\n  info: \"informations...\",\r\n  extent: \"zoom to extent\",\r\n  trash: \"remove layer\",\r\n  plus: \"expand/shrink\"\r\n};\r\n\r\n/** Test if a layer should be displayed in the switcher\r\n * @param {ol.layer} layer\r\n * @return {boolean} true if the layer is displayed\r\n */\r\nol_control_LayerSwitcher.prototype.displayInLayerSwitcher = function(layer) {\r\n  return (layer.get('displayInLayerSwitcher')!==false);\r\n};\r\n\r\n/**\r\n * Set the map instance the control is associated with.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_LayerSwitcher.prototype.setMap = function(map) {\r\n  ol_control_Control.prototype.setMap.call(this, map);\r\n  this.drawPanel();\r\n  \r\n  if (this._listener) {\r\n    for (var i in this._listener) ol_Observable_unByKey(this._listener[i]);\r\n  }\r\n  this._listener = null;\r\n\r\n  // Get change (new layer added or removed)\r\n  if (map) {\r\n    this._listener = {\r\n      moveend: map.on('moveend', this.viewChange.bind(this)),\r\n      size: map.on('change:size', this.overflow.bind(this))\r\n    }\r\n    // Listen to a layer group\r\n    if (this._layerGroup) {\r\n      this._listener.change = this._layerGroup.getLayers().on('change:length', this.drawPanel.bind(this));\r\n    } else  {\r\n      //Listen to all layers\r\n      this._listener.change = map.getLayerGroup().getLayers().on('change:length', this.drawPanel.bind(this));\r\n    }\r\n  }\r\n};\r\n\r\n/** Show control\r\n */\r\nol_control_LayerSwitcher.prototype.show = function() {\r\n  this.element.classList.add('ol-forceopen');\r\n  this.overflow();\r\n  self.dispatchEvent({ type: 'toggle', collapsed: false });\r\n};\r\n\r\n/** Hide control\r\n */\r\nol_control_LayerSwitcher.prototype.hide = function() {\r\n  this.element.classList.remove('ol-forceopen');\r\n  this.overflow();\r\n  self.dispatchEvent({ type: 'toggle', collapsed: true });\r\n};\r\n\r\n/** Toggle control\r\n */\r\nol_control_LayerSwitcher.prototype.toggle = function() {\r\n  this.element.classList.toggle(\"ol-forceopen\");\r\n  this.overflow();\r\n};\r\n\r\n/** Is control open\r\n * @return {boolean}\r\n */\r\nol_control_LayerSwitcher.prototype.isOpen = function() {\r\n  return this.element.classList.contains(\"ol-forceopen\");\r\n};\r\n\r\n/** Add a custom header\r\n * @param {Element|string} html content html\r\n */\r\nol_control_LayerSwitcher.prototype.setHeader = function(html) {\r\n  ol_ext_element.setHTML(this.header_, html);\r\n};\r\n\r\n/** Calculate overflow and add scrolls\r\n * @param {Number} dir scroll direction -1|0|1|'+50%'|'-50%'\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.overflow = function(dir) {\t\r\n  if (this.button && !this._noScroll) {\r\n    // Nothing to show\r\n    if (ol_ext_element.hidden(this.panel_)) {\r\n      ol_ext_element.setStyle(this.element, { height: 'auto' });\r\n      return;\r\n    }\r\n    // Calculate offset\r\n    var h = ol_ext_element.outerHeight(this.element);\r\n    var hp = ol_ext_element.outerHeight(this.panel_);\r\n    var dh = this.button.offsetTop + ol_ext_element.outerHeight(this.button);\r\n    //var dh = this.button.position().top + this.button.outerHeight(true);\r\n\r\n    var top = this.panel_.offsetTop - dh;\r\n    if (hp > h-dh) {\r\n      // Bug IE: need to have an height defined\r\n      ol_ext_element.setStyle(this.element, { height: '100%' });\r\n      var li = this.panel_.querySelectorAll('li.visible .li-content')[0];\r\n      var lh = li ? 2 * ol_ext_element.getStyle(li, 'height') : 0;\r\n      switch (dir) {\r\n        case 1: top += lh; break;\r\n        case -1: top -= lh; break;\r\n        case \"+50%\": top += Math.round(h/2); break;\r\n        case \"-50%\": top -= Math.round(h/2); break;\r\n        default: break;\r\n      }\r\n      // Scroll div\r\n      if (top+hp <= h-3*dh/2) {\r\n        top = h-3*dh/2-hp;\r\n        ol_ext_element.hide(this.botv);\r\n      } else {\r\n        ol_ext_element.show(this.botv);\r\n      }\r\n      if (top >= 0) {\r\n        top = 0;\r\n        ol_ext_element.hide(this.topv);\r\n      } else {\r\n        ol_ext_element.show(this.topv);\r\n      }\r\n      // Scroll ?\r\n      ol_ext_element.setStyle(this.panel_, { top: top+\"px\" });\r\n      return true;\r\n    } else {\r\n      ol_ext_element.setStyle(this.element, { height: \"auto\" });\r\n      ol_ext_element.setStyle(this.panel_, { top: 0 });\r\n      ol_ext_element.hide(this.botv);\r\n      ol_ext_element.hide(this.topv);\r\n      return false;\r\n    }\r\n  }\r\n  else return false;\r\n};\r\n\r\n/** Set the layer associated with a li\r\n * @param {Element} li\r\n * @param {ol.layer} layer\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype._setLayerForLI = function(li, layer) {\r\n  var listeners = [];\r\n  if (layer.getLayers) {\r\n    listeners.push(layer.getLayers().on('change:length', this.drawPanel.bind(this)));\r\n  }\r\n  if (li) {\r\n    // Handle opacity change\r\n    listeners.push(layer.on('change:opacity', (function() {\r\n      this.setLayerOpacity(layer, li);\r\n    }).bind(this)));\r\n    // Handle visibility chage\r\n    listeners.push(layer.on('change:visible', (function() {\r\n      this.setLayerVisibility(layer, li);\r\n    }).bind(this)));\r\n  }\r\n  // Other properties\r\n  listeners.push(layer.on('propertychange', (function(e) {\r\n    if (e.key === 'displayInLayerSwitcher'\r\n      || e.key === 'openInLayerSwitcher') {\r\n      this.drawPanel(e);\r\n    }\r\n  }).bind(this)));\r\n  this._layers.push({ li:li, layer:layer, listeners: listeners });\r\n};\r\n\r\n/** Set opacity for a layer\r\n * @param {ol.layer.Layer} layer\r\n * @param {Element} li the list element\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.setLayerOpacity = function(layer, li) {\r\n  var i = li.querySelector('.layerswitcher-opacity-cursor')\r\n  if (i) i.style.left = (layer.getOpacity()*100)+\"%\"\r\n  this.dispatchEvent({ type: 'layer:opacity', layer: layer });\r\n};\r\n\r\n/** Set visibility for a layer\r\n * @param {ol.layer.Layer} layer\r\n * @param {Element} li the list element\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.setLayerVisibility = function(layer, li) {\r\n  var i = li.querySelector('.ol-visibility');\r\n  if (i) i.checked = layer.getVisible();\r\n  if (layer.getVisible()) li.classList.add('ol-visible');\r\n  else li.classList.remove('ol-visible');\r\n  this.dispatchEvent({ type: 'layer:visible', layer: layer });\r\n};\r\n\r\n/** Clear layers associated with li\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype._clearLayerForLI = function() {\r\n  this._layers.forEach(function (li) {\r\n    li.listeners.forEach(function(l) {\r\n      ol_Observable_unByKey(l);\r\n    });\r\n  })\r\n  this._layers = [];\r\n};\r\n\r\n/** Get the layer associated with a li\r\n * @param {Element} li\r\n * @return {ol.layer}\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype._getLayerForLI = function(li) {\r\n  for (var i=0, l; l=this._layers[i]; i++) {\r\n    if (l.li===li) return l.layer;\r\n  }\r\n  return null;\r\n};\r\n\r\n/**\r\n * On view change hide layer depending on resolution / extent\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.viewChange = function() {\r\n  this.panel_.querySelectorAll('li').forEach( function(li) {\r\n    var l = this._getLayerForLI(li);\r\n    if (l) {\r\n      if (this.testLayerVisibility(l)) li.classList.remove('ol-layer-hidden');\r\n      else li.classList.add('ol-layer-hidden');\r\n    }\r\n  }.bind(this));\r\n};\r\n\r\n/** Get control panel\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.getPanel = function() {\r\n  return this.panelContainer_;\r\n};\r\n\r\n/** Draw the panel control (prevent multiple draw due to layers manipulation on the map with a delay function)\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.drawPanel = function() {\r\n  if (!this.getMap()) return;\r\n  var self = this;\r\n  // Multiple event simultaneously / draw once => put drawing in the event queue\r\n  this.dcount++;\r\n  setTimeout (function(){ self.drawPanel_(); }, this.get('drawDelay') || 0);\r\n};\r\n\r\n/** Delayed draw panel control \r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.drawPanel_ = function() {\r\n  if (--this.dcount || this.dragging_) return;\r\n  var scrollTop = this.panelContainer_.scrollTop;\r\n\r\n  // Remove existing layers\r\n  this._clearLayerForLI();\r\n  this.panel_.querySelectorAll('li').forEach (function(li) {\r\n    if (!li.classList.contains('ol-header')) li.remove();\r\n  }.bind(this));\r\n  // Draw list\r\n  if (this._layerGroup) this.drawList (this.panel_, this._layerGroup.getLayers());\r\n  else if (this.getMap()) this.drawList (this.panel_, this.getMap().getLayers());\r\n\r\n  // Reset scrolltop\r\n  this.panelContainer_.scrollTop = scrollTop;\r\n};\r\n\r\n/** Change layer visibility according to the baselayer option\r\n * @param {ol.layer}\r\n * @param {Array<ol.layer>} related layers\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.switchLayerVisibility = function(l, layers) {\r\n  if (!l.get('baseLayer')) {\r\n    l.setVisible(!l.getVisible());\r\n  } else {\r\n    if (!l.getVisible()) l.setVisible(true);\r\n    layers.forEach(function(li) {\r\n      if (l!==li && li.get('baseLayer') && li.getVisible()) li.setVisible(false);\r\n    });\r\n  }\r\n};\r\n\r\n/** Check if layer is on the map (depending on resolution / zoom and extent)\r\n * @param {ol.layer}\r\n * @return {boolean}\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.testLayerVisibility = function(layer) {\r\n  if (!this.getMap()) return true;\r\n  var res = this.getMap().getView().getResolution();\r\n  var zoom = this.getMap().getView().getZoom();\r\n  // Calculate visibility on resolution or zoom\r\n  if (layer.getMaxResolution()<=res || layer.getMinResolution()>=res) {\r\n    return false;\r\n  } else if (layer.getMinZoom && (layer.getMinZoom()>=zoom || layer.getMaxZoom()<zoom)) {\r\n    return false;\r\n  } else {\r\n    // Check extent\r\n    var ex0 = layer.getExtent();\r\n    if (ex0) {\r\n      var ex = this.getMap().getView().calculateExtent(this.getMap().getSize());\r\n      return ol_extent_intersects(ex, ex0);\r\n    }\r\n    return true;\r\n  }\r\n};\r\n\r\n\r\n/** Start ordering the list\r\n*\t@param {event} e drag event\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.dragOrdering_ = function(e) {\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n  // Get params\r\n  var self = this;\r\n  var elt = e.currentTarget.parentNode.parentNode;\r\n  var start = true;\r\n  var panel = this.panel_; \r\n  var pageY;\r\n  var pageY0 = e.pageY \r\n    || (e.touches && e.touches.length && e.touches[0].pageY) \r\n    || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageY);\r\n  var target, dragElt;\r\n  var layer, group;\r\n  elt.parentNode.classList.add('drag');\r\n\r\n  // Stop ordering\r\n  function stop() {\r\n    if (target) {\r\n      // Get drag on parent\r\n      var drop = layer;\r\n      var isSelected = self.getSelection() === drop;\r\n      if (drop && target) {\r\n        var collection ;\r\n        if (group) collection = group.getLayers();\r\n        else collection = self._layerGroup ?  self._layerGroup.getLayers() : self.getMap().getLayers();\r\n        var layers = collection.getArray();\r\n        // Switch layers\r\n        for (var i=0; i<layers.length; i++) {\r\n          if (layers[i]==drop) {\r\n            collection.removeAt (i);\r\n            break;\r\n          }\r\n        }\r\n        for (var j=0; j<layers.length; j++) {\r\n          if (layers[j] === target) {\r\n            if (i>j) collection.insertAt (j,drop);\r\n            else collection.insertAt (j+1,drop);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n      if (isSelected) self.selectLayer(drop);\r\n      \r\n      self.dispatchEvent({ type: \"reorder-end\", layer: drop, group: group });\r\n    }\r\n    \r\n    elt.parentNode.querySelectorAll('li').forEach(function(li){\r\n      li.classList.remove('dropover');\r\n      li.classList.remove('dropover-after');\r\n      li.classList.remove('dropover-before');\r\n    });\r\n    elt.classList.remove(\"drag\");\r\n    elt.parentNode.classList.remove(\"drag\");\r\n    self.element.classList.remove('drag');\r\n    if (dragElt) dragElt.remove();\r\n\r\n    ol_ext_element.removeListener(document, 'mousemove touchmove', move);\r\n    ol_ext_element.removeListener(document, 'mouseup touchend touchcancel', stop);\r\n  }\r\n\r\n  // Ordering\r\n  function move(e) {\r\n    // First drag (more than 2 px) => show drag element (ghost)\r\n    pageY = e.pageY \r\n        || (e.touches && e.touches.length && e.touches[0].pageY) \r\n        || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageY);\r\n    if (start && Math.abs(pageY0 - pageY) > 2) {\r\n      start = false;\r\n      elt.classList.add(\"drag\");\r\n      layer = self._getLayerForLI(elt);\r\n      target = false;\r\n      group = self._getLayerForLI(elt.parentNode.parentNode);\r\n      // Ghost div\r\n      dragElt = ol_ext_element.create('LI', { \r\n        className: 'ol-dragover',\r\n        html: elt.innerHTML,\r\n        style: { \r\n          position: \"absolute\", \r\n          \"z-index\": 10000, \r\n          left: elt.offsetLeft, \r\n          opacity: 0.5,\r\n          width: ol_ext_element.outerWidth(elt),\r\n          height: ol_ext_element.getStyle(elt,'height'),\r\n        },\r\n        parent: panel \r\n      });\r\n      self.element.classList.add('drag');\r\n      self.dispatchEvent({ type: \"reorder-start\", layer: layer, group: group });\r\n    }\r\n    // Start a new drag sequence\r\n    if (!start) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n\r\n      // Ghost div\r\n      ol_ext_element.setStyle(dragElt, { top: pageY - ol_ext_element.offsetRect(panel).top + panel.scrollTop +5 });\r\n      \r\n      var li;\r\n      if (!e.touches) {\r\n        li = e.target;\r\n      } else {\r\n        li = document.elementFromPoint(e.touches[0].clientX, e.touches[0].clientY);\r\n      }\r\n      if (li.classList.contains(\"ol-switcherbottomdiv\")) {\r\n        self.overflow(-1);\r\n      } else if (li.classList.contains(\"ol-switchertopdiv\")) {\r\n        self.overflow(1);\r\n      }\r\n      // Get associated li\r\n      while (li && li.tagName!=='LI') {\r\n        li = li.parentNode;\r\n      }\r\n      if (!li || !li.classList.contains('dropover')) {\r\n        elt.parentNode.querySelectorAll('li').forEach(function(li) {\r\n          li.classList.remove('dropover');\r\n          li.classList.remove('dropover-after');\r\n          li.classList.remove('dropover-before');\r\n        });\r\n      }\r\n      if (li && li.parentNode.classList.contains('drag') && li !== elt) {\r\n        target = self._getLayerForLI(li);\r\n        // Don't mix layer level\r\n        if (target && !target.get('allwaysOnTop') == !layer.get('allwaysOnTop')) {\r\n          li.classList.add(\"dropover\");\r\n          li.classList.add((elt.offsetTop < li.offsetTop) ? 'dropover-after' : 'dropover-before');\r\n        } else {\r\n          target = false;\r\n        }\r\n        ol_ext_element.show(dragElt);\r\n      } else {\r\n        target = false;\r\n        if (li===elt) ol_ext_element.hide(dragElt);\r\n        else ol_ext_element.show(dragElt);\r\n      }\r\n      \r\n      if (!target) dragElt.classList.add(\"forbidden\");\r\n      else dragElt.classList.remove(\"forbidden\");\r\n    }\r\n  }\r\n\r\n  // Start ordering\r\n  ol_ext_element.addListener(document, 'mousemove touchmove', move);\r\n  ol_ext_element.addListener(document, 'mouseup touchend touchcancel', stop);\r\n};\r\n\r\n\r\n/** Change opacity on drag \r\n*\t@param {event} e drag event\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.dragOpacity_ = function(e) {\r\n  e.stopPropagation();\r\n  e.preventDefault();\r\n  var self = this\r\n  // Register start params\r\n  var elt = e.target;\r\n  var layer = this._getLayerForLI(elt.parentNode.parentNode.parentNode);\r\n  if (!layer) return;\r\n  var x = e.pageX \r\n    || (e.touches && e.touches.length && e.touches[0].pageX) \r\n    || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageX);\r\n  var start = ol_ext_element.getStyle (elt, 'left') - x;\r\n  self.dragging_ = true;\r\n\r\n  // stop dragging\r\n  function stop() {\r\n    ol_ext_element.removeListener(document, \"mouseup touchend touchcancel\", stop);\r\n    ol_ext_element.removeListener(document, \"mousemove touchmove\", move);\r\n    self.dragging_ = false;\r\n  }\r\n  // On draggin\r\n  function move(e) {\r\n    var x = e.pageX \r\n      || (e.touches && e.touches.length && e.touches[0].pageX) \r\n      || (e.changedTouches && e.changedTouches.length && e.changedTouches[0].pageX);\r\n    var delta = (start + x) / ol_ext_element.getStyle(elt.parentNode, 'width');\r\n    var opacity = Math.max (0, Math.min(1, delta));\r\n    ol_ext_element.setStyle (elt, { left: (opacity*100) + \"%\" });\r\n    elt.parentNode.nextElementSibling.innerHTML = Math.round(opacity*100);\r\n    layer.setOpacity(opacity);\r\n  }\r\n  // Register move\r\n  ol_ext_element.addListener(document, \"mouseup touchend touchcancel\", stop);\r\n  ol_ext_element.addListener(document, \"mousemove touchmove\", move);\r\n};\r\n\r\n\r\n/** Render a list of layer\r\n * @param {Elemen} element to render\r\n * @layers {Array{ol.layer}} list of layer to show\r\n * @api stable\r\n * @private\r\n */\r\nol_control_LayerSwitcher.prototype.drawList = function(ul, collection) {\r\n  var self = this;\r\n  var layers = collection.getArray();\r\n\r\n  // Change layer visibility\r\n  var setVisibility = function(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    self.switchLayerVisibility(l, collection);\r\n    if (self.get('selection') && l.getVisible()) {\r\n      self.selectLayer(l);\r\n    }\r\n    if (self.onchangeCheck) {\r\n      self.onchangeCheck(l);\r\n    }\r\n  };\r\n  // Info button click\r\n  function onInfo(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault(); \r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    self.oninfo(l); \r\n    self.dispatchEvent({ type: \"info\", layer: l });\r\n  }\r\n  // Zoom to extent button\r\n  function zoomExtent(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault(); \r\n    var l = self._getLayerForLI(this.parentNode.parentNode);\r\n    if (self.onextent) self.onextent(l); \r\n    else self.getMap().getView().fit (l.getExtent(), self.getMap().getSize()); \r\n    self.dispatchEvent({ type: \"extent\", layer: l });\r\n  }\r\n  // Remove a layer on trash click\r\n  function removeLayer(e) {\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n    var li = this.parentNode.parentNode.parentNode.parentNode;\r\n    var layer, group = self._getLayerForLI(li);\r\n    // Remove the layer from a group or from a map\r\n    if (group) {\r\n      layer = self._getLayerForLI(this.parentNode.parentNode);\r\n      group.getLayers().remove(layer);\r\n      if (group.getLayers().getLength()==0 && !group.get('noSwitcherDelete')) {\r\n        removeLayer.call(li.querySelectorAll('.layerTrash')[0], e);\r\n      }\r\n    } else {\r\n      li = this.parentNode.parentNode;\r\n      self.getMap().removeLayer(self._getLayerForLI(li));\r\n    }\r\n  }\r\n\r\n  // Create a list for a layer\r\n  function createLi(layer) {\r\n    if (!this.displayInLayerSwitcher(layer)) {\r\n      this._setLayerForLI(null, layer);\r\n      return;\r\n    } \r\n\r\n    var li = ol_ext_element.create('LI', {\r\n      className: (layer.getVisible()?\"visible \":\" \")+(layer.get('baseLayer')?\"baselayer\":\"\"),\r\n      parent: ul\r\n    });\r\n    this._setLayerForLI(li, layer);\r\n    if (this._selectedLayer === layer) {\r\n      li.classList.add('ol-layer-select');\r\n    }\r\n\r\n    var layer_buttons = ol_ext_element.create('DIV', {\r\n      className: 'ol-layerswitcher-buttons',\r\n      parent: li\r\n    });\r\n\r\n    // Content div\r\n    var d = ol_ext_element.create('DIV', {\r\n      className: 'li-content',// + (this.testLayerVisibility(layer) ? '' : ' ol-layer-hidden'),\r\n      parent: li\r\n    });\r\n    \r\n    // Visibility\r\n    ol_ext_element.create('INPUT', {\r\n      type: layer.get('baseLayer') ? 'radio' : 'checkbox',\r\n      className: 'ol-visibility',\r\n      checked: layer.getVisible(),\r\n      click: setVisibility,\r\n      parent: d\r\n    });\r\n    // Label\r\n    var label = ol_ext_element.create('LABEL', {\r\n      title: layer.get('title') || layer.get('name'),\r\n      click: setVisibility,\r\n      unselectable: 'on',\r\n      style: {\r\n        userSelect: 'none'\r\n      },\r\n      parent: d\r\n    });\r\n    label.addEventListener('selectstart', function(){ return false; });\r\n    ol_ext_element.create('SPAN', {\r\n      html: layer.get('title') || layer.get('name'),\r\n      click: function(e) {\r\n        if (this.get('selection')) {\r\n          e.stopPropagation();\r\n          this.selectLayer(layer);\r\n        }\r\n      }.bind(this),\r\n      parent: label\r\n    });\r\n\r\n    //  up/down\r\n    if (this.reordering) {\r\n      if ( (i<layers.length-1 && (layer.get(\"allwaysOnTop\") || !layers[i+1].get(\"allwaysOnTop\")) )\r\n      || (i>0 && (!layer.get(\"allwaysOnTop\") || layers[i-1].get(\"allwaysOnTop\")) ) ) {\r\n        ol_ext_element.create('DIV', {\r\n          className: 'layerup ol-noscroll',\r\n          title: this.tip.up,\r\n          on: { 'mousedown touchstart': function(e) { self.dragOrdering_(e) } },\r\n          parent: layer_buttons\r\n        });\r\n      }\r\n    }\r\n\r\n    // Show/hide sub layers\r\n    if (layer.getLayers) {\r\n      var nb = 0;\r\n      layer.getLayers().forEach(function(l) {\r\n        if (self.displayInLayerSwitcher(l)) nb++;\r\n      });\r\n      if (nb) {\r\n        ol_ext_element.create('DIV', {\r\n          className: layer.get(\"openInLayerSwitcher\") ? \"collapse-layers\" : \"expend-layers\",\r\n          title: this.tip.plus,\r\n          click: function() {\r\n            var l = self._getLayerForLI(this.parentNode.parentNode);\r\n            l.set(\"openInLayerSwitcher\", !l.get(\"openInLayerSwitcher\") )\r\n          },\r\n          parent: layer_buttons\r\n        });\r\n      }\r\n    }\r\n\r\n    // Info button\r\n    if (this.oninfo) {\r\n      ol_ext_element.create('DIV', {\r\n        className: 'layerInfo',\r\n        title: this.tip.info,\r\n        click: onInfo,\r\n        parent: layer_buttons\r\n      });\r\n    }\r\n    // Layer remove\r\n    if (this.hastrash && !layer.get(\"noSwitcherDelete\")) {\r\n      ol_ext_element.create('DIV', {\r\n        className: 'layerTrash',\r\n        title: this.tip.trash,\r\n        click: removeLayer,\r\n        parent: layer_buttons\r\n      });\r\n    }\r\n    // Layer extent\r\n    if (this.hasextent && layers[i].getExtent()) {\r\n      var ex = layers[i].getExtent();\r\n      if (ex.length==4 && ex[0]<ex[2] && ex[1]<ex[3]) {\r\n        ol_ext_element.create('DIV', {\r\n          className: 'layerExtent',\r\n          title: this.tip.extent,\r\n          click: zoomExtent,\r\n          parent: layer_buttons  \r\n        });\r\n      }\r\n    }\r\n\r\n    // Progress\r\n    if (this.show_progress && layer instanceof ol_layer_Tile) {\r\n      var p = ol_ext_element.create('DIV', {\r\n        className: 'layerswitcher-progress',\r\n        parent: d\r\n      });\r\n      this.setprogress_(layer);\r\n      layer.layerswitcher_progress = ol_ext_element.create('DIV', { parent: p });\r\n    }\r\n\r\n    // Opacity\r\n    var opacity = ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity',\r\n      // Click on the opacity line\r\n      click: function(e){\r\n        if (e.target !== this) return;\r\n        e.stopPropagation();\r\n        e.preventDefault();\r\n        var op = Math.max ( 0, Math.min( 1, e.offsetX / ol_ext_element.getStyle(this, 'width')));\r\n        self._getLayerForLI(this.parentNode.parentNode).setOpacity(op);\r\n      },\r\n      parent: d\r\n    });\r\n    // Start dragging\r\n    ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity-cursor ol-noscroll',\r\n      style: { left: (layer.getOpacity()*100)+\"%\" },\r\n      on: {\r\n        'mousedown touchstart': function(e) { self.dragOpacity_ (e); }\r\n      },\r\n      parent: opacity\r\n    });\r\n    // Percent\r\n    ol_ext_element.create('DIV', {\r\n      className: 'layerswitcher-opacity-label',\r\n      html: Math.round(layer.getOpacity()*100),\r\n      parent: d\r\n    });\r\n\r\n    // Layer group\r\n    if (layer.getLayers) {\r\n      li.classList.add('ol-layer-group');\r\n      if (layer.get(\"openInLayerSwitcher\") === true) {\r\n        var ul2 = ol_ext_element.create('UL', {\r\n          parent: li\r\n        });\r\n        this.drawList (ul2, layer.getLayers());\r\n      }\r\n    }\r\n    li.classList.add(this.getLayerClass(layer));\r\n\r\n    // Dispatch a dralist event to allow customisation\r\n    this.dispatchEvent({ type:'drawlist', layer:layer, li:li });\r\n  }\r\n\r\n  // Add the layer list\r\n  for (var i=layers.length-1; i>=0; i--) { \r\n    createLi.call(this, layers[i]); \r\n  }\r\n\r\n  this.viewChange();\r\n\r\n  if (ul === this.panel_) this.overflow();\r\n};\r\n\r\n/** Select a layer\r\n * @param {ol.layer.Layer} layer\r\n * @returns {string} the layer classname\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.getLayerClass = function(layer) {\r\n  if (!layer) return 'none';\r\n  if (layer.getLayers) return 'ol-layer-group';\r\n  if (layer instanceof ol_layer_Vector) return 'ol-layer-vector';\r\n  if (layer instanceof ol_layer_VectorTile) return 'ol-layer-vectortile';\r\n  if (layer instanceof ol_layer_Tile) return 'ol-layer-tile';\r\n  if (layer instanceof ol_layer_Image) return 'ol-layer-image';\r\n  if (layer instanceof ol_layer_Heatmap) return 'ol-layer-heatmap';\r\n  /* ol < 6 compatibility VectorImage is not defined */\r\n  // if (layer instanceof ol_layer_VectorImage) return 'ol-layer-vectorimage';\r\n  if (layer.getFeatures) return 'ol-layer-vectorimage';\r\n  /* */\r\n  return 'unknown';\r\n};\r\n\r\n/** Select a layer\r\n * @param {ol.layer.Layer} layer\r\n * @api\r\n */\r\nol_control_LayerSwitcher.prototype.selectLayer = function(layer, silent) {\r\n  if (!layer) {\r\n    if (!this.getMap()) return;\r\n    layer = this.getMap().getLayers().item(this.getMap().getLayers().getLength()-1)\r\n  }\r\n  this._selectedLayer = layer;\r\n  this.drawPanel();\r\n  if (!silent) this.dispatchEvent({ type: 'select', layer: layer });\r\n};\r\n\r\n/** Get selected layer\r\n * @returns {ol.layer.Layer}\r\n */\r\nol_control_LayerSwitcher.prototype.getSelection = function() {\r\n  return this._selectedLayer;\r\n};\r\n\r\n/** Handle progress bar for a layer\r\n*\t@private\r\n*/\r\nol_control_LayerSwitcher.prototype.setprogress_ = function(layer) {\r\n  if (!layer.layerswitcher_progress) {\r\n    var loaded = 0;\r\n    var loading = 0;\r\n    var draw = function() {\r\n      if (loading === loaded) {\r\n        loading = loaded = 0;\r\n        ol_ext_element.setStyle(layer.layerswitcher_progress, { width: 0 });// layer.layerswitcher_progress.width(0);\r\n      } else {\r\n        ol_ext_element.setStyle(layer.layerswitcher_progress, { width: (loaded / loading * 100).toFixed(1) + '%' });// layer.layerswitcher_progress.css('width', (loaded / loading * 100).toFixed(1) + '%');\r\n      }\r\n    }\r\n    layer.getSource().on('tileloadstart', function() {\r\n      loading++;\r\n      draw();\r\n    });\r\n    layer.getSource().on('tileloadend', function() {\r\n      loaded++;\r\n      draw();\r\n    });\r\n    layer.getSource().on('tileloaderror', function() {\r\n      loaded++;\r\n      draw();\r\n    });\r\n  }\r\n};\r\n\r\nexport default ol_control_LayerSwitcher\r\n","/**\n * @module ol/CollectionEventType\n */\n/**\n * @enum {string}\n */\nexport default {\n    /**\n     * Triggered when an item is added to the collection.\n     * @event module:ol/Collection.CollectionEvent#add\n     * @api\n     */\n    ADD: 'add',\n    /**\n     * Triggered when an item is removed from the collection.\n     * @event module:ol/Collection.CollectionEvent#remove\n     * @api\n     */\n    REMOVE: 'remove',\n};\n//# sourceMappingURL=CollectionEventType.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/Feature\n */\nimport BaseObject from './Object.js';\nimport EventType from './events/EventType.js';\nimport { assert } from './asserts.js';\nimport { listen, unlistenByKey } from './events.js';\n/**\n * @typedef {typeof Feature|typeof import(\"./render/Feature.js\").default} FeatureClass\n */\n/**\n * @typedef {Feature|import(\"./render/Feature.js\").default} FeatureLike\n */\n/***\n * @template Return\n * @typedef {import(\"./Observable\").OnSignature<import(\"./Observable\").EventTypes, import(\"./events/Event.js\").default, Return> &\n *   import(\"./Observable\").OnSignature<import(\"./ObjectEventType\").Types|'change:geometry', import(\"./Object\").ObjectEvent, Return> &\n *   import(\"./Observable\").CombinedOnSignature<import(\"./Observable\").EventTypes|import(\"./ObjectEventType\").Types\n *     |'change:geometry', Return>} FeatureOnSignature\n */\n/***\n * @template Geometry\n * @typedef {Object<string, *> & { geometry?: Geometry }} ObjectWithGeometry\n */\n/**\n * @classdesc\n * A vector object for geographic features with a geometry and other\n * attribute properties, similar to the features in vector file formats like\n * GeoJSON.\n *\n * Features can be styled individually with `setStyle`; otherwise they use the\n * style of their vector layer.\n *\n * Note that attribute properties are set as {@link module:ol/Object~BaseObject} properties on\n * the feature object, so they are observable, and have get/set accessors.\n *\n * Typically, a feature has a single geometry property. You can set the\n * geometry using the `setGeometry` method and get it with `getGeometry`.\n * It is possible to store more than one geometry on a feature using attribute\n * properties. By default, the geometry used for rendering is identified by\n * the property name `geometry`. If you want to use another geometry property\n * for rendering, use the `setGeometryName` method to change the attribute\n * property associated with the geometry for the feature.  For example:\n *\n * ```js\n *\n * import Feature from 'ol/Feature';\n * import Polygon from 'ol/geom/Polygon';\n * import Point from 'ol/geom/Point';\n *\n * var feature = new Feature({\n *   geometry: new Polygon(polyCoords),\n *   labelPoint: new Point(labelCoords),\n *   name: 'My Polygon'\n * });\n *\n * // get the polygon geometry\n * var poly = feature.getGeometry();\n *\n * // Render the feature as a point using the coordinates from labelPoint\n * feature.setGeometryName('labelPoint');\n *\n * // get the point geometry\n * var point = feature.getGeometry();\n * ```\n *\n * @api\n * @template {import(\"./geom/Geometry.js\").default} [Geometry=import(\"./geom/Geometry.js\").default]\n */\nvar Feature = /** @class */ (function (_super) {\n    __extends(Feature, _super);\n    /**\n     * @param {Geometry|ObjectWithGeometry<Geometry>} [opt_geometryOrProperties]\n     *     You may pass a Geometry object directly, or an object literal containing\n     *     properties. If you pass an object literal, you may include a Geometry\n     *     associated with a `geometry` key.\n     */\n    function Feature(opt_geometryOrProperties) {\n        var _this = _super.call(this) || this;\n        /***\n         * @type {FeatureOnSignature<import(\"./events\").EventsKey>}\n         */\n        _this.on;\n        /***\n         * @type {FeatureOnSignature<import(\"./events\").EventsKey>}\n         */\n        _this.once;\n        /***\n         * @type {FeatureOnSignature<void>}\n         */\n        _this.un;\n        /**\n         * @private\n         * @type {number|string|undefined}\n         */\n        _this.id_ = undefined;\n        /**\n         * @type {string}\n         * @private\n         */\n        _this.geometryName_ = 'geometry';\n        /**\n         * User provided style.\n         * @private\n         * @type {import(\"./style/Style.js\").StyleLike}\n         */\n        _this.style_ = null;\n        /**\n         * @private\n         * @type {import(\"./style/Style.js\").StyleFunction|undefined}\n         */\n        _this.styleFunction_ = undefined;\n        /**\n         * @private\n         * @type {?import(\"./events.js\").EventsKey}\n         */\n        _this.geometryChangeKey_ = null;\n        _this.addChangeListener(_this.geometryName_, _this.handleGeometryChanged_);\n        if (opt_geometryOrProperties) {\n            if (typeof (\n            /** @type {?} */ (opt_geometryOrProperties).getSimplifiedGeometry) === 'function') {\n                var geometry = /** @type {Geometry} */ (opt_geometryOrProperties);\n                _this.setGeometry(geometry);\n            }\n            else {\n                /** @type {Object<string, *>} */\n                var properties = opt_geometryOrProperties;\n                _this.setProperties(properties);\n            }\n        }\n        return _this;\n    }\n    /**\n     * Clone this feature. If the original feature has a geometry it\n     * is also cloned. The feature id is not set in the clone.\n     * @return {Feature<Geometry>} The clone.\n     * @api\n     */\n    Feature.prototype.clone = function () {\n        var clone = /** @type {Feature<Geometry>} */ (new Feature(this.hasProperties() ? this.getProperties() : null));\n        clone.setGeometryName(this.getGeometryName());\n        var geometry = this.getGeometry();\n        if (geometry) {\n            clone.setGeometry(/** @type {Geometry} */ (geometry.clone()));\n        }\n        var style = this.getStyle();\n        if (style) {\n            clone.setStyle(style);\n        }\n        return clone;\n    };\n    /**\n     * Get the feature's default geometry.  A feature may have any number of named\n     * geometries.  The \"default\" geometry (the one that is rendered by default) is\n     * set when calling {@link module:ol/Feature~Feature#setGeometry}.\n     * @return {Geometry|undefined} The default geometry for the feature.\n     * @api\n     * @observable\n     */\n    Feature.prototype.getGeometry = function () {\n        return /** @type {Geometry|undefined} */ (this.get(this.geometryName_));\n    };\n    /**\n     * Get the feature identifier.  This is a stable identifier for the feature and\n     * is either set when reading data from a remote source or set explicitly by\n     * calling {@link module:ol/Feature~Feature#setId}.\n     * @return {number|string|undefined} Id.\n     * @api\n     */\n    Feature.prototype.getId = function () {\n        return this.id_;\n    };\n    /**\n     * Get the name of the feature's default geometry.  By default, the default\n     * geometry is named `geometry`.\n     * @return {string} Get the property name associated with the default geometry\n     *     for this feature.\n     * @api\n     */\n    Feature.prototype.getGeometryName = function () {\n        return this.geometryName_;\n    };\n    /**\n     * Get the feature's style. Will return what was provided to the\n     * {@link module:ol/Feature~Feature#setStyle} method.\n     * @return {import(\"./style/Style.js\").StyleLike|undefined} The feature style.\n     * @api\n     */\n    Feature.prototype.getStyle = function () {\n        return this.style_;\n    };\n    /**\n     * Get the feature's style function.\n     * @return {import(\"./style/Style.js\").StyleFunction|undefined} Return a function\n     * representing the current style of this feature.\n     * @api\n     */\n    Feature.prototype.getStyleFunction = function () {\n        return this.styleFunction_;\n    };\n    /**\n     * @private\n     */\n    Feature.prototype.handleGeometryChange_ = function () {\n        this.changed();\n    };\n    /**\n     * @private\n     */\n    Feature.prototype.handleGeometryChanged_ = function () {\n        if (this.geometryChangeKey_) {\n            unlistenByKey(this.geometryChangeKey_);\n            this.geometryChangeKey_ = null;\n        }\n        var geometry = this.getGeometry();\n        if (geometry) {\n            this.geometryChangeKey_ = listen(geometry, EventType.CHANGE, this.handleGeometryChange_, this);\n        }\n        this.changed();\n    };\n    /**\n     * Set the default geometry for the feature.  This will update the property\n     * with the name returned by {@link module:ol/Feature~Feature#getGeometryName}.\n     * @param {Geometry|undefined} geometry The new geometry.\n     * @api\n     * @observable\n     */\n    Feature.prototype.setGeometry = function (geometry) {\n        this.set(this.geometryName_, geometry);\n    };\n    /**\n     * Set the style for the feature to override the layer style.  This can be a\n     * single style object, an array of styles, or a function that takes a\n     * resolution and returns an array of styles. To unset the feature style, call\n     * `setStyle()` without arguments or a falsey value.\n     * @param {import(\"./style/Style.js\").StyleLike} [opt_style] Style for this feature.\n     * @api\n     * @fires module:ol/events/Event~BaseEvent#event:change\n     */\n    Feature.prototype.setStyle = function (opt_style) {\n        this.style_ = opt_style;\n        this.styleFunction_ = !opt_style\n            ? undefined\n            : createStyleFunction(opt_style);\n        this.changed();\n    };\n    /**\n     * Set the feature id.  The feature id is considered stable and may be used when\n     * requesting features or comparing identifiers returned from a remote source.\n     * The feature id can be used with the\n     * {@link module:ol/source/Vector~VectorSource#getFeatureById} method.\n     * @param {number|string|undefined} id The feature id.\n     * @api\n     * @fires module:ol/events/Event~BaseEvent#event:change\n     */\n    Feature.prototype.setId = function (id) {\n        this.id_ = id;\n        this.changed();\n    };\n    /**\n     * Set the property name to be used when getting the feature's default geometry.\n     * When calling {@link module:ol/Feature~Feature#getGeometry}, the value of the property with\n     * this name will be returned.\n     * @param {string} name The property name of the default geometry.\n     * @api\n     */\n    Feature.prototype.setGeometryName = function (name) {\n        this.removeChangeListener(this.geometryName_, this.handleGeometryChanged_);\n        this.geometryName_ = name;\n        this.addChangeListener(this.geometryName_, this.handleGeometryChanged_);\n        this.handleGeometryChanged_();\n    };\n    return Feature;\n}(BaseObject));\n/**\n * Convert the provided object into a feature style function.  Functions passed\n * through unchanged.  Arrays of Style or single style objects wrapped\n * in a new feature style function.\n * @param {!import(\"./style/Style.js\").StyleFunction|!Array<import(\"./style/Style.js\").default>|!import(\"./style/Style.js\").default} obj\n *     A feature style function, a single style, or an array of styles.\n * @return {import(\"./style/Style.js\").StyleFunction} A style function.\n */\nexport function createStyleFunction(obj) {\n    if (typeof obj === 'function') {\n        return obj;\n    }\n    else {\n        /**\n         * @type {Array<import(\"./style/Style.js\").default>}\n         */\n        var styles_1;\n        if (Array.isArray(obj)) {\n            styles_1 = obj;\n        }\n        else {\n            assert(typeof ( /** @type {?} */(obj).getZIndex) === 'function', 41); // Expected an `import(\"./style/Style.js\").Style` or an array of `import(\"./style/Style.js\").Style`\n            var style = /** @type {import(\"./style/Style.js\").default} */ (obj);\n            styles_1 = [style];\n        }\n        return function () {\n            return styles_1;\n        };\n    }\n}\nexport default Feature;\n//# sourceMappingURL=Feature.js.map","/** Vanilla JS geographic inputs\r\n * color, size, width, font, symboles, dash, arrow, pattern\r\n */\r\nimport ol_ext_inherits from '../ext'\r\nimport ol_Object from 'ol/Object'\r\n\r\n/** @namespace  ol.ext.input\r\n */\r\n/*global ol*/\r\nif (window.ol) {\r\n  ol.ext.input = {};\r\n}\r\n\r\n/** Abstract base class; normally only used for creating subclasses and not instantiated in apps.    \r\n * @constructor\r\n * @extends {ol_Object}\r\n * @param {*} options\r\n *  @param {Element} [options.input] input element, if none create one\r\n *  @param {string} [options.type] input type, if no input\r\n *  @param {number} [options.min] input min, if no input\r\n *  @param {number} [options.max] input max, if no input\r\n *  @param {number} [options.step] input step, if no input\r\n *  @param {string|number} [options.val] input value\r\n *  @param {boolean} [options.checked] check input\r\n *  @param {boolean} [options.hidden] the input is display:none\r\n *  @param {boolean} [options.disabled] disable input\r\n *  @param {Element} [options.parent] parent element, if no input\r\n */\r\nvar ol_ext_input_Base = function(options) {\r\n  options = options || {};\r\n  \r\n  ol_Object.call(this);\r\n  \r\n  var input = this.input = options.input;\r\n  if (!input) {\r\n    input = this.input = document.createElement('INPUT');\r\n    if (options.type) input.setAttribute('type', options.type);\r\n    if (options.min !== undefined) input.setAttribute('min', options.min);\r\n    if (options.max !== undefined) input.setAttribute('max', options.max);\r\n    if (options.step !== undefined) input.setAttribute('step', options.step);\r\n    if (options.parent) options.parent.appendChild(input);\r\n  } \r\n  if (options.disabled) input.disabled = true;\r\n  if (options.checked !== undefined) input.checked = !!options.checked;\r\n  if (options.val !== undefined) input.value = options.val;\r\n  if (options.hidden) input.style.display = 'none';\r\n  input.addEventListener('focus', function() {\r\n    if (this.element) this.element.classList.add('ol-focus');\r\n  }.bind(this))\r\n  var tout;\r\n  input.addEventListener('focusout', function() {\r\n    if (this.element) {\r\n      if (tout) clearTimeout(tout);\r\n      tout = setTimeout(function() {\r\n        this.element.classList.remove('ol-focus');\r\n      }.bind(this), 0);\r\n    }\r\n  }.bind(this))\r\n};\r\nol_ext_inherits(ol_ext_input_Base, ol_Object);\r\n\r\n/** Listen to drag event\r\n * @param {Element} elt \r\n * @param {function} cback when draggin on the element\r\n * @private\r\n */\r\nol_ext_input_Base.prototype._listenDrag = function(elt, cback) {\r\n  var handle = function(e) {\r\n    this.moving = true;\r\n    this.element.classList.add('ol-moving');\r\n    var listen = function(e) {\r\n      if (e.type==='pointerup') {\r\n        document.removeEventListener('pointermove', listen);\r\n        document.removeEventListener('pointerup', listen);\r\n        document.removeEventListener('pointercancel', listen);\r\n        setTimeout(function() {\r\n          this.moving = false;\r\n          this.element.classList.remove('ol-moving');\r\n        }.bind(this));\r\n      }\r\n      if (e.target === elt) cback(e);\r\n      e.stopPropagation();\r\n      e.preventDefault();\r\n    }.bind(this);\r\n    document.addEventListener('pointermove', listen, false);\r\n    document.addEventListener('pointerup', listen, false);\r\n    document.addEventListener('pointercancel', listen, false);\r\n    e.stopPropagation();\r\n    e.preventDefault();\r\n  }.bind(this)\r\n  elt.addEventListener('mousedown', handle, false);\r\n  elt.addEventListener('touchstart', handle, false);\r\n};\r\n\r\n/** Set the current value\r\n */\r\nol_ext_input_Base.prototype.setValue = function(v) {\r\n  if (v !== undefined) this.input.value = v;\r\n  this.input.dispatchEvent(new Event('change'));\r\n};\r\n\r\n/** Get the current getValue\r\n * @returns {string}\r\n */\r\nol_ext_input_Base.prototype.getValue = function() {\r\n  return this.input.value;\r\n};\r\n\r\n/** Get the input element\r\n * @returns {Element}\r\n */\r\nol_ext_input_Base.prototype.getInputElement = function() {\r\n  return this.input;\r\n};\r\n\r\nexport default ol_ext_input_Base\r\n","import ol_ext_inherits from '../ext'\r\nimport ol_ext_input_Base from './Base'\r\n\r\n/** Checkbox input\r\n * @constructor\r\n * @extends {ol_ext_input_Base}\r\n * @fires check\r\n * @param {*} options\r\n *  @param {string} [options.className]\r\n *  @param {Element|string} [options.html] label content\r\n *  @param {string} [options.after] label garnish (placed after)\r\n *  @param {Element} [options.input] input element, if non create one\r\n *  @param {Element} [options.parent] parent element, if create an input\r\n *  @param {boolean} [options.autoClose=true]\r\n *  @param {boolean} [options.visible=false] display the input\r\n */\r\nvar ol_ext_input_Checkbox = function(options) {\r\n  options = options || {};\r\n\r\n  ol_ext_input_Base.call(this, options);\r\n\r\n  var label = this.element = document.createElement('LABEL');\r\n  if (options.html instanceof Element) label.appendChild(options.html)\r\n  else if (options.html !== undefined) label.innerHTML = options.html;\r\n  label.className = ('ol-ext-check ol-ext-checkbox '  + (options.className || '')).trim();\r\n\r\n  if (this.input.parentNode) this.input.parentNode.insertBefore(label, this.input);\r\n  label.appendChild(this.input);\r\n  label.appendChild(document.createElement('SPAN'));\r\n  if (options.after) {\r\n    label.appendChild(document.createTextNode(options.after));\r\n  }\r\n\r\n  // Handle change\r\n  this.input.addEventListener('change', function() {\r\n    this.dispatchEvent({ type: 'check', checked: this.input.checked, value: this.input.value });\r\n  }.bind(this));\r\n\r\n};\r\nol_ext_inherits(ol_ext_input_Checkbox, ol_ext_input_Base);\r\n  \r\nol_ext_input_Checkbox.prototype.isChecked = function () {\r\n  return this.input.checked;\r\n};\r\n\r\nexport default ol_ext_input_Checkbox\r\n","import ol_ext_inherits from '../ext'\r\nimport ol_ext_input_Checkbox from './Checkbox'\r\n\r\n/** Switch input\r\n * @constructor\r\n * @extends {ol_ext_input_Checkbox}\r\n * @fires check\r\n * @param {*} options\r\n *  @param {string} [options.className]\r\n *  @param {Element} [options.input] input element, if non create one\r\n *  @param {Element} [options.parent] parent element, if create an input\r\n */\r\nvar ol_ext_input_Switch = function(options) {\r\n  options = options || {};\r\n\r\n  ol_ext_input_Checkbox.call(this, options);\r\n\r\n  this.element.className = ('ol-ext-toggle-switch ' + (options.className || '')).trim();\r\n};\r\nol_ext_inherits(ol_ext_input_Switch, ol_ext_input_Checkbox);\r\n  \r\nexport default ol_ext_input_Switch\r\n","import ol_ext_inherits from '../ext'\r\nimport ol_ext_input_Checkbox from './Checkbox'\r\n\r\n/** Switch input\r\n * @constructor\r\n * @extends {ol_ext_input_Checkbox}\r\n * @fires check\r\n * @param {*} options\r\n *  @param {string} [options.className]\r\n *  @param {Element} [options.input] input element, if non create one\r\n *  @param {Element} [options.parent] parent element, if create an input\r\n */\r\nvar ol_ext_input_Radio = function(options) {\r\n  options = options || {};\r\n\r\n  ol_ext_input_Checkbox.call(this, options);\r\n\r\n  this.element.className = ('ol-ext-check ol-ext-radio ' + (options.className || '')).trim();\r\n};\r\nol_ext_inherits(ol_ext_input_Radio, ol_ext_input_Checkbox);\r\n  \r\nexport default ol_ext_input_Radio\r\n","/** Vanilla JS helper to manipulate DOM without jQuery\r\n * @see https://github.com/nefe/You-Dont-Need-jQuery\r\n * @see https://plainjs.com/javascript/\r\n * @see http://youmightnotneedjquery.com/\r\n */\r\nimport ol_ext_input_Checkbox from './input/Checkbox'\r\nimport ol_ext_input_Switch from './input/Switch'\r\nimport ol_ext_input_Radio from './input/Radio'\r\n\r\n/** @namespace ol.ext.element */\r\nvar ol_ext_element = {};\r\n\r\n/**\r\n * Create an element\r\n * @param {string} tagName The element tag, use 'TEXT' to create a text node\r\n * @param {*} options\r\n *  @param {string} options.className className The element class name \r\n *  @param {Element} options.parent Parent to append the element as child\r\n *  @param {Element|string} [options.html] Content of the element (if text is not set)\r\n *  @param {string} [options.text] Text content (if html is not set)\r\n *  @param {Element|string} [options.options] when tagName = SELECT a list of options as key:value to add to the select\r\n *  @param {string} options.* Any other attribut to add to the element\r\n */\r\nol_ext_element.create = function (tagName, options) {\r\n  options = options || {};\r\n  var elt;\r\n  // Create text node\r\n  if (tagName === 'TEXT') {\r\n    elt = document.createTextNode(options.html||'');\r\n    if (options.parent) options.parent.appendChild(elt);\r\n  } else {\r\n    // Other element\r\n    elt = document.createElement(tagName);\r\n    if (/button/i.test(tagName)) elt.setAttribute('type', 'button');\r\n    for (var attr in options) {\r\n      switch (attr) {\r\n        case 'className': {\r\n          if (options.className && options.className.trim) elt.setAttribute('class', options.className.trim());\r\n          break;\r\n        }\r\n        case 'text': {\r\n          elt.innerText = options.text;\r\n          break;\r\n        }\r\n        case 'html': {\r\n          if (options.html instanceof Element) elt.appendChild(options.html)\r\n          else if (options.html!==undefined) elt.innerHTML = options.html;\r\n          break;\r\n        }\r\n        case 'parent': {\r\n          if (options.parent) options.parent.appendChild(elt);\r\n          break;\r\n        }\r\n        case 'options': {\r\n          if (/select/i.test(tagName)) {\r\n            for (var i in options.options) {\r\n              ol_ext_element.create('OPTION', {\r\n                html: i,\r\n                value: options.options[i],\r\n                parent: elt          \r\n              })\r\n            }\r\n          }\r\n          break;\r\n        }\r\n        case 'style': {\r\n          ol_ext_element.setStyle(elt, options.style);\r\n          break;\r\n        }\r\n        case 'change':\r\n        case 'click': {\r\n          ol_ext_element.addListener(elt, attr, options[attr]);\r\n          break;\r\n        }\r\n        case 'on': {\r\n          for (var e in options.on) {\r\n            ol_ext_element.addListener(elt, e, options.on[e]);\r\n          }\r\n          break;\r\n        }\r\n        case 'checked': {\r\n          elt.checked = !!options.checked;\r\n          break;\r\n        }\r\n        default: {\r\n          elt.setAttribute(attr, options[attr]);\r\n          break;\r\n        }\r\n      }\r\n    }\r\n  }\r\n  return elt;\r\n};\r\n\r\n/** Create a toggle switch input\r\n * @param {*} options\r\n *  @param {string|Element} options.html\r\n *  @param {string|Element} options.after\r\n *  @param {boolean} options.checked\r\n *  @param {*} [options.on] a list of actions\r\n *  @param {function} [options.click]\r\n *  @param {function} [options.change]\r\n *  @param {Element} options.parent\r\n */\r\nol_ext_element.createSwitch = function (options) {\r\n  var input = ol_ext_element.create('INPUT', {\r\n    type: 'checkbox',\r\n    on: options.on,\r\n    click: options.click,\r\n    change: options.change,\r\n    parent: options.parent\r\n  });\r\n  var opt = Object.assign ({ input: input }, options || {});\r\n  new ol_ext_input_Switch(opt);\r\n  return input;\r\n};\r\n\r\n/** Create a toggle switch input\r\n * @param {*} options\r\n *  @param {string|Element} options.html\r\n *  @param {string|Element} options.after\r\n *  @param {string} [options.name] input name\r\n *  @param {string} [options.type=checkbox] input type: radio or checkbox\r\n *  @param {string} options.value input value\r\n *  @param {*} [options.on] a list of actions\r\n *  @param {function} [options.click]\r\n *  @param {function} [options.change]\r\n *  @param {Element} options.parent\r\n */\r\nol_ext_element.createCheck = function (options) {\r\n  var input = ol_ext_element.create('INPUT', {\r\n    name: options.name,\r\n    type: (options.type==='radio' ? 'radio' : 'checkbox'),\r\n    on: options.on,\r\n    parent: options.parent\r\n  });\r\n  var opt = Object.assign ({ input: input }, options || {});\r\n  if (options.type === 'radio') {\r\n    new ol_ext_input_Radio(opt);\r\n  } else {\r\n    new ol_ext_input_Checkbox(opt);\r\n  }\r\n  return input;\r\n};\r\n\r\n/** Set inner html or append a child element to an element\r\n * @param {Element} element\r\n * @param {Element|string} html Content of the element\r\n */\r\nol_ext_element.setHTML = function(element, html) {\r\n  if (html instanceof Element) element.appendChild(html)\r\n  else if (html!==undefined) element.innerHTML = html;\r\n};\r\n\r\n/** Append text into an elemnt\r\n * @param {Element} element\r\n * @param {string} text text content\r\n */\r\nol_ext_element.appendText = function(element, text) {\r\n  element.appendChild(document.createTextNode(text||''));\r\n};\r\n\r\n/**\r\n * Add a set of event listener to an element\r\n * @param {Element} element\r\n * @param {string|Array<string>} eventType\r\n * @param {function} fn\r\n */\r\nol_ext_element.addListener = function (element, eventType, fn, useCapture ) {\r\n  if (typeof eventType === 'string') eventType = eventType.split(' ');\r\n  eventType.forEach(function(e) {\r\n    element.addEventListener(e, fn, useCapture);\r\n  });\r\n};\r\n\r\n/**\r\n * Add a set of event listener to an element\r\n * @param {Element} element\r\n * @param {string|Array<string>} eventType\r\n * @param {function} fn\r\n */\r\nol_ext_element.removeListener = function (element, eventType, fn) {\r\n  if (typeof eventType === 'string') eventType = eventType.split(' ');\r\n  eventType.forEach(function(e) {\r\n    element.removeEventListener(e, fn);\r\n  });\r\n};\r\n\r\n/**\r\n * Show an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.show = function (element) {\r\n  element.style.display = '';\r\n};\r\n\r\n/**\r\n * Hide an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.hide = function (element) {\r\n  element.style.display = 'none';\r\n};\r\n\r\n/**\r\n * Test if an element is hihdden\r\n * @param {Element} element\r\n * @return {boolean}\r\n */\r\nol_ext_element.hidden = function (element) {\r\n  return ol_ext_element.getStyle(element, 'display') === 'none';\r\n};\r\n\r\n/**\r\n * Toggle an element\r\n * @param {Element} element\r\n */\r\nol_ext_element.toggle = function (element) {\r\n  element.style.display = (element.style.display==='none' ? '' : 'none');\r\n};\r\n\r\n/** Set style of an element\r\n * @param {DOMElement} el the element\r\n * @param {*} st list of style\r\n */\r\nol_ext_element.setStyle = function(el, st) {\r\n  for (var s in st) {\r\n    switch (s) {\r\n      case 'top':\r\n      case 'left':\r\n      case 'bottom':\r\n      case 'right':\r\n      case 'minWidth':\r\n      case 'maxWidth':\r\n      case 'width':\r\n      case 'height': {\r\n        if (typeof(st[s]) === 'number') {\r\n          el.style[s] = st[s]+'px';\r\n        } else {\r\n          el.style[s] = st[s];\r\n        }\r\n        break;\r\n      }\r\n      default: {\r\n        el.style[s] = st[s];\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * Get style propertie of an element\r\n * @param {DOMElement} el the element\r\n * @param {string} styleProp Propertie name\r\n * @return {*} style value\r\n */\r\nol_ext_element.getStyle = function(el, styleProp) {\r\n  var value, defaultView = (el.ownerDocument || document).defaultView;\r\n  // W3C standard way:\r\n  if (defaultView && defaultView.getComputedStyle) {\r\n    // sanitize property name to css notation\r\n    // (hypen separated words eg. font-Size)\r\n    styleProp = styleProp.replace(/([A-Z])/g, \"-$1\").toLowerCase();\r\n    value = defaultView.getComputedStyle(el, null).getPropertyValue(styleProp);\r\n  } else if (el.currentStyle) { // IE\r\n    // sanitize property name to camelCase\r\n    styleProp = styleProp.replace(/-(\\w)/g, function(str, letter) {\r\n      return letter.toUpperCase();\r\n    });\r\n    value = el.currentStyle[styleProp];\r\n    // convert other units to pixels on IE\r\n    if (/^\\d+(em|pt|%|ex)?$/i.test(value)) { \r\n      return (function(value) {\r\n        var oldLeft = el.style.left, oldRsLeft = el.runtimeStyle.left;\r\n        el.runtimeStyle.left = el.currentStyle.left;\r\n        el.style.left = value || 0;\r\n        value = el.style.pixelLeft + \"px\";\r\n        el.style.left = oldLeft;\r\n        el.runtimeStyle.left = oldRsLeft;\r\n        return value;\r\n      })(value);\r\n    }\r\n  }\r\n  if (/px$/.test(value)) return parseInt(value);\r\n  return value;\r\n};\r\n\r\n/** Get outerHeight of an elemen\r\n * @param {DOMElement} elt\r\n * @return {number}\r\n */\r\nol_ext_element.outerHeight = function(elt) {\r\n  return elt.offsetHeight + ol_ext_element.getStyle(elt, 'marginBottom')\r\n};\r\n\r\n/** Get outerWidth of an elemen\r\n * @param {DOMElement} elt\r\n * @return {number}\r\n */\r\nol_ext_element.outerWidth = function(elt) {\r\n  return elt.offsetWidth + ol_ext_element.getStyle(elt, 'marginLeft')\r\n};\r\n\r\n/** Get element offset rect\r\n * @param {DOMElement} elt\r\n * @return {*} \r\n */\r\nol_ext_element.offsetRect = function(elt) {\r\n  var rect = elt.getBoundingClientRect();\r\n  return {\r\n    top: rect.top + (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0),\r\n    left: rect.left + (window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0),\r\n    height: rect.height || (rect.bottom - rect.top),\r\n    width: rect.width || (rect.right - rect.left)\r\n  }\r\n};\r\n\r\n/** Get element offset \r\n * @param {ELement} elt\r\n * @returns {Object} top/left offset\r\n */\r\nol_ext_element.getFixedOffset = function(elt) {\r\n  var offset = {\r\n    left:0,\r\n    top:0\r\n  };\r\n  var getOffset = function(parent) {\r\n    if (!parent) return offset;\r\n    // Check position when transform\r\n    if (ol_ext_element.getStyle(parent, 'position') === 'absolute'\r\n      && ol_ext_element.getStyle(parent, 'transform') !== \"none\") {\r\n      var r = parent.getBoundingClientRect();\r\n      offset.left += r.left; \r\n      offset.top += r.top; \r\n      return offset;\r\n    }\r\n    return getOffset(parent.offsetParent)\r\n  }\r\n  return getOffset(elt.offsetParent)\r\n};\r\n\r\n/** Get element offset rect\r\n * @param {DOMElement} elt\r\n * @param {boolean} fixed get fixed position\r\n * @return {Object} \r\n */\r\nol_ext_element.positionRect = function(elt, fixed) {\r\n  var gleft = 0;\r\n  var gtop = 0;\r\n\r\n  var getRect = function( parent ) {\r\n    if (parent) {\r\n      gleft += parent.offsetLeft;\r\n      gtop += parent.offsetTop;\r\n      return getRect(parent.offsetParent);\r\n    } else {\r\n      var r = {\r\n        top: elt.offsetTop + gtop,\r\n        left: elt.offsetLeft + gleft\r\n      };\r\n      if (fixed) {\r\n        r.top -= (window.pageYOffset || document.documentElement.scrollTop || document.body.scrollTop || 0);\r\n        r.left -= (window.pageXOffset || document.documentElement.scrollLeft || document.body.scrollLeft || 0);\r\n      }\r\n      r.bottom = r.top + elt.offsetHeight;\r\n      r.right = r.top + elt.offsetWidth;\r\n      return r;\r\n    }\r\n  }; \r\n  return getRect(elt.offsetParent);\r\n}\r\n\r\n/** Make a div scrollable without scrollbar.\r\n * On touch devices the default behavior is preserved\r\n * @param {DOMElement} elt\r\n * @param {*} options\r\n *  @param {function} [options.onmove] a function that takes a boolean indicating that the div is scrolling\r\n *  @param {boolean} [options.vertical=false] \r\n *  @param {boolean} [options.animate=true] add kinetic to scroll\r\n *  @param {boolean} [options.mousewheel=false] enable mousewheel to scroll\r\n *  @param {boolean} [options.minibar=false] add a mini scrollbar to the parent element (only vertical scrolling)\r\n * @returns {Object} an object with a refresh function\r\n */\r\nol_ext_element.scrollDiv = function(elt, options) {\r\n  options = options || {};\r\n  var pos = false;\r\n  var speed = 0;\r\n  var d, dt = 0;\r\n\r\n  var onmove = (typeof(options.onmove) === 'function' ? options.onmove : function(){});\r\n  //var page = options.vertical ? 'pageY' : 'pageX';\r\n  var page = options.vertical ? 'screenY' : 'screenX';\r\n  var scroll = options.vertical ? 'scrollTop' : 'scrollLeft';\r\n  var moving = false;\r\n  // Factor scale content / container\r\n  var scale, isbar;\r\n\r\n  // Update the minibar\r\n  var updateCounter = 0;\r\n  var updateMinibar = function() {\r\n    if (scrollbar) {\r\n      updateCounter++;\r\n      setTimeout(updateMinibarDelay);\r\n    }\r\n  }\r\n  var updateMinibarDelay = function() {\r\n    if (scrollbar) {\r\n      updateCounter--;\r\n      // Prevent multi call\r\n      if (updateCounter) return;\r\n      // Container height\r\n      var pheight = elt.clientHeight;\r\n      // Content height\r\n      var height = elt.scrollHeight;\r\n      // Set scrollbar value\r\n      scale = pheight / height;\r\n      scrollbar.style.height = scale * 100 + '%';\r\n      scrollbar.style.top = (elt.scrollTop / height * 100) + '%';\r\n      scrollContainer.style.height = pheight + 'px';\r\n      // No scroll\r\n      if (pheight > height - .5) scrollContainer.classList.add('ol-100pc');\r\n      else scrollContainer.classList.remove('ol-100pc');\r\n    }\r\n  }\r\n  \r\n  // Handle pointer down\r\n  var onPointerDown = function(e) {\r\n    // Prevent scroll\r\n    if (e.target.classList.contains('ol-noscroll')) return;\r\n    // Start scrolling\r\n    moving = false;\r\n    pos = e[page];\r\n    dt = new Date();\r\n    elt.classList.add('ol-move');\r\n    // Prevent elt dragging\r\n    e.preventDefault();\r\n    // Listen scroll\r\n    window.addEventListener('pointermove', onPointerMove);\r\n    ol_ext_element.addListener(window, ['pointerup','pointercancel'], onPointerUp);\r\n  }\r\n\r\n  // Register scroll\r\n  var onPointerMove = function(e) {\r\n    moving = true;\r\n    if (pos !== false) {\r\n      var delta = (isbar ? -1/scale : 1) * (pos - e[page]);\r\n      elt[scroll] += delta;\r\n      d = new Date();\r\n      if (d-dt) {\r\n        speed = (speed + delta / (d - dt))/2;\r\n      }\r\n      pos = e[page];\r\n      dt = d;\r\n      // Tell we are moving\r\n      if (delta) onmove(true);\r\n    }\r\n  };\r\n  \r\n  // Animate scroll\r\n  var animate = function(to) {\r\n    var step = (to>0) ? Math.min(100, to/2) : Math.max(-100, to/2);\r\n    to -= step;\r\n    elt[scroll] += step;\r\n    if (-1 < to && to < 1) {\r\n      if (moving) setTimeout(function() { elt.classList.remove('ol-move'); });\r\n      else elt.classList.remove('ol-move');\r\n      moving = false;\r\n      onmove(false);\r\n    } else {\r\n      setTimeout(function() {\r\n        animate(to);\r\n      }, 40);\r\n    }\r\n  }\r\n  \r\n  // Initialize scroll container for minibar\r\n  var scrollContainer, scrollbar;\r\n  if (options.vertical && options.minibar) {\r\n    var init = function(b) {\r\n      // only once\r\n      elt.removeEventListener('pointermove', init);\r\n      elt.parentNode.classList.add('ol-miniscroll');\r\n      scrollbar = ol_ext_element.create('DIV');\r\n      scrollContainer = ol_ext_element.create('DIV', {\r\n        className: 'ol-scroll',\r\n        html: scrollbar\r\n      });\r\n      elt.parentNode.insertBefore(scrollContainer, elt);\r\n      // Move scrollbar\r\n      scrollbar.addEventListener('pointerdown', function(e) {\r\n        isbar = true;\r\n        onPointerDown(e)\r\n      });\r\n      // Handle mousewheel\r\n      if (options.mousewheel) {\r\n        ol_ext_element.addListener(scrollContainer, \r\n          ['mousewheel', 'DOMMouseScroll', 'onmousewheel'], \r\n          function(e) { onMouseWheel(e) }\r\n        );\r\n        ol_ext_element.addListener(scrollbar, \r\n          ['mousewheel', 'DOMMouseScroll', 'onmousewheel'], \r\n          function(e) { onMouseWheel(e) }\r\n        );\r\n      }\r\n      // Update on enter\r\n      elt.parentNode.addEventListener('pointerenter', updateMinibar);\r\n      // Update on resize\r\n      window.addEventListener('resize', updateMinibar);\r\n      // Update\r\n      if (b!==false) updateMinibar();\r\n    };\r\n    // Allready inserted in the DOM\r\n    if (elt.parentNode) init(false);\r\n    // or wait when ready\r\n    else elt.addEventListener('pointermove', init);\r\n    // Update on scroll\r\n    elt.addEventListener('scroll', function() {\r\n      updateMinibar();\r\n    });\r\n  }\r\n\r\n  // Enable scroll\r\n  elt.style['touch-action'] = 'none';\r\n  elt.style['overflow'] = 'hidden';\r\n  elt.classList.add('ol-scrolldiv');\r\n  \r\n  // Start scrolling\r\n  ol_ext_element.addListener(elt, ['pointerdown'], function(e) {\r\n    isbar = false;\r\n    onPointerDown(e)\r\n  });\r\n\r\n  // Prevet click when moving...\r\n  elt.addEventListener('click', function(e) {\r\n    if (elt.classList.contains('ol-move')) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n  }, true);\r\n\r\n  // Stop scrolling\r\n  var onPointerUp = function(e) {\r\n    dt = new Date() - dt;\r\n    if (dt>100 || isbar) {\r\n      // User stop: no speed\r\n      speed = 0;\r\n    } else if (dt>0) {\r\n      // Calculate new speed\r\n      speed = ((speed||0) + (pos - e[page]) / dt) / 2;\r\n    }\r\n    animate(options.animate===false ? 0 : speed*200);\r\n    pos = false;\r\n    speed = 0;\r\n    dt = 0;\r\n    // Add class to handle click (on iframe / double-click)\r\n    if (!elt.classList.contains('ol-move')) {\r\n      elt.classList.add('ol-hasClick')\r\n      setTimeout(function() { elt.classList.remove('ol-hasClick'); }, 500);\r\n    } else {\r\n      elt.classList.remove('ol-hasClick');\r\n    }\r\n    isbar = false;\r\n    window.removeEventListener('pointermove', onPointerMove)\r\n    ol_ext_element.removeListener(window, ['pointerup','pointercancel'], onPointerUp);\r\n  };\r\n\r\n  // Handle mousewheel\r\n  var onMouseWheel = function(e) {\r\n    var delta = Math.max(-1, Math.min(1, (e.wheelDelta || -e.detail)));\r\n    elt.classList.add('ol-move');\r\n    elt[scroll] -= delta*30;\r\n    elt.classList.remove('ol-move');\r\n    return false;\r\n  }\r\n  if (options.mousewheel) { // && !elt.classList.contains('ol-touch')) {\r\n    ol_ext_element.addListener(elt, \r\n      ['mousewheel', 'DOMMouseScroll', 'onmousewheel'], \r\n      onMouseWheel\r\n    );\r\n  }\r\n\r\n  return { \r\n    refresh: updateMinibar\r\n  }\r\n};\r\n\r\n/** Dispatch an event to an Element \r\n * @param {string} eventName\r\n * @param {Element} element\r\n */\r\nol_ext_element.dispatchEvent = function (eventName, element) {\r\n  var event;\r\n  try {\r\n    event = new CustomEvent(eventName);\r\n  } catch(e) {\r\n    // Try customevent on IE\r\n    event = document.createEvent(\"CustomEvent\");\r\n    event.initCustomEvent(eventName, true, true, {});\r\n  }\r\n  element.dispatchEvent(event);\r\n};\r\n\r\nexport default ol_ext_element\r\n","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/AssertionError\n */\nimport { VERSION } from './util.js';\n/**\n * Error object thrown when an assertion failed. This is an ECMA-262 Error,\n * extended with a `code` property.\n * See https://developer.mozilla.org/en-US/docs/Web/JavaScript/Reference/Global_Objects/Error.\n */\nvar AssertionError = /** @class */ (function (_super) {\n    __extends(AssertionError, _super);\n    /**\n     * @param {number} code Error code.\n     */\n    function AssertionError(code) {\n        var _this = this;\n        var path = VERSION === 'latest' ? VERSION : 'v' + VERSION.split('-')[0];\n        var message = 'Assertion failed. See https://openlayers.org/en/' +\n            path +\n            '/doc/errors/#' +\n            code +\n            ' for details.';\n        _this = _super.call(this, message) || this;\n        /**\n         * Error code. The meaning of the code can be found on\n         * https://openlayers.org/en/latest/doc/errors/ (replace `latest` with\n         * the version found in the OpenLayers script's header comment if a version\n         * other than the latest is used).\n         * @type {number}\n         * @api\n         */\n        _this.code = code;\n        /**\n         * @type {string}\n         */\n        _this.name = 'AssertionError';\n        // Re-assign message, see https://github.com/Rich-Harris/buble/issues/40\n        _this.message = message;\n        return _this;\n    }\n    return AssertionError;\n}(Error));\nexport default AssertionError;\n//# sourceMappingURL=AssertionError.js.map","/** @namespace  ol.ext\r\n */\r\n/*global ol*/\r\nif (window.ol && !ol.ext) {\r\n  ol.ext = {};\r\n}\r\n\r\n/** Inherit the prototype methods from one constructor into another.\r\n * replace deprecated ol method\r\n *\r\n * @param {!Function} childCtor Child constructor.\r\n * @param {!Function} parentCtor Parent constructor.\r\n * @function module:ol.inherits\r\n * @api\r\n */\r\nvar ol_ext_inherits = function(child,parent) {\r\n  child.prototype = Object.create(parent.prototype);\r\n  child.prototype.constructor = child;\r\n};\r\n\r\n// Compatibilty with ol > 5 to be removed when v6 is out\r\nif (window.ol) {\r\n  if (!ol.inherits) ol.inherits = ol_ext_inherits;\r\n}\r\n\r\n/* IE Polyfill */\r\n// NodeList.forEach\r\nif (window.NodeList && !NodeList.prototype.forEach) {\r\n  NodeList.prototype.forEach = Array.prototype.forEach;\r\n}\r\n// Element.remove\r\nif (window.Element && !Element.prototype.remove) {\r\n  Element.prototype.remove = function() {\r\n    if (this.parentNode) this.parentNode.removeChild(this);\r\n  }\r\n}\r\n/* End Polyfill */\r\n\r\nexport { ol_ext_inherits }\r\nexport default ol_ext_inherits\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Button from './Button'\r\n\r\n/** A simple toggle control\r\n * The control can be created with an interaction to control its activation.\r\n *\r\n * @constructor\r\n * @extends {ol_control_Button}\r\n * @fires change:active, change:disable\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {String} options.title title of the control\r\n *  @param {String} options.html html to insert in the control\r\n *  @param {ol.interaction} options.interaction interaction associated with the control\r\n *  @param {bool} options.active the control is created active, default false\r\n *  @param {bool} options.disable the control is created disabled, default false\r\n *  @param {ol.control.Bar} options.bar a subbar associated with the control (drawn when active if control is nested in a ol.control.Bar)\r\n *  @param {bool} options.autoActive the control will activate when shown in an ol.control.Bar, default false\r\n *  @param {function} options.onToggle callback when control is clicked (or use change:active event)\r\n */\r\nvar ol_control_Toggle = function(options) {\r\n  options = options || {};\r\n  var self = this;\r\n\r\n  this.interaction_ = options.interaction;\r\n  if (this.interaction_) {\r\n    this.interaction_.setActive(options.active);\r\n    this.interaction_.on(\"change:active\", function() {\r\n      self.setActive(self.interaction_.getActive());\r\n    });\r\n  }\r\n\r\n  if (options.toggleFn) options.onToggle = options.toggleFn; // compat old version\r\n  options.handleClick = function() {\r\n    self.toggle();\r\n    if (options.onToggle) options.onToggle.call(self, self.getActive());\r\n  };\r\n  options.className = (options.className||\"\") + \" ol-toggle\";\r\n  ol_control_Button.call(this, options);\r\n\r\n  this.set(\"title\", options.title);\r\n\r\n  this.set (\"autoActivate\", options.autoActivate);\r\n  if (options.bar) this.setSubBar(options.bar);\r\n\r\n  this.setActive (options.active);\r\n  this.setDisable (options.disable);\r\n};\r\nol_ext_inherits(ol_control_Toggle, ol_control_Button);\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add interaction attached to it to this map.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_Toggle.prototype.setMap = function(map) {\r\n  if (!map && this.getMap()) {\r\n    if (this.interaction_) {\r\n      this.getMap().removeInteraction (this.interaction_);\r\n    }\r\n    if (this.subbar_) this.getMap().removeControl (this.subbar_);\r\n  }\r\n\r\n  ol_control_Button.prototype.setMap.call(this, map);\r\n\r\n  if (map) {\r\n    if (this.interaction_) map.addInteraction (this.interaction_);\r\n    if (this.subbar_) map.addControl (this.subbar_);\r\n  }\r\n};\r\n\r\n/** Get the subbar associated with a control\r\n * @return {ol_control_Bar}\r\n */\r\nol_control_Toggle.prototype.getSubBar = function () {\r\n  return this.subbar_;\r\n};\r\n\r\n/** Set the subbar associated with a control\r\n * @param {ol_control_Bar} [bar] a subbar if none remove the current subbar\r\n */\r\nol_control_Toggle.prototype.setSubBar = function (bar) {\r\n  var map = this.getMap();\r\n  if (map && this.subbar_) map.removeControl (this.subbar_);\r\n  this.subbar_ = bar;\r\n  if (bar) {\r\n    this.subbar_.setTarget(this.element);\r\n    this.subbar_.element.classList.add(\"ol-option-bar\");\r\n    if (map) map.addControl (this.subbar_);\r\n  }\r\n};\r\n\r\n/**\r\n * Test if the control is disabled.\r\n * @return {bool}.\r\n * @api stable\r\n */\r\nol_control_Toggle.prototype.getDisable = function() {\r\n  var button = this.element.querySelector(\"button\");\r\n  return button && button.disabled;\r\n};\r\n\r\n/** Disable the control. If disable, the control will be deactivated too.\r\n* @param {bool} b disable (or enable) the control, default false (enable)\r\n*/\r\nol_control_Toggle.prototype.setDisable = function(b) {\r\n  if (this.getDisable()==b) return;\r\n  this.element.querySelector(\"button\").disabled = b;\r\n  if (b && this.getActive()) this.setActive(false);\r\n\r\n  this.dispatchEvent({ type:'change:disable', key:'disable', oldValue:!b, disable:b });\r\n};\r\n\r\n/**\r\n * Test if the control is active.\r\n * @return {bool}.\r\n * @api stable\r\n */\r\nol_control_Toggle.prototype.getActive = function() {\r\n  return this.element.classList.contains(\"ol-active\");\r\n};\r\n\r\n/** Toggle control state active/deactive\r\n */\r\nol_control_Toggle.prototype.toggle = function() {\r\n  if (this.getActive()) this.setActive(false);\r\n  else this.setActive(true);\r\n};\r\n\r\n/** Change control state\r\n * @param {bool} b activate or deactivate the control, default false\r\n */\r\nol_control_Toggle.prototype.setActive = function(b) {\r\n  if (this.interaction_) this.interaction_.setActive (b);\r\n  if (this.subbar_) this.subbar_.setActive(b);\r\n  if (this.getActive()===b) return;\r\n  if (b) this.element.classList.add(\"ol-active\");\r\n  else this.element.classList.remove(\"ol-active\");\r\n\r\n  this.dispatchEvent({ type:'change:active', key:'active', oldValue:!b, active:b });\r\n};\r\n\r\n/** Set the control interaction\r\n* @param {_ol_interaction_} i interaction to associate with the control\r\n*/\r\nol_control_Toggle.prototype.setInteraction = function(i) {\r\n  this.interaction_ = i;\r\n};\r\n\r\n/** Get the control interaction\r\n* @return {_ol_interaction_} interaction associated with the control\r\n*/\r\nol_control_Toggle.prototype.getInteraction = function() {\r\n  return this.interaction_;\r\n};\r\n\r\nexport default ol_control_Toggle\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Button from \"./Button\";\r\n\r\n/** A simple push button control drawn as text\r\n * @constructor\r\n * @extends {ol_control_Button}\r\n * @param {Object=} options Control options.\r\n *\t@param {String} options.className class of the control\r\n *\t@param {String} options.title title of the control\r\n *\t@param {String} options.html html to insert in the control\r\n *\t@param {function} options.handleClick callback when control is clicked (or use change:active event)\r\n */\r\n\r\nvar ol_control_TextButton = function(options)\r\n{\toptions = options || {};\r\n    options.className = (options.className||\"\") + \" ol-text-button\";\r\n    ol_control_Button.call(this, options);\r\n};\r\nol_ext_inherits(ol_control_TextButton, ol_control_Button);\r\n\r\nexport default ol_control_TextButton\r\n","/*\tCopyright (c) 2018 Jean-Marc VIGLINO, \r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\n\r\n/** A Select interaction to delete features on click.\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires deletestart\r\n * @fires deleteend\r\n * @param {*} options ol.interaction.Select options\r\n */\r\nvar ol_interaction_Delete = function(options) {\r\n  ol_interaction_Select.call(this, options);\r\n  this.on('select', function(e) {\r\n    this.getFeatures().clear();\r\n    this.delete(e.selected);\r\n  }.bind(this));\r\n};\r\nol_ext_inherits(ol_interaction_Delete, ol_interaction_Select);\r\n\r\n/** Get vector source of the map\r\n * @return {Array<ol.source.Vector>}\r\n */\r\nol_interaction_Delete.prototype._getSources = function(layers) {\r\n  if (!this.getMap()) return [];\r\n  if (!layers) layers = this.getMap().getLayers();\r\n  var sources = [];\r\n  layers.forEach(function (l) {\r\n    // LayerGroup\r\n    if (l.getLayers) {\r\n      sources = sources.concat(this._getSources(l.getLayers()));\r\n    } else {\r\n      if (l.getSource && l.getSource() instanceof ol_source_Vector) {\r\n        sources.push(l.getSource());\r\n      }\r\n    }\r\n  }.bind(this));\r\n  return sources;\r\n};\r\n\r\n/** Delete features: remove the features from the map (from all layers in the map)\r\n * @param {ol.Collection<ol.Feature>|Array<ol.Feature>} features The features to delete\r\n * @api\r\n */\r\nol_interaction_Delete.prototype.delete = function(features) {\r\n  if (features && (features.length || features.getLength())) {\r\n    this.dispatchEvent({ type: 'deletestart', features: features });\r\n    var delFeatures = [];\r\n    // Get the sources concerned\r\n    this._getSources().forEach(function (source) {\r\n      try {\r\n        // Try to delete features in the source\r\n        features.forEach(function(f) {\r\n          source.removeFeature(f);\r\n          delFeatures.push(f);\r\n        });\r\n      } catch(e) { /* ok */ }\r\n    })\r\n    this.dispatchEvent({ type: 'deleteend', features: delFeatures });\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Delete","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n\r\n  Usefull function to handle geometric operations\r\n*/\r\n\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_LinearRing from 'ol/geom/LinearRing'\r\nimport ol_geom_MultiLineString from 'ol/geom/MultiLineString'\r\nimport ol_geom_MultiPoint from 'ol/geom/MultiPoint'\r\nimport ol_geom_MultiPolygon from 'ol/geom/MultiPolygon'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_geom_Circle from 'ol/geom/Circle'\r\nimport {getCenter as ol_extent_getCenter} from 'ol/extent'\r\nimport {buffer as ol_extent_buffer} from 'ol/extent'\r\n\r\n/** Distance beetween 2 points\r\n *\tUsefull geometric functions\r\n * @param {ol.Coordinate} p1 first point\r\n * @param {ol.Coordinate} p2 second point\r\n * @return {number} distance\r\n */\r\nvar ol_coordinate_dist2d = function(p1, p2) {\r\n  var dx = p1[0]-p2[0];\r\n  var dy = p1[1]-p2[1];\r\n  return Math.sqrt(dx*dx+dy*dy);\r\n}\r\n\r\n/** 2 points are equal\r\n *\tUsefull geometric functions\r\n * @param {ol.Coordinate} p1 first point\r\n * @param {ol.Coordinate} p2 second point\r\n * @return {boolean}\r\n */\r\nvar ol_coordinate_equal = function(p1, p2) {\r\n  return (p1[0]==p2[0] && p1[1]==p2[1]);\r\n}\r\n\r\n/** Get center coordinate of a feature\r\n * @param {ol.Feature} f\r\n * @return {ol.coordinate} the center\r\n */\r\nvar ol_coordinate_getFeatureCenter = function(f) {\r\n  return ol_coordinate_getGeomCenter (f.getGeometry());\r\n};\r\n\r\n/** Get center coordinate of a geometry\r\n* @param {ol.geom.Geometry} geom\r\n* @return {ol.Coordinate} the center\r\n*/\r\nvar ol_coordinate_getGeomCenter = function(geom) {\r\n  switch (geom.getType()) {\r\n    case 'Point': \r\n      return geom.getCoordinates();\r\n    case \"MultiPolygon\":\r\n      geom = geom.getPolygon(0);\r\n      // fallthrough\r\n    case \"Polygon\":\r\n      return geom.getInteriorPoint().getCoordinates();\r\n    default:\r\n      return geom.getClosestPoint(ol_extent_getCenter(geom.getExtent()));\r\n  }\r\n};\r\n\r\n/** Offset a polyline\r\n * @param {Array<ol.Coordinate>} coords\r\n * @param {number} offset\r\n * @return {Array<ol.Coordinate>} resulting coord\r\n * @see http://stackoverflow.com/a/11970006/796832\r\n * @see https://drive.google.com/viewerng/viewer?a=v&pid=sites&srcid=ZGVmYXVsdGRvbWFpbnxqa2dhZGdldHN0b3JlfGd4OjQ4MzI5M2Y0MjNmNzI2MjY\r\n */\r\nvar ol_coordinate_offsetCoords = function (coords, offset) {\r\n  var path = [];\r\n  var N = coords.length-1;\r\n  var max = N;\r\n  var mi, mi1, li, li1, ri, ri1, si, si1, Xi1, Yi1;\r\n  var p0, p1, p2;\r\n  var isClosed = ol_coordinate_equal(coords[0],coords[N]);\r\n  if (!isClosed) {\r\n    p0 = coords[0];\r\n    p1 = coords[1];\r\n    p2 = [\r\n      p0[0] + (p1[1] - p0[1]) / ol_coordinate_dist2d(p0,p1) *offset,\r\n      p0[1] - (p1[0] - p0[0]) / ol_coordinate_dist2d(p0,p1) *offset\r\n    ];\r\n    path.push(p2);\r\n    coords.push(coords[N])\r\n    N++;\r\n    max--;\r\n  }\r\n  for (var i = 0; i < max; i++) {\r\n    p0 = coords[i];\r\n    p1 = coords[(i+1) % N];\r\n    p2 = coords[(i+2) % N];\r\n\r\n    mi = (p1[1] - p0[1])/(p1[0] - p0[0]);\r\n    mi1 = (p2[1] - p1[1])/(p2[0] - p1[0]);\r\n    // Prevent alignements\r\n    if (Math.abs(mi-mi1) > 1e-10) {\r\n      li = Math.sqrt((p1[0] - p0[0])*(p1[0] - p0[0])+(p1[1] - p0[1])*(p1[1] - p0[1]));\r\n      li1 = Math.sqrt((p2[0] - p1[0])*(p2[0] - p1[0])+(p2[1] - p1[1])*(p2[1] - p1[1]));\r\n      ri = p0[0] + offset*(p1[1] - p0[1])/li;\r\n      ri1 = p1[0] + offset*(p2[1] - p1[1])/li1;\r\n      si = p0[1] - offset*(p1[0] - p0[0])/li;\r\n      si1 = p1[1] - offset*(p2[0] - p1[0])/li1;\r\n      Xi1 = (mi1*ri1-mi*ri+si-si1) / (mi1-mi);\r\n      Yi1 = (mi*mi1*(ri1-ri)+mi1*si-mi*si1) / (mi1-mi);\r\n\r\n      // Correction for vertical lines\r\n      if(p1[0] - p0[0] == 0) {\r\n        Xi1 = p1[0] + offset*(p1[1] - p0[1])/Math.abs(p1[1] - p0[1]);\r\n        Yi1 = mi1*Xi1 - mi1*ri1 + si1;\r\n      }\r\n      if (p2[0] - p1[0] == 0 ) {\r\n        Xi1 = p2[0] + offset*(p2[1] - p1[1])/Math.abs(p2[1] - p1[1]);\r\n        Yi1 = mi*Xi1 - mi*ri + si;\r\n      }\r\n\r\n      path.push([Xi1, Yi1]);\r\n    }\r\n  }\r\n  if (isClosed) {\r\n    path.push(path[0]);\r\n  } else {\r\n    coords.pop();\r\n    p0 = coords[coords.length-1];\r\n    p1 = coords[coords.length-2];\r\n    p2 = [\r\n      p0[0] - (p1[1] - p0[1]) / ol_coordinate_dist2d(p0,p1) *offset,\r\n      p0[1] + (p1[0] - p0[0]) / ol_coordinate_dist2d(p0,p1) *offset\r\n    ];\r\n    path.push(p2);\r\n  }\r\n  return path;\r\n}\r\n\r\n/** Find the segment a point belongs to\r\n * @param {ol.Coordinate} pt\r\n * @param {Array<ol.Coordinate>} coords\r\n * @return {} the index (-1 if not found) and the segment\r\n */\r\nvar ol_coordinate_findSegment = function (pt, coords) {\r\n  for (var i=0; i<coords.length-1; i++) {\r\n    var p0 = coords[i];\r\n    var p1 = coords[i+1];\r\n    if (ol_coordinate_equal(pt, p0) || ol_coordinate_equal(pt, p1)) {\r\n      return { index:1, segment: [p0,p1] };\r\n    } else {\r\n      var d0 = ol_coordinate_dist2d(p0,p1);\r\n      var v0 = [ (p1[0] - p0[0]) / d0, (p1[1] - p0[1]) / d0 ];\r\n      var d1 = ol_coordinate_dist2d(p0,pt);\r\n      var v1 = [ (pt[0] - p0[0]) / d1, (pt[1] - p0[1]) / d1 ];\r\n      if (Math.abs(v0[0]*v1[1] - v0[1]*v1[0]) < 1e-10) {\r\n        return { index:1, segment: [p0,p1] };\r\n      }\r\n    }\r\n  }\r\n  return { index: -1 };\r\n};\r\n\r\n/**\r\n * Split a Polygon geom with horizontal lines\r\n * @param {Array<ol.Coordinate>} geom\r\n * @param {number} y the y to split\r\n * @param {number} n contour index\r\n * @return {Array<Array<ol.Coordinate>>}\r\n */\r\nvar ol_coordinate_splitH = function (geom, y, n) {\r\n  var x, abs;\r\n  var list = [];\r\n  for (var i=0; i<geom.length-1; i++) {\r\n    // Hole separator?\r\n    if (!geom[i].length || !geom[i+1].length) continue;\r\n    // Intersect\r\n    if (geom[i][1]<=y && geom[i+1][1]>y || geom[i][1]>=y && geom[i+1][1]<y) {\r\n      abs = (y-geom[i][1]) / (geom[i+1][1]-geom[i][1]);\r\n      x = abs * (geom[i+1][0]-geom[i][0]) + geom[i][0];\r\n      list.push ({ contour: n, index: i, pt: [x,y], abs: abs });\r\n    }\r\n  }\r\n  // Sort x\r\n  list.sort(function(a,b) { return a.pt[0] - b.pt[0] });\r\n  // Horizontal segment\r\n  var result = [];\r\n  for (var j=0; j<list.length-1; j += 2) {\r\n    result.push([list[j], list[j+1]])\r\n  }\r\n  return result;\r\n};\r\n\r\n/** Create a geometry given a type and coordinates */\r\nvar ol_geom_createFromType = function (type, coordinates) {\r\n  switch (type) {\r\n    case 'LineString': return new ol_geom_LineString(coordinates);\r\n    case 'LinearRing': return new ol_geom_LinearRing(coordinates);\r\n    case 'MultiLineString': return new ol_geom_MultiLineString(coordinates);\r\n    case 'MultiPoint': return new ol_geom_MultiPoint(coordinates);\r\n    case 'MultiPolygon': return new ol_geom_MultiPolygon(coordinates);\r\n    case 'Point': return new ol_geom_Point(coordinates);\r\n    case 'Polygon': return new ol_geom_Polygon(coordinates);\r\n    default:\r\n      console.error('[createFromType] Unsupported type: '+type);\r\n      return null;\r\n  }\r\n};\r\n\r\nexport {ol_geom_createFromType}\r\nexport {ol_coordinate_dist2d, ol_coordinate_equal, ol_coordinate_findSegment, ol_coordinate_getFeatureCenter, ol_coordinate_getGeomCenter, ol_coordinate_offsetCoords, ol_coordinate_splitH}\r\n\r\n/** Intersect 2 lines\r\n * @param {Arrar<ol.coordinate>} d1\r\n * @param {Arrar<ol.coordinate>} d2\r\n */\r\nvar ol_coordinate_getIntersectionPoint = function (d1, d2) {\r\n  var d1x = d1[1][0] - d1[0][0];\r\n  var d1y = d1[1][1] - d1[0][1];\r\n  var d2x = d2[1][0] - d2[0][0];\r\n  var d2y = d2[1][1] - d2[0][1];\r\n  var det = d1x * d2y - d1y * d2x;\r\n  if (det != 0) {\r\n    var k = (d1x * d1[0][1] - d1x * d2[0][1] - d1y * d1[0][0] + d1y * d2[0][0]) / det;\r\n    return [d2[0][0] + k*d2x, d2[0][1] + k*d2y];\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\nexport { ol_coordinate_getIntersectionPoint }\r\n\r\nvar ol_extent_intersection;\r\n\r\n(function() {\r\n// Split at x\r\nfunction splitX(pts, x) {\r\n  var pt;\r\n  for (let i=pts.length-1; i>0; i--) {\r\n    if ((pts[i][0]>x && pts[i-1][0]<x) || (pts[i][0]<x && pts[i-1][0]>x)) {\r\n      pt = [ x, (x - pts[i][0]) / (pts[i-1][0]-pts[i][0]) * (pts[i-1][1]-pts[i][1]) + pts[i][1]];\r\n      pts.splice(i, 0, pt);\r\n    }\r\n  }\r\n}\r\n// Split at y\r\nfunction splitY(pts, y) {\r\n  var pt;\r\n  for (let i=pts.length-1; i>0; i--) {\r\n    if ((pts[i][1]>y && pts[i-1][1]<y) || (pts[i][1]<y && pts[i-1][1]>y)) {\r\n      pt = [ (y - pts[i][1]) / (pts[i-1][1]-pts[i][1]) * (pts[i-1][0]-pts[i][0]) + pts[i][0], y];\r\n      pts.splice(i, 0, pt);\r\n    }\r\n  }\r\n}\r\n\r\n/** Fast polygon intersection with an extent (used for area calculation)\r\n * @param {ol_extent_Extent} extent\r\n * @param {ol_geom_Polygon|ol_geom_MultiPolygon} polygon\r\n * @returns {ol_geom_Polygon|ol_geom_MultiPolygon|null} return null if not a polygon geometry\r\n */\r\nol_extent_intersection = function(extent, polygon) {\r\n  var poly = (polygon.getType() === 'Polygon');\r\n  if (!poly && polygon.getType() !== 'MultiPolygon') return null;\r\n  var geom = polygon.getCoordinates();\r\n  if (poly) geom = [geom];\r\n  geom.forEach(function(g) {\r\n    g.forEach(function(c) {\r\n      splitX(c, extent[0]);\r\n      splitX(c, extent[2]);\r\n      splitY(c, extent[1]);\r\n      splitY(c, extent[3]);\r\n    });\r\n  })\r\n  // Snap geom to the extent \r\n  geom.forEach(function(g) {\r\n    g.forEach(function(c) {\r\n      c.forEach(function(p) {\r\n        if (p[0]<extent[0]) p[0] = extent[0];\r\n        else if (p[0]>extent[2]) p[0] = extent[2];\r\n        if (p[1]<extent[1]) p[1] = extent[1];\r\n        else if (p[1]>extent[3]) p[1] = extent[3];\r\n      })\r\n    })\r\n  })\r\n  if (poly) {\r\n    return new ol_geom_Polygon(geom[0]);\r\n  } else {\r\n    return new ol_geom_MultiPolygon(geom);\r\n  }\r\n};\r\n})();\r\n\r\nexport {ol_extent_intersection}\r\n\r\n/** Add points along a segment\r\n * @param {ol_Coordinate} p1 \r\n * @param {ol_Coordinate} p2 \r\n * @param {number} d \r\n * @param {boolean} start include starting point, default true\r\n * @returns {Array<ol_Coordinate>}\r\n */\r\nvar ol_coordinate_sampleAt = function(p1, p2, d, start) {\r\n  var pts = [];\r\n  if (start!==false) pts.push(p1);\r\n  var dl = ol_coordinate_dist2d(p1,p2);\r\n  if (dl) {\r\n    var nb = Math.round(dl/d);\r\n    if (nb>1) {\r\n      var dx = (p2[0]-p1[0]) / nb;\r\n      var dy = (p2[1]-p1[1]) / nb;\r\n      for (var i=1; i<nb; i++) {\r\n        pts.push([p1[0] + dx*i, p1[1] + dy*i])\r\n      }\r\n    }\r\n  }\r\n  pts.push(p2);\r\n  return pts;\r\n};\r\nexport { ol_coordinate_sampleAt }\r\n\r\n/** Sample a LineString at a distance\r\n * @param {number} d\r\n * @returns {ol_geom_LineString}\r\n */\r\nol_geom_LineString.prototype.sampleAt = function(d) {\r\n  var line = this.getCoordinates();\r\n  var result = [];\r\n  for (var i=1; i<line.length; i++) {\r\n    result = result.concat(ol_coordinate_sampleAt(line[i-1], line[i], d, i===1));\r\n  }\r\n  return new ol_geom_LineString(result);\r\n};\r\n\r\n/** Sample a MultiLineString at a distance\r\n * @param {number} d\r\n * @returns {ol_geom_MultiLineString}\r\n */\r\nol_geom_MultiLineString.prototype.sampleAt = function(d) {\r\n  var lines = this.getCoordinates();\r\n  var result = [];\r\n  lines.forEach(function(p) {\r\n    var l = [];\r\n    for (var i=1; i<p.length; i++) {\r\n      l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], d, i===1));\r\n    }\r\n    result.push(l);\r\n  })\r\n  return new ol_geom_MultiLineString(result);\r\n};\r\n\r\n/** Sample a Polygon at a distance\r\n * @param {number} d\r\n * @returns {ol_geom_Polygon}\r\n */\r\nol_geom_Polygon.prototype.sampleAt = function(res) {\r\n  var poly = this.getCoordinates();\r\n  var result = [];\r\n  poly.forEach(function(p) {\r\n    var l = [];\r\n    for (var i=1; i<p.length; i++) {\r\n      l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], res, i===1));\r\n    }\r\n    result.push(l);\r\n  })\r\n  return new ol_geom_Polygon(result);\r\n};\r\n\r\n/** Sample a MultiPolygon at a distance\r\n * @param {number} res\r\n * @returns {ol_geom_MultiPolygon}\r\n */\r\nol_geom_MultiPolygon.prototype.sampleAt = function(res) {\r\n  var mpoly = this.getCoordinates();\r\n  var result = [];\r\n  mpoly.forEach(function(poly) {\r\n    var a = [];\r\n    result.push(a);\r\n    poly.forEach(function(p) {\r\n      var l = [];\r\n      for (var i=1; i<p.length; i++) {\r\n        l = l.concat(ol_coordinate_sampleAt(p[i-1], p[i], res, i===1));\r\n      }\r\n      a.push(l);\r\n    })\r\n  });\r\n  return new ol_geom_MultiPolygon(result);\r\n};\r\n\r\n/** Intersect a geometry using a circle\r\n * @param {ol_geom_Geometry} geom\r\n * @param {number} resolution circle resolution to sample the polygon on the circle, default 1\r\n * @returns {ol_geom_Geometry}\r\n */\r\nol_geom_Circle.prototype.intersection = function(geom, resolution) {\r\n  if (geom.sampleAt) {\r\n    var ext = ol_extent_buffer(this.getCenter().concat(this.getCenter()), this.getRadius());\r\n    geom = ol_extent_intersection(ext, geom);\r\n    geom = geom.simplify(resolution);\r\n    var c = this.getCenter();\r\n    var r = this.getRadius();\r\n    //var res = (resolution||1) * r / 100;\r\n    var g = geom.sampleAt(resolution).getCoordinates();\r\n    switch (geom.getType()) {\r\n      case 'Polygon': g = [g];\r\n        // fallthrough\r\n      case 'MultiPolygon': {\r\n        var hasout = false;\r\n        // var hasin = false;\r\n        var result = [];\r\n        g.forEach(function(poly) {\r\n          var a = [];\r\n          result.push(a);\r\n          poly.forEach(function(ring) {\r\n            var l = [];\r\n            a.push(l);\r\n            ring.forEach(function(p) {\r\n              var d = ol_coordinate_dist2d(c, p);\r\n              if (d > r) {\r\n                hasout = true;\r\n                l.push([\r\n                  c[0] + r / d * (p[0]-c[0]),\r\n                  c[1] + r / d * (p[1]-c[1])\r\n                ]);\r\n              } else {\r\n                // hasin = true;\r\n                l.push(p);\r\n              }\r\n            });\r\n          })\r\n        });\r\n        if (!hasout) return geom;\r\n        if (geom.getType() === 'Polygon') {\r\n          return new ol_geom_Polygon(result[0]);\r\n        } else {\r\n          return new ol_geom_MultiPolygon(result);\r\n        }\r\n      }\r\n    }\r\n  } else {\r\n    console.warn('[ol/geom/Circle~intersection] Unsupported geometry type: '+geom.getType());\r\n  }\r\n  return geom;\r\n};\r\n","import ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\n\r\nvar ol_style_Style_defaultStyle;\r\n\r\n(function() {\r\n\r\n// Style\r\nvar white = [255, 255, 255, 1];\r\nvar blue = [0, 153, 255, 1];\r\nvar width = 3;\r\n\r\nvar defaultEditStyle = [\r\n  new ol_style_Style({\r\n    stroke: new ol_style_Stroke({ color: white, width: width + 2 })\r\n  }),\r\n  new ol_style_Style({\r\n    image: new ol_style_Circle({\r\n      radius: width * 2,\r\n      fill: new ol_style_Fill({ color: blue }),\r\n      stroke: new ol_style_Stroke({ color: white, width: width / 2 })\r\n    }),\r\n    stroke: new ol_style_Stroke({ color: blue, width: width }),\r\n    fill: new ol_style_Fill({\r\n      color: [255, 255, 255, 0.5]\r\n    })\r\n  })\r\n];\r\n\r\n/**\r\n * Get the default style\r\n * @param {boolean|*} [edit] true to get editing style or a { color, fillColor } object, default get default blue style\r\n * @return {Array<ol.style.Style>}\r\n */\r\nol_style_Style_defaultStyle = function(edit) {\r\n  if (edit===true) {\r\n    return defaultEditStyle;\r\n  } else {\r\n    edit = edit || {};\r\n    var fill = new ol_style_Fill({\r\n      color: edit.fillColor || 'rgba(255,255,255,0.4)'\r\n    });\r\n    var stroke = new ol_style_Stroke({\r\n      color: edit.color || '#3399CC',\r\n      width: 1.25\r\n    });\r\n    var style = new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        fill: fill,\r\n        stroke: stroke,\r\n        radius: 5\r\n      }),\r\n      fill: fill,\r\n      stroke: stroke\r\n    });\r\n    return [ style ];\r\n  }\r\n};\r\n\r\n})();\r\n\r\nexport default ol_style_Style_defaultStyle\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n\treleased under the CeCILL-B license (French BSD license)\r\n\t(http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport {ol_coordinate_dist2d, ol_coordinate_findSegment, ol_coordinate_offsetCoords} from \"../geom/GeomUtils\";\r\n\r\nimport ol_style_Style_defaultStyle from '../style/defaultStyle'\r\n\r\n/** Offset interaction for offseting feature geometry\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires offsetstart\r\n * @fires offsetting\r\n * @fires offsetend\r\n * @param {any} options\r\n *\t@param {function} [options.filter] a function that takes a feature and a layer and return true if the feature can be modified\r\n *\t@param {ol.layer.Vector | Array<ol.layer.Vector>} options.layers list of feature to transform \r\n *\t@param {ol.Collection.<ol.Feature>} options.features collection of feature to transform\r\n *\t@param {ol.source.Vector | undefined} options.source source to duplicate feature when ctrl key is down\r\n *\t@param {boolean} options.duplicate force feature to duplicate (source must be set)\r\n *  @param {ol.style.Style | Array.<ol.style.Style> | ol.style.StyleFunction | undefined} style style for the sketch\r\n */\r\nvar ol_interaction_Offset = function(options) {\r\n  if (!options) options = {};\r\n\r\n\t// Extend pointer\r\n\tol_interaction_Pointer.call(this, {\r\n    handleDownEvent: this.handleDownEvent_,\r\n    handleDragEvent: this.handleDragEvent_,\r\n    handleMoveEvent: this.handleMoveEvent_,\r\n    handleUpEvent: this.handleUpEvent_\r\n  });\r\n    \r\n  this._filter = options.filter;\r\n\t// Collection of feature to transform\r\n\tthis.features_ = options.features;\r\n\t// List of layers to transform\r\n  this.layers_ = options.layers ? (options.layers instanceof Array) ? options.layers:[options.layers] : null;\r\n  // duplicate\r\n  this.set('duplicate', options.duplicate);\r\n  this.source_ = options.source;\r\n  // Style\r\n  this._style = (typeof (options.style) === 'function') ? options.style : function () { \r\n    if (options.style) return options.style;\r\n    else return ol_style_Style_defaultStyle(true);\r\n  };\r\n\r\n  // init\r\n  this.previousCursor_ = false;\r\n};\r\nol_ext_inherits(ol_interaction_Offset, ol_interaction_Pointer);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Offset.prototype.setMap = function(map) {\r\n\tol_interaction_Pointer.prototype.setMap.call (this, map);\r\n};\r\n\r\n/** Get Feature at pixel\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {any} a feature and the hit point\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.getFeatureAtPixel_ = function(e) {\r\n  var self = this;\r\n\treturn this.getMap().forEachFeatureAtPixel(e.pixel,\r\n\t\tfunction(feature, layer) {\r\n      var current;\r\n      if (self._filter && !self._filter(feature, layer)) return false;\r\n\t\t\t// feature belong to a layer\r\n\t\t\tif (self.layers_) {\r\n        for (var i=0; i<self.layers_.length; i++) {\r\n          if (self.layers_[i]===layer) {\r\n            current = feature;\r\n            break;\r\n          }\r\n\t\t\t\t}\r\n\t\t\t}\r\n\t\t\t// feature in the collection\r\n\t\t\telse if (self.features_) {\r\n        self.features_.forEach (function(f) {\r\n          if (f===feature) {\r\n            current = feature \r\n          }\r\n        });\r\n\t\t\t}\r\n\t\t\t// Others\r\n\t\t\telse {\r\n        current = feature;\r\n      }\r\n\r\n      // Only poygon or linestring\r\n      var typeGeom = current.getGeometry().getType();\r\n      if (current && /Polygon|LineString/.test(typeGeom)) {\r\n        if (typeGeom==='Polygon' && current.getGeometry().getCoordinates().length>1) return false;\r\n        // test distance\r\n        var p = current.getGeometry().getClosestPoint(e.coordinate);\r\n        var dx = p[0]-e.coordinate[0];\r\n        var dy = p[1]-e.coordinate[1];\r\n        var d = Math.sqrt(dx*dx+dy*dy) / e.frameState.viewState.resolution;\r\n      \r\n        if (d<5) {\r\n          return { \r\n            feature: current, \r\n            hit: p, \r\n            coordinates: current.getGeometry().getCoordinates(),\r\n            geom: current.getGeometry().clone(),\r\n            geomType: typeGeom\r\n          }\r\n        } else {\r\n          return false;\r\n        }\r\n      } else {\r\n        return false;\r\n      }\r\n\t\t},  { hitTolerance: 5 });\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleDownEvent_ = function(e) {\t\r\n  this.current_ = this.getFeatureAtPixel_(e);\r\n  if (this.current_) {\r\n    this.currentStyle_ = this.current_.feature.getStyle();\r\n    if (this.source_ && (this.get('duplicate') || e.originalEvent.ctrlKey)) {\r\n      this.current_.feature = this.current_.feature.clone();\r\n      this.current_.feature.setStyle(this._style(this.current_.feature));\r\n      this.source_.addFeature(this.current_.feature);\r\n    } else {\r\n      // Modify the current feature\r\n      this.current_.feature.setStyle(this._style(this.current_.feature));\r\n      this._modifystart = true;\r\n    }\r\n    this.dispatchEvent({ type:'offsetstart', feature: this.current_.feature, offset: 0 });\r\n    return true;\r\n  } else  {\r\n    return false;\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleDragEvent_ = function(e) {\r\n  if (this._modifystart) {\r\n    this.dispatchEvent({ type:'modifystart', features: [ this.current_.feature ] });\r\n    this._modifystart = false;\r\n  }\r\n  var p = this.current_.geom.getClosestPoint(e.coordinate);\r\n  var d = ol_coordinate_dist2d(p, e.coordinate);\r\n  var seg, v1, v2, offset;\r\n  switch (this.current_.geomType) {\r\n    case  'Polygon': {\r\n      seg = ol_coordinate_findSegment(p, this.current_.coordinates[0]).segment;\r\n      if (seg) {\r\n        v1 = [ seg[1][0]-seg[0][0], seg[1][1]-seg[0][1] ];\r\n        v2 = [ e.coordinate[0]-p[0], e.coordinate[1]-p[1] ];\r\n        if (v1[0]*v2[1] - v1[1]*v2[0] > 0) {\r\n          d = -d;\r\n        }\r\n\r\n        offset = [];\r\n        for (var i=0; i<this.current_.coordinates.length; i++) {\r\n          offset.push( ol_coordinate_offsetCoords(this.current_.coordinates[i], i==0 ? d : -d) );\r\n        }\r\n        this.current_.feature.setGeometry(new ol_geom_Polygon(offset));\r\n      }\r\n      break;\r\n    }\r\n    case 'LineString': {\r\n      seg = ol_coordinate_findSegment(p, this.current_.coordinates).segment;\r\n      if (seg) {\r\n        v1 = [ seg[1][0]-seg[0][0], seg[1][1]-seg[0][1] ];\r\n        v2 = [ e.coordinate[0]-p[0], e.coordinate[1]-p[1] ];\r\n        if (v1[0]*v2[1] - v1[1]*v2[0] > 0) {\r\n          d = -d;\r\n        }\r\n        offset = ol_coordinate_offsetCoords(this.current_.coordinates, d);\r\n        this.current_.feature.setGeometry(new ol_geom_LineString(offset));\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      break;\r\n    }\r\n  }\r\n  this.dispatchEvent({ type:'offsetting', feature: this.current_.feature, offset: d, segment: [p, e.coordinate], coordinate: e.coordinate });  \r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Map browser event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleUpEvent_ = function(e) {\r\n  if (!this._modifystart) {\r\n    this.dispatchEvent({ type:'offsetend', feature: this.current_.feature, coordinate: e.coordinate }); \r\n  }\r\n  this.current_.feature.setStyle(this.currentStyle_);\r\n  this.current_ = false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} e Event.\r\n * @private\r\n */\r\nol_interaction_Offset.prototype.handleMoveEvent_ = function(e) {\t\r\n  var f = this.getFeatureAtPixel_(e);\r\n  if (f) {\r\n    if (this.previousCursor_ === false) {\r\n      this.previousCursor_ = e.map.getTargetElement().style.cursor;\r\n    }\r\n    e.map.getTargetElement().style.cursor = 'pointer';\r\n  } else {\r\n    e.map.getTargetElement().style.cursor = this.previousCursor_;\r\n    this.previousCursor_ = false;\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Offset\r\n","import {ol_coordinate_equal} from \"./GeomUtils\";\r\nimport ol_geom_LineString from \"ol/geom/LineString\";\r\n\r\n/** Split a lineString by a point or a list of points\r\n *\tNB: points must be on the line, use getClosestPoint() to get one\r\n * @param {ol.Coordinate | Array<ol.Coordinate>} pt points to split the line\r\n * @param {Number} tol distance tolerance for 2 points to be equal\r\n */\r\nol_geom_LineString.prototype.splitAt = function(pt, tol) {\r\n  var i;\r\n  if (!pt) return [this];\r\n    if (!tol) tol = 1e-10;\r\n    // Test if list of points\r\n    if (pt.length && pt[0].length) {\r\n      var result = [this];\r\n      for (i=0; i<pt.length; i++) {\r\n        var r = [];\r\n        for (var k=0; k<result.length; k++) {\r\n          var ri = result[k].splitAt(pt[i], tol);\r\n          r = r.concat(ri);\r\n        }\r\n        result = r;\r\n      }\r\n      return result;\r\n    }\r\n    // Nothing to do\r\n    if (ol_coordinate_equal(pt,this.getFirstCoordinate())\r\n    || ol_coordinate_equal(pt,this.getLastCoordinate())) {\r\n      return [this];\r\n    }\r\n    // Get\r\n    var c0 = this.getCoordinates();\r\n    var ci=[c0[0]];\r\n    var c = [];\r\n    for (i=0; i<c0.length-1; i++) {\r\n      // Filter equal points\r\n      if (ol_coordinate_equal(c0[i],c0[i+1])) continue;\r\n      // Extremity found\r\n      if (ol_coordinate_equal(pt,c0[i+1])) {\r\n        ci.push(c0[i+1]);\r\n        c.push(new ol_geom_LineString(ci));\r\n        ci = [];\r\n      }\r\n      // Test alignement\r\n      else if (!ol_coordinate_equal(pt,c0[i])) {\r\n        var d1, d2, split=false;\r\n        if (c0[i][0] == c0[i+1][0]) {\r\n          d1 = (c0[i][1]-pt[1]) / (c0[i][1]-c0[i+1][1]);\r\n          split = (c0[i][0] == pt[0]) && (0 < d1 && d1 <= 1)\r\n        } else if (c0[i][1] == c0[i+1][1]) {\r\n          d1 = (c0[i][0]-pt[0]) / (c0[i][0]-c0[i+1][0]);\r\n          split = (c0[i][1] == pt[1]) && (0 < d1 && d1 <= 1)\r\n        } else {\r\n          d1 = (c0[i][0]-pt[0]) / (c0[i][0]-c0[i+1][0]);\r\n          d2 = (c0[i][1]-pt[1]) / (c0[i][1]-c0[i+1][1]);\r\n          split = (Math.abs(d1-d2) <= tol && 0 < d1 && d1 <= 1)\r\n        }\r\n        // pt is inside the segment > split\r\n        if (split) {\r\n          ci.push(pt);\r\n          c.push (new ol_geom_LineString(ci));\r\n          ci = [pt];\r\n        }\r\n      }\r\n      ci.push(c0[i+1]);\r\n    }\r\n    if (ci.length>1) c.push (new ol_geom_LineString(ci));\r\n    if (c.length) return c;\r\n    else return [this];\r\n}\r\n\r\n// import('ol-ext/geom/LineStringSplitAt')","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport {ol_coordinate_dist2d} from \"../geom/GeomUtils\";\r\nimport '../geom/LineStringSplitAt'\r\n\r\n/** Interaction split interaction for splitting feature geometry\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires  beforesplit, aftersplit, pointermove\r\n * @param {*} \r\n *  @param {ol.source.Vector|Array<ol.source.Vector>} [options.sources] a list of source to split (configured with useSpatialIndex set to true), if none use map visible layers.\r\n *  @param {ol.Collection.<ol.Feature>} options.features collection of feature to split (instead of a list of sources)\r\n *  @param {integer} options.snapDistance distance (in px) to snap to an object, default 25px\r\n *\t@param {string|undefined} options.cursor cursor name to display when hovering an objet\r\n *  @param {function|undefined} options.filter a filter that takes a feature and return true if it can be clipped, default always split.\r\n *  @param ol_style_Style | Array<ol_style_Style> | false | undefined} options.featureStyle Style for the selected features, choose false if you don't want feature selection. By default the default edit style is used.\r\n *  @param {ol_style_Style | Array<ol_style_Style> | undefined} options.sketchStyle Style for the sektch features. \r\n *  @param {function|undefined} options.tolerance Distance between the calculated intersection and a vertex on the source geometry below which the existing vertex will be used for the split.  Default is 1e-10.\r\n */\r\nvar ol_interaction_Split = function(options) {\r\n  if (!options) options = {};\r\n\r\n  ol_interaction_Interaction.call(this, {\r\n    handleEvent: function(e) {\r\n      switch (e.type) {\r\n        case \"singleclick\":\r\n          return this.handleDownEvent(e);\r\n        case \"pointermove\":\r\n          return this.handleMoveEvent(e);\r\n        default: \r\n          return true;\r\n      }\r\n      //return true;\r\n    }\r\n  });\r\n\r\n  // Snap distance (in px)\r\n  this.snapDistance_ = options.snapDistance || 25;\r\n  // Split tolerance between the calculated intersection and the geometry\r\n  this.tolerance_ = options.tolerance || 1e-10;\r\n  // Cursor\r\n  this.cursor_ = options.cursor;\r\n\r\n  // List of source to split\r\n  this.setSources(options.sources);\r\n\r\n  if (options.features) {\r\n    this.sources_.push (new ol_source_Vector({ features: options.features }));\r\n  }\r\n\r\n  // Get all features candidate\r\n  this.filterSplit_ = options.filter || function(){ return true; };\r\n\r\n  // Default style\r\n  var white = [255, 255, 255, 1];\r\n  var blue = [0, 153, 255, 1];\r\n  var width = 3;\r\n  var fill = new ol_style_Fill({ color: 'rgba(255,255,255,0.4)' });\r\n  var stroke = new ol_style_Stroke({\r\n    color: '#3399CC',\r\n    width: 1.25\r\n  });\r\n  var sketchStyle = [\r\n    new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        fill: fill,\r\n        stroke: stroke,\r\n        radius: 5\r\n      }),\r\n      fill: fill,\r\n      stroke: stroke\r\n    })\r\n  ];\r\n  var featureStyle = [\r\n    new ol_style_Style({\r\n      stroke: new ol_style_Stroke({\r\n        color: white,\r\n        width: width + 2\r\n      })\r\n    }),\r\n    new ol_style_Style({\r\n      image: new ol_style_Circle({\r\n        radius: 2*width,\r\n        fill: new ol_style_Fill({\r\n          color: blue\r\n        }),\r\n        stroke: new ol_style_Stroke({\r\n          color: white,\r\n          width: width/2\r\n        })\r\n      }),\r\n      stroke: new ol_style_Stroke({\r\n          color: blue,\r\n          width: width\r\n        })\r\n    }),\r\n  ];\r\n\r\n  // Custom style\r\n  if (options.sketchStyle) sketchStyle = options.sketchStyle instanceof Array ? options.sketchStyle : [options.sketchStyle];\r\n  if (options.featureStyle) featureStyle = options.featureStyle instanceof Array ? options.featureStyle : [options.featureStyle];\r\n\r\n  // Create a new overlay for the sketch\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'Split overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: function(f) {\r\n      if (f._sketch_) return sketchStyle;\r\n      else return featureStyle;\r\n    }\r\n  });\r\n\r\n};\r\nol_ext_inherits(ol_interaction_Split, ol_interaction_Interaction);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Split.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/** Get sources to split features in\r\n * @return {Array<ol.source.Vector>}\r\n */\r\nol_interaction_Split.prototype.getSources = function() {\r\n  if (!this.sources_ && this.getMap()) {\r\n    var sources = []\r\n    function getSources(layers) {\r\n      layers.forEach(function(layer) {\r\n        if (layer.getVisible()) {\r\n          if (layer.getSource && layer.getSource() instanceof ol_source_Vector) {\r\n            sources.unshift(layer.getSource());\r\n          } else if (layer.getLayers) {\r\n            getSources(layer.getLayers());\r\n          }\r\n        }\r\n      })\r\n    }\r\n    getSources(this.getMap().getLayers())\r\n    return sources;\r\n  }\r\n  return this.sources_ || [];\r\n};\r\n\r\n/** Set sources to split features in \r\n * @param {ol.source.Vector|Array<ol.source.Vector>} [sources]\r\n */\r\nol_interaction_Split.prototype.setSources = function(sources) {\r\n  this.sources_ = sources ? (sources instanceof Array ? sources||false : [sources]) : false;\r\n};\r\n\r\n\r\n/** Get closest feature at pixel\r\n * @param {ol.Pixel} \r\n * @return {ol.feature} \r\n * @private\r\n */\r\nol_interaction_Split.prototype.getClosestFeature = function(e) {\r\n  var source, f, c, g, d = this.snapDistance_+1;\r\n  // Look for closest point in the sources\r\n  this.getSources().forEach(function(si) {\r\n    var fi = si.getClosestFeatureToCoordinate(e.coordinate);\r\n    if (fi && fi.getGeometry().splitAt) {\r\n      var ci = fi.getGeometry().getClosestPoint(e.coordinate);\r\n      var gi = new ol_geom_LineString([e.coordinate,ci]);\r\n      var di = gi.getLength() / e.frameState.viewState.resolution;\r\n      if (di < d) {\r\n        source = si;\r\n        d = di;\r\n        f = fi;\r\n        g = gi;\r\n        c = ci;\r\n      }\r\n    }\r\n  });\r\n  // Snap ?\r\n  if (d > this.snapDistance_) {\r\n    return false;\r\n  } else {\r\n    // Snap to node\r\n    var coord = this.getNearestCoord (c, f.getGeometry().getCoordinates());\r\n    var p = this.getMap().getPixelFromCoordinate(coord);\r\n    if (ol_coordinate_dist2d(e.pixel, p) < this.snapDistance_) {\r\n      c = coord;\r\n    }\r\n    //\r\n    return { source:source, feature:f, coord: c, link: g };\r\n  }\r\n}\r\n\r\n/** Get nearest coordinate in a list \r\n* @param {ol.coordinate} pt the point to find nearest\r\n* @param {Array<ol.coordinate>} coords list of coordinates\r\n* @return {ol.coordinate} the nearest coordinate in the list\r\n*/\r\nol_interaction_Split.prototype.getNearestCoord = function(pt, coords) {\r\n  var d, dm=Number.MAX_VALUE, p0;\r\n  for (var i=0; i < coords.length; i++) {\r\n    d = ol_coordinate_dist2d (pt, coords[i]);\r\n    if (d < dm) {\r\n      dm = d;\r\n      p0 = coords[i];\r\n    }\r\n  }\r\n  return p0;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n */\r\nol_interaction_Split.prototype.handleDownEvent = function(evt) {\r\n  // Something to split ?\r\n  var current = this.getClosestFeature(evt);\r\n\r\n  if (current) {\r\n    var self = this;\r\n    self.overlayLayer_.getSource().clear();\r\n    var split = current.feature.getGeometry().splitAt(current.coord, this.tolerance_);\r\n    var i;\r\n    if (split.length > 1) {\r\n      var tosplit = [];\r\n      for (i=0; i<split.length; i++) {\r\n        var f = current.feature.clone();\r\n        f.setGeometry(split[i]);\r\n        tosplit.push(f);\r\n      }\r\n      self.dispatchEvent({ type:'beforesplit', original: current.feature, features: tosplit });\r\n      current.source.dispatchEvent({ type:'beforesplit', original: current.feature, features: tosplit });\r\n      current.source.removeFeature(current.feature);\r\n      for (i=0; i<tosplit.length; i++) {\r\n        current.source.addFeature(tosplit[i]);\r\n      }\r\n      self.dispatchEvent({ type:'aftersplit', original: current.feature, features: tosplit });\r\n      current.source.dispatchEvent({ type:'aftersplit', original: current.feature, features: tosplit });\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n */\r\nol_interaction_Split.prototype.handleMoveEvent = function(e) {\r\n  var map = e.map;\r\n  this.overlayLayer_.getSource().clear();\r\n  var current = this.getClosestFeature(e);\r\n\r\n  if (current && this.filterSplit_(current.feature)) {\r\n    var p, l;\r\n    // Draw sketch\r\n    this.overlayLayer_.getSource().addFeature(current.feature);\r\n    p = new ol_Feature(new ol_geom_Point(current.coord));\r\n    p._sketch_ = true;\r\n    this.overlayLayer_.getSource().addFeature(p);\r\n    //\r\n    l = new ol_Feature(current.link);\r\n    l._sketch_ = true;\r\n    this.overlayLayer_.getSource().addFeature(l);\r\n    // move event\r\n    this.dispatchEvent({\r\n      type: 'pointermove',\r\n      coordinate: e.coordinate,\r\n      frameState: e.frameState,\r\n      originalEvent: e.originalEvent,\r\n      map: e.map,\r\n      pixel: e.pixel,\r\n      feature: current.feature,\r\n      linkGeometry: current.link\r\n    });\r\n  } else {\r\n    this.dispatchEvent(e);\r\n  }\r\n\r\n  var element = map.getTargetElement();\r\n  if (this.cursor_) {\r\n    if (current) {\r\n      if (element.style.cursor != this.cursor_) {\r\n        this.previousCursor_ = element.style.cursor;\r\n        element.style.cursor = this.cursor_;\r\n      }\r\n    } else if (this.previousCursor_ !== undefined) {\r\n      element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\nexport default ol_interaction_Split\r\n","import ol_ext_inherits from '../util/ext'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_style_RegularShape from 'ol/style/RegularShape'\r\nimport {fromExtent as ol_geom_Polygon_fromExtent} from 'ol/geom/Polygon'\r\nimport {boundingExtent as ol_extent_boundingExtent, buffer as ol_extent_buffer, createEmpty as ol_extent_createEmpty, extend as ol_extent_extend, getCenter as ol_extent_getCenter} from 'ol/extent'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\n\r\n/** Interaction rotate\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires select | rotatestart | rotating | rotateend | translatestart | translating | translateend | scalestart | scaling | scaleend\r\n * @param {any} options\r\n *  @param {function} options.filter A function that takes a Feature and a Layer and returns true if the feature may be transformed or false otherwise.\r\n *  @param {Array<ol.Layer>} options.layers array of layers to transform,\r\n *  @param {ol.Collection<ol.Feature>} options.features collection of feature to transform,\r\n *\t@param {ol.EventsConditionType|undefined} options.condition A function that takes an ol.MapBrowserEvent and a feature collection and returns a boolean to indicate whether that event should be handled. default: ol.events.condition.always.\r\n *\t@param {ol.EventsConditionType|undefined} options.addCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event should be handled ie. the feature will be added to the transforms features. default: ol.events.condition.never.\r\n *\t@param {number | undefined} options.hitTolerance Tolerance to select feature in pixel, default 0\r\n *\t@param {bool} options.translateFeature Translate when click on feature\r\n *\t@param {bool} options.translate Can translate the feature\r\n *  @param {bool} options.translateBBox Enable translate when the user drags inside the bounding box\r\n *\t@param {bool} options.stretch can stretch the feature\r\n *\t@param {bool} options.scale can scale the feature\r\n *\t@param {bool} options.rotate can rotate the feature\r\n *\t@param {bool} options.noFlip prevent the feature geometry to flip, default false\r\n *\t@param {bool} options.selection the intraction handle selection/deselection, if not use the select prototype to add features to transform, default true\r\n *\t@param {ol.events.ConditionType | undefined} options.keepAspectRatio A function that takes an ol.MapBrowserEvent and returns a boolean to keep aspect ratio, default ol.events.condition.shiftKeyOnly.\r\n *\t@param {ol.events.ConditionType | undefined} options.modifyCenter A function that takes an ol.MapBrowserEvent and returns a boolean to apply scale & strech from the center, default ol.events.condition.metaKey or ol.events.condition.ctrlKey.\r\n *\t@param {boolean} options.enableRotatedTransform Enable transform when map is rotated\r\n *\t@param {boolean} [options.keepRectangle=false] keep rectangle when possible\r\n *\t@param {*} options.style list of ol.style for handles\r\n *  @param {number|Array<number>|function} [options.pointRadius=0] radius for points or a function that takes a feature and returns the radius (or [radiusX, radiusY]). If not null show handles to transform the points\r\n */\r\nvar ol_interaction_Transform = function(options) {\r\n  if (!options) options = {};\r\n\tvar self = this;\r\n\r\n  this.selection_ = new ol_Collection();\r\n\r\n\t// Create a new overlay layer for the sketch\r\n\tthis.handles_ = new ol_Collection();\r\n\tthis.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      features: this.handles_,\r\n      useSpatialIndex: false,\r\n      wrapX: false // For vector editing across the -180 and 180 meridians to work properly, this should be set to false\r\n    }),\r\n    name:'Transform overlay',\r\n    displayInLayerSwitcher: false,\r\n    // Return the style according to the handle type\r\n    style: function (feature) {\r\n      return (self.style[(feature.get('handle')||'default')+(feature.get('constraint')||'')+(feature.get('option')||'')]);\r\n    },\r\n  });\r\n\r\n  // Extend pointer\r\n  ol_interaction_Pointer.call(this, {\r\n    handleDownEvent: this.handleDownEvent_,\r\n    handleDragEvent: this.handleDragEvent_,\r\n    handleMoveEvent: this.handleMoveEvent_,\r\n    handleUpEvent: this.handleUpEvent_\r\n  });\r\n\r\n  // Collection of feature to transform\r\n  this.features_ = options.features;\r\n  // Filter or list of layers to transform\r\n  if (typeof(options.filter)==='function') this._filter = options.filter;\r\n  this.layers_ = options.layers ? (options.layers instanceof Array) ? options.layers:[options.layers] : null;\r\n\r\n  this._handleEvent = options.condition || function() { return true; };\r\n  this.addFn_ = options.addCondition || function() { return false; };\r\n  this.setPointRadius(options.pointRadius);\r\n  /* Translate when click on feature */\r\n  this.set('translateFeature', (options.translateFeature!==false));\r\n  /* Can translate the feature */\r\n  this.set('translate', (options.translate!==false));\r\n  /* Translate when click on the bounding box */\r\n  this.set('translateBBox', (options.translateBBox===true));\r\n  /* Can stretch the feature */\r\n  this.set('stretch', (options.stretch!==false));\r\n  /* Can scale the feature */\r\n  this.set('scale', (options.scale!==false));\r\n  /* Can rotate the feature */\r\n  this.set('rotate', (options.rotate!==false));\r\n  /* Keep aspect ratio */\r\n  this.set('keepAspectRatio', (options.keepAspectRatio || function(e){ return e.originalEvent.shiftKey }));\r\n  /* Modify center */\r\n  this.set('modifyCenter', (options.modifyCenter || function(e){ return e.originalEvent.metaKey || e.originalEvent.ctrlKey }));\r\n  /* Prevent flip */\r\n  this.set('noFlip', (options.noFlip || false));\r\n  /* Handle selection */\r\n  this.set('selection', (options.selection !== false));\r\n  /*  */\r\n  this.set('hitTolerance', (options.hitTolerance || 0));\r\n  /* Enable view rotated transforms */\r\n  this.set('enableRotatedTransform', (options.enableRotatedTransform || false));\r\n  /* Keep rectangle angles 90 degrees */\r\n  this.set('keepRectangle', (options.keepRectangle || false));\r\n\r\n\r\n  // Force redraw when changed\r\n  this.on ('propertychange', function() {\r\n    this.drawSketch_();\r\n  });\r\n\r\n  // setstyle\r\n  this.setDefaultStyle();\r\n};\r\nol_ext_inherits(ol_interaction_Transform, ol_interaction_Pointer);\r\n\r\n/** Cursors for transform\r\n*/\r\nol_interaction_Transform.prototype.Cursors = {\r\n  'default': 'auto',\r\n  'select': 'pointer',\r\n  'translate': 'move',\r\n  'rotate': 'move',\r\n  'rotate0': 'move',\r\n  'scale': 'nesw-resize',\r\n  'scale1': 'nwse-resize',\r\n  'scale2': 'nesw-resize',\r\n  'scale3': 'nwse-resize',\r\n  'scalev': 'ew-resize',\r\n  'scaleh1': 'ns-resize',\r\n  'scalev2': 'ew-resize',\r\n  'scaleh3': 'ns-resize'\r\n};\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setMap = function(map) {\r\n  var oldMap = this.getMap();\r\n  if (oldMap) {\r\n    var targetElement = oldMap.getTargetElement();\r\n    oldMap.removeLayer(this.overlayLayer_);\r\n    if (this.previousCursor_ && targetElement) {\r\n      targetElement.style.cursor = this.previousCursor_;\r\n    }\r\n    this.previousCursor_ = undefined;\r\n  }\r\n  ol_interaction_Pointer.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n  if (map === null) {\r\n    this.select(null);\r\n  }\r\n  if (map !== null) {\r\n    this.isTouch = /touch/.test(map.getViewport().className);\r\n    this.setDefaultStyle();\r\n  }\r\n};\r\n\r\n/**\r\n * Activate/deactivate interaction\r\n * @param {bool}\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setActive = function(b) {\r\n  this.select(null);\r\n  this.overlayLayer_.setVisible(b);\r\n  ol_interaction_Pointer.prototype.setActive.call (this, b);\r\n};\r\n\r\n/** Set default sketch style\r\n * @param {Object|undefined} options\r\n *  @param {ol_style_Stroke} stroke stroke style for selection rectangle\r\n *  @param {ol_style_Fill} fill fill style for selection rectangle\r\n *  @param {ol_style_Stroke} pointStroke stroke style for handles\r\n *  @param {ol_style_Fill} pointFill fill style for handles\r\n */\r\nol_interaction_Transform.prototype.setDefaultStyle = function(options) {\r\n  options = options || {}\r\n  // Style\r\n  var stroke = options.pointStroke || new ol_style_Stroke({ color: [255,0,0,1], width: 1 });\r\n  var strokedash = options.stroke || new ol_style_Stroke({ color: [255,0,0,1], width: 1, lineDash:[4,4] });\r\n  var fill0 = options.fill || new ol_style_Fill({ color:[255,0,0,0.01] });\r\n  var fill = options.pointFill || new ol_style_Fill({ color:[255,255,255,0.8] });\r\n  var circle = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 12 : 6,\r\n      displacement: this.isTouch ? [24, -24] : [12, -12],\r\n      points: 15\r\n    });\r\n  // Old version with no displacement\r\n  if (!circle.setDisplacement) circle.getAnchor()[0] = this.isTouch ? -10 : -5; \r\n  var bigpt = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 16 : 8,\r\n      points: 4,\r\n      angle: Math.PI/4\r\n    });\r\n  var smallpt = new ol_style_RegularShape({\r\n      fill: fill,\r\n      stroke: stroke,\r\n      radius: this.isTouch ? 12 : 6,\r\n      points: 4,\r\n      angle: Math.PI/4\r\n    });\r\n  function createStyle (img, stroke, fill) {\r\n    return [ new ol_style_Style({image:img, stroke:stroke, fill:fill}) ];\r\n  }\r\n  /** Style for handles */\r\n  this.style = {\r\n    'default': createStyle (bigpt, strokedash, fill0),\r\n    'translate': createStyle (bigpt, stroke, fill),\r\n    'rotate': createStyle (circle, stroke, fill),\r\n    'rotate0': createStyle (bigpt, stroke, fill),\r\n    'scale': createStyle (bigpt, stroke, fill),\r\n    'scale1': createStyle (bigpt, stroke, fill),\r\n    'scale2': createStyle (bigpt, stroke, fill),\r\n    'scale3': createStyle (bigpt, stroke, fill),\r\n    'scalev': createStyle (smallpt, stroke, fill),\r\n    'scaleh1': createStyle (smallpt, stroke, fill),\r\n    'scalev2': createStyle (smallpt, stroke, fill),\r\n    'scaleh3': createStyle (smallpt, stroke, fill),\r\n  };\r\n  this.drawSketch_();\r\n}\r\n\r\n/**\r\n * Set sketch style.\r\n * @param {style} style Style name: 'default','translate','rotate','rotate0','scale','scale1','scale2','scale3','scalev','scaleh1','scalev2','scaleh3'\r\n * @param {ol.style.Style|Array<ol.style.Style>} olstyle\r\n * @api stable\r\n */\r\nol_interaction_Transform.prototype.setStyle = function(style, olstyle) {\r\n  if (!olstyle) return;\r\n  if (olstyle instanceof Array) this.style[style] = olstyle;\r\n  else this.style[style] = [ olstyle ];\r\n  for (var i=0; i<this.style[style].length; i++) {\r\n    var im = this.style[style][i].getImage();\r\n    if (im) {\r\n      if (style == 'rotate') {\r\n        im.getAnchor()[0] = -5;\r\n      }\r\n      if (this.isTouch) im.setScale(1.8);\r\n    }\r\n    var tx = this.style[style][i].getText();\r\n    if (tx) {\r\n      if (style == 'rotate') tx.setOffsetX(this.isTouch ? 14 : 7);\r\n      if (this.isTouch) tx.setScale(1.8);\r\n    }\r\n  }\r\n  this.drawSketch_();\r\n};\r\n\r\n/** Get Feature at pixel\r\n * @param {ol.Pixel}\r\n * @return {ol.feature}\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.getFeatureAtPixel_ = function(pixel) {\r\n  var self = this;\r\n  return this.getMap().forEachFeatureAtPixel(pixel,\r\n    function(feature, layer) {\r\n      var found = false;\r\n      // Overlay ?\r\n      if (!layer) {\r\n        if (feature===self.bbox_) {\r\n          if (self.get('translateBBox')) {\r\n            return { feature: feature, handle: 'translate', constraint:'', option: '' };\r\n          } else {\r\n            return false;\r\n          }\r\n        }\r\n        self.handles_.forEach (function(f) { if (f===feature) found=true; });\r\n        if (found) return { feature: feature, handle:feature.get('handle'), constraint:feature.get('constraint'), option:feature.get('option') };\r\n      }\r\n      // No seletion\r\n      if (!self.get('selection')) {\r\n        // Return the currently selected feature the user is interacting with.\r\n        if (self.selection_.getArray().some(function(f) { return feature === f; })) {\r\n          return { feature: feature };\r\n        }\r\n        return null;\r\n      }\r\n      // filter condition\r\n      if (self._filter) {\r\n        if (self._filter(feature,layer)) return { feature: feature };\r\n        else return null;\r\n      }\r\n      // feature belong to a layer\r\n      else if (self.layers_) {\r\n        for (var i=0; i<self.layers_.length; i++) {\r\n          if (self.layers_[i]===layer) return { feature: feature };\r\n        }\r\n        return null;\r\n      }\r\n      // feature in the collection\r\n      else if (self.features_) {\r\n        self.features_.forEach (function(f) { if (f===feature) found=true; });\r\n        if (found) return { feature: feature };\r\n        else return null;\r\n      }\r\n      // Others\r\n      else return { feature: feature };\r\n    },\r\n    { hitTolerance: this.get('hitTolerance') }\r\n  ) || {};\r\n}\r\n\r\n/** Rotate feature from map view rotation\r\n * @param {ol.Feature} f the feature\r\n * @param {boolean} clone clone resulting geom\r\n * @param {ol.geom.Geometry} rotated geometry\r\n */\r\nol_interaction_Transform.prototype.getGeometryRotateToZero_ = function(f, clone) {\r\n  var origGeom = f.getGeometry();\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  if (viewRotation === 0 || !this.get('enableRotatedTransform')) {\r\n    return (clone) ? origGeom.clone() : origGeom;\r\n  }\r\n  var rotGeom = origGeom.clone();\r\n  rotGeom.rotate(viewRotation * -1, this.getMap().getView().getCenter());\r\n  return rotGeom;\r\n};\r\n\r\n/** Test if rectangle\r\n * @param {ol.Geometry} geom\r\n * @returns {boolean}\r\n * @private\r\n */\r\nol_interaction_Transform.prototype._isRectangle = function(geom) {\r\n  if (this.get('keepRectangle') && geom.getType() === 'Polygon') {\r\n    var coords = geom.getCoordinates()[0];\r\n    return coords.length === 5;\r\n  }\r\n  return false;\r\n};\r\n\r\n/** Draw transform sketch\r\n* @param {boolean} draw only the center\r\n*/\r\nol_interaction_Transform.prototype.drawSketch_ = function(center) {\r\n  var i, f, geom;\r\n  var keepRectangle = this.selection_.item(0) && this._isRectangle(this.selection_.item(0).getGeometry());\r\n  this.overlayLayer_.getSource().clear();\r\n  if (!this.selection_.getLength()) return;\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  var ext = this.getGeometryRotateToZero_(this.selection_.item(0)).getExtent();\r\n  var coords;\r\n  if (keepRectangle) {\r\n    coords = this.getGeometryRotateToZero_(this.selection_.item(0)).getCoordinates()[0].slice(0, 4);\r\n    coords.unshift(coords[3]);\r\n  }\r\n  // Clone and extend\r\n  ext = ol_extent_buffer(ext, 0);\r\n  this.selection_.forEach(function (f) {\r\n    var extendExt = this.getGeometryRotateToZero_(f).getExtent();\r\n    ol_extent_extend(ext, extendExt);\r\n  }.bind(this));\r\n\r\n  var ptRadius = (this.selection_.getLength() === 1 ? this._pointRadius(this.selection_.item(0)) : 0);\r\n  if (ptRadius && !(ptRadius instanceof Array)) ptRadius = [ptRadius, ptRadius];\r\n\r\n  if (center===true) {\r\n    if (!this.ispt_) {\r\n      this.overlayLayer_.getSource().addFeature(new ol_Feature( { geometry: new ol_geom_Point(this.center_), handle:'rotate0' }) );\r\n      geom = ol_geom_Polygon_fromExtent(ext);\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        geom.rotate(viewRotation, this.getMap().getView().getCenter())\r\n      }\r\n      f = this.bbox_ = new ol_Feature(geom);\r\n      this.overlayLayer_.getSource().addFeature (f);\r\n    }\r\n  } else {\r\n    if (this.ispt_) {\r\n      // Calculate extent arround the point\r\n      var p = this.getMap().getPixelFromCoordinate([ext[0], ext[1]]);\r\n      if (p) {\r\n        var dx = ptRadius ? ptRadius[0] || 10 : 10;\r\n        var dy = ptRadius ? ptRadius[1] || 10 : 10;\r\n        ext = ol_extent_boundingExtent([\r\n          this.getMap().getCoordinateFromPixel([p[0] - dx, p[1] - dy]),\r\n          this.getMap().getCoordinateFromPixel([p[0] + dx, p[1] + dy])\r\n        ]);\r\n      }\r\n    }\r\n    geom = keepRectangle ? new ol_geom_Polygon([coords]) : ol_geom_Polygon_fromExtent(ext);\r\n    if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n      geom.rotate(viewRotation, this.getMap().getView().getCenter())\r\n    }\r\n    f = this.bbox_ = new ol_Feature(geom);\r\n    var features = [];\r\n    var g = geom.getCoordinates()[0];\r\n    if (!this.ispt_ || ptRadius) {\r\n      features.push(f);\r\n      // Middle\r\n      if (!this.iscircle_ && !this.ispt_ && this.get('stretch') && this.get('scale')) for (i=0; i<g.length-1; i++) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point([(g[i][0]+g[i+1][0])/2,(g[i][1]+g[i+1][1])/2]), handle:'scale', constraint:i%2?\"h\":\"v\", option:i });\r\n        features.push(f);\r\n      }\r\n      // Handles\r\n      if (this.get('scale')) for (i=0; i<g.length-1; i++) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point(g[i]), handle:'scale', option:i });\r\n        features.push(f);\r\n      }\r\n      // Center\r\n      if (this.get('translate') && !this.get('translateFeature')) {\r\n        f = new ol_Feature( { geometry: new ol_geom_Point([(g[0][0]+g[2][0])/2, (g[0][1]+g[2][1])/2]), handle:'translate' });\r\n        features.push(f);\r\n      }\r\n    }\r\n    // Rotate\r\n    if (!this.iscircle_ && this.get('rotate')) {\r\n      f = new ol_Feature( { geometry: new ol_geom_Point(g[3]), handle:'rotate' });\r\n      features.push(f);\r\n    }\r\n    // Add sketch\r\n    this.overlayLayer_.getSource().addFeatures(features);\r\n  }\r\n\r\n};\r\n\r\n/** Select a feature to transform\r\n* @param {ol.Feature} feature the feature to transform\r\n* @param {boolean} add true to add the feature to the selection, default false\r\n*/\r\nol_interaction_Transform.prototype.select = function(feature, add) {\r\n  if (!feature) {\r\n    this.selection_.clear();\r\n    this.drawSketch_();\r\n    return;\r\n  }\r\n  if (!feature.getGeometry || !feature.getGeometry()) return;\r\n  // Add to selection\r\n  if (add) {\r\n    this.selection_.push(feature);\r\n  } else {\r\n\tvar index = this.selection_.getArray().indexOf(feature);\r\n\tthis.selection_.removeAt(index);\r\n  }\r\n  this.ispt_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false);\r\n  this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n  this.drawSketch_();\r\n  this.watchFeatures_();\r\n  // select event\r\n  this.dispatchEvent({ type:'select', feature: feature, features: this.selection_ });\r\n};\r\n\r\n/** Update the selection collection.\r\n* @param {ol.Collection<ol.Feature>} features the features to transform\r\n*/\r\nol_interaction_Transform.prototype.setSelection = function(features) {\r\n  this.selection_.clear();\r\n  features.forEach(function(feature) {\r\n    this.selection_.push(feature);\r\n  }.bind(this));\r\n\r\n  this.ispt_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false);\r\n  this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n  this.drawSketch_();\r\n  this.watchFeatures_();\r\n  // select event\r\n  this.dispatchEvent({ type:'select', features: this.selection_ });\r\n};\r\n\r\n/** Watch selected features\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.watchFeatures_ = function() {\r\n  // Listen to feature modification\r\n  if (this._featureListeners) {\r\n    this._featureListeners.forEach(function (l) {\r\n      ol_Observable_unByKey(l)\r\n    });\r\n  }\r\n  this._featureListeners = [];\r\n  this.selection_.forEach(function(f) {\r\n    this._featureListeners.push(\r\n      f.on('change', function() {\r\n        if (!this.isUpdating_) {\r\n          this.drawSketch_();\r\n        }\r\n      }.bind(this))\r\n    );\r\n  }.bind(this));\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleDownEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.selection_)) return;\r\n  var sel = this.getFeatureAtPixel_(evt.pixel);\r\n  var feature = sel.feature;\r\n  if (this.selection_.getLength()\r\n    && this.selection_.getArray().indexOf(feature) >= 0\r\n    && ((this.ispt_ && this.get('translate')) || this.get('translateFeature'))\r\n  ){\r\n    sel.handle = 'translate';\r\n  }\r\n  if (sel.handle) {\r\n    this.mode_ = sel.handle;\r\n    this.opt_ = sel.option;\r\n    this.constraint_ = sel.constraint;\r\n    // Save info\r\n    var viewRotation = this.getMap().getView().getRotation();\r\n    this.coordinate_ = evt.coordinate;\r\n    this.pixel_ = evt.pixel;\r\n    this.geoms_ = [];\r\n    this.rotatedGeoms_ = [];\r\n    var extent = ol_extent_createEmpty();\r\n    var rotExtent = ol_extent_createEmpty();\r\n    for (var i=0, f; f=this.selection_.item(i); i++) {\r\n      this.geoms_.push(f.getGeometry().clone());\r\n      extent = ol_extent_extend(extent, f.getGeometry().getExtent());\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var rotGeom = this.getGeometryRotateToZero_(f, true);\r\n        this.rotatedGeoms_.push(rotGeom);\r\n        rotExtent = ol_extent_extend(rotExtent, rotGeom.getExtent());\r\n      }\r\n    }\r\n    this.extent_ = (ol_geom_Polygon_fromExtent(extent)).getCoordinates()[0];\r\n    if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n      this.rotatedExtent_ = (ol_geom_Polygon_fromExtent(rotExtent)).getCoordinates()[0];\r\n    }\r\n    if (this.mode_==='rotate') {\r\n      this.center_ = this.getCenter() || ol_extent_getCenter(extent);\r\n      // we are now rotating (cursor down on rotate mode), so apply the grabbing cursor\r\n      var element = evt.map.getTargetElement();\r\n      element.style.cursor = this.Cursors.rotate0;\r\n      this.previousCursor_ = element.style.cursor;\r\n    } else {\r\n      this.center_ = ol_extent_getCenter(extent);\r\n    }\r\n    this.angle_ = Math.atan2(this.center_[1]-evt.coordinate[1], this.center_[0]-evt.coordinate[0]);\r\n\r\n    this.dispatchEvent({\r\n      type: this.mode_+'start',\r\n      feature: this.selection_.item(0), // backward compatibility\r\n      features: this.selection_,\r\n      pixel: evt.pixel,\r\n      coordinate: evt.coordinate\r\n    });\r\n    return true;\r\n  }\r\n  else if (this.get('selection')) {\r\n    if (feature){\r\n      if (!this.addFn_(evt)) this.selection_.clear();\r\n      var index = this.selection_.getArray().indexOf(feature);\r\n      if (index < 0) this.selection_.push(feature);\r\n      else this.selection_.removeAt(index);\r\n    } else {\r\n      this.selection_.clear();\r\n    }\r\n    this.ispt_ = this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Point\") : false;\r\n    this.iscircle_ = (this.selection_.getLength()===1 ? (this.selection_.item(0).getGeometry().getType() == \"Circle\") : false);\r\n    this.drawSketch_();\r\n    this.watchFeatures_();\r\n    this.dispatchEvent({ type:'select', feature: feature, features: this.selection_, pixel: evt.pixel, coordinate: evt.coordinate });\r\n    return false;\r\n  }\r\n};\r\n\r\n\r\n/**\r\n * Get features to transform\r\n * @return {ol.Collection<ol.Feature>}\r\n */\r\nol_interaction_Transform.prototype.getFeatures = function() {\r\n  return this.selection_;\r\n};\r\n\r\n/**\r\n * Get the rotation center\r\n * @return {ol.coordinates|undefined}\r\n */\r\nol_interaction_Transform.prototype.getCenter = function() {\r\n  return this.get('center');\r\n};\r\n\r\n/**\r\n * Set the rotation center\r\n * @param {ol.coordinates|undefined} c the center point, default center on the objet\r\n */\r\nol_interaction_Transform.prototype.setCenter = function(c) {\r\n  return this.set('center', c);\r\n}\r\n\r\nfunction projectVectorOnVector(displacement_vector, base) {\r\n  var k = (displacement_vector[0] * base[0] + displacement_vector[1] * base[1]) / (base[0] * base[0] + base[1] * base[1]);\r\n  return [base[0] * k, base[1] * k];\r\n}\r\n\r\nfunction countVector(start, end) {\r\n  return [end[0] - start[0], end[1] - start[1]];\r\n}\r\n\r\nfunction movePoint(point, displacementVector) {\r\n  return [point[0]+displacementVector[0], point[1]+displacementVector[1]];\r\n}\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleDragEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.features_)) return;\r\n  var viewRotation = this.getMap().getView().getRotation();\r\n  var i, j, f, geometry;\r\n  var pt0 = [this.coordinate_[0], this.coordinate_[1]];\r\n  var pt = [evt.coordinate[0], evt.coordinate[1]];\r\n  this.isUpdating_ = true;\r\n  switch (this.mode_) {\r\n    case 'rotate': {\r\n      var a = Math.atan2(this.center_[1]-pt[1], this.center_[0]-pt[0]);\r\n      if (!this.ispt) {\r\n        // var geometry = this.geom_.clone();\r\n        // geometry.rotate(a-this.angle_, this.center_);\r\n        // this.feature_.setGeometry(geometry);\r\n        for (i=0, f; f=this.selection_.item(i); i++) {\r\n          geometry = this.geoms_[i].clone();\r\n          geometry.rotate(a - this.angle_, this.center_);\r\n          // bug: ol, bad calculation circle geom extent\r\n          if (geometry.getType() == 'Circle') geometry.setCenterAndRadius(geometry.getCenter(), geometry.getRadius());\r\n          f.setGeometry(geometry);\r\n        }\r\n      }\r\n      this.drawSketch_(true);\r\n      this.dispatchEvent({\r\n        type:'rotating',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        angle: a-this.angle_,\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    case 'translate': {\r\n      var deltaX = pt[0] - pt0[0];\r\n      var deltaY = pt[1] - pt0[1];\r\n\r\n      //this.feature_.getGeometry().translate(deltaX, deltaY);\r\n      for (i=0, f; f=this.selection_.item(i); i++) {\r\n        f.getGeometry().translate(deltaX, deltaY);\r\n      }\r\n      this.handles_.forEach(function(f) {\r\n        f.getGeometry().translate(deltaX, deltaY);\r\n      });\r\n\r\n      this.coordinate_ = evt.coordinate;\r\n      this.dispatchEvent({\r\n        type:'translating',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        delta:[deltaX,deltaY],\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    case 'scale': {\r\n      var center = this.center_;\r\n      if (this.get('modifyCenter')(evt)) {\r\n        var extentCoordinates = this.extent_;\r\n        if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n          extentCoordinates = this.rotatedExtent_;\r\n        }\r\n        center = extentCoordinates[(Number(this.opt_)+2)%4];\r\n      }\r\n      var keepRectangle = (this.geoms_.length == 1 && this._isRectangle(this.geoms_[0]));\r\n      var stretch = this.constraint_;\r\n      var opt = this.opt_;\r\n\r\n      var downCoordinate = this.coordinate_;\r\n      var dragCoordinate = evt.coordinate;\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var downPoint = new ol_geom_Point(this.coordinate_);\r\n        downPoint.rotate(viewRotation * -1, center);\r\n        downCoordinate = downPoint.getCoordinates();\r\n\r\n        var dragPoint = new ol_geom_Point(evt.coordinate);\r\n        dragPoint.rotate(viewRotation * -1, center);\r\n        dragCoordinate = dragPoint.getCoordinates();\r\n      }\r\n\r\n      var scx = ((dragCoordinate)[0] - (center)[0]) / (downCoordinate[0] - (center)[0]);\r\n      var scy = ((dragCoordinate)[1] - (center)[1]) / (downCoordinate[1] - (center)[1]);\r\n      var displacementVector = [dragCoordinate[0] - downCoordinate[0], (dragCoordinate)[1] - downCoordinate[1]];\r\n\r\n      if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n        var centerPoint = new ol_geom_Point(center);\r\n        centerPoint.rotate(viewRotation * -1, this.getMap().getView().getCenter());\r\n        center = centerPoint.getCoordinates();\r\n      }\r\n\r\n      if (this.get('noFlip')) {\r\n        if (scx<0) scx=-scx;\r\n        if (scy<0) scy=-scy;\r\n      }\r\n\r\n      if (this.constraint_) {\r\n        if (this.constraint_==\"h\") scx=1;\r\n        else scy=1;\r\n      } else {\r\n        if (this.get('keepAspectRatio')(evt)) {\r\n          scx = scy = Math.min(scx,scy);\r\n        }\r\n      }\r\n\r\n      for (i=0, f; f=this.selection_.item(i); i++) {\r\n        geometry = (viewRotation === 0 || !this.get('enableRotatedTransform')) ? this.geoms_[i].clone() : this.rotatedGeoms_[i].clone();\r\n        geometry.applyTransform(function(g1, g2, dim) {\r\n          if (dim<2) return g2;\r\n\r\n          if (!keepRectangle) {\r\n            for (j=0; j<g1.length; j+=dim) {\r\n              if (scx!=1) g2[j] = center[0] + (g1[j]-center[0])*scx;\r\n              if (scy!=1) g2[j+1] = center[1] + (g1[j+1]-center[1])*scy;\r\n            }\r\n          } else {\r\n            var pointArray = [[6], [0, 8], [2], [4]]\r\n            var pointA = [g1[0], g1[1]];\r\n            var pointB = [g1[2], g1[3]];\r\n            var pointC = [g1[4], g1[5]];\r\n            var pointD = [g1[6], g1[7]];\r\n            var pointA1 = [g1[8], g1[9]];\r\n\r\n            if (stretch) {\r\n              var base = (opt % 2 === 0) ? countVector(pointA, pointB) : countVector(pointD, pointA);\r\n              var projectedVector = projectVectorOnVector(displacementVector, base);\r\n              var nextIndex = opt+1 < pointArray.length ? opt+1 : 0;\r\n              var coordsToChange = [...pointArray[opt], ...pointArray[nextIndex]];\r\n\r\n              for (j = 0; j < g1.length; j += dim) {\r\n                  g2[j] = coordsToChange.includes(j) ? g1[j] + projectedVector[0] : g1[j];\r\n                  g2[j + 1] = coordsToChange.includes(j) ? g1[j + 1] + projectedVector[1] : g1[j + 1];\r\n              }\r\n            } else {\r\n              var projectedLeft, projectedRight;\r\n              switch (opt) {\r\n                case 0:\r\n                  displacementVector = countVector(pointD, dragCoordinate);\r\n                  projectedLeft = projectVectorOnVector(displacementVector, countVector(pointC, pointD));\r\n                  projectedRight = projectVectorOnVector(displacementVector, countVector(pointA, pointD));\r\n                  [g2[0], g2[1]] = movePoint(pointA, projectedLeft);\r\n                  [g2[4], g2[5]] = movePoint(pointC, projectedRight);\r\n                  [g2[6], g2[7]] = movePoint(pointD, displacementVector);\r\n                  [g2[8], g2[9]] = movePoint(pointA1, projectedLeft);\r\n                  break;\r\n                case 1:\r\n                  displacementVector = countVector(pointA, dragCoordinate);\r\n                  projectedLeft = projectVectorOnVector(displacementVector, countVector(pointD, pointA));\r\n                  projectedRight = projectVectorOnVector(displacementVector, countVector(pointB, pointA));\r\n                  [g2[0], g2[1]] = movePoint(pointA, displacementVector);\r\n                  [g2[2], g2[3]] = movePoint(pointB, projectedLeft);\r\n                  [g2[6], g2[7]] = movePoint(pointD, projectedRight);\r\n                  [g2[8], g2[9]] = movePoint(pointA1, displacementVector);\r\n                  break;\r\n                case 2:\r\n                  displacementVector = countVector(pointB, dragCoordinate);\r\n                  projectedLeft = projectVectorOnVector(displacementVector, countVector(pointA, pointB));\r\n                  projectedRight = projectVectorOnVector(displacementVector, countVector(pointC, pointB));\r\n                  [g2[0], g2[1]] = movePoint(pointA, projectedRight);\r\n                  [g2[2], g2[3]] = movePoint(pointB, displacementVector);\r\n                  [g2[4], g2[5]] = movePoint(pointC, projectedLeft);\r\n                  [g2[8], g2[9]] = movePoint(pointA1, projectedRight);\r\n                  break;\r\n                case 3:\r\n                  displacementVector = countVector(pointC, dragCoordinate);\r\n                  projectedLeft = projectVectorOnVector(displacementVector, countVector(pointB, pointC));\r\n                  projectedRight = projectVectorOnVector(displacementVector, countVector(pointD, pointC));\r\n                  [g2[2], g2[3]] = movePoint(pointB, projectedRight);\r\n                  [g2[4], g2[5]] = movePoint(pointC, displacementVector);\r\n                  [g2[6], g2[7]] = movePoint(pointD, projectedLeft);\r\n                  break;\r\n              }\r\n            }\r\n          }\r\n\r\n          // bug: ol, bad calculation circle geom extent\r\n          if (geometry.getType() == 'Circle') geometry.setCenterAndRadius(geometry.getCenter(), geometry.getRadius());\r\n          return g2;\r\n        });\r\n        if (this.get('enableRotatedTransform') && viewRotation !== 0) {\r\n          //geometry.rotate(viewRotation, rotationCenter);\r\n          geometry.rotate(viewRotation, this.getMap().getView().getCenter());\r\n        }\r\n        f.setGeometry(geometry);\r\n      }\r\n      this.drawSketch_();\r\n      this.dispatchEvent({\r\n        type:'scaling',\r\n        feature: this.selection_.item(0),\r\n        features: this.selection_,\r\n        scale:[scx,scy],\r\n        pixel: evt.pixel,\r\n        coordinate: evt.coordinate\r\n      });\r\n      break;\r\n    }\r\n    default: break;\r\n  }\r\n  this.isUpdating_ = false;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n * @private\r\n */\r\nol_interaction_Transform.prototype.handleMoveEvent_ = function(evt) {\r\n  if (!this._handleEvent(evt, this.features_)) return;\r\n  // console.log(\"handleMoveEvent\");\r\n  if (!this.mode_) {\r\n    var sel = this.getFeatureAtPixel_(evt.pixel);\r\n    var element = evt.map.getTargetElement();\r\n    if (sel.feature) {\r\n      var c = sel.handle ? this.Cursors[(sel.handle||'default')+(sel.constraint||'')+(sel.option||'')] : this.Cursors.select;\r\n\r\n      if (this.previousCursor_===undefined) {\r\n        this.previousCursor_ = element.style.cursor;\r\n      }\r\n      element.style.cursor = c;\r\n    } else {\r\n      if (this.previousCursor_!==undefined) element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_Transform.prototype.handleUpEvent_ = function(evt) {\r\n  // remove rotate0 cursor on Up event, otherwise it's stuck on grab/grabbing\r\n  if (this.mode_ === 'rotate') {\r\n    var element = evt.map.getTargetElement();\r\n    element.style.cursor = this.Cursors.default;\r\n    this.previousCursor_ = undefined;\r\n  }\r\n\r\n  //dispatchEvent\r\n  this.dispatchEvent({\r\n    type:this.mode_+'end',\r\n    feature: this.selection_.item(0),\r\n    features: this.selection_,\r\n    oldgeom: this.geoms_[0],\r\n    oldgeoms: this.geoms_\r\n  });\r\n\r\n  this.drawSketch_();\r\n  this.mode_ = null;\r\n  return false;\r\n};\r\n\r\n/** Get the features that are selected for transform\r\n * @return ol.Collection\r\n */\r\nol_interaction_Transform.prototype.getFeatures = function() {\r\n  return this.selection_;\r\n};\r\n\r\n/** Set the point radius to calculate handles on points\r\n *  @param {number|Array<number>|function} [pointRadius=0] radius for points or a function that takes a feature and returns the radius (or [radiusX, radiusY]). If not null show handles to transform the points\r\n */\r\nol_interaction_Transform.prototype.setPointRadius = function(pointRadius) {\r\n  if (typeof(pointRadius)==='function') {\r\n    this._pointRadius = pointRadius;\r\n  } else {\r\n    this._pointRadius = function(){ return pointRadius };\r\n  }\r\n};\r\n\r\n\r\nexport default ol_interaction_Transform\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Pointer from 'ol/interaction/Pointer'\r\nimport ol_style_Style from 'ol/style/Style'\r\nimport ol_style_Stroke from 'ol/style/Stroke'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_style_Fill from 'ol/style/Fill'\r\nimport ol_style_Circle from 'ol/style/Circle'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_Feature from 'ol/Feature'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport {ol_coordinate_dist2d, ol_coordinate_equal} from \"../geom/GeomUtils\";\r\nimport {boundingExtent as ol_extent_boundingExtent} from 'ol/extent'\r\nimport {buffer as ol_extent_buffer} from 'ol/extent'\r\nimport {altKeyOnly as ol_events_condition_altKeyOnly} from 'ol/events/condition'\r\nimport {primaryAction as ol_events_condition_primaryAction} from 'ol/events/condition'\r\nimport {always as ol_events_condition_always} from 'ol/events/condition'\r\n\r\nimport '../geom/LineStringSplitAt'\r\n\r\n/** Interaction for modifying feature geometries. Similar to the core ol/interaction/Modify.\r\n * The interaction is more suitable to use to handle feature modification: only features concerned \r\n * by the modification are passed to the events (instead of all feature with ol/interaction/Modify)\r\n * - the modifystart event is fired before the feature is modified (no points still inserted)\r\n * - the modifyend event is fired after the modification\r\n * - it fires a modifying event\r\n * @constructor\r\n * @extends {ol_interaction_Pointer}\r\n * @fires modifystart\r\n * @fires modifying\r\n * @fires modifyend\r\n * @fires select\r\n * @param {*} options\r\n *\t@param {ol.source.Vector} options.source a source to modify (configured with useSpatialIndex set to true)\r\n *\t@param {ol.source.Vector|Array<ol.source.Vector>} options.sources a list of source to modify (configured with useSpatialIndex set to true)\r\n *  @param {ol.Collection.<ol.Feature>} options.features collection of feature to modify\r\n *  @param {integer} options.pixelTolerance Pixel tolerance for considering the pointer close enough to a segment or vertex for editing. Default is 10.\r\n *  @param {function|undefined} options.filter a filter that takes a feature and return true if it can be modified, default always true.\r\n *  @param {ol.style.Style | Array<ol.style.Style> | undefined} options.style Style for the sketch features.\r\n *  @param {ol.EventsConditionType | undefined} options.condition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event will be considered to add or move a vertex to the sketch. Default is ol.events.condition.primaryAction.\r\n *  @param {ol.EventsConditionType | undefined} options.deleteCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether that event should be handled. By default, ol.events.condition.singleClick with ol.events.condition.altKeyOnly results in a vertex deletion.\r\n *  @param {ol.EventsConditionType | undefined} options.insertVertexCondition A function that takes an ol.MapBrowserEvent and returns a boolean to indicate whether a new vertex can be added to the sketch features. Default is ol.events.condition.always\r\n *  @param {boolean} options.wrapX Wrap the world horizontally on the sketch overlay, default false\r\n */\r\nvar ol_interaction_ModifyFeature = function(options){\r\n  if (!options) options = {};\r\n\r\n  var dragging, modifying;\r\n  ol_interaction_Pointer.call(this,{\r\n    /*\r\n    handleDownEvent: this.handleDownEvent,\r\n    handleDragEvent: this.handleDragEvent,\r\n    handleMoveEvent: this.handleMoveEvent,\r\n    handleUpEvent: this.handleUpEvent,\r\n    */\r\n    handleEvent: function(e) {\r\n      switch(e.type) {\r\n        case 'pointerdown': {\r\n          dragging = this.handleDownEvent(e);\r\n          modifying = dragging || this._deleteCondition(e);\r\n          return !dragging;\r\n        }\r\n        case 'pointerup': {\r\n          dragging = false;\r\n          return this.handleUpEvent(e);\r\n        }\r\n        case 'pointerdrag': {\r\n          if (dragging) return this.handleDragEvent(e);\r\n          else return true;\r\n        }\r\n        case 'pointermove': {\r\n          if (!dragging) return this.handleMoveEvent(e);\r\n          else return true;\r\n        }\r\n        case 'singleclick':\r\n        case 'click': {\r\n          // Prevent click when modifying\r\n          return !modifying;\r\n        }\r\n        default: return true;\r\n      }\r\n    }\r\n  });\r\n\r\n  // Snap distance (in px)\r\n  this.snapDistance_ = options.pixelTolerance || 10;\r\n  // Split tolerance between the calculated intersection and the geometry\r\n  this.tolerance_ = 1e-10;\r\n  // Cursor\r\n  this.cursor_ = options.cursor;\r\n\r\n  // List of source to split\r\n  this.sources_ = options.sources ? (options.sources instanceof Array) ? options.sources:[options.sources] : [];\r\n  if (options.source) this.sources_.push (options.source);\r\n  if (options.features) this.sources_.push (new ol_source_Vector({ features: options.features }));\r\n\r\n  // Get all features candidate\r\n  this.filterSplit_ = options.filter || function(){ return true; };\r\n\r\n  this._condition = options.condition || ol_events_condition_primaryAction;\r\n  this._deleteCondition = options.deleteCondition || ol_events_condition_altKeyOnly;\r\n  this._insertVertexCondition = options.insertVertexCondition || ol_events_condition_always;\r\n\r\n  // Default style\r\n  var sketchStyle = function() {\r\n    return [ new ol_style_Style({\r\n        image: new ol_style_Circle({\r\n          radius: 6,\r\n          fill: new ol_style_Fill({ color: [0, 153, 255, 1] }),\r\n          stroke: new ol_style_Stroke({ color: '#FFF', width: 1.25 })\r\n        })\r\n      })\r\n    ];\r\n  }\r\n\r\n  // Custom style\r\n  if (options.style) {\r\n    if (typeof(options.style) === 'function') {\r\n      sketchStyle = options.style\r\n     } else {\r\n       sketchStyle = function() { return options.style; }\r\n     }\r\n  }\r\n\r\n  // Create a new overlay for the sketch\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'Modify overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: sketchStyle,\r\n    wrapX: options.wrapX\r\n  });\r\n\r\n};\r\nol_ext_inherits(ol_interaction_ModifyFeature, ol_interaction_Pointer);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_ModifyFeature.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/**\r\n * Activate or deactivate the interaction + remove the sketch.\r\n * @param {boolean} active.\r\n * @api stable\r\n */\r\nol_interaction_ModifyFeature.prototype.setActive = function(active) {\r\n  ol_interaction_Interaction.prototype.setActive.call (this, active);\r\n  if (this.overlayLayer_) this.overlayLayer_.getSource().clear();\r\n};\r\n\r\n/** Change the filter function\r\n * @param {function|undefined} options.filter a filter that takes a feature and return true if it can be modified, default always true.\r\n */\r\nol_interaction_ModifyFeature.prototype.setFilter = function(filter) {\r\n  if (typeof(filter) === 'function') this.filterSplit_ = filter;\r\n  else if (filter === undefined) this.filterSplit_ = function(){ return true; };\r\n};\r\n\r\n/** Get closest feature at pixel\r\n * @param {ol.Pixel} \r\n * @return {*} \r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.getClosestFeature = function(e) {\r\n  var f, c, d = this.snapDistance_+1;\r\n  for (var i=0; i<this.sources_.length; i++) {\r\n    var source = this.sources_[i];\r\n    f = source.getClosestFeatureToCoordinate(e.coordinate);\r\n    if (f && this.filterSplit_(f)) {\r\n      var ci = f.getGeometry().getClosestPoint(e.coordinate);\r\n      var di = ol_coordinate_dist2d(e.coordinate,ci) / e.frameState.viewState.resolution;\r\n      if (di < d){\r\n        d = di;\r\n        c = ci;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  if (d > this.snapDistance_) {\r\n    if (this.currentFeature) this.dispatchEvent({ type: 'select', selected: [], deselected: [this.currentFeature] })\r\n    this.currentFeature = null;\r\n    return false;\r\n  } else {\r\n    // Snap to node\r\n    var coord = this.getNearestCoord (c, f.getGeometry());\r\n    if (coord) {\r\n      coord = coord.coord;\r\n      var p = this.getMap().getPixelFromCoordinate(coord);\r\n      if (ol_coordinate_dist2d(e.pixel, p) < this.snapDistance_) {\r\n        c = coord;\r\n      }\r\n      //\r\n      if (this.currentFeature !== f) this.dispatchEvent({ type: 'select', selected: [f], deselected: [this.currentFeature] })\r\n      this.currentFeature = f;\r\n      return { source:source, feature:f, coord: c };\r\n    }\r\n  }\r\n}\r\n\r\n/** Get nearest coordinate in a list \r\n* @param {ol.coordinate} pt the point to find nearest\r\n* @param {ol.geom} coords list of coordinates\r\n* @return {*} the nearest point with a coord (projected point), dist (distance to the geom), ring (if Polygon)\r\n*/\r\nol_interaction_ModifyFeature.prototype.getNearestCoord = function(pt, geom) {\r\n  var i, l, p, p0, dm;\r\n  switch (geom.getType()) {\r\n    case 'Point': {\r\n      return { coord: geom.getCoordinates(), dist: ol_coordinate_dist2d(geom.getCoordinates(), pt) };\r\n    }\r\n    case 'MultiPoint': {\r\n      return this.getNearestCoord (pt, new ol_geom_LineString(geom.getCoordinates()));\r\n    }\r\n    case 'LineString':\r\n    case 'LinearRing': {\r\n      var d;\r\n      dm = Number.MAX_VALUE;\r\n      var coords = geom.getCoordinates();\r\n      for (i=0; i < coords.length; i++) {\r\n        d = ol_coordinate_dist2d (pt, coords[i]);\r\n        if (d < dm) {\r\n          dm = d;\r\n          p0 = coords[i];\r\n        }\r\n      }\r\n      return { coord: p0, dist: dm };\r\n    }\r\n    case 'MultiLineString': {\r\n      var lstring = geom.getLineStrings();\r\n      p0 = false, dm = Number.MAX_VALUE;\r\n      for (i=0; l=lstring[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.ring = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'Polygon': {\r\n      var lring = geom.getLinearRings();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=lring[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.ring = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'MultiPolygon': {\r\n      var poly = geom.getPolygons();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=poly[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.poly = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    case 'GeometryCollection': {\r\n      var g = geom.getGeometries();\r\n      p0 = false;\r\n      dm = Number.MAX_VALUE;\r\n      for (i=0; l=g[i]; i++) {\r\n        p = this.getNearestCoord(pt, l);\r\n        if (p && p.dist<dm) {\r\n          p0 = p;\r\n          dm = p.dist;\r\n          p0.geom = i;\r\n        }\r\n      }\r\n      return p0;\r\n    }\r\n    default: return false;\r\n  }\r\n};\r\n\r\n/** Get arcs concerned by a modification \r\n * @param {ol.geom} geom the geometry concerned\r\n * @param {ol.coordinate} coord pointed coordinates\r\n */\r\nol_interaction_ModifyFeature.prototype.getArcs = function(geom, coord) {\r\n  var arcs = false;\r\n  var coords, i, s, l, g;\r\n  switch(geom.getType()) {\r\n    case 'Point': {\r\n      if (ol_coordinate_equal(coord, geom.getCoordinates())) {\r\n        arcs = { \r\n          geom: geom, \r\n          type: geom.getType(),\r\n          coord1: [],\r\n          coord2: [],\r\n          node: true\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPoint': {\r\n      coords = geom.getCoordinates();\r\n      for (i=0; i < coords.length; i++) {\r\n        if (ol_coordinate_equal(coord, coords[i])) {\r\n          arcs = { \r\n            geom: geom, \r\n            type: geom.getType(),\r\n            index: i,\r\n            coord1: [],\r\n            coord2: [],\r\n            node: true\r\n          }\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'LinearRing': \r\n    case 'LineString': {\r\n      var p = geom.getClosestPoint(coord);\r\n      if (ol_coordinate_dist2d(p,coord) < 1.5*this.tolerance_) {\r\n        var split;\r\n        // Split the line in two\r\n        if (geom.getType() === 'LinearRing') {\r\n          g = new ol_geom_LineString(geom.getCoordinates());\r\n          split = g.splitAt(coord, this.tolerance_);\r\n        } else {\r\n          split = geom.splitAt(coord, this.tolerance_);\r\n        }\r\n        // If more than 2\r\n        if (split.length>2) {\r\n          coords = split[1].getCoordinates();\r\n          for (i=2; s=split[i]; i++) {\r\n            var c = s.getCoordinates();\r\n            c.shift();\r\n            coords = coords.concat(c);\r\n          }\r\n          split = [ split[0], new ol_geom_LineString(coords) ];\r\n        }\r\n        // Split in two\r\n        if (split.length === 2) {\r\n          var c0 = split[0].getCoordinates();\r\n          var c1 = split[1].getCoordinates();\r\n          var nbpt = c0.length + c1.length -1;\r\n          c0.pop();\r\n          c1.shift();\r\n          arcs = { \r\n            geom: geom, \r\n            type: geom.getType(),\r\n            coord1: c0, \r\n            coord2: c1,\r\n            node: (geom.getCoordinates().length === nbpt),\r\n            closed: false\r\n          }\r\n        } else if (split.length === 1) {\r\n          s = split[0].getCoordinates();\r\n          var start = ol_coordinate_equal(s[0], coord);\r\n          var end = ol_coordinate_equal(s[s.length-1], coord);\r\n          // Move first point\r\n          if (start) {\r\n            s.shift();\r\n            if (end) s.pop();\r\n            arcs = { \r\n              geom: geom, \r\n              type: geom.getType(),\r\n              coord1: [], \r\n              coord2: s,\r\n              node: true,\r\n              closed: end\r\n            }\r\n          } else if (end) {\r\n            // Move last point\r\n            s.pop()\r\n            arcs = { \r\n              geom: geom, \r\n              type: geom.getType(),\r\n              coord1: s, \r\n              coord2: [],\r\n              node: true,\r\n              closed: false\r\n            }\r\n          }\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      var lstring = geom.getLineStrings();\r\n      for (i=0; l=lstring[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.lstring = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      var lring = geom.getLinearRings();\r\n      for (i=0; l=lring[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.index = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      var poly = geom.getPolygons();\r\n      for (i=0; l=poly[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.type = geom.getType();\r\n          arcs.poly = i;\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      g = geom.getGeometries();\r\n      for (i=0; l=g[i]; i++) {\r\n        arcs = this.getArcs(l, coord);\r\n        if (arcs) {\r\n          arcs.geom = geom;\r\n          arcs.g = i;\r\n          arcs.typeg = arcs.type;\r\n          arcs.type = geom.getType();\r\n          break;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      console.error('ol/interaction/ModifyFeature '+geom.getType()+' not supported!');\r\n      break;\r\n    }\r\n  }\r\n  return arcs;\r\n};\r\n\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `true` to start the drag sequence.\r\n */\r\nol_interaction_ModifyFeature.prototype.handleDownEvent = function(evt) {\r\n  if (!this.getActive()) return false;\r\n\r\n  // Something to move ?\r\n  var current = this.getClosestFeature(evt);\r\n\r\n  if (current && (this._condition(evt) || this._deleteCondition(evt))) {\r\n    var features = [];\r\n    this.arcs = [];\r\n\r\n    // Get features concerned\r\n    this.sources_.forEach(function(s) {\r\n      var extent = ol_extent_buffer (ol_extent_boundingExtent([current.coord]), this.tolerance_);\r\n      features = features.concat(features, s.getFeaturesInExtent(extent));\r\n    }.bind(this));\r\n\r\n    // Get arcs concerned\r\n    this._modifiedFeatures = [];\r\n    features.forEach(function(f) {\r\n      var a = this.getArcs(f.getGeometry(), current.coord);\r\n      if (a) {\r\n        if (this._insertVertexCondition(evt) || a.node) {\r\n          a.feature = f;\r\n          this._modifiedFeatures.push(f);\r\n          this.arcs.push(a);\r\n        }\r\n      }\r\n    }.bind(this));\r\n\r\n    if (this._modifiedFeatures.length) {\r\n      if (this._deleteCondition(evt)) {\r\n        return !this._removePoint(current, evt); \r\n      } else {\r\n        this.dispatchEvent({ \r\n          type:'modifystart', \r\n          coordinate: current.coord,\r\n          originalEvent: evt.originalEvent,\r\n          features: this._modifiedFeatures\r\n        });\r\n        this.handleDragEvent({ \r\n          coordinate: current.coord,\r\n          originalEvent: evt.originalEvent\r\n        })\r\n        return true;\r\n      }\r\n    } else {\r\n      return true;\r\n    }\r\n  } else {\r\n    return false;\r\n  }\r\n};\r\n\r\n/** Get modified features\r\n * @return {Array<ol.Feature>} list of modified features\r\n */\r\nol_interaction_ModifyFeature.prototype.getModifiedFeatures = function() {\r\n  return this._modifiedFeatures || [];\r\n};\r\n\r\n/** Removes the vertex currently being pointed.\r\n */\r\nol_interaction_ModifyFeature.prototype.removePoint = function() {\r\n  this._removePoint({},{});\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype._getModification = function(a) {\r\n  var coords = a.coord1.concat(a.coord2);\r\n  switch (a.type) {\r\n    case 'LineString': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>1) {\r\n        if (a.geom.getCoordinates().length != coords.length) {\r\n          a.coords = coords;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>1) {\r\n        var c = a.geom.getCoordinates();\r\n        if (c[a.lstring].length != coords.length) {\r\n          c[a.lstring] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>3) {\r\n        c = a.geom.getCoordinates();\r\n        if (c[a.index].length != coords.length) {\r\n          c[a.index] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      if (a.closed) coords.push(coords[0]);\r\n      if (coords.length>3) {\r\n        c = a.geom.getCoordinates();\r\n        if (c[a.poly][a.index].length != coords.length) {\r\n          c[a.poly][a.index] = coords;\r\n          a.coords = c;\r\n          return true;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      a.type = a.typeg;\r\n      var geom = a.geom;\r\n      var geoms = geom.getGeometries();\r\n      a.geom = geoms[a.g];\r\n      var found = this._getModification(a);\r\n      // Restore current arc\r\n      geom.setGeometries(geoms);\r\n      a.geom = geom;\r\n      a.type = 'GeometryCollection';\r\n      return found;\r\n    }\r\n    default: {\r\n      //console.error('ol/interaction/ModifyFeature '+a.type+' not supported!');\r\n      break;\r\n    }\r\n  }\r\n  return false;\r\n};\r\n\r\n/** Removes the vertex currently being pointed.\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype._removePoint = function(current, evt) {\r\n  if (!this.arcs) return false;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n\r\n  var found = false;\r\n  // Get all modifications\r\n  this.arcs.forEach(function(a) {\r\n    found = found || this._getModification(a);\r\n  }.bind(this));\r\n\r\n  // Almost one point is removed\r\n  if (found) {\r\n    this.dispatchEvent({ \r\n      type:'modifystart', \r\n      coordinate: current.coord,\r\n      originalEvent: evt.originalEvent,\r\n      features: this._modifiedFeatures\r\n    });\r\n    this.arcs.forEach(function(a) {\r\n      if (a.geom.getType() === 'GeometryCollection') {\r\n        if (a.coords) {\r\n          var geoms = a.geom.getGeometries();\r\n          geoms[a.g].setCoordinates(a.coords);\r\n          a.geom.setGeometries(geoms);\r\n        }\r\n      } else {\r\n        if (a.coords) a.geom.setCoordinates(a.coords);\r\n      }\r\n    }.bind(this));\r\n    this.dispatchEvent({ \r\n      type:'modifyend', \r\n      coordinate: current.coord,\r\n      originalEvent: evt.originalEvent,\r\n      features: this._modifiedFeatures\r\n    });\r\n  }\r\n\r\n  this.arcs = [];\r\n  return found;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleUpEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n  if (!this.arcs || !this.arcs.length) return true;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n  this.dispatchEvent({ \r\n    type:'modifyend', \r\n    coordinate: e.coordinate,\r\n    originalEvent: e.originalEvent,\r\n    features: this._modifiedFeatures\r\n  });\r\n  \r\n  this.arcs = [];\r\n  return true;\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.setArcCoordinates = function(a, coords) {\r\n  var c;\r\n  switch (a.type) {\r\n    case 'Point': {\r\n      a.geom.setCoordinates(coords[0]);\r\n      break;\r\n    }\r\n    case 'MultiPoint': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.index] = coords[0];\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'LineString': {\r\n      a.geom.setCoordinates(coords);\r\n      break;\r\n    }\r\n    case 'MultiLineString': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.lstring] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'Polygon': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.index] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'MultiPolygon': {\r\n      c = a.geom.getCoordinates();\r\n      c[a.poly][a.index] = coords;\r\n      a.geom.setCoordinates(c);\r\n      break;\r\n    }\r\n    case 'GeometryCollection': {\r\n      a.type = a.typeg;\r\n      var geom = a.geom;\r\n      var geoms = geom.getGeometries();\r\n      a.geom = geoms[a.g];\r\n      this.setArcCoordinates(a, coords);\r\n      geom.setGeometries(geoms);\r\n      a.geom = geom;\r\n      a.type = 'GeometryCollection';\r\n      break;\r\n    }\r\n  }\r\n};\r\n/**\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleDragEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n  if (!this.arcs) return true;\r\n\r\n  // Show sketch\r\n  this.overlayLayer_.getSource().clear();\r\n  var p = new ol_Feature(new ol_geom_Point(e.coordinate));\r\n  this.overlayLayer_.getSource().addFeature(p);\r\n\r\n  // Nothing to do\r\n  if (!this.arcs.length) return true;\r\n\r\n  // Move arcs\r\n  this.arcs.forEach(function(a) {\r\n    var coords = a.coord1.concat([e.coordinate], a.coord2);\r\n    if (a.closed) coords.push(e.coordinate);\r\n    this.setArcCoordinates(a, coords);\r\n  }.bind(this));\r\n\r\n  this.dispatchEvent({ \r\n    type:'modifying', \r\n    coordinate: e.coordinate,\r\n    originalEvent: e.originalEvent,\r\n    features: this._modifiedFeatures\r\n  });\r\n\r\n  return true;\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n * @private\r\n */\r\nol_interaction_ModifyFeature.prototype.handleMoveEvent = function(e) {\r\n  if (!this.getActive()) return false;\r\n\r\n  this.overlayLayer_.getSource().clear();\r\n  var current = this.getClosestFeature(e);\r\n\r\n  // Draw sketch\r\n  if (current) {\r\n    var p = new ol_Feature(new ol_geom_Point(current.coord));\r\n    this.overlayLayer_.getSource().addFeature(p);\r\n  }\r\n\r\n  // Show cursor\r\n  var element = e.map.getTargetElement();\r\n  if (this.cursor_) {\r\n    if (current) {\r\n      if (element.style.cursor != this.cursor_) {\r\n        this.previousCursor_ = element.style.cursor;\r\n        element.style.cursor = this.cursor_;\r\n      }\r\n    } else if (this.previousCursor_ !== undefined) {\r\n      element.style.cursor = this.previousCursor_;\r\n      this.previousCursor_ = undefined;\r\n    }\r\n  }\r\n};\r\n\r\n/** Get the current feature to modify\r\n * @return {ol.Feature} \r\n */\r\nol_interaction_ModifyFeature.prototype.getCurrentFeature = function() {\r\n  return this.currentFeature;\r\n};\r\n\r\nexport default ol_interaction_ModifyFeature","/*\tCopyright (c) 2016 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_style_Style_defaultStyle from '../style/defaultStyle'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport ol_source_Vector from 'ol/source/Vector'\r\nimport ol_geom_Circle from 'ol/geom/Circle'\r\nimport {fromCircle as ol_geom_Polygon_fromCircle} from 'ol/geom/Polygon'\r\nimport ol_geom_Point from 'ol/geom/Point'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_Feature from 'ol/Feature'\r\n\r\n/** Interaction rotate\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires drawstart, drawing, drawend, drawcancel\r\n * @param {olx.interaction.TransformOptions} options\r\n *  @param {Array<ol.Layer>} options.source Destination source for the drawn features\r\n *  @param {ol.Collection<ol.Feature>} options.features Destination collection for the drawn features \r\n *  @param {ol.style.Style | Array.<ol.style.Style> | ol.style.StyleFunction | undefined} options.style style for the sketch\r\n *  @param {integer} options.sides number of sides, default 0 = circle\r\n *  @param { ol.events.ConditionType | undefined } options.condition A function that takes an ol.MapBrowserEvent and returns a boolean that event should be handled. By default module:ol/events/condition.always.\r\n *  @param { ol.events.ConditionType | undefined } options.squareCondition A function that takes an ol.MapBrowserEvent and returns a boolean to draw square features. Default test shift key\r\n *  @param { ol.events.ConditionType | undefined } options.centerCondition A function that takes an ol.MapBrowserEvent and returns a boolean to draw centered features. Default check Ctrl key\r\n *  @param { bool } options.canRotate Allow rotation when centered + square, default: true\r\n *  @param { string } [options.geometryName=geometry] \r\n *  @param { number } options.clickTolerance click tolerance on touch devices, default: 6\r\n *  @param { number } options.maxCircleCoordinates Maximum number of point on a circle, default: 100\r\n */\r\nvar ol_interaction_DrawRegular = function(options) {\r\n  if (!options) options={};\r\n\r\n  this.squaredClickTolerance_ = options.clickTolerance ? options.clickTolerance * options.clickTolerance : 36;\r\n  this.maxCircleCoordinates_ = options.maxCircleCoordinates || 100;\r\n\r\n  // Collection of feature to transform \r\n  this.features_ = options.features;\r\n  // List of layers to transform \r\n  this.source_ = options.source;\r\n  // Square condition\r\n  this.conditionFn_ = options.condition;\r\n  // Square condition\r\n  this.squareFn_ = options.squareCondition;\r\n  // Centered condition\r\n  this.centeredFn_ = options.centerCondition;\r\n  // Allow rotation when centered + square\r\n  this.canRotate_ = (options.canRotate !== false);\r\n  // Specify custom geometry name\r\n  this.geometryName_ = options.geometryName;\r\n\r\n  // Number of sides (default=0: circle)\r\n  this.setSides(options.sides);\r\n\r\n  // Style\r\n  var defaultStyle = ol_style_Style_defaultStyle(true);\r\n\r\n  // Create a new overlay layer for the sketch\r\n  this.sketch_ = new ol_Collection();\r\n  this.overlayLayer_ = new ol_layer_Vector({\r\n    source: new ol_source_Vector({\r\n      features: this.sketch_,\r\n      useSpatialIndex: false\r\n    }),\r\n    name:'DrawRegular overlay',\r\n    displayInLayerSwitcher: false,\r\n    style: options.style || defaultStyle\r\n  });\r\n\r\n  ol_interaction_Interaction.call(this, {\t\r\n      /*\r\n      handleDownEvent: this.handleDownEvent_,\r\n      handleMoveEvent: this.handleMoveEvent_,\r\n      handleUpEvent: this.handleUpEvent_,\r\n      */\r\n      handleEvent: this.handleEvent_\r\n    });\r\n};\r\nol_ext_inherits(ol_interaction_DrawRegular, ol_interaction_Interaction);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeLayer(this.overlayLayer_);\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  this.overlayLayer_.setMap(map);\r\n};\r\n\r\n/**\r\n * Activate/deactivate the interaction\r\n * @param {boolean}\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setActive = function(b) {\r\n  this.reset();\r\n  ol_interaction_Interaction.prototype.setActive.call (this, b);\r\n}\r\n\r\n/**\r\n * Reset the interaction\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.reset = function() {\r\n  this.overlayLayer_.getSource().clear();\r\n  this.started_ = false;\r\n}\r\n\r\n/**\r\n * Set the number of sides.\r\n * @param {int} number of sides.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.setSides = function (nb) {\r\n  nb = parseInt(nb);\r\n  this.sides_ = nb>2 ? nb : 0;\r\n}\r\n\r\n/**\r\n * Allow rotation when centered + square\r\n * @param {bool} \r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.canRotate = function (b) {\r\n  if (b===true || b===false) this.canRotate_ = b;\r\n  return this.canRotate_;\r\n}\r\n\r\n/**\r\n * Get the number of sides.\r\n * @return {int} number of sides.\r\n * @api stable\r\n */\r\nol_interaction_DrawRegular.prototype.getSides = function () {\r\n  return this.sides_;\r\n}\r\n\r\n/** Default start angle array for each sides\r\n*/\r\nol_interaction_DrawRegular.prototype.startAngle = {\r\n  'default':Math.PI/2,\r\n  3: -Math.PI/2,\r\n  4: Math.PI/4\r\n};\r\n\r\n/** Get geom of the current drawing\r\n* @return {ol.geom.Polygon | ol.geom.Point}\r\n*/\r\nol_interaction_DrawRegular.prototype.getGeom_ = function () {\r\n  this.overlayLayer_.getSource().clear();\r\n  if (!this.center_) return false;\r\n\r\n  var g;\r\n  if (this.coord_) {\r\n    var center = this.center_;\r\n    var coord = this.coord_;\r\n\r\n    // Specific case: circle\r\n    var d, dmax, r, circle, centerPx;\r\n    if (!this.sides_ && this.square_ && !this.centered_) {\r\n      center = [(coord[0] + center[0])/2, (coord[1] + center[1])/2];\r\n      d = [coord[0] - center[0], coord[1] - center[1]];\r\n      r = Math.sqrt(d[0]*d[0]+d[1]*d[1]);\r\n      circle = new ol_geom_Circle(center, r, 'XY');\r\n      // Optimize points on the circle\r\n      centerPx = this.getMap().getPixelFromCoordinate(center);\r\n      dmax = Math.max (100, Math.abs(centerPx[0]-this.coordPx_[0]), Math.abs(centerPx[1]-this.coordPx_[1]));\r\n      dmax = Math.min ( this.maxCircleCoordinates_, Math.round(dmax / 3 ));\r\n      return ol_geom_Polygon_fromCircle (circle, dmax, 0);\r\n    } else {\r\n      var hasrotation = this.canRotate_ && this.centered_ && this.square_;\r\n      d = [coord[0] - center[0], coord[1] - center[1]];\r\n      if (this.square_ && !hasrotation) {\r\n        //var d = [coord[0] - center[0], coord[1] - center[1]];\r\n        var dm = Math.max (Math.abs(d[0]), Math.abs(d[1])); \r\n        coord = [ \r\n          center[0] + (d[0]>0 ? dm:-dm),\r\n          center[1] + (d[1]>0 ? dm:-dm)\r\n        ];\r\n      }\r\n      r = Math.sqrt(d[0]*d[0]+d[1]*d[1]);\r\n      if (r>0) {\r\n        circle = new ol_geom_Circle(center, r, 'XY');\r\n        var a;\r\n        if (hasrotation) a = Math.atan2(d[1], d[0]);\r\n        else a = this.startAngle[this.sides_] || this.startAngle['default'];\r\n\r\n        if (this.sides_) {\r\n          g = ol_geom_Polygon_fromCircle (circle, this.sides_, a);\r\n        } else {\r\n          // Optimize points on the circle\r\n          centerPx = this.getMap().getPixelFromCoordinate(this.center_);\r\n          dmax = Math.max (100, Math.abs(centerPx[0]-this.coordPx_[0]), Math.abs(centerPx[1]-this.coordPx_[1]));\r\n          dmax = Math.min ( this.maxCircleCoordinates_, Math.round(dmax / (this.centered_ ? 3:5) ));\r\n          g = ol_geom_Polygon_fromCircle (circle, dmax, 0);\r\n        }\r\n\r\n        if (hasrotation) return g;\r\n      \r\n        // Scale polygon to fit extent\r\n        var ext = g.getExtent();\r\n        if (!this.centered_) center = this.center_;\r\n        else center = [ 2*this.center_[0]-this.coord_[0], 2*this.center_[1]-this.coord_[1] ];\r\n        var scx = (center[0] - coord[0]) / (ext[0] - ext[2]);\r\n        var scy = (center[1] - coord[1]) / (ext[1] - ext[3]);\r\n        if (this.square_) {\r\n          var sc = Math.min(Math.abs(scx),Math.abs(scy));\r\n          scx = Math.sign(scx)*sc;\r\n          scy = Math.sign(scy)*sc;\r\n        }\r\n        var t = [ center[0] - ext[0]*scx, center[1] - ext[1]*scy ];\r\n      \r\n        g.applyTransform(function(g1, g2, dim) {\r\n          for (var i=0; i<g1.length; i+=dim) {\r\n            g2[i] = g1[i]*scx + t[0];\r\n            g2[i+1] = g1[i+1]*scy + t[1];\r\n          }\r\n          return g2;\r\n        });\r\n        return g;\r\n      }\r\n    }\r\n  }\r\n\r\n  // No geom => return a point\r\n  return new ol_geom_Point(this.center_);\r\n};\r\n\r\n/** Draw sketch\r\n* @return {ol.Feature} The feature being drawn.\r\n*/\r\nol_interaction_DrawRegular.prototype.drawSketch_ = function(evt) {\r\n  this.overlayLayer_.getSource().clear();\r\n  if (evt) {\r\n    this.square_ = this.squareFn_ ? this.squareFn_(evt) : evt.originalEvent.shiftKey;\r\n    this.centered_ = this.centeredFn_ ? this.centeredFn_(evt) : evt.originalEvent.metaKey || evt.originalEvent.ctrlKey;\r\n    var g = this.getGeom_();\r\n    if (g) {\r\n      var f = this.feature_;\r\n\r\n      //f.setGeometry (g);\r\n      if (g.getType()==='Polygon') f.getGeometry().setCoordinates(g.getCoordinates());\r\n      this.overlayLayer_.getSource().addFeature(f);\r\n      if (this.coord_ \r\n        && this.square_ \r\n        && ((this.canRotate_ && this.centered_ && this.coord_) || (!this.sides_ && !this.centered_))) {\r\n        this.overlayLayer_.getSource().addFeature(new ol_Feature(new ol_geom_LineString([this.center_,this.coord_])));\r\n      }\r\n      return f;\r\n    }\r\n  }\r\n};\r\n\r\n/** Draw sketch (Point)\r\n*/\r\nol_interaction_DrawRegular.prototype.drawPoint_ = function(pt, noclear) {\r\n  if (!noclear) this.overlayLayer_.getSource().clear();\r\n  this.overlayLayer_.getSource().addFeature(new ol_Feature(new ol_geom_Point(pt)));\r\n};\r\n\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n */\r\nol_interaction_DrawRegular.prototype.handleEvent_ = function(evt) {\r\n  var dx, dy;\r\n  // Event date time\r\n  this._eventTime = new Date();\r\n  switch (evt.type) {\r\n    case \"pointerdown\": {\r\n      if (this.conditionFn_ && !this.conditionFn_(evt)) break;\r\n      this.downPx_ = evt.pixel;\r\n      this.start_(evt);\r\n      // Test long touch\r\n      var dt = 500;\r\n      this._longTouch = false;\r\n      setTimeout(function() {\r\n        this._longTouch = (new Date() - this._eventTime > .9*dt);\r\n        if (this._longTouch) this.handleMoveEvent_(evt);\r\n      }.bind(this), dt);\r\n      break;\r\n    }\r\n    case \"pointerup\": {\r\n      // Started and fisrt move\r\n      if (this.started_ && this.coord_) {\r\n        dx = this.downPx_[0] - evt.pixel[0];\r\n        dy = this.downPx_[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n          // The pointer has moved\r\n          if ( this.lastEvent == \"pointermove\" || this.lastEvent == \"keydown\" ) {\r\n            this.end_(evt);\r\n          }\r\n          // On touch device there is no move event : terminate = click on the same point\r\n          else {\r\n            dx = this.upPx_[0] - evt.pixel[0];\r\n            dy = this.upPx_[1] - evt.pixel[1];\r\n            if ( dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n              this.end_(evt);\r\n            } else  {\r\n              this.handleMoveEvent_(evt);\r\n              this.drawPoint_(evt.coordinate,true);\r\n            }\r\n          }\r\n        }\r\n      }\r\n      this.upPx_ = evt.pixel;\t\r\n      break;\r\n    }\r\n    case \"pointerdrag\": {\r\n      if (this.started_) {\r\n        var centerPx = this.getMap().getPixelFromCoordinate(this.center_);\r\n        dx = centerPx[0] - evt.pixel[0];\r\n        dy = centerPx[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy <= this.squaredClickTolerance_) {\r\n          this.reset();\r\n        }\r\n      }\r\n      return !this._longTouch;\r\n      // break;\r\n    }\r\n    case \"pointermove\": {\r\n      if (this.started_) {\r\n        dx = this.downPx_[0] - evt.pixel[0];\r\n        dy = this.downPx_[1] - evt.pixel[1];\r\n        if (dx*dx + dy*dy > this.squaredClickTolerance_) {\r\n          this.handleMoveEvent_(evt);\r\n          this.lastEvent = evt.type;\r\n        }\r\n      }\r\n      break;\r\n    }\r\n    default: {\r\n      this.lastEvent = evt.type;\r\n      // Prevent zoom in on dblclick\r\n      if (this.started_ && evt.type==='dblclick') {\r\n        //evt.stopPropagation();\r\n        return false;\r\n      }\r\n      break;\r\n    }\r\n  }\r\n  return true;\r\n}\r\n\r\n/** Stop drawing.\r\n */\r\nol_interaction_DrawRegular.prototype.finishDrawing = function() {\r\n  if (this.started_ && this.coord_) {\r\n    this.end_({ pixel: this.upPx_, coordinate: this.coord_});\r\n  }\r\n};\r\n\r\n/**\r\n * @param {ol.MapBrowserEvent} evt Event.\r\n */\r\nol_interaction_DrawRegular.prototype.handleMoveEvent_ = function(evt) {\r\n  if (this.started_) {\r\n    this.coord_ = evt.coordinate;\r\n    this.coordPx_ = evt.pixel;\r\n    var f = this.drawSketch_(evt);\r\n    this.dispatchEvent({ \r\n      type:'drawing', \r\n      feature: f, \r\n      pixel: evt.pixel, \r\n      startCoordinate: this.center_,\r\n      coordinate: evt.coordinate, \r\n      square: this.square_, \r\n      centered: this.centered_ \r\n    });\r\n  } else  {\r\n    this.drawPoint_(evt.coordinate);\r\n  }\r\n};\r\n\r\n/** Start an new draw\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_DrawRegular.prototype.start_ = function(evt) {\r\n  if (!this.started_) {\r\n    this.started_ = true;\r\n    this.center_ = evt.coordinate;\r\n    this.coord_ = null;\r\n    var f = this.feature_ = new ol_Feature({});\r\n    f.setGeometryName(this.geometryName_);\r\n    f.setGeometry(new ol_geom_Polygon([[evt.coordinate,evt.coordinate,evt.coordinate]]));\r\n    this.drawSketch_(evt);\r\n    this.dispatchEvent({ type:'drawstart', feature: f, pixel: evt.pixel, coordinate: evt.coordinate });\r\n  } else {\r\n    this.coord_ = evt.coordinate;\r\n  }\r\n};\r\n\r\n/** End drawing\r\n * @param {ol.MapBrowserEvent} evt Map browser event.\r\n * @return {boolean} `false` to stop the drag sequence.\r\n */\r\nol_interaction_DrawRegular.prototype.end_ = function(evt) {\r\n  this.coord_ = evt.coordinate;\r\n  this.started_ = false;\r\n  if (this.coord_ && (this.center_[0]!==this.coord_[0] || this.center_[1]!==this.coord_[1])) {\r\n    var f = this.feature_;\r\n\r\n    f.setGeometry(this.getGeom_());\r\n    if (this.source_) this.source_.addFeature(f);\r\n    else if (this.features_) this.features_.push(f);\r\n    this.dispatchEvent({ type:'drawend', feature: f, pixel: evt.pixel, coordinate: evt.coordinate, square: this.square_, centered: this.centered_ });\r\n  } else {\r\n    this.dispatchEvent({ type:'drawcancel', feature: null, pixel: evt.pixel, coordinate: evt.coordinate, square: this.square_, centered: this.centered_ });\r\n  }\r\n\r\n  this.center_ = this.coord_ = null;\r\n  this.drawSketch_();\r\n};\r\n\r\nexport default ol_interaction_DrawRegular\r\n","/*\tCopyright (c) 2017 Jean-Marc VIGLINO, \r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\n\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_geom_MultiPolygon from 'ol/geom/MultiPolygon'\r\nimport ol_geom_LinearRing from 'ol/geom/LinearRing'\r\nimport ol_interaction_Draw from 'ol/interaction/Draw'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\n\r\n/** Interaction to draw holes in a polygon.\r\n * It fires a drawstart, drawend event when drawing the hole\r\n * and a modifystart, modifyend event before and after inserting the hole in the feature geometry.\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires drawstart\r\n * @fires drawend\r\n * @fires modifystart\r\n * @fires modifyend\r\n * @param {olx.interaction.DrawHoleOptions} options extend olx.interaction.DrawOptions\r\n * \t@param {Array<ol.layer.Vector> | function | undefined} options.layers A list of layers from which polygons should be selected. Alternatively, a filter function can be provided. default: all visible layers\r\n * \t@param {Array<ol.Feature> | ol.Collection<ol.Feature> | function | undefined} options.featureFilter An array or a collection of features the interaction applies on or a function that takes a feature and a layer and returns true if the feature is a candidate\r\n * \t@param { ol.style.Style | Array<ol.style.Style> | StyleFunction | undefined }\tStyle for the selected features, default: default edit style\r\n */\r\nvar ol_interaction_DrawHole = function(options) {\r\n  if (!options) options = {};\r\n  var self = this;\r\n\r\n  // Select interaction for the current feature\r\n  this._select = new ol_interaction_Select({ style: options.style });\r\n  this._select.setActive(false);\r\n\r\n  // Geometry function that test points inside the current\r\n  var geometryFn, geomFn = options.geometryFunction;\r\n  if (geomFn) {\r\n    geometryFn = function(c,g) {\r\n      g = self._geometryFn (c, g);\r\n      return geomFn (c,g);\r\n    }\r\n  } else {\r\n    geometryFn = function(c,g) { return self._geometryFn (c, g); }\r\n  }\r\n\r\n  // Create draw interaction\r\n  options.type = \"Polygon\";\r\n  options.geometryFunction = geometryFn;\r\n  ol_interaction_Draw.call(this, options);\r\n\r\n  // Layer filter function\r\n  if (options.layers) {\r\n    if (typeof (options.layers) === 'function') {\r\n      this.layers_ = options.layers;\r\n    } else if (options.layers.indexOf) {\r\n      this.layers_ = function(l) {\r\n        return (options.layers.indexOf(l) >= 0); \r\n      };\r\n    }\r\n  }\r\n\r\n  // Features to apply on \r\n  if (typeof(options.featureFilter) === 'function') {\r\n    this._features = options.featureFilter;\r\n  } else if (options.featureFilter) {\r\n    var features = options.featureFilter;\r\n    this._features = function(f) {\r\n      if (features.indexOf) {\r\n        return !!features[features.indexOf(f)];\r\n      } else {\r\n        return !!features.item(features.getArray().indexOf(f));\r\n      }\r\n    }\r\n  } else {\r\n    this._features = function() { return true }\r\n  }\r\n\r\n  // Start drawing if inside a feature\r\n  this.on('drawstart', this._startDrawing.bind(this));\r\n  // End drawing add the hole to the current Polygon\r\n  this.on('drawend', this._finishDrawing.bind(this));\r\n};\r\nol_ext_inherits(ol_interaction_DrawHole, ol_interaction_Draw);\r\n\r\n/**\r\n * Remove the interaction from its current map, if any,  and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_DrawHole.prototype.setMap = function(map) {\r\n  if (this.getMap()) this.getMap().removeInteraction(this._select);\r\n  if (map) map.addInteraction(this._select);\r\n  ol_interaction_Draw.prototype.setMap.call (this, map);\r\n};\r\n\r\n/**\r\n * Activate/deactivate the interaction\r\n * @param {boolean}\r\n * @api stable\r\n */\r\nol_interaction_DrawHole.prototype.setActive = function(b) {\r\n  this._select.getFeatures().clear();\r\n  ol_interaction_Draw.prototype.setActive.call (this, b);\r\n};\r\n\r\n/**\r\n * Remove last point of the feature currently being drawn \r\n * (test if points to remove before).\r\n */\r\nol_interaction_DrawHole.prototype.removeLastPoint = function() {\r\n  if (this._feature && this._feature.getGeometry().getCoordinates()[0].length>2) {\r\n    ol_interaction_Draw.prototype.removeLastPoint.call(this);\r\n  }\r\n};\r\n\r\n/** \r\n * Get the current polygon to hole\r\n * @return {ol.Feature}\r\n */\r\nol_interaction_DrawHole.prototype.getPolygon = function() {\r\n  return this._polygon;\r\n  // return this._select.getFeatures().item(0).getGeometry();\r\n};\r\n\r\n/**\r\n * Get current feature to add a hole and start drawing\r\n * @param {ol_interaction_Draw.Event} e\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._startDrawing = function(e) {\r\n  var map = this.getMap();\r\n  this._feature = e.feature;\r\n  var coord = e.feature.getGeometry().getCoordinates()[0][0];\r\n  this._current = null;\r\n  // Check object under the pointer\r\n  map.forEachFeatureAtPixel(\r\n    map.getPixelFromCoordinate(coord),\r\n    function(feature, layer) {\r\n      // Not yet found?\r\n      if (!this._current && this._features(feature, layer)) {\r\n        var poly = feature.getGeometry();\r\n        if (poly.getType() === \"Polygon\"\r\n          && poly.intersectsCoordinate(coord)) {\r\n          this._polygonIndex = false;\r\n          this._polygon = poly;\r\n          this._current = feature;\r\n        } else if (poly.getType() === \"MultiPolygon\"\r\n          && poly.intersectsCoordinate(coord)) {\r\n          for (var i=0, p; p=poly.getPolygon(i); i++) {\r\n            if (p.intersectsCoordinate(coord)) {\r\n              this._polygonIndex = i;\r\n              this._polygon = p;\r\n              this._current = feature;\r\n              break;\r\n            }\r\n          }\r\n        }\r\n      }\r\n    }.bind(this), {\r\n      layerFilter: this.layers_\r\n    }\r\n  );\r\n  this._select.getFeatures().clear();\r\n  if (!this._current) {\r\n    this.setActive(false);\r\n    this.setActive(true);\r\n  } else {\r\n    this._select.getFeatures().push(this._current);\r\n  }\r\n};\r\n\r\n/**\r\n * Stop drawing and add the sketch feature to the target feature. \r\n * @param {ol_interaction_Draw.Event} e\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._finishDrawing = function(e) {\r\n  // The feature is the hole\r\n  e.hole = e.feature;\r\n  // Get the current feature\r\n  e.feature = this._select.getFeatures().item(0);\r\n  this.dispatchEvent({ type: 'modifystart', features: [ this._current ] });\r\n  // Create the hole\r\n  var c = e.hole.getGeometry().getCoordinates()[0];\r\n  if (c.length > 3) {\r\n    if (this._polygonIndex!==false) {\r\n      var geom = e.feature.getGeometry();\r\n      var newGeom = new ol_geom_MultiPolygon([]);\r\n      for (var i=0, pi; pi=geom.getPolygon(i); i++) {\r\n        if (i===this._polygonIndex) {\r\n          pi.appendLinearRing(new ol_geom_LinearRing(c));\r\n          newGeom.appendPolygon(pi);\r\n        } else {\r\n          newGeom.appendPolygon(pi);\r\n        }\r\n      }\r\n      e.feature.setGeometry(newGeom);\r\n    } else {\r\n      this.getPolygon().appendLinearRing(new ol_geom_LinearRing(c));\r\n    }\r\n  }\r\n  this.dispatchEvent({ type: 'modifyend', features: [ this._current ] });\r\n  // reset\r\n  this._feature = null;\r\n  this._select.getFeatures().clear();\r\n};\r\n\r\n/**\r\n * Function that is called when a geometry's coordinates are updated.\r\n * @param {Array<ol.coordinate>} coordinates\r\n * @param {ol_geom_Polygon} geometry\r\n * @return {ol_geom_Polygon}\r\n * @private\r\n */\r\nol_interaction_DrawHole.prototype._geometryFn = function(coordinates, geometry) {\r\n  var coord = coordinates[0].pop();\r\n  if (!this.getPolygon() || this.getPolygon().intersectsCoordinate(coord)) {\r\n    this.lastOKCoord = [coord[0],coord[1]];\r\n  }\r\n  coordinates[0].push([this.lastOKCoord[0],this.lastOKCoord[1]]);\r\n\r\n  if (geometry) {\r\n    geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]);\r\n  } else {\r\n    geometry = new ol_geom_Polygon(coordinates);\r\n  }\r\n  return geometry;\r\n};\r\n\r\nexport default ol_interaction_DrawHole\r\n","import ol_ext_inherits from '../util/ext'\r\nimport {shiftKeyOnly as ol_events_condition_shiftKeyOnly} from 'ol/events/condition'\r\nimport {click as ol_events_condition_click} from 'ol/events/condition'\r\nimport ol_interaction_Draw from 'ol/interaction/Draw'\r\nimport ol_geom_LineString from 'ol/geom/LineString'\r\nimport ol_geom_Polygon from 'ol/geom/Polygon'\r\nimport ol_interaction_Select from 'ol/interaction/Select'\r\n\r\nimport ol_control_Bar from './Bar'\r\nimport ol_control_Button from './Button'\r\nimport ol_control_Toggle from './Toggle'\r\nimport ol_control_TextButton from './TextButton'\r\nimport ol_interaction_Delete from '../interaction/Delete'\r\nimport ol_ext_element from '../util/element'\r\nimport ol_interaction_Offset from '../interaction/Offset'\r\nimport ol_interaction_Split from '../interaction/Split'\r\nimport ol_interaction_Transform from '../interaction/Transform'\r\nimport ol_interaction_ModifyFeature from '../interaction/ModifyFeature'\r\nimport ol_interaction_DrawRegular from '../interaction/DrawRegular'\r\nimport ol_interaction_DrawHole from '../interaction/DrawHole'\r\n\r\n/** Control bar for editing in a layer\r\n * @constructor\r\n * @extends {ol_control_Bar}\r\n * @fires info\r\n * @param {Object=} options Control options.\r\n *\t@param {String} options.className class of the control\r\n *\t@param {String} options.target Specify a target if you want the control to be rendered outside of the map's viewport.\r\n *\t@param {boolean} options.edition false to remove the edition tools, default true\r\n *\t@param {Object} options.interactions List of interactions to add to the bar \r\n *    ie. Select, Delete, Info, DrawPoint, DrawLine, DrawPolygon\r\n *    Each interaction can be an interaction or true (to get the default one) or false to remove it from bar\r\n *\t@param {ol.source.Vector} options.source Source for the drawn features. \r\n */\r\nvar ol_control_EditBar = function(options) {\r\n  options = options || {};\r\n  options.interactions = options.interactions || {};\r\n\r\n  // New bar\r\n\tol_control_Bar.call(this, {\r\n    className: (options.className ? options.className+' ': '') + 'ol-editbar',\r\n    toggleOne: true,\r\n\t\ttarget: options.target\r\n  });\r\n\r\n  this._source = options.source;\r\n  // Add buttons / interaction\r\n  this._interactions = {};\r\n  this._setSelectInteraction(options);\r\n  if (options.edition!==false) this._setEditInteraction(options);\r\n  this._setModifyInteraction(options);\r\n};\r\nol_ext_inherits(ol_control_EditBar, ol_control_Bar);\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add its controls associated to this map.\r\n * @param {_ol_Map_} map The map instance.\r\n */\r\nol_control_EditBar.prototype.setMap = function (map) {\r\n  if (this.getMap()) {\r\n    if (this._interactions.Delete) this.getMap().removeInteraction(this._interactions.Delete);\r\n    if (this._interactions.ModifySelect) this.getMap().removeInteraction(this._interactions.ModifySelect);\r\n  }\r\n  \r\n  ol_control_Bar.prototype.setMap.call(this, map);\r\n\r\n  if (this.getMap()) {\r\n    if (this._interactions.Delete) this.getMap().addInteraction(this._interactions.Delete);\r\n    if (this._interactions.ModifySelect) this.getMap().addInteraction(this._interactions.ModifySelect);\r\n  }\r\n};\r\n\r\n/** Get an interaction associated with the bar\r\n * @param {string} name \r\n */\r\nol_control_EditBar.prototype.getInteraction = function (name) {\r\n  return this._interactions[name];\r\n};\r\n\r\n/** Get the option title */\r\nol_control_EditBar.prototype._getTitle = function (option) {\r\n  if (option) {\r\n    if (option.get) return option.get('title');\r\n    else if (typeof(option) === 'string') return option;\r\n    else return option.title;\r\n  } \r\n};\r\n\r\n/** Add selection tool:\r\n * 1. a toggle control with a select interaction\r\n * 2. an option bar to delete / get information on the selected feature\r\n * @private\r\n */\r\nol_control_EditBar.prototype._setSelectInteraction = function (options) {\r\n  var self = this;\r\n  \r\n  // Sub bar\r\n  var sbar = new ol_control_Bar();\r\n  var selectCtrl;\r\n\r\n  // Delete button\r\n  if (options.interactions.Delete !== false) {\r\n    if (options.interactions.Delete instanceof ol_interaction_Delete) {\r\n      this._interactions.Delete = options.interactions.Delete; \r\n    } else {\r\n      this._interactions.Delete = new ol_interaction_Delete();\r\n    }\r\n    var del = this._interactions.Delete;\r\n    del.setActive(false);\r\n    if (this.getMap()) this.getMap().addInteraction(del);\r\n    sbar.addControl (new ol_control_Button({\r\n      className: 'ol-delete',\r\n      title: this._getTitle(options.interactions.Delete) || \"Delete\",\r\n      name: 'Delete',\r\n      handleClick: function(e) {\r\n        // Delete selection\r\n        del.delete(selectCtrl.getInteraction().getFeatures());\r\n        var evt = {\r\n          type: 'select',\r\n          selected: [],\r\n          deselected: selectCtrl.getInteraction().getFeatures().getArray().slice(),\r\n          mapBrowserEvent: e.mapBrowserEvent\r\n        };\r\n        selectCtrl.getInteraction().getFeatures().clear();\r\n        selectCtrl.getInteraction().dispatchEvent(evt);\r\n      }\r\n    }));\r\n  }\r\n\r\n  // Info button\r\n  if (options.interactions.Info !== false) {\r\n    sbar.addControl (new ol_control_Button({\r\n      className: 'ol-info',\r\n      name: 'Info',\r\n      title: this._getTitle(options.interactions.Info) || \"Show informations\",\r\n      handleClick: function() {\r\n        self.dispatchEvent({ \r\n          type: 'info', \r\n          features: selectCtrl.getInteraction().getFeatures() \r\n        });\r\n      }\r\n    }));\r\n  }\r\n\r\n  // Select button\r\n  if (options.interactions.Select !== false) {\r\n    if (options.interactions.Select instanceof ol_interaction_Select) {\r\n      this._interactions.Select = options.interactions.Select\r\n    } else {\r\n      this._interactions.Select = new ol_interaction_Select({\r\n        condition: ol_events_condition_click\r\n      });\r\n    }\r\n    var sel = this._interactions.Select;\r\n    selectCtrl = new ol_control_Toggle({\r\n      className: 'ol-selection',\r\n      name: 'Select',\r\n      title: this._getTitle(options.interactions.Select) || \"Select\",\r\n      interaction: sel,\r\n      bar: sbar.getControls().length ? sbar : undefined,\r\n      autoActivate:true,\r\n      active:true\r\n    });\r\n\r\n    this.addControl(selectCtrl);\r\n    sel.on('change:active', function() {\r\n      sel.getFeatures().clear();\r\n    });\r\n  }\r\n};\r\n\r\n\r\n/** Add editing tools\r\n * @private\r\n */ \r\nol_control_EditBar.prototype._setEditInteraction = function (options) {\r\n  if (options.interactions.DrawPoint !== false) {\r\n    if (options.interactions.DrawPoint instanceof ol_interaction_Draw) {\r\n      this._interactions.DrawPoint = options.interactions.DrawPoint;\r\n    } else {\r\n      this._interactions.DrawPoint = new ol_interaction_Draw({\r\n        type: 'Point',\r\n        source: this._source\r\n      });\r\n    }\r\n    var pedit = new ol_control_Toggle({\r\n      className: 'ol-drawpoint',\r\n      name: 'DrawPoint',\r\n      title: this._getTitle(options.interactions.DrawPoint) || 'Point',\r\n      interaction: this._interactions.DrawPoint\r\n    });\r\n    this.addControl ( pedit );\r\n  }\r\n\r\n  if (options.interactions.DrawLine !== false) {\r\n    if (options.interactions.DrawLine instanceof ol_interaction_Draw) {\r\n      this._interactions.DrawLine = options.interactions.DrawLine\r\n    } else {\r\n      this._interactions.DrawLine = new ol_interaction_Draw ({\r\n        type: 'LineString',\r\n        source: this._source,\r\n        // Count inserted points\r\n        geometryFunction: function(coordinates, geometry) {\r\n          if (geometry) geometry.setCoordinates(coordinates);\r\n          else geometry = new ol_geom_LineString(coordinates);\r\n          this.nbpts = geometry.getCoordinates().length;\r\n          return geometry;\r\n        }\r\n      });\r\n    }\r\n    var ledit = new ol_control_Toggle({\r\n      className: 'ol-drawline',\r\n      title: this._getTitle(options.interactions.DrawLine) || 'LineString',\r\n      name: 'DrawLine',\r\n      interaction: this._interactions.DrawLine,\r\n      // Options bar associated with the control\r\n      bar: new ol_control_Bar ({\r\n        controls:[ \r\n          new ol_control_TextButton({\r\n            html: this._getTitle(options.interactions.UndoDraw) || 'undo',\r\n            title: this._getTitle(options.interactions.UndoDraw) || \"delete last point\",\r\n            handleClick: function() {\r\n              if (ledit.getInteraction().nbpts>1) ledit.getInteraction().removeLastPoint();\r\n            }\r\n          }),\r\n          new ol_control_TextButton ({\r\n            html: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n            title: this._getTitle(options.interactions.FinishDraw) || \"finish\",\r\n            handleClick: function() {\r\n              // Prevent null objects on finishDrawing\r\n              if (ledit.getInteraction().nbpts>2) ledit.getInteraction().finishDrawing();\r\n            }\r\n          })\r\n        ]\r\n      }) \r\n    });\r\n\r\n    this.addControl ( ledit );\r\n  }\r\n\r\n  if (options.interactions.DrawPolygon !== false) {\r\n    if (options.interactions.DrawPolygon instanceof ol_interaction_Draw){\r\n      this._interactions.DrawPolygon = options.interactions.DrawPolygon\r\n    } else {\r\n      this._interactions.DrawPolygon = new ol_interaction_Draw ({\r\n        type: 'Polygon',\r\n        source: this._source,\r\n        // Count inserted points\r\n        geometryFunction: function(coordinates, geometry) {\r\n          this.nbpts = coordinates[0].length;\r\n          if (geometry) geometry.setCoordinates([coordinates[0].concat([coordinates[0][0]])]);\r\n          else geometry = new ol_geom_Polygon(coordinates);\r\n          return geometry;\r\n        }\r\n      });\r\n    }\r\n    this._setDrawPolygon(\r\n      'ol-drawpolygon', \r\n      this._interactions.DrawPolygon, \r\n      this._getTitle(options.interactions.DrawPolygon) || 'Polygon', \r\n      'DrawPolygon',\r\n      options\r\n    );\r\n  }\r\n\r\n  // Draw hole\r\n  if (options.interactions.DrawHole !== false) {\r\n    if (options.interactions.DrawHole instanceof ol_interaction_DrawHole){\r\n      this._interactions.DrawHole = options.interactions.DrawHole;\r\n    } else {\r\n      this._interactions.DrawHole = new ol_interaction_DrawHole ();\r\n    }\r\n    this._setDrawPolygon(\r\n      'ol-drawhole', \r\n      this._interactions.DrawHole, \r\n      this._getTitle(options.interactions.DrawHole) || 'Hole',\r\n      'DrawHole', \r\n      options\r\n    );\r\n  }\r\n\r\n  // Draw regular\r\n  if (options.interactions.DrawRegular !== false) {\r\n    var label = { pts: 'pts', circle: 'circle' };\r\n    if (options.interactions.DrawRegular instanceof ol_interaction_DrawRegular) {\r\n      this._interactions.DrawRegular = options.interactions.DrawRegular;\r\n      label.pts = this._interactions.DrawRegular.get('ptsLabel') || label.pts;\r\n      label.circle = this._interactions.DrawRegular.get('circleLabel') || label.circle;\r\n    } else {\r\n      this._interactions.DrawRegular = new ol_interaction_DrawRegular ({\r\n        source: this._source,\r\n        sides: 4\r\n      });\r\n      if (options.interactions.DrawRegular) {\r\n        label.pts = options.interactions.DrawRegular.ptsLabel || label.pts;\r\n        label.circle = options.interactions.DrawRegular.circleLabel || label.circle;\r\n      }\r\n    }\r\n    var regular = this._interactions.DrawRegular;\r\n\r\n    var div = document.createElement('DIV');\r\n\r\n    var down = ol_ext_element.create('DIV', { parent: div });\r\n    ol_ext_element.addListener(down, ['click', 'touchstart'], function() {\r\n      var sides = regular.getSides() -1;\r\n      if (sides < 2) sides = 2;\r\n      regular.setSides (sides);\r\n      text.textContent = sides>2 ? sides+' '+label.pts : label.circle;\r\n    }.bind(this));\r\n\r\n    var text = ol_ext_element.create('TEXT', { html:'4 '+label.pts, parent: div });\r\n    \r\n    var up = ol_ext_element.create('DIV', { parent: div });\r\n    ol_ext_element.addListener(up, ['click', 'touchstart'], function() {\r\n      var sides = regular.getSides() +1;\r\n      if (sides<3) sides=3;\r\n      regular.setSides(sides);\r\n      text.textContent = sides+' '+label.pts;\r\n    }.bind(this));\r\n\r\n    var ctrl = new ol_control_Toggle({\r\n      className: 'ol-drawregular',\r\n      title: this._getTitle(options.interactions.DrawRegular) || 'Regular',\r\n      name: 'DrawRegular',\r\n      interaction: this._interactions.DrawRegular,\r\n      // Options bar associated with the control\r\n      bar: new ol_control_Bar ({\r\n        controls:[ \r\n          new ol_control_TextButton({\r\n            html: div\r\n          })\r\n        ]\r\n      }) \r\n    });\r\n    this.addControl (ctrl);\r\n  }\r\n\r\n};\r\n\r\n/**\r\n * @private\r\n */\r\nol_control_EditBar.prototype._setDrawPolygon = function (className, interaction, title, name, options) {\r\n  var fedit = new ol_control_Toggle ({\r\n    className: className,\r\n    name: name,\r\n    title: title,\r\n    interaction: interaction,\r\n    // Options bar associated with the control\r\n    bar: new ol_control_Bar({\r\n      controls:[ \r\n        new ol_control_TextButton ({\r\n          html: this._getTitle(options.interactions.UndoDraw) || 'undo',\r\n          title: this._getTitle(options.interactions.UndoDraw) || 'undo last point',\r\n          handleClick: function(){\r\n            if (fedit.getInteraction().nbpts>1) fedit.getInteraction().removeLastPoint();\r\n          }\r\n        }),\r\n        new ol_control_TextButton({\r\n          html: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n          title: this._getTitle(options.interactions.FinishDraw) || 'finish',\r\n          handleClick: function() {\r\n            // Prevent null objects on finishDrawing\r\n            if (fedit.getInteraction().nbpts>3) fedit.getInteraction().finishDrawing();\r\n          }\r\n        })\r\n      ]\r\n    }) \r\n  });\r\n  this.addControl (fedit);\r\n  return fedit;\r\n};\r\n\r\n/** Add modify tools\r\n * @private\r\n */ \r\nol_control_EditBar.prototype._setModifyInteraction = function (options) {\r\n  // Modify on selected features\r\n  if (options.interactions.ModifySelect !== false && options.interactions.Select !== false) {\r\n    if (options.interactions.ModifySelect instanceof ol_interaction_ModifyFeature) {\r\n      this._interactions.ModifySelect = options.interactions.ModifySelect;\r\n    } else {\r\n      this._interactions.ModifySelect = new ol_interaction_ModifyFeature({\r\n        features: this.getInteraction('Select').getFeatures()\r\n      });\r\n    }\r\n    if (this.getMap()) this.getMap().addInteraction(this._interactions.ModifySelect);\r\n    // Activate with select\r\n    this._interactions.ModifySelect.setActive(this._interactions.Select.getActive());\r\n    this._interactions.Select.on('change:active', function() {\r\n      this._interactions.ModifySelect.setActive(this._interactions.Select.getActive());\r\n    }.bind(this));\r\n  }\r\n\r\n  if (options.interactions.Transform !== false) {\r\n    if (options.interactions.Transform instanceof ol_interaction_Transform) {\r\n      this._interactions.Transform = options.interactions.Transform;\r\n    } else {\r\n      this._interactions.Transform = new ol_interaction_Transform ({\r\n        addCondition: ol_events_condition_shiftKeyOnly\r\n      });\r\n    }\r\n    var transform = new ol_control_Toggle ({\r\n      html: '<i></i>',\r\n      className: 'ol-transform',\r\n      title: this._getTitle(options.interactions.Transform) || 'Transform',\r\n      name: 'Transform',\r\n      interaction: this._interactions.Transform\r\n    });\r\n    this.addControl (transform);\r\n  }\r\n\r\n  if (options.interactions.Split !== false) {\r\n    if (options.interactions.Split instanceof ol_interaction_Split) {\r\n      this._interactions.Split = options.interactions.Split;\r\n    } else {\r\n      this._interactions.Split = new ol_interaction_Split ({\r\n          sources: this._source\r\n      });\r\n    }\r\n    var split = new ol_control_Toggle ({\r\n      className: 'ol-split',\r\n      title: this._getTitle(options.interactions.Split) || 'Split',\r\n      name: 'Split', \r\n      interaction: this._interactions.Split\r\n    });\r\n    this.addControl (split);\r\n  }\r\n\r\n  if (options.interactions.Offset !== false) {\r\n    if (options.interactions.Offset instanceof ol_interaction_Offset) {\r\n      this._interactions.Offset = options.interactions.Offset;\r\n    } else {\r\n      this._interactions.Offset = new ol_interaction_Offset ({\r\n          source: this._source\r\n      });\r\n    }\r\n    var offset = new ol_control_Toggle ({\r\n      html: '<i></i>',\r\n      className: 'ol-offset',\r\n      title: this._getTitle(options.interactions.Offset) || 'Offset',\r\n      name: 'Offset',\r\n      interaction: this._interactions.Offset\r\n    });\r\n    this.addControl (offset);\r\n  }\r\n\r\n};\r\n\r\nexport default ol_control_EditBar\r\n","import ol_source_Vector from 'ol/source/Vector'\r\n\r\n(function () {\r\n  var clear = ol_source_Vector.prototype.clear;\r\n\r\n  /** Overwrite ol/source/Vector clear to fire clearstart / clearend event\r\n   */\r\n  ol_source_Vector.prototype.clear = function(opt_fast) {\r\n    this.dispatchEvent({ type: 'clearstart' });\r\n    clear.call(this, opt_fast)\r\n    this.dispatchEvent({ type: 'clearend' });\r\n  };\r\n})();\r\n","import ol_ext_inherits from '../util/ext'\r\nimport ol_Collection from 'ol/Collection'\r\nimport ol_interaction_Interaction from 'ol/interaction/Interaction'\r\nimport ol_layer_Vector from 'ol/layer/Vector'\r\nimport {unByKey as ol_Observable_unByKey} from 'ol/Observable'\r\nimport '../source/Vector' \r\n\r\n/** Undo/redo interaction\r\n * @constructor\r\n * @extends {ol_interaction_Interaction}\r\n * @fires undo\r\n * @fires redo\r\n * @fires change:add\r\n * @fires change:remove\r\n * @fires change:clear\r\n * @param {Object} options\r\n *  @param {number=} options.maxLength max undo stack length (0=Infinity), default Infinity\r\n *  @param {Array<ol.Layer>} options.layers array of layers to undo/redo\r\n */\r\nvar ol_interaction_UndoRedo = function(options) {\r\n  if (!options) options = {};\r\n\r\n\tol_interaction_Interaction.call(this, {\t\r\n    handleEvent: function() { \r\n      return true; \r\n    }\r\n  });\r\n\r\n  //array of layers to undo/redo\r\n  this._layers = options.layers\r\n\r\n  this._undoStack = new ol_Collection();\r\n  this._redoStack = new ol_Collection();\r\n  // Zero level stack\r\n  this._undo = [];\r\n  this._redo = [];\r\n  this._undoStack.on('add', function(e) {\r\n    if (e.element.level === undefined) {\r\n      e.element.level = this._level;\r\n      if (!e.element.level) {\r\n        e.element.view = {\r\n          center: this.getMap().getView().getCenter(),\r\n          zoom: this.getMap().getView().getZoom()\r\n        };\r\n        this._undo.push(e.element);\r\n      }\r\n    } else {\r\n      if (!e.element.level) this._undo.push(this._redo.shift());\r\n    }\r\n    if (!e.element.level) {\r\n      this.dispatchEvent({ \r\n        type: 'stack:add', \r\n        action: e.element\r\n      });\r\n    }\r\n    this._reduce();\r\n  }.bind(this));\r\n  this._undoStack.on('remove', function(e) {\r\n    if (!e.element.level) {\r\n      if (this._doShift) {\r\n        this._undo.shift();\r\n      } else {\r\n        if (this._undo.length) this._redo.push(this._undo.pop());\r\n      }\r\n      if (!this._doClear) {\r\n        this.dispatchEvent({ \r\n          type: 'stack:remove', \r\n          action: e.element,\r\n          shift: this._doShift\r\n        });\r\n      }\r\n    }\r\n  }.bind(this));\r\n  // Block counter\r\n  this._block = 0;\r\n  this._level = 0;\r\n  // Shift an undo action ?\r\n  this._doShift = false;\r\n  // Start recording\r\n  this._record = true;\r\n  // Custom definitions\r\n  this._defs = {};\r\n};\r\nol_ext_inherits(ol_interaction_UndoRedo, ol_interaction_Interaction);\r\n\r\n/** Add a custom undo/redo\r\n * @param {string} action the action key name\r\n * @param {function} undoFn function called when undoing\r\n * @param {function} redoFn function called when redoing\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.define = function(action, undoFn, redoFn) {\r\n  this._defs[action] = { undo: undoFn, redo: redoFn };\r\n};\r\n\r\n/** Get first level undo / redo length\r\n * @param {string} [type] get redo stack length, default get undo\r\n * @return {number}\r\n */\r\nol_interaction_UndoRedo.prototype.length = function(type) {\r\n  return (type==='redo') ? this._redo.length : this._undo.length;\r\n};\r\n\r\n/** Set undo stack max length\r\n * @param {number} length\r\n */\r\nol_interaction_UndoRedo.prototype.setMaxLength = function(length) {\r\n  length = parseInt(length);\r\n  if (length && length<0) length = 0;\r\n  this.set('maxLength', length);\r\n  this._reduce();\r\n};\r\n\r\n/** Get undo / redo size (includes all block levels)\r\n * @param {string} [type] get redo stack length, default get undo\r\n * @return {number}\r\n */\r\nol_interaction_UndoRedo.prototype.size = function(type) {\r\n  return (type==='redo') ? this._redoStack.getLength() : this._undoStack.getLength();\r\n};\r\n\r\n/** Set undo stack max size\r\n * @param {number} size\r\n */\r\nol_interaction_UndoRedo.prototype.setMaxSize = function(size) {\r\n  size = parseInt(size);\r\n  if (size && size<0) size = 0;\r\n  this.set('maxSize', size);\r\n  this._reduce();\r\n};\r\n\r\n/** Reduce stack: shift undo to set size\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._reduce = function() {\r\n  if (this.get('maxLength')) {\r\n    while (this.length() > this.get('maxLength')) {\r\n      this.shift();\r\n    }\r\n  }\r\n  if (this.get('maxSize')) {\r\n    while (this.length() > 1 && this.size() > this.get('maxSize')) {\r\n      this.shift();\r\n    }\r\n  }\r\n};\r\n\r\n/** Get first level undo / redo first level stack\r\n * @param {string} [type] get redo stack, default get undo\r\n * @return {Array<*>}\r\n */\r\nol_interaction_UndoRedo.prototype.getStack = function(type) {\r\n  return (type==='redo') ? this._redo : this._undo;\r\n};\r\n\r\n/** Add a new custom undo/redo\r\n * @param {string} action the action key name\r\n * @param {any} prop an object that will be passed in the undo/redo functions of the action\r\n * @param {string} name action name\r\n * @return {boolean} true if the action is defined\r\n */\r\nol_interaction_UndoRedo.prototype.push = function(action, prop, name) {\r\n  if (this._defs[action]) {\r\n    this._undoStack.push({ \r\n      type: action,\r\n      name: name,\r\n      custom: true,\r\n      prop: prop \r\n    });\r\n    return true;\r\n  } else {\r\n    console.warn('[UndoRedoInteraction]: \"'+action+'\" is not defined.');\r\n    return false;\r\n  }\r\n};\r\n\r\n/** Remove undo action from the beginning of the stack. \r\n * The action is not returned.\r\n */\r\nol_interaction_UndoRedo.prototype.shift = function() {\r\n  this._doShift = true;\r\n  var a = this._undoStack.removeAt(0);\r\n  this._doShift = false;\r\n  // Remove all block\r\n  if (a.type==='blockstart') {\r\n    a = this._undoStack.item(0);\r\n    while (this._undoStack.getLength() && a.level>0) {\r\n      this._undoStack.removeAt(0);\r\n      a = this._undoStack.item(0);\r\n    }\r\n  }\r\n};\r\n\r\n/** Activate or deactivate the interaction, ie. records or not events on the map.\r\n * @param {boolean} active\r\n * @api stable\r\n */\r\nol_interaction_UndoRedo.prototype.setActive = function(active) {\r\n  ol_interaction_Interaction.prototype.setActive.call (this, active);\r\n  this._record = active;\r\n};\r\n\r\n/**\r\n * Remove the interaction from its current map, if any, and attach it to a new\r\n * map, if any. Pass `null` to just remove the interaction from the current map.\r\n * @param {ol.Map} map Map.\r\n * @api stable\r\n */\r\nol_interaction_UndoRedo.prototype.setMap = function(map) {\r\n  if (this._mapListener) {\r\n    this._mapListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._mapListener = [];\r\n  ol_interaction_Interaction.prototype.setMap.call (this, map);\r\n  // Watch blocks\r\n  if (map) {\r\n    this._mapListener.push(map.on('undoblockstart', this.blockStart.bind(this)));\r\n    this._mapListener.push(map.on('undoblockend', this.blockEnd.bind(this)));\r\n  }\r\n  // Watch sources\r\n  this._watchSources();\r\n  this._watchInteractions();\r\n};\r\n\r\n/** Watch for changes in the map sources\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._watchSources = function() {\r\n  var map = this.getMap();\r\n  // Clear listeners\r\n  if (this._sourceListener) {\r\n    this._sourceListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._sourceListener = [];\r\n  \r\n  var self = this;\r\n\r\n  // Ges vector layers \r\n  function getVectorLayers(layers, init) {\r\n    if (!init) init = [];\r\n    layers.forEach(function(l) {\r\n      if (l instanceof ol_layer_Vector) {\r\n        if (!self._layers || self._layers.indexOf(l) >= 0) {\r\n          init.push(l);\r\n        }\r\n      } else if (l.getLayers) {\r\n        getVectorLayers(l.getLayers(), init);\r\n      }\r\n    });\r\n    return init;\r\n  }\r\n\r\n  if (map) {\r\n    // Watch the vector sources in the map \r\n    var vectors = getVectorLayers(map.getLayers());\r\n    vectors.forEach((function(l) {\r\n      var s = l.getSource();\r\n      this._sourceListener.push( s.on(['addfeature', 'removefeature'], this._onAddRemove.bind(this)) );\r\n      this._sourceListener.push( s.on('clearstart', function() {\r\n        this.blockStart('clear')\r\n      }.bind(this)));\r\n      this._sourceListener.push( s.on('clearend', this.blockEnd.bind(this)) );\r\n    }).bind(this));\r\n\r\n    // Watch new inserted/removed\r\n    this._sourceListener.push( map.getLayers().on(['add', 'remove'], this._watchSources.bind(this) ) );\r\n  }\r\n};\r\n\r\n/** Watch for interactions\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._watchInteractions = function() {\r\n  var map = this.getMap();\r\n  // Clear listeners\r\n  if (this._interactionListener) {\r\n    this._interactionListener.forEach(function(l) { ol_Observable_unByKey(l); })\r\n  }\r\n  this._interactionListener = [];\r\n\r\n  if (map) {\r\n    // Watch the interactions in the map \r\n    map.getInteractions().forEach((function(i) {\r\n      this._interactionListener.push(i.on(\r\n        ['setattributestart', 'modifystart', 'rotatestart', 'translatestart', 'scalestart', 'deletestart', 'deleteend', 'beforesplit', 'aftersplit'], \r\n        this._onInteraction.bind(this)\r\n      ));\r\n    }).bind(this));\r\n\r\n    // Watch new inserted / unwatch removed\r\n    this._interactionListener.push( map.getInteractions().on(\r\n      ['add', 'remove'], \r\n      this._watchInteractions.bind(this)\r\n    ));\r\n  }\r\n};\r\n\r\n/** A feature is added / removed\r\n */\r\nol_interaction_UndoRedo.prototype._onAddRemove = function(e) {\r\n  if (this._record) {\r\n    this._redoStack.clear();\r\n    this._redo.length = 0;\r\n    this._undoStack.push({\r\n      type: e.type, \r\n      source: e.target, \r\n      feature: e.feature\r\n    });\r\n  }\r\n};\r\n\r\n/** Perform an interaction\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction = function(e) {\r\n  var fn = this._onInteraction[e.type];\r\n  if (fn) fn.call(this,e);\r\n};\r\n\r\n/** Set attribute\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.setattributestart = function(e) {\r\n  this.blockStart(e.target.get('name') || 'setattribute');\r\n  var newp = Object.assign({}, e.properties);\r\n  e.features.forEach(function(f) {\r\n    var oldp = {};\r\n    for (var p in newp) {\r\n      oldp[p] = f.get(p);\r\n    }\r\n    this._undoStack.push({\r\n      type: 'changeattribute', \r\n      feature: f,\r\n      newProperties: newp,\r\n      oldProperties: oldp\r\n    });\r\n  }.bind(this));\r\n  this.blockEnd();\r\n};\r\n\r\nol_interaction_UndoRedo.prototype._onInteraction.rotatestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.translatestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.scalestart = \r\nol_interaction_UndoRedo.prototype._onInteraction.modifystart = function (e) {\r\n  this.blockStart(e.type.replace(/start$/,''));\r\n  e.features.forEach(function(m) {\r\n    this._undoStack.push({ \r\n      type: 'changegeometry', \r\n      feature: m, \r\n      oldGeom: m.getGeometry().clone() \r\n    });\r\n  }.bind(this));\r\n  this.blockEnd();\r\n};\r\n\r\n/** Start an undo block\r\n * @param {string} [name] name f the action\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.blockStart = function (name) {\r\n  this._redoStack.clear();\r\n  this._redo.length = 0;\r\n  this._undoStack.push({ \r\n    type: 'blockstart', \r\n    name: name\r\n  });\r\n  this._level++;\r\n};\r\n\r\n/** @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.beforesplit = function() {\r\n  // Check modify before split\r\n  var l = this._undoStack.getLength();\r\n  if (l>2 \r\n    && this._undoStack.item(l-1).type === 'blockend'\r\n    && this._undoStack.item(l-2).type === 'changegeometry') {\r\n    this._undoStack.pop();\r\n  } else {\r\n    this.blockStart('split');\r\n  }\r\n};\r\nol_interaction_UndoRedo.prototype._onInteraction.deletestart = function() {\r\n  this.blockStart('delete');\r\n}\r\n\r\n/** End an undo block\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.blockEnd = function () {\r\n  this._undoStack.push({ type: 'blockend' });\r\n  this._level--;\r\n};\r\n\r\n/** @private\r\n */\r\nol_interaction_UndoRedo.prototype._onInteraction.aftersplit =\r\nol_interaction_UndoRedo.prototype._onInteraction.deleteend =\r\nol_interaction_UndoRedo.prototype.blockEnd;\r\n\r\n/** handle undo/redo\r\n * @private\r\n */\r\nol_interaction_UndoRedo.prototype._handleDo = function(e, undo) {\r\n  // Not active\r\n  if (!this.getActive()) return;\r\n\r\n  // Stop recording while undoing\r\n  this._record = false;\r\n  if (e.custom) {\r\n    if (this._defs[e.type]) {\r\n      if (undo) this._defs[e.type].undo(e.prop);\r\n      else this._defs[e.type].redo(e.prop);\r\n    } else {\r\n      console.warn('[UndoRedoInteraction]: \"'+e.type+'\" is not defined.');\r\n    }\r\n  } else {\r\n    switch (e.type) {\r\n      case 'addfeature': {\r\n        if (undo) e.source.removeFeature(e.feature);\r\n        else e.source.addFeature(e.feature);\r\n        break;\r\n      }\r\n      case 'removefeature': {\r\n        if (undo) e.source.addFeature(e.feature);\r\n        else e.source.removeFeature(e.feature);\r\n        break;\r\n      }\r\n      case 'changegeometry': {\r\n        var geom = e.feature.getGeometry();\r\n        e.feature.setGeometry(e.oldGeom);\r\n        e.oldGeom = geom;\r\n        break;\r\n      }\r\n      case 'changeattribute': {\r\n        var newp = e.newProperties;\r\n        var oldp = e.oldProperties;\r\n        for (var p in oldp) {\r\n          if (oldp === undefined) e.feature.unset(p);\r\n          else e.feature.set(p, oldp[p]);\r\n        }\r\n        e.oldProperties = newp;\r\n        e.newProperties = oldp;\r\n        break;\r\n      }\r\n      case 'blockstart': {\r\n        this._block += undo ? -1 : 1;\r\n        break;\r\n      }\r\n      case 'blockend': {\r\n        this._block += undo ? 1 : -1;\r\n        break;\r\n      }\r\n      default: {\r\n        console.warn('[UndoRedoInteraction]: \"'+e.type+'\" is not defined.');\r\n      }\r\n    }\r\n  }\r\n\r\n  // Handle block\r\n  if (this._block<0) this._block = 0;\r\n  if (this._block) {\r\n    if (undo) this.undo();\r\n    else this.redo();\r\n  }\r\n  this._record = true;\r\n\r\n  // Dispatch event\r\n  this.dispatchEvent( { \r\n    type: undo ? 'undo' : 'redo',\r\n    action: e\r\n  });\r\n};\r\n\r\n/** Undo last operation\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.undo = function() {\r\n  var e = this._undoStack.item(this._undoStack.getLength() - 1);\r\n  if (!e) return;\r\n  this._redoStack.push(e);\r\n  this._undoStack.pop();\r\n  this._handleDo(e, true);\r\n};\r\n\r\n/** Redo last operation\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.redo = function() {\r\n  var e = this._redoStack.item(this._redoStack.getLength() - 1);\r\n  if (!e) return;\r\n  this._undoStack.push(e);\r\n  this._redoStack.pop();\r\n  this._handleDo(e, false);\r\n};\r\n\r\n/** Clear undo stack\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.clear = function() {\r\n  this._doClear = true;\r\n  this._undo.length = this._redo.length = 0;\r\n  this._undoStack.clear();\r\n  this._redoStack.clear();\r\n  this._doClear = false;\r\n  this.dispatchEvent({ type: 'stack:clear' });\r\n};\r\n\r\n/** Check if undo is avaliable\r\n * @return {number} the number of undo \r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.hasUndo = function() {\r\n  return this._undoStack.getLength();\r\n};\r\n\r\n/** Check if redo is avaliable\r\n * @return {number} the number of redo\r\n * @api\r\n */\r\nol_interaction_UndoRedo.prototype.hasRedo = function() {\r\n  return this._redoStack.getLength();\r\n};\r\n\r\nexport default ol_interaction_UndoRedo\r\n","/**\n * @module ol/Disposable\n */\n/**\n * @classdesc\n * Objects that need to clean up after themselves.\n */\nvar Disposable = /** @class */ (function () {\n    function Disposable() {\n        /**\n         * The object has already been disposed.\n         * @type {boolean}\n         * @protected\n         */\n        this.disposed = false;\n    }\n    /**\n     * Clean up.\n     */\n    Disposable.prototype.dispose = function () {\n        if (!this.disposed) {\n            this.disposed = true;\n            this.disposeInternal();\n        }\n    };\n    /**\n     * Extension point for disposable objects.\n     * @protected\n     */\n    Disposable.prototype.disposeInternal = function () { };\n    return Disposable;\n}());\nexport default Disposable;\n//# sourceMappingURL=Disposable.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/Collection\n */\nimport AssertionError from './AssertionError.js';\nimport BaseObject from './Object.js';\nimport CollectionEventType from './CollectionEventType.js';\nimport Event from './events/Event.js';\n/**\n * @enum {string}\n * @private\n */\nvar Property = {\n    LENGTH: 'length',\n};\n/**\n * @classdesc\n * Events emitted by {@link module:ol/Collection~Collection} instances are instances of this\n * type.\n */\nvar CollectionEvent = /** @class */ (function (_super) {\n    __extends(CollectionEvent, _super);\n    /**\n     * @param {import(\"./CollectionEventType.js\").default} type Type.\n     * @param {*} [opt_element] Element.\n     * @param {number} [opt_index] The index of the added or removed element.\n     */\n    function CollectionEvent(type, opt_element, opt_index) {\n        var _this = _super.call(this, type) || this;\n        /**\n         * The element that is added to or removed from the collection.\n         * @type {*}\n         * @api\n         */\n        _this.element = opt_element;\n        /**\n         * The index of the added or removed element.\n         * @type {number}\n         * @api\n         */\n        _this.index = opt_index;\n        return _this;\n    }\n    return CollectionEvent;\n}(Event));\nexport { CollectionEvent };\n/***\n * @template Return\n * @typedef {import(\"./Observable\").OnSignature<import(\"./Observable\").EventTypes, import(\"./events/Event.js\").default, Return> &\n *   import(\"./Observable\").OnSignature<import(\"./ObjectEventType\").Types|'change:length', import(\"./Object\").ObjectEvent, Return> &\n *   import(\"./Observable\").OnSignature<'add'|'remove', CollectionEvent, Return> &\n *   import(\"./Observable\").CombinedOnSignature<import(\"./Observable\").EventTypes|import(\"./ObjectEventType\").Types|\n *     'change:length'|'add'|'remove',Return>} CollectionOnSignature\n */\n/**\n * @typedef {Object} Options\n * @property {boolean} [unique=false] Disallow the same item from being added to\n * the collection twice.\n */\n/**\n * @classdesc\n * An expanded version of standard JS Array, adding convenience methods for\n * manipulation. Add and remove changes to the Collection trigger a Collection\n * event. Note that this does not cover changes to the objects _within_ the\n * Collection; they trigger events on the appropriate object, not on the\n * Collection as a whole.\n *\n * @fires CollectionEvent\n *\n * @template T\n * @api\n */\nvar Collection = /** @class */ (function (_super) {\n    __extends(Collection, _super);\n    /**\n     * @param {Array<T>} [opt_array] Array.\n     * @param {Options} [opt_options] Collection options.\n     */\n    function Collection(opt_array, opt_options) {\n        var _this = _super.call(this) || this;\n        /***\n         * @type {CollectionOnSignature<import(\"./events\").EventsKey>}\n         */\n        _this.on;\n        /***\n         * @type {CollectionOnSignature<import(\"./events\").EventsKey>}\n         */\n        _this.once;\n        /***\n         * @type {CollectionOnSignature<void>}\n         */\n        _this.un;\n        var options = opt_options || {};\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.unique_ = !!options.unique;\n        /**\n         * @private\n         * @type {!Array<T>}\n         */\n        _this.array_ = opt_array ? opt_array : [];\n        if (_this.unique_) {\n            for (var i = 0, ii = _this.array_.length; i < ii; ++i) {\n                _this.assertUnique_(_this.array_[i], i);\n            }\n        }\n        _this.updateLength_();\n        return _this;\n    }\n    /**\n     * Remove all elements from the collection.\n     * @api\n     */\n    Collection.prototype.clear = function () {\n        while (this.getLength() > 0) {\n            this.pop();\n        }\n    };\n    /**\n     * Add elements to the collection.  This pushes each item in the provided array\n     * to the end of the collection.\n     * @param {!Array<T>} arr Array.\n     * @return {Collection<T>} This collection.\n     * @api\n     */\n    Collection.prototype.extend = function (arr) {\n        for (var i = 0, ii = arr.length; i < ii; ++i) {\n            this.push(arr[i]);\n        }\n        return this;\n    };\n    /**\n     * Iterate over each element, calling the provided callback.\n     * @param {function(T, number, Array<T>): *} f The function to call\n     *     for every element. This function takes 3 arguments (the element, the\n     *     index and the array). The return value is ignored.\n     * @api\n     */\n    Collection.prototype.forEach = function (f) {\n        var array = this.array_;\n        for (var i = 0, ii = array.length; i < ii; ++i) {\n            f(array[i], i, array);\n        }\n    };\n    /**\n     * Get a reference to the underlying Array object. Warning: if the array\n     * is mutated, no events will be dispatched by the collection, and the\n     * collection's \"length\" property won't be in sync with the actual length\n     * of the array.\n     * @return {!Array<T>} Array.\n     * @api\n     */\n    Collection.prototype.getArray = function () {\n        return this.array_;\n    };\n    /**\n     * Get the element at the provided index.\n     * @param {number} index Index.\n     * @return {T} Element.\n     * @api\n     */\n    Collection.prototype.item = function (index) {\n        return this.array_[index];\n    };\n    /**\n     * Get the length of this collection.\n     * @return {number} The length of the array.\n     * @observable\n     * @api\n     */\n    Collection.prototype.getLength = function () {\n        return this.get(Property.LENGTH);\n    };\n    /**\n     * Insert an element at the provided index.\n     * @param {number} index Index.\n     * @param {T} elem Element.\n     * @api\n     */\n    Collection.prototype.insertAt = function (index, elem) {\n        if (this.unique_) {\n            this.assertUnique_(elem);\n        }\n        this.array_.splice(index, 0, elem);\n        this.updateLength_();\n        this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD, elem, index));\n    };\n    /**\n     * Remove the last element of the collection and return it.\n     * Return `undefined` if the collection is empty.\n     * @return {T|undefined} Element.\n     * @api\n     */\n    Collection.prototype.pop = function () {\n        return this.removeAt(this.getLength() - 1);\n    };\n    /**\n     * Insert the provided element at the end of the collection.\n     * @param {T} elem Element.\n     * @return {number} New length of the collection.\n     * @api\n     */\n    Collection.prototype.push = function (elem) {\n        if (this.unique_) {\n            this.assertUnique_(elem);\n        }\n        var n = this.getLength();\n        this.insertAt(n, elem);\n        return this.getLength();\n    };\n    /**\n     * Remove the first occurrence of an element from the collection.\n     * @param {T} elem Element.\n     * @return {T|undefined} The removed element or undefined if none found.\n     * @api\n     */\n    Collection.prototype.remove = function (elem) {\n        var arr = this.array_;\n        for (var i = 0, ii = arr.length; i < ii; ++i) {\n            if (arr[i] === elem) {\n                return this.removeAt(i);\n            }\n        }\n        return undefined;\n    };\n    /**\n     * Remove the element at the provided index and return it.\n     * Return `undefined` if the collection does not contain this index.\n     * @param {number} index Index.\n     * @return {T|undefined} Value.\n     * @api\n     */\n    Collection.prototype.removeAt = function (index) {\n        var prev = this.array_[index];\n        this.array_.splice(index, 1);\n        this.updateLength_();\n        this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE, prev, index));\n        return prev;\n    };\n    /**\n     * Set the element at the provided index.\n     * @param {number} index Index.\n     * @param {T} elem Element.\n     * @api\n     */\n    Collection.prototype.setAt = function (index, elem) {\n        var n = this.getLength();\n        if (index < n) {\n            if (this.unique_) {\n                this.assertUnique_(elem, index);\n            }\n            var prev = this.array_[index];\n            this.array_[index] = elem;\n            this.dispatchEvent(new CollectionEvent(CollectionEventType.REMOVE, prev, index));\n            this.dispatchEvent(new CollectionEvent(CollectionEventType.ADD, elem, index));\n        }\n        else {\n            for (var j = n; j < index; ++j) {\n                this.insertAt(j, undefined);\n            }\n            this.insertAt(index, elem);\n        }\n    };\n    /**\n     * @private\n     */\n    Collection.prototype.updateLength_ = function () {\n        this.set(Property.LENGTH, this.array_.length);\n    };\n    /**\n     * @private\n     * @param {T} elem Element.\n     * @param {number} [opt_except] Optional index to ignore.\n     */\n    Collection.prototype.assertUnique_ = function (elem, opt_except) {\n        for (var i = 0, ii = this.array_.length; i < ii; ++i) {\n            if (this.array_[i] === elem && i !== opt_except) {\n                throw new AssertionError(58);\n            }\n        }\n    };\n    return Collection;\n}(BaseObject));\nexport default Collection;\n//# sourceMappingURL=Collection.js.map","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Control from 'ol/control/Control'\r\n\r\nimport ol_ext_element from '../util/element'\r\n\r\n/** A simple push button control\r\n * @constructor\r\n * @extends {ol_control_Control}\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {String} options.title title of the control\r\n *  @param {String} options.name an optional name, default none\r\n *  @param {String} options.html html to insert in the control\r\n *  @param {function} options.handleClick callback when control is clicked (or use change:active event)\r\n */\r\nvar ol_control_Button = function(options){\r\n  options = options || {};\r\n\r\n  var element = document.createElement(\"div\");\r\n  element.className = (options.className || '') + \" ol-button ol-unselectable ol-control\";\r\n  var self = this;\r\n\r\n  var bt = this.button_ = document.createElement(/ol-text-button/.test(options.className) ? \"div\": \"button\");\r\n  bt.type = \"button\";\r\n  if (options.title) bt.title = options.title;\r\n  if (options.name) bt.name = options.name;\r\n  if (options.html instanceof Element) bt.appendChild(options.html)\r\n  else bt.innerHTML = options.html || \"\";\r\n  var evtFunction = function(e) {\r\n    if (e && e.preventDefault) {\r\n      e.preventDefault();\r\n      e.stopPropagation();\r\n    }\r\n    if (options.handleClick) {\r\n      options.handleClick.call(self, e);\r\n    }\r\n  };\r\n  bt.addEventListener(\"click\", evtFunction);\r\n  // bt.addEventListener(\"touchstart\", evtFunction);\r\n  element.appendChild(bt);\r\n\r\n  // Try to get a title in the button content\r\n  if (!options.title && bt.firstElementChild) {\r\n    bt.title = bt.firstElementChild.title;\r\n  }\r\n\r\n  ol_control_Control.call(this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  if (options.title) {\r\n    this.set(\"title\", options.title);\r\n  }\r\n  if (options.title) this.set(\"title\", options.title);\r\n  if (options.name) this.set(\"name\", options.name);\r\n};\r\nol_ext_inherits(ol_control_Button, ol_control_Control);\r\n\r\n/** Set the control visibility\r\n* @param {boolean} b \r\n*/\r\nol_control_Button.prototype.setVisible = function (val) {\r\n  if (val) ol_ext_element.show(this.element);\r\n  else ol_ext_element.hide(this.element);\r\n};\r\n\r\n/**\r\n * Set the button title\r\n * @param {string} title\r\n */\r\nol_control_Button.prototype.setTitle = function(title) {\r\n  this.button_.setAttribute('title', title);\r\n};\r\n\r\n/**\r\n * Set the button html\r\n * @param {string} html\r\n */\r\nol_control_Button.prototype.setHtml = function(html) {\r\n  ol_ext_element.setHTML (this.button_, html);\r\n};\r\n\r\n/**\r\n * Get the button element\r\n * @returns {Element}\r\n */\r\nol_control_Button.prototype.getButtonElement = function() {\r\n  return this.button_;\r\n};\r\n\r\nexport default ol_control_Button\r\n","/*\tCopyright (c) 2016 Jean-Marc VIGLINO,\r\n  released under the CeCILL-B license (French BSD license)\r\n  (http://www.cecill.info/licences/Licence_CeCILL-B_V1-en.txt).\r\n*/\r\nimport ol_ext_inherits from '../util/ext'\r\nimport ol_control_Control from 'ol/control/Control'\r\n\r\n/** Control bar for OL3\r\n * The control bar is a container for other controls. It can be used to create toolbars.\r\n * Control bars can be nested and combined with ol.control.Toggle to handle activate/deactivate.\r\n * @class\r\n * @constructor\r\n * @extends ol_control_Control\r\n * @param {Object=} options Control options.\r\n *  @param {String} options.className class of the control\r\n *  @param {boolean} options.group is a group, default false\r\n *  @param {boolean} options.toggleOne only one toggle control is active at a time, default false\r\n *  @param {boolean} options.autoDeactivate used with subbar to deactivate all control when top level control deactivate, default false\r\n *  @param {Array<ol_control_Control> } options.controls a list of control to add to the bar\r\n */\r\nvar ol_control_Bar = function(options) {\r\n  if (!options) options={};\r\n  var element = document.createElement(\"div\");\r\n      element.classList.add('ol-unselectable', 'ol-control', 'ol-bar');\r\n  if (options.className) {\r\n    var classes = options.className.split(' ').filter(function(className) {\r\n      return className.length > 0;\r\n    });\r\n    element.classList.add.apply(element.classList, classes)\r\n  }\r\n  if (options.group) element.classList.add('ol-group');\r\n\r\n  ol_control_Control.call(this, {\r\n    element: element,\r\n    target: options.target\r\n  });\r\n\r\n  this.set('toggleOne', options.toggleOne);\r\n  this.set('autoDeactivate', options.autoDeactivate);\r\n\r\n  this.controls_ = [];\r\n  if (options.controls instanceof Array) {\r\n    for (var i=0; i<options.controls.length; i++) {\r\n      this.addControl(options.controls[i]);\r\n    }\r\n  }\r\n};\r\nol_ext_inherits(ol_control_Bar, ol_control_Control);\r\n\r\n/** Set the control visibility\r\n * @param {boolean} val\r\n */\r\nol_control_Bar.prototype.setVisible = function (val) {\r\n  if (val) this.element.style.display = '';\r\n  else this.element.style.display = 'none';\r\n}\r\n\r\n/** Get the control visibility\r\n * @return {boolean} b\r\n */\r\nol_control_Bar.prototype.getVisible = function () {\r\n  return this.element.style.display != 'none';\r\n}\r\n\r\n/**\r\n * Set the map instance the control is associated with\r\n * and add its controls associated to this map.\r\n * @param {ol_Map} map The map instance.\r\n */\r\nol_control_Bar.prototype.setMap = function (map) {\r\n  ol_control_Control.prototype.setMap.call(this, map);\r\n\r\n  for (var i=0; i<this.controls_.length; i++) {\r\n    var c = this.controls_[i];\r\n    // map.addControl(c);\r\n    c.setMap(map);\r\n  }\r\n};\r\n\r\n/** Get controls in the panel\r\n *\t@param {Array<ol_control_Control>}\r\n */\r\nol_control_Bar.prototype.getControls = function () {\r\n  return this.controls_;\r\n};\r\n\r\n/** Set tool bar position\r\n * @param {string} pos a combinaison of top|left|bottom|right\r\n */\r\nol_control_Bar.prototype.setPosition = function (pos) {\r\n  this.element.classList.remove('ol-left', 'ol-top', 'ol-bottom', 'ol-right');\r\n  pos = pos.split ('-');\r\n  for (var i=0; i<pos.length; i++) {\r\n    switch (pos[i]) {\r\n      case 'top':\r\n      case 'left':\r\n      case 'bottom':\r\n      case 'right':\r\n        this.element.classList.add(\"ol-\"+pos[i]);\r\n        break;\r\n      default: break;\r\n    }\r\n  }\r\n};\r\n\r\n/** Add a control to the bar\r\n *\t@param {ol_control_Control} c control to add\r\n */\r\nol_control_Bar.prototype.addControl = function (c) {\r\n  this.controls_.push(c);\r\n  c.setTarget(this.element);\r\n  if (this.getMap()) {\r\n    this.getMap().addControl(c);\r\n  }\r\n  // Activate and toogleOne\r\n  c.on ('change:active', function(e) { this.onActivateControl_(e, c); }.bind(this));\r\n  if (c.getActive) {\r\n    // c.dispatchEvent({ type:'change:active', key:'active', oldValue:false, active:true });\r\n    this.onActivateControl_({ target: c, active: c.getActive() }, c);\r\n  }\r\n};\r\n\r\n/** Deativate all controls in a bar\r\n * @param {ol_control_Control} [except] a control\r\n */\r\nol_control_Bar.prototype.deactivateControls = function (except) {\r\n  for (var i=0; i<this.controls_.length; i++) {\r\n  if (this.controls_[i] !== except && this.controls_[i].setActive) {\r\n      this.controls_[i].setActive(false);\r\n    }\r\n  }\r\n};\r\n\r\n/** Get active control in the bar\r\n * @returns {Array<ol_control_Control>}\r\n */\r\nol_control_Bar.prototype.getActiveControls = function () {\r\n  var active = [];\r\n  for (var i=0, c; c=this.controls_[i]; i++) {\r\n    if (c.getActive && c.getActive()) active.push(c);\r\n  }\r\n  return active;\r\n}\r\n\r\n/** Auto activate/deactivate controls in the bar\r\n * @param {boolean} b activate/deactivate\r\n */\r\nol_control_Bar.prototype.setActive = function (b) {\r\n  if (!b && this.get(\"autoDeactivate\")) {\r\n    this.deactivateControls();\r\n  }\r\n  if (b) {\r\n    var ctrls = this.getControls();\r\n    for (var i=0, sb; (sb = ctrls[i]); i++) {\r\n      if (sb.get(\"autoActivate\")) sb.setActive(true);\r\n    }\r\n  }\r\n}\r\n\r\n/** Post-process an activated/deactivated control\r\n *\t@param {ol.event} e :an object with a target {_ol_control_} and active flag {bool}\r\n */\r\nol_control_Bar.prototype.onActivateControl_ = function (e, ctrl) {\r\n  if (this.get('toggleOne')) {\r\n    if (e.active) {\r\n      var n;\r\n      //var ctrl = e.target;\r\n      for (n=0; n<this.controls_.length; n++) {\r\n        if (this.controls_[n]===ctrl) break;\r\n      }\r\n      // Not here!\r\n      if (n==this.controls_.length) return;\r\n      this.deactivateControls (this.controls_[n]);\r\n    } else {\r\n      // No one active > test auto activate\r\n      if (!this.getActiveControls().length) {\r\n        for (var i=0, c; c=this.controls_[i]; i++) {\r\n          if (c.get(\"autoActivate\")) {\r\n            c.setActive(true);\r\n            break;\r\n          }\r\n        }\r\n      }\r\n    }\r\n  }\r\n};\r\n\r\n/**\r\n * @param {string} name of the control to search\r\n * @return {ol.control.Control}\r\n */\r\nol_control_Bar.prototype.getControlsByName = function(name) {\r\n  var controls = this.getControls();\r\n  return controls.filter(\r\n    function(control) {\r\n      return (control.get('name') === name);\r\n    }\r\n  );\r\n};\r\n\r\nexport default ol_control_Bar\r\n"],"sourceRoot":""}