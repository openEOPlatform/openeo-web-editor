(window["webpackJsonp"]=window["webpackJsonp"]||[]).push([["chunk-fb557d00","chunk-a359f53c","chunk-a359f53c"],{2368:function(e,t,r){"use strict";r.d(t,"b",(function(){return y})),r.d(t,"a",(function(){return R}));var i=r("5116"),n=r("6d83"),a=r("dc07"),o=r("acc1"),s=r("1939"),u=r("aab2"),h=r("cae5"),c=r("5e7e"),l=r("86e0"),f=r("a896"),p=r("0af5"),d=r("be6c"),g=r("2c30"),_=r("256f"),T=r("1300"),v=r("9f5e"),m=r("345d"),E=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),y={TILE_TEXTURE_ARRAY:"u_tileTextures",TILE_TRANSFORM:"u_tileTransform",TRANSITION_ALPHA:"u_transitionAlpha",DEPTH:"u_depth",TEXTURE_PIXEL_WIDTH:"u_texturePixelWidth",TEXTURE_PIXEL_HEIGHT:"u_texturePixelHeight",TEXTURE_RESOLUTION:"u_textureResolution",TEXTURE_ORIGIN_X:"u_textureOriginX",TEXTURE_ORIGIN_Y:"u_textureOriginY",RENDER_EXTENT:"u_renderExtent",RESOLUTION:"u_resolution",ZOOM:"u_zoom"},R={TEXTURE_COORD:"a_textureCoord"},x=[{name:R.TEXTURE_COORD,size:2,type:c["a"].FLOAT}],b={};function O(e){return 2*(1-1/(e+1))-1}function S(e,t,r){r in e||(e[r]=[]),e[r].push(t)}function I(e,t){var r=e.layerStatesArray[e.layerIndex];r.extent&&(t=Object(p["A"])(t,Object(_["l"])(r.extent,e.viewState.projection)));var i=r.layer.getRenderSource();if(!i.getWrapX()){var n=i.getTileGridForProjection(e.viewState.projection).getExtent();n&&(t=Object(p["A"])(t,n))}return t}function C(e,t){return"".concat(e.getKey(),",").concat(Object(g["c"])(t))}var A=function(e){function t(t,r){var n=e.call(this,t,{uniforms:r.uniforms})||this;n.renderComplete=!1,n.tileTransform_=Object(f["c"])(),n.tempMat4_=Object(d["a"])(),n.tempTileRange_=new a["b"](0,0,0,0),n.tempTileCoord_=Object(g["a"])(0,0,0),n.tempSize_=[0,0],n.program_,n.vertexShader_=r.vertexShader,n.fragmentShader_=r.fragmentShader,n.indices_=new u["a"](l["c"],l["e"]),n.indices_.fromArray([0,1,3,1,2,3]);var o=void 0!==r.cacheSize?r.cacheSize:512;return n.tileTextureCache_=new i["a"](o),n.paletteTextures_=r.paletteTextures||[],n.frameState_=null,n}return E(t,e),t.prototype.reset=function(t){e.prototype.reset.call(this,{uniforms:t.uniforms}),this.vertexShader_=t.vertexShader,this.fragmentShader_=t.fragmentShader,this.paletteTextures_=t.paletteTextures||[],this.helper&&(this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_))},t.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.helper.flushBufferData(this.indices_)},t.prototype.isDrawableTile_=function(e){var t=this.getLayer(),r=e.getState(),i=t.getUseInterimTilesOnError();return r==o["a"].LOADED||r==o["a"].EMPTY||r==o["a"].ERROR&&!i},t.prototype.prepareFrameInternal=function(e){var t=this.getLayer(),r=t.getRenderSource();return!!r&&(!Object(p["G"])(I(e,e.extent))&&r.getState()===n["a"].READY)},t.prototype.enqueueTiles=function(e,t,r,i){var n=e.viewState,a=this.getLayer(),u=a.getRenderSource(),h=u.getTileGridForProjection(n.projection),c=u.getTilePixelRatio(e.pixelRatio),l=u.getGutterForProjection(n.projection),f=Object(T["c"])(u);f in e.wantedTiles||(e.wantedTiles[f]={});for(var p=e.wantedTiles[f],d=this.tileTextureCache_,_=Math.max(r-a.getPreload(),h.getMinZoom(),a.getMinZoom()),v=r;v>=_;--v)for(var m=h.getTileRangeForExtentAndZ(t,v,this.tempTileRange_),E=h.getResolution(v),y=m.minX;y<=m.maxX;++y)for(var R=m.minY;R<=m.maxY;++R){var x=Object(g["a"])(v,y,R,this.tempTileCoord_),b=C(u,x),O=void 0,I=void 0;if(d.containsKey(b)&&(O=d.get(b),I=O.tile),!O||O.tile.key!==u.getKey())if(I=u.getTile(v,y,R,e.pixelRatio,n.projection),O)if(this.isDrawableTile_(I))O.setTile(I);else{var A=I.getInterimTile();O.setTile(A)}else O=new s["a"]({tile:I,grid:h,helper:this.helper,tilePixelRatio:c,gutter:l}),d.set(b,O);S(i,O,v);var P=I.getKey();p[P]=!0,I.getState()===o["a"].IDLE&&(e.tileQueue.isKeyQueued(P)||e.tileQueue.enqueue([I,f,h.getTileCoordCenter(x),E]))}},t.prototype.renderFrame=function(e){this.frameState_=e,this.renderComplete=!0;var t=this.helper.getGL();this.preRender(t,e);var r=e.viewState,i=this.getLayer(),n=i.getRenderSource(),a=n.getTileGridForProjection(r.projection),o=I(e,e.extent),s=a.getZForResolution(r.resolution,n.zDirection),u={};if(e.nextExtent){var h=a.getZForResolution(r.nextResolution,n.zDirection),c=I(e,e.nextExtent);this.enqueueTiles(e,c,h,u)}this.enqueueTiles(e,o,s,u);for(var l={},p=Object(T["c"])(this),_=e.time,E=!1,R=u[s],S=0,C=R.length;S<C;++S){var A=R[S],P=A.tile,F=P.tileCoord;if(A.loaded){var w=P.getAlpha(p,_);if(1===w){P.endTransition(p);continue}E=!0;var j=Object(g["c"])(F);l[j]=w}this.renderComplete=!1;var L=this.findAltTiles_(a,F,s+1,u);if(!L)for(var B=a.getMinZoom(),D=s-1;D>=B;--D){var U=this.findAltTiles_(a,F,D,u);if(U)break}}this.helper.useProgram(this.program_),this.helper.prepareDraw(e,!E);for(var M=Object.keys(u).map(Number).sort(v["i"]),N=r.center[0],X=r.center[1],G=0,z=M.length;G<z;++G){var k=M[G],H=a.getResolution(k),Z=Object(m["c"])(a.getTileSize(k),this.tempSize_),V=a.getOrigin(k),Y=(N-V[0])/(Z[0]*H),K=(V[1]-X)/(Z[1]*H),W=r.resolution/H,q=O(k),J=u[k];for(S=0,C=J.length;S<C;++S){A=J[S];if(A.loaded){P=A.tile,F=P.tileCoord,j=Object(g["c"])(F);var Q=F[1],$=F[2];Object(f["b"])(this.tileTransform_,0,0,2/(e.size[0]*W/Z[0]),-2/(e.size[1]*W/Z[1]),r.rotation,-(Y-Q),-(K-$)),this.helper.setUniformMatrixValue(y.TILE_TRANSFORM,Object(d["b"])(this.tempMat4_,this.tileTransform_)),this.helper.bindBuffer(A.coords),this.helper.bindBuffer(this.indices_),this.helper.enableAttributes(x);var ee=0;while(ee<A.textures.length){var te="TEXTURE"+ee,re="".concat(y.TILE_TEXTURE_ARRAY,"[").concat(ee,"]");t.activeTexture(t[te]),t.bindTexture(t.TEXTURE_2D,A.textures[ee]),t.uniform1i(this.helper.getUniformLocation(re),ee),++ee}for(var ie=0;ie<this.paletteTextures_.length;++ie){var ne=this.paletteTextures_[ie];t.activeTexture(t["TEXTURE"+ee]);var ae=ne.getTexture(t);t.bindTexture(t.TEXTURE_2D,ae),t.uniform1i(this.helper.getUniformLocation(ne.name),ee),++ee}w=j in l?l[j]:1;w<1&&(e.animate=!0),this.helper.setUniformFloatValue(y.TRANSITION_ALPHA,w),this.helper.setUniformFloatValue(y.DEPTH,q),this.helper.setUniformFloatValue(y.TEXTURE_PIXEL_WIDTH,Z[0]),this.helper.setUniformFloatValue(y.TEXTURE_PIXEL_HEIGHT,Z[1]),this.helper.setUniformFloatValue(y.TEXTURE_RESOLUTION,H),this.helper.setUniformFloatValue(y.TEXTURE_ORIGIN_X,V[0]+Q*Z[0]*H),this.helper.setUniformFloatValue(y.TEXTURE_ORIGIN_Y,V[1]-$*Z[1]*H),this.helper.setUniformFloatVec4(y.RENDER_EXTENT,o),this.helper.setUniformFloatValue(y.RESOLUTION,r.resolution),this.helper.setUniformFloatValue(y.ZOOM,r.zoom),this.helper.drawElements(0,this.indices_.getSize())}}}this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);var oe=this.helper.getCanvas(),se=this.tileTextureCache_;while(se.canExpireCache()){A=se.pop();A.dispose()}var ue=function(e,t){n.expireCache(t.viewState.projection,b)};return e.postRenderFunctions.push(ue),this.postRender(t,e),oe},t.prototype.getData=function(e){var t=this.helper.getGL();if(!t)return null;var r=this.frameState_;if(!r)return null;var i=this.getLayer(),n=Object(f["a"])(r.pixelToCoordinateTransform,e.slice()),a=r.viewState,o=i.getExtent();if(o&&!Object(p["f"])(Object(_["l"])(o,a.projection),n))return null;var s=i.getRenderSource(),u=s.getTileGridForProjection(a.projection);if(!s.getWrapX()){var h=u.getExtent();if(h&&!Object(p["f"])(h,n))return null}for(var c=this.tileTextureCache_,l=u.getZForResolution(a.resolution);l>=u.getMinZoom();--l){var d=u.getTileCoordForCoordAndZ(n,l),g=C(s,d);if(c.containsKey(g)){var T=c.get(g);if(T.loaded){var v=u.getOrigin(l),E=Object(m["c"])(u.getTileSize(l)),y=u.getResolution(l),R=(n[0]-v[0])/y-d[1]*E[0],x=(v[1]-n[1])/y-d[2]*E[1];return T.getPixelData(R,x)}}}return null},t.prototype.findAltTiles_=function(e,t,r,i){var n=e.getTileRangeForTileCoordAndZ(t,r,this.tempTileRange_);if(!n)return!1;for(var a=!0,o=this.tileTextureCache_,s=this.getLayer().getRenderSource(),u=n.minX;u<=n.maxX;++u)for(var h=n.minY;h<=n.maxY;++h){var c=C(s,[r,u,h]),l=!1;if(o.containsKey(c)){var f=o.get(c);f.loaded&&(S(i,f,r),l=!0)}l||(a=!1)}return a},t.prototype.removeHelper=function(){if(this.helper){var t=this.tileTextureCache_;t.forEach((function(e){return e.dispose()})),t.clear()}e.prototype.removeHelper.call(this)},t.prototype.disposeInternal=function(){var t=this.helper;if(t){var r=t.getGL();r.deleteProgram(this.program_),delete this.program_,t.deleteBuffer(this.indices_)}e.prototype.disposeInternal.call(this),delete this.indices_,delete this.tileTextureCache_,delete this.frameState_},t}(h["d"]);t["c"]=A},"30d1":function(e,t,r){"use strict";r.d(t,"a",(function(){return h})),r.d(t,"b",(function(){return c})),r.d(t,"c",(function(){return l})),r.d(t,"d",(function(){return p}));var i=r("3749"),n=r("f623"),a=r("869f"),o=r("1300"),s=.5,u={Point:E,LineString:T,Polygon:R,MultiPoint:y,MultiLineString:v,MultiPolygon:m,GeometryCollection:_,Circle:f};function h(e,t){return parseInt(Object(o["c"])(e),10)-parseInt(Object(o["c"])(t),10)}function c(e,t){var r=l(e,t);return r*r}function l(e,t){return s*e/t}function f(e,t,r,n,a){var o=r.getFill(),s=r.getStroke();if(o||s){var u=e.getBuilder(r.getZIndex(),i["a"].CIRCLE);u.setFillStrokeStyle(o,s),u.drawCircle(t,n)}var h=r.getText();if(h&&h.getText()){var c=(a||e).getBuilder(r.getZIndex(),i["a"].TEXT);c.setTextStyle(h),c.drawText(t,n)}}function p(e,t,r,i,n,o,s){var u=!1,h=r.getImage();if(h){var c=h.getImageState();c==a["a"].LOADED||c==a["a"].ERROR?h.unlistenImageChange(n):(c==a["a"].IDLE&&h.load(),c=h.getImageState(),h.listenImageChange(n),u=!0)}return d(e,t,r,i,o,s),u}function d(e,t,r,i,n,a){var o=r.getGeometryFunction()(t);if(o){var s=o.simplifyTransformed(i,n),h=r.getRenderer();if(h)g(e,s,r,t);else{var c=u[s.getType()];c(e,s,r,t,a)}}}function g(e,t,r,a){if(t.getType()!=n["a"].GEOMETRY_COLLECTION){var o=e.getBuilder(r.getZIndex(),i["a"].DEFAULT);o.drawCustom(t,a,r.getRenderer(),r.getHitDetectionRenderer())}else for(var s=t.getGeometries(),u=0,h=s.length;u<h;++u)g(e,s[u],r,a)}function _(e,t,r,i,n){var a,o,s=t.getGeometriesArray();for(a=0,o=s.length;a<o;++a){var h=u[s[a].getType()];h(e,s[a],r,i,n)}}function T(e,t,r,n,a){var o=r.getStroke();if(o){var s=e.getBuilder(r.getZIndex(),i["a"].LINE_STRING);s.setFillStrokeStyle(null,o),s.drawLineString(t,n)}var u=r.getText();if(u&&u.getText()){var h=(a||e).getBuilder(r.getZIndex(),i["a"].TEXT);h.setTextStyle(u),h.drawText(t,n)}}function v(e,t,r,n,a){var o=r.getStroke();if(o){var s=e.getBuilder(r.getZIndex(),i["a"].LINE_STRING);s.setFillStrokeStyle(null,o),s.drawMultiLineString(t,n)}var u=r.getText();if(u&&u.getText()){var h=(a||e).getBuilder(r.getZIndex(),i["a"].TEXT);h.setTextStyle(u),h.drawText(t,n)}}function m(e,t,r,n,a){var o=r.getFill(),s=r.getStroke();if(s||o){var u=e.getBuilder(r.getZIndex(),i["a"].POLYGON);u.setFillStrokeStyle(o,s),u.drawMultiPolygon(t,n)}var h=r.getText();if(h&&h.getText()){var c=(a||e).getBuilder(r.getZIndex(),i["a"].TEXT);c.setTextStyle(h),c.drawText(t,n)}}function E(e,t,r,n,o){var s,u=r.getImage(),h=r.getText();if(o&&(e=o,s=u&&h&&h.getText()?{}:void 0),u){if(u.getImageState()!=a["a"].LOADED)return;var c=e.getBuilder(r.getZIndex(),i["a"].IMAGE);c.setImageStyle(u,s),c.drawPoint(t,n)}if(h&&h.getText()){var l=e.getBuilder(r.getZIndex(),i["a"].TEXT);l.setTextStyle(h,s),l.drawText(t,n)}}function y(e,t,r,n,o){var s,u=r.getImage(),h=r.getText();if(o&&(e=o,s=u&&h&&h.getText()?{}:void 0),u){if(u.getImageState()!=a["a"].LOADED)return;var c=e.getBuilder(r.getZIndex(),i["a"].IMAGE);c.setImageStyle(u,s),c.drawMultiPoint(t,n)}if(h&&h.getText()){var l=(o||e).getBuilder(r.getZIndex(),i["a"].TEXT);l.setTextStyle(h,s),l.drawText(t,n)}}function R(e,t,r,n,a){var o=r.getFill(),s=r.getStroke();if(o||s){var u=e.getBuilder(r.getZIndex(),i["a"].POLYGON);u.setFillStrokeStyle(o,s),u.drawPolygon(t,n)}var h=r.getText();if(h&&h.getText()){var c=(a||e).getBuilder(r.getZIndex(),i["a"].TEXT);c.setTextStyle(h),c.drawText(t,n)}}},ac3a:function(e,t,r){"use strict";var i=r("ae50"),n=r("f623"),a=r("a43f"),o=r("496f"),s=r("aab2"),u=r("cae5"),h=r("d706"),c=r("86e0"),l=r("5e7e"),f=r("a896"),p=r("92fa"),d=r("0af5"),g=r("7fd1"),_=r("1300"),T=r("1e8d"),v=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),m=function(e){function t(t,r){var i=this,n=r.uniforms||{},o=Object(f["c"])();n[l["b"].PROJECTION_MATRIX]=o,i=e.call(this,t,{uniforms:n,postProcesses:r.postProcesses})||this,i.ready=!1,i.sourceRevision_=-1,i.verticesBuffer_=new s["a"](c["a"],c["b"]),i.hitVerticesBuffer_=new s["a"](c["a"],c["b"]),i.indicesBuffer_=new s["a"](c["c"],c["b"]),i.vertexShader_=r.vertexShader,i.fragmentShader_=r.fragmentShader,i.program_,i.hitDetectionEnabled_=!(!r.hitFragmentShader||!r.hitVertexShader),i.hitVertexShader_=r.hitVertexShader,i.hitFragmentShader_=r.hitFragmentShader,i.hitProgram_;var h=r.attributes?r.attributes.map((function(e){return{name:"a_"+e.name,size:1,type:l["a"].FLOAT}})):[];i.attributes=[{name:"a_position",size:2,type:l["a"].FLOAT},{name:"a_index",size:1,type:l["a"].FLOAT}].concat(h),i.hitDetectionAttributes=[{name:"a_position",size:2,type:l["a"].FLOAT},{name:"a_index",size:1,type:l["a"].FLOAT},{name:"a_hitColor",size:4,type:l["a"].FLOAT},{name:"a_featureUid",size:1,type:l["a"].FLOAT}].concat(h),i.customAttributes=r.attributes?r.attributes:[],i.previousExtent_=Object(d["j"])(),i.currentTransform_=o,i.renderTransform_=Object(f["c"])(),i.invertRenderTransform_=Object(f["c"])(),i.renderInstructions_=new Float32Array(0),i.hitRenderInstructions_=new Float32Array(0),i.hitRenderTarget_,i.generateBuffersRun_=0,i.worker_=Object(g["a"])(),i.worker_.addEventListener("message",function(e){var t=e.data;if(t.type===u["a"].GENERATE_BUFFERS){var r=t.projectionTransform;t.hitDetection?(this.hitVerticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.hitVerticesBuffer_)):(this.verticesBuffer_.fromArrayBuffer(t.vertexBuffer),this.helper.flushBufferData(this.verticesBuffer_)),this.indicesBuffer_.fromArrayBuffer(t.indexBuffer),this.helper.flushBufferData(this.indicesBuffer_),this.renderTransform_=r,Object(f["d"])(this.invertRenderTransform_,this.renderTransform_),t.hitDetection?this.hitRenderInstructions_=new Float32Array(e.data.renderInstructions):(this.renderInstructions_=new Float32Array(e.data.renderInstructions),t.generateBuffersRun===this.generateBuffersRun_&&(this.ready=!0)),this.getLayer().changed()}}.bind(i)),i.featureCache_={},i.featureCount_=0;var p=i.getLayer().getSource();return i.sourceListenKeys_=[Object(T["a"])(p,a["a"].ADDFEATURE,i.handleSourceFeatureAdded_,i),Object(T["a"])(p,a["a"].CHANGEFEATURE,i.handleSourceFeatureChanged_,i),Object(T["a"])(p,a["a"].REMOVEFEATURE,i.handleSourceFeatureDelete_,i),Object(T["a"])(p,a["a"].CLEAR,i.handleSourceFeatureClear_,i)],p.forEachFeature(function(e){this.featureCache_[Object(_["c"])(e)]={feature:e,properties:e.getProperties(),geometry:e.getGeometry()},this.featureCount_++}.bind(i)),i}return v(t,e),t.prototype.afterHelperCreated=function(){this.program_=this.helper.getProgram(this.fragmentShader_,this.vertexShader_),this.hitDetectionEnabled_&&(this.hitProgram_=this.helper.getProgram(this.hitFragmentShader_,this.hitVertexShader_),this.hitRenderTarget_=new h["a"](this.helper))},t.prototype.handleSourceFeatureAdded_=function(e){var t=e.feature;this.featureCache_[Object(_["c"])(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()},this.featureCount_++},t.prototype.handleSourceFeatureChanged_=function(e){var t=e.feature;this.featureCache_[Object(_["c"])(t)]={feature:t,properties:t.getProperties(),geometry:t.getGeometry()}},t.prototype.handleSourceFeatureDelete_=function(e){var t=e.feature;delete this.featureCache_[Object(_["c"])(t)],this.featureCount_--},t.prototype.handleSourceFeatureClear_=function(){this.featureCache_={},this.featureCount_=0},t.prototype.renderFrame=function(e){var t=this.helper.getGL();this.preRender(t,e);var r=this.indicesBuffer_.getSize();this.helper.drawElements(0,r),this.helper.finalizeDraw(e,this.dispatchPreComposeEvent,this.dispatchPostComposeEvent);var i=this.helper.getCanvas();return this.hitDetectionEnabled_&&(this.renderHitDetection(e),this.hitRenderTarget_.clearCachedData()),this.postRender(t,e),i},t.prototype.prepareFrameInternal=function(e){var t=this.getLayer(),r=t.getSource(),n=e.viewState,a=!e.viewHints[o["a"].ANIMATING]&&!e.viewHints[o["a"].INTERACTING],s=!Object(d["o"])(this.previousExtent_,e.extent),u=this.sourceRevision_<r.getRevision();if(u&&(this.sourceRevision_=r.getRevision()),a&&(s||u)){var h=n.projection,c=n.resolution,l=t instanceof i["a"]?t.getRenderBuffer():0,p=Object(d["c"])(e.extent,l*c);r.loadFeatures(p,c,h),this.rebuildBuffers_(e),this.previousExtent_=e.extent.slice()}return this.helper.makeProjectionTransform(e,this.currentTransform_),Object(f["f"])(this.currentTransform_,this.invertRenderTransform_),this.helper.useProgram(this.program_),this.helper.prepareDraw(e),this.helper.bindBuffer(this.verticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.attributes),!0},t.prototype.rebuildBuffers_=function(e){var t=Object(f["c"])();this.helper.makeProjectionTransform(e,t);var r,i,a=(2+this.customAttributes.length)*this.featureCount_;if(this.renderInstructions_&&this.renderInstructions_.length===a||(this.renderInstructions_=new Float32Array(a)),this.hitDetectionEnabled_){var o=(7+this.customAttributes.length)*this.featureCount_;this.hitRenderInstructions_&&this.hitRenderInstructions_.length===o||(this.hitRenderInstructions_=new Float32Array(o))}var s,h=[],c=[],l=0,p=0;for(var d in this.featureCache_)if(r=this.featureCache_[d],i=r.geometry,i&&i.getType()===n["a"].POINT){h[0]=i.getFlatCoordinates()[0],h[1]=i.getFlatCoordinates()[1],Object(f["a"])(t,h),s=Object(u["c"])(p+6,c),this.renderInstructions_[l++]=h[0],this.renderInstructions_[l++]=h[1],this.hitDetectionEnabled_&&(this.hitRenderInstructions_[p++]=h[0],this.hitRenderInstructions_[p++]=h[1],this.hitRenderInstructions_[p++]=s[0],this.hitRenderInstructions_[p++]=s[1],this.hitRenderInstructions_[p++]=s[2],this.hitRenderInstructions_[p++]=s[3],this.hitRenderInstructions_[p++]=Number(d));for(var g=void 0,_=0;_<this.customAttributes.length;_++)g=this.customAttributes[_].callback(r.feature,r.properties),this.renderInstructions_[l++]=g,this.hitDetectionEnabled_&&(this.hitRenderInstructions_[p++]=g)}var T={type:u["a"].GENERATE_BUFFERS,renderInstructions:this.renderInstructions_.buffer,customAttributesCount:this.customAttributes.length};if(T["projectionTransform"]=t,T["generateBuffersRun"]=++this.generateBuffersRun_,this.ready=!1,this.worker_.postMessage(T,[this.renderInstructions_.buffer]),this.renderInstructions_=null,this.hitDetectionEnabled_){var v={type:u["a"].GENERATE_BUFFERS,renderInstructions:this.hitRenderInstructions_.buffer,customAttributesCount:5+this.customAttributes.length};v["projectionTransform"]=t,v["hitDetection"]=!0,this.worker_.postMessage(v,[this.hitRenderInstructions_.buffer]),this.hitRenderInstructions_=null}},t.prototype.forEachFeatureAtCoordinate=function(e,t,r,i,n){if(Object(p["a"])(this.hitDetectionEnabled_,66),this.hitRenderInstructions_){var a=Object(f["a"])(t.coordinateToPixelTransform,e.slice()),o=this.hitRenderTarget_.readPixel(a[0]/2,a[1]/2),s=[o[0]/255,o[1]/255,o[2]/255,o[3]/255],h=Object(u["b"])(s),c=this.hitRenderInstructions_[h],l=Math.floor(c).toString(),d=this.getLayer().getSource(),g=d.getFeatureByUid(l);return g?i(g,this.getLayer(),null):void 0}},t.prototype.renderHitDetection=function(e){if(this.hitVerticesBuffer_.getSize()){this.hitRenderTarget_.setSize([Math.floor(e.size[0]/2),Math.floor(e.size[1]/2)]),this.helper.useProgram(this.hitProgram_),this.helper.prepareDrawToRenderTarget(e,this.hitRenderTarget_,!0),this.helper.bindBuffer(this.hitVerticesBuffer_),this.helper.bindBuffer(this.indicesBuffer_),this.helper.enableAttributes(this.hitDetectionAttributes);var t=this.indicesBuffer_.getSize();this.helper.drawElements(0,t)}},t.prototype.disposeInternal=function(){this.worker_.terminate(),this.layer_=null,this.sourceListenKeys_.forEach((function(e){Object(T["c"])(e)})),this.sourceListenKeys_=null,e.prototype.disposeInternal.call(this)},t}(u["d"]);t["a"]=m},cae5:function(e,t,r){"use strict";r.d(t,"a",(function(){return l})),r.d(t,"c",(function(){return p})),r.d(t,"b",(function(){return d}));var i=r("df4c"),n=r("faf4"),a=r("3333"),o=r("070d"),s=r("5e7e"),u=r("a896"),h=r("0af5"),c=function(){var e=function(t,r){return e=Object.setPrototypeOf||{__proto__:[]}instanceof Array&&function(e,t){e.__proto__=t}||function(e,t){for(var r in t)Object.prototype.hasOwnProperty.call(t,r)&&(e[r]=t[r])},e(t,r)};return function(t,r){if("function"!==typeof r&&null!==r)throw new TypeError("Class extends value "+String(r)+" is not a constructor or null");function i(){this.constructor=t}e(t,r),t.prototype=null===r?Object.create(r):(i.prototype=r.prototype,new i)}}(),l={GENERATE_BUFFERS:"GENERATE_BUFFERS"},f=function(e){function t(t,r){var n=e.call(this,t)||this,a=r||{};return n.inversePixelTransform_=Object(u["c"])(),n.pixelContext_=null,n.postProcesses_=a.postProcesses,n.uniforms_=a.uniforms,n.helper,t.addChangeListener(i["a"].MAP,n.removeHelper.bind(n)),n.dispatchPreComposeEvent=n.dispatchPreComposeEvent.bind(n),n.dispatchPostComposeEvent=n.dispatchPostComposeEvent.bind(n),n}return c(t,e),t.prototype.dispatchPreComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(o["a"].PRECOMPOSE)){var i=new a["a"](o["a"].PRECOMPOSE,void 0,t,e);r.dispatchEvent(i)}},t.prototype.dispatchPostComposeEvent=function(e,t){var r=this.getLayer();if(r.hasListener(o["a"].POSTCOMPOSE)){var i=new a["a"](o["a"].POSTCOMPOSE,void 0,t,e);r.dispatchEvent(i)}},t.prototype.reset=function(e){this.uniforms_=e.uniforms,this.helper&&this.helper.setUniforms(this.uniforms_)},t.prototype.removeHelper=function(){this.helper&&(this.helper.dispose(),delete this.helper)},t.prototype.prepareFrame=function(e){if(this.getLayer().getRenderSource()){for(var r=!0,i=-1,n=void 0,a=0,o=e.layerStatesArray.length;a<o;a++){var u=e.layerStatesArray[a].layer,h=u.getRenderer();if(h instanceof t){var c=u.getClassName();if((r||c!==n)&&(i+=1,r=!1),n=c,h===this)break}else r=!0}var l="map/"+e.mapId+"/group/"+i;this.helper&&this.helper.canvasCacheKeyMatches(l)||(this.removeHelper(),this.helper=new s["c"]({postProcesses:this.postProcesses_,uniforms:this.uniforms_,canvasCacheKey:l}),n&&(this.helper.getCanvas().className=n),this.afterHelperCreated())}return this.prepareFrameInternal(e)},t.prototype.afterHelperCreated=function(){},t.prototype.prepareFrameInternal=function(e){return!0},t.prototype.disposeInternal=function(){this.removeHelper(),e.prototype.disposeInternal.call(this)},t.prototype.dispatchRenderEvent_=function(e,t,r){var i=this.getLayer();if(i.hasListener(e)){Object(u["b"])(this.inversePixelTransform_,0,0,r.pixelRatio,-r.pixelRatio,0,0,-r.size[1]);var n=new a["a"](e,this.inversePixelTransform_,r,t);i.dispatchEvent(n)}},t.prototype.preRender=function(e,t){this.dispatchRenderEvent_(o["a"].PRERENDER,e,t)},t.prototype.postRender=function(e,t){this.dispatchRenderEvent_(o["a"].POSTRENDER,e,t)},t.prototype.getDataAtPixel=function(e,t,r){var i=Object(u["a"])([t.pixelRatio,0,0,t.pixelRatio,0,0],e.slice()),n=this.helper.getGL();if(!n)return null;var a=this.getLayer(),o=a.getExtent();if(o){var s=Object(u["a"])(t.pixelToCoordinateTransform,e.slice());if(!Object(h["f"])(o,s))return null}var c=n.getContextAttributes();if(!c||!c.preserveDrawingBuffer)return new Uint8Array;var l,f=Math.round(i[0]),p=Math.round(i[1]),d=this.pixelContext_;if(!d){var g=document.createElement("canvas");g.width=1,g.height=1,d=g.getContext("2d"),this.pixelContext_=d}d.clearRect(0,0,1,1);try{d.drawImage(n.canvas,f,p,1,1,0,0,1,1),l=d.getImageData(0,0,1,1).data}catch(_){return l}return 0===l[3]?null:l},t}(n["a"]);function p(e,t){var r=t||[],i=256,n=i-1;return r[0]=Math.floor(e/i/i/i)/n,r[1]=Math.floor(e/i/i)%i/n,r[2]=Math.floor(e/i)%i/n,r[3]=e%i/n,r}function d(e){var t=0,r=256,i=r-1;return t+=Math.round(e[0]*r*r*r*i),t+=Math.round(e[1]*r*r*i),t+=Math.round(e[2]*r*i),t+=Math.round(e[3]*i),t}t["d"]=f}}]);
//# sourceMappingURL=chunk-fb557d00.eeedb9ba.js.map