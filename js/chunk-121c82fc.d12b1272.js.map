{"version":3,"sources":["webpack:///./node_modules/ol/renderer/canvas/Layer.js","webpack:///./node_modules/ol/renderer/Map.js","webpack:///./node_modules/ol/renderer/Composite.js","webpack:///./node_modules/ol/renderer/canvas/ImageLayer.js","webpack:///./node_modules/ol/renderer/canvas/VectorTileLayer.js","webpack:///./node_modules/ol/renderer/canvas/TileLayer.js","webpack:///./node_modules/ol/renderer/canvas/VectorLayer.js","webpack:///./node_modules/ol/renderer/Layer.js"],"names":["__extends","extendStatics","d","b","Object","setPrototypeOf","__proto__","Array","p","prototype","hasOwnProperty","call","TypeError","String","__","this","constructor","create","CanvasLayerRenderer","_super","layer","_this","container","renderedResolution","tempTransform","pixelTransform","inversePixelTransform","context","containerReused","useContainer","target","transform","opacity","layerClassName","getLayer","getClassName","style","className","canvas","firstElementChild","HTMLCanvasElement","getContext","document","createElement","position","width","height","appendChild","left","transformOrigin","clipUnrotated","frameState","extent","topLeft","topRight","bottomRight","bottomLeft","coordinateToPixelTransform","inverted","save","beginPath","moveTo","Math","round","lineTo","clip","dispatchRenderEvent_","type","hasListener","event_1","dispatchEvent","preRender","PRERENDER","postRender","POSTRENDER","getRenderTransform","center","resolution","rotation","pixelRatio","offsetX","dx1","dy1","sx","sy","dx2","dy2","getDataAtPixel","pixel","hitTolerance","data","renderPixel","slice","layerExtent","getExtent","renderCoordinate","pixelToCoordinateTransform","x","y","newCanvas","newContext","clearRect","drawImage","getImageData","err","name","Uint8Array","MapRenderer","map","map_","dispatchRenderEvent","calculateMatrices2D","viewState","size","forEachFeatureAtCoordinate","coordinate","checkWrapped","callback","thisArg","layerFilter","thisArg2","result","managed","feature","geometry","projection","translatedCoordinate","offsets","canWrapX","projectionExtent","worldWidth","push","layerStates","layerStatesArray","numLayers","length","matches","tmpCoord","i","j","layerState","hasRenderer","layerRenderer","getRenderer","source","getSource","coordinates","getWrapX","callback_1","bind","order","forEach","m","distanceSq","sort","a","some","forEachLayerAtPixel","hasFeatureAtCoordinate","hasFeature","undefined","getMap","renderFrame","scheduleExpireIconCache","canExpireCache","postRenderFunctions","expireIconCache","Disposable","expire","Map","CompositeMapRenderer","fontChangeListenerKey_","ObjectEventType","PROPERTYCHANGE","redrawText","element_","zIndex","getViewport","insertBefore","firstChild","children_","renderedVisible_","disposeInternal","parentNode","removeChild","PRECOMPOSE","declutterLayers","previousElement","ii","layerIndex","sourceState","READY","UNDEFINED","element","render","renderDeclutter","POSTCOMPOSE","display","CanvasImageLayerRenderer","imageLayer","image_","getImage","prepareFrame","viewResolution","imageSource","hints","viewHints","renderedExtent","ANIMATING","INTERACTING","sourceProjection","getProjection","image","loadImage","imageExtent","imageResolution","getResolution","imagePixelRatio","getPixelRatio","viewCenter","scale","size_1","sqrt","canvasTransform","clipped","img","dw","dh","getContextOptions","dx","dy","previousAlpha","globalAlpha","restore","IMAGE_REPLAYS","POLYGON","CIRCLE","LINE_STRING","IMAGE","TEXT","VECTOR_REPLAYS","DEFAULT","CanvasVectorTileLayerRenderer","boundHandleStyleImageChange_","handleStyleImageChange_","dirty_","renderedLayerRevision_","renderedPixelToCoordinateTransform_","renderedRotation_","tmpTransform_","prepareTile","tile","state","getState","LOADED","ERROR","updateExecutorGroup_","tileImageNeedsRender_","getTile","z","hifi","wantedResolution","Date","now","time","getRenderMode","VECTOR","renderTileImage_","isDrawableTile","executorGroups","hasContext","getTileImage","layerRevision","getRevision","renderedTiles","revision","renderOrder","getRenderOrder","builderState","getReplayState","dirty","renderedRevision","renderedRenderOrder","declutter","getDeclutter","sourceTileGrid","getTileGrid","tileGrid","getTileGridForProjection","tileExtent","getTileCoordExtent","wrappedTileCoord","sourceTiles","getSourceTiles","layerUid","hitDetectionImageData","declutterExecutorGroups","_loop_1","t","tt","sourceTile","sourceTileCoord","tileCoord","sourceTileExtent","sharedExtent","builderExtent","getRenderBuffer","this_1","tmpExtent","bufferedExtent","builderGroup","declutterBuilderGroup","squaredTolerance","styles","styleFunction","getStyleFunction","renderFeature","features","getFeatures","getGeometry","executorGroupInstructions","finish","replayExtent","renderingReplayGroup","getOverlaps","declutterExecutorGroup","hitExtent","found","featureCallback","key","getId","match","splice","lastIndexOf","_loop_2","declutteredFeatures","declutterTree","all","item","value","executorGroup","Promise","resolve","reject","renderedProjection","getTileCoordForCoordAndResolution","toString","extent_1","loadingSourceTiles","corner","tilePixel","reduce","accumulator","concat","animatingOrInteracting_","tileSize","getTileSize","getZForResolution","transforms","getTileCoordCenter","handleFontsChanged","getVisible","changed","event","renderIfReadyAndVisible","alpha","getOpacity","tiles","execute","getTileRenderTransform","worldOffset","renderMode","replayTypes","clips","clipZs","hasExecutors","currentZ","currentClip","getClipCoords","jj","opt_declutterBuilderGroup","loading","isArray","replayState","renderedTileResolution","renderedTileRevision","tileResolution","renderPixelRatio","max","getTilePixelSize","renderScale","setTransform","apply","pixelScale","CanvasTileLayerRenderer","tileLayer","extentChanged","renderedExtent_","renderedPixelRatio","newTiles_","tmpTileRange_","tileState","useInterimTilesOnError","getUseInterimTilesOnError","EMPTY","tileSource","getPreload","setState","getInterimTile","loadedTileCallback","zoom","sourceRevision","zDirection","tilePixelRatio","getTilePixelRatio","canvasExtent","tileRange","getTileRangeForExtentAndZ","tilesToDrawByZ","findLoadedTiles","createLoadedTileFinder","tmpTileRange","minX","maxX","minY","maxY","uid","inTransition","indexOf","getAlpha","childTileRange","getTileCoordChildTileRange","covered","forEachTileCoordParentTileRange","canvasScale","zs","keys","Number","getOpaque","reverse","currentTilePixelSize","currentResolution","currentScale","dx_1","dy_1","originTileCoord","getTileCoordForCoordAndZ","originTileExtent","origin_1","tileGutter","getGutterForProjection","tilesToDraw","tileCoordKey","xIndex","nextX","yIndex","nextY","w","h","transition","i_1","drawTileImage","unshift","updateUsedTiles","usedTiles","manageTilePyramid","scheduleExpireCache","gutter","alphaChanged","animate","endTransition","postRenderFunction","tileSourceKey","expireCache","getKey","preload","opt_tileCallback","wantedTiles","tileQueue","minZoom","getMinZoom","tileCount","IDLE","isKeyQueued","enqueue","useTile","updateCacheSize","CanvasVectorLayerRenderer","vectorLayer","hitDetectionImageData_","renderedFeatures_","renderedRevision_","renderedResolution_","NaN","wrappedRenderedExtent_","renderedCenter_","renderedProjection_","renderedRenderOrder_","replayGroup_","replayGroupChanged","clipping","renderWorlds","opt_declutterTree","vectorSource","snapToPixel","multiWorld","endWorld","ceil","world","floor","replayGroup","isEmpty","startX","animating","interacting","updateWhileAnimating","getUpdateWhileAnimating","updateWhileInteracting","getUpdateWhileInteracting","frameStateExtent","vectorLayerRevision","vectorLayerRenderBuffer","vectorLayerRenderOrder","loadExtents","loadExtent","userTransform","userProjection","userExtent_1","loadFeatures","userExtent","getFeaturesInExtent","replayGroupInstructions","opt_transform","LayerRenderer","boundHandleImageChange_","handleImageChange_","layer_","forEachLoadedTile","imageState","addEventListener","CHANGE","load","getSourceState"],"mappings":"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","file":"js/chunk-121c82fc.d12b1272.js","sourcesContent":["var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/Layer\n */\nimport LayerRenderer from '../Layer.js';\nimport RenderEvent from '../../render/Event.js';\nimport RenderEventType from '../../render/EventType.js';\nimport { apply as applyTransform, compose as composeTransform, create as createTransform, } from '../../transform.js';\nimport { containsCoordinate, getBottomLeft, getBottomRight, getTopLeft, getTopRight, } from '../../extent.js';\nimport { createCanvasContext2D } from '../../dom.js';\nimport { cssOpacity } from '../../css.js';\n/**\n * @abstract\n * @template {import(\"../../layer/Layer.js\").default} LayerType\n * @extends {LayerRenderer<LayerType>}\n */\nvar CanvasLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasLayerRenderer, _super);\n    /**\n     * @param {LayerType} layer Layer.\n     */\n    function CanvasLayerRenderer(layer) {\n        var _this = _super.call(this, layer) || this;\n        /**\n         * @protected\n         * @type {HTMLElement}\n         */\n        _this.container = null;\n        /**\n         * @protected\n         * @type {number}\n         */\n        _this.renderedResolution;\n        /**\n         * A temporary transform.  The values in this transform should only be used in a\n         * function that sets the values.\n         * @protected\n         * @type {import(\"../../transform.js\").Transform}\n         */\n        _this.tempTransform = createTransform();\n        /**\n         * The transform for rendered pixels to viewport CSS pixels.  This transform must\n         * be set when rendering a frame and may be used by other functions after rendering.\n         * @protected\n         * @type {import(\"../../transform.js\").Transform}\n         */\n        _this.pixelTransform = createTransform();\n        /**\n         * The transform for viewport CSS pixels to rendered pixels.  This transform must\n         * be set when rendering a frame and may be used by other functions after rendering.\n         * @protected\n         * @type {import(\"../../transform.js\").Transform}\n         */\n        _this.inversePixelTransform = createTransform();\n        /**\n         * @type {CanvasRenderingContext2D}\n         */\n        _this.context = null;\n        /**\n         * @type {boolean}\n         */\n        _this.containerReused = false;\n        return _this;\n    }\n    /**\n     * Get a rendering container from an existing target, if compatible.\n     * @param {HTMLElement} target Potential render target.\n     * @param {string} transform CSS Transform.\n     * @param {number} opacity Opacity.\n     */\n    CanvasLayerRenderer.prototype.useContainer = function (target, transform, opacity) {\n        var layerClassName = this.getLayer().getClassName();\n        var container, context;\n        if (target &&\n            target.style.opacity === cssOpacity(opacity) &&\n            target.className === layerClassName) {\n            var canvas = target.firstElementChild;\n            if (canvas instanceof HTMLCanvasElement) {\n                context = canvas.getContext('2d');\n            }\n        }\n        if (context && context.canvas.style.transform === transform) {\n            // Container of the previous layer renderer can be used.\n            this.container = target;\n            this.context = context;\n            this.containerReused = true;\n        }\n        else if (this.containerReused) {\n            // Previously reused container cannot be used any more.\n            this.container = null;\n            this.context = null;\n            this.containerReused = false;\n        }\n        if (!this.container) {\n            container = document.createElement('div');\n            container.className = layerClassName;\n            var style = container.style;\n            style.position = 'absolute';\n            style.width = '100%';\n            style.height = '100%';\n            context = createCanvasContext2D();\n            var canvas = context.canvas;\n            container.appendChild(canvas);\n            style = canvas.style;\n            style.position = 'absolute';\n            style.left = '0';\n            style.transformOrigin = 'top left';\n            this.container = container;\n            this.context = context;\n        }\n    };\n    /**\n     * @param {CanvasRenderingContext2D} context Context.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {import(\"../../extent.js\").Extent} extent Clip extent.\n     * @protected\n     */\n    CanvasLayerRenderer.prototype.clipUnrotated = function (context, frameState, extent) {\n        var topLeft = getTopLeft(extent);\n        var topRight = getTopRight(extent);\n        var bottomRight = getBottomRight(extent);\n        var bottomLeft = getBottomLeft(extent);\n        applyTransform(frameState.coordinateToPixelTransform, topLeft);\n        applyTransform(frameState.coordinateToPixelTransform, topRight);\n        applyTransform(frameState.coordinateToPixelTransform, bottomRight);\n        applyTransform(frameState.coordinateToPixelTransform, bottomLeft);\n        var inverted = this.inversePixelTransform;\n        applyTransform(inverted, topLeft);\n        applyTransform(inverted, topRight);\n        applyTransform(inverted, bottomRight);\n        applyTransform(inverted, bottomLeft);\n        context.save();\n        context.beginPath();\n        context.moveTo(Math.round(topLeft[0]), Math.round(topLeft[1]));\n        context.lineTo(Math.round(topRight[0]), Math.round(topRight[1]));\n        context.lineTo(Math.round(bottomRight[0]), Math.round(bottomRight[1]));\n        context.lineTo(Math.round(bottomLeft[0]), Math.round(bottomLeft[1]));\n        context.clip();\n    };\n    /**\n     * @param {import(\"../../render/EventType.js\").default} type Event type.\n     * @param {CanvasRenderingContext2D} context Context.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @private\n     */\n    CanvasLayerRenderer.prototype.dispatchRenderEvent_ = function (type, context, frameState) {\n        var layer = this.getLayer();\n        if (layer.hasListener(type)) {\n            var event_1 = new RenderEvent(type, this.inversePixelTransform, frameState, context);\n            layer.dispatchEvent(event_1);\n        }\n    };\n    /**\n     * @param {CanvasRenderingContext2D} context Context.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @protected\n     */\n    CanvasLayerRenderer.prototype.preRender = function (context, frameState) {\n        this.dispatchRenderEvent_(RenderEventType.PRERENDER, context, frameState);\n    };\n    /**\n     * @param {CanvasRenderingContext2D} context Context.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @protected\n     */\n    CanvasLayerRenderer.prototype.postRender = function (context, frameState) {\n        this.dispatchRenderEvent_(RenderEventType.POSTRENDER, context, frameState);\n    };\n    /**\n     * Creates a transform for rendering to an element that will be rotated after rendering.\n     * @param {import(\"../../coordinate.js\").Coordinate} center Center.\n     * @param {number} resolution Resolution.\n     * @param {number} rotation Rotation.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {number} width Width of the rendered element (in pixels).\n     * @param {number} height Height of the rendered element (in pixels).\n     * @param {number} offsetX Offset on the x-axis in view coordinates.\n     * @protected\n     * @return {!import(\"../../transform.js\").Transform} Transform.\n     */\n    CanvasLayerRenderer.prototype.getRenderTransform = function (center, resolution, rotation, pixelRatio, width, height, offsetX) {\n        var dx1 = width / 2;\n        var dy1 = height / 2;\n        var sx = pixelRatio / resolution;\n        var sy = -sx;\n        var dx2 = -center[0] + offsetX;\n        var dy2 = -center[1];\n        return composeTransform(this.tempTransform, dx1, dy1, sx, sy, -rotation, dx2, dy2);\n    };\n    /**\n     * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @return {Uint8ClampedArray|Uint8Array} The result.  If there is no data at the pixel\n     *    location, null will be returned.  If there is data, but pixel values cannot be\n     *    returned, and empty array will be returned.\n     */\n    CanvasLayerRenderer.prototype.getDataAtPixel = function (pixel, frameState, hitTolerance) {\n        var renderPixel = applyTransform(this.inversePixelTransform, pixel.slice());\n        var context = this.context;\n        var layer = this.getLayer();\n        var layerExtent = layer.getExtent();\n        if (layerExtent) {\n            var renderCoordinate = applyTransform(frameState.pixelToCoordinateTransform, pixel.slice());\n            /** get only data inside of the layer extent */\n            if (!containsCoordinate(layerExtent, renderCoordinate)) {\n                return null;\n            }\n        }\n        var data;\n        try {\n            var x = Math.round(renderPixel[0]);\n            var y = Math.round(renderPixel[1]);\n            var newCanvas = document.createElement('canvas');\n            var newContext = newCanvas.getContext('2d');\n            newCanvas.width = 1;\n            newCanvas.height = 1;\n            newContext.clearRect(0, 0, 1, 1);\n            newContext.drawImage(context.canvas, x, y, 1, 1, 0, 0, 1, 1);\n            data = newContext.getImageData(0, 0, 1, 1).data;\n        }\n        catch (err) {\n            if (err.name === 'SecurityError') {\n                // tainted canvas, we assume there is data at the given pixel (although there might not be)\n                return new Uint8Array();\n            }\n            return data;\n        }\n        if (data[3] === 0) {\n            return null;\n        }\n        return data;\n    };\n    return CanvasLayerRenderer;\n}(LayerRenderer));\nexport default CanvasLayerRenderer;\n//# sourceMappingURL=Layer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/Map\n */\nimport Disposable from '../Disposable.js';\nimport { TRUE } from '../functions.js';\nimport { abstract } from '../util.js';\nimport { compose as composeTransform, makeInverse } from '../transform.js';\nimport { getWidth } from '../extent.js';\nimport { shared as iconImageCache } from '../style/IconImageCache.js';\nimport { inView } from '../layer/Layer.js';\nimport { wrapX } from '../coordinate.js';\n/**\n * @typedef HitMatch\n * @property {import(\"../Feature.js\").FeatureLike} feature Feature.\n * @property {import(\"../layer/Layer.js\").default} layer Layer.\n * @property {import(\"../geom/SimpleGeometry.js\").default} geometry Geometry.\n * @property {number} distanceSq Squared distance.\n * @property {import(\"./vector.js\").FeatureCallback<T>} callback Callback.\n * @template T\n */\n/**\n * @abstract\n */\nvar MapRenderer = /** @class */ (function (_super) {\n    __extends(MapRenderer, _super);\n    /**\n     * @param {import(\"../PluggableMap.js\").default} map Map.\n     */\n    function MapRenderer(map) {\n        var _this = _super.call(this) || this;\n        /**\n         * @private\n         * @type {import(\"../PluggableMap.js\").default}\n         */\n        _this.map_ = map;\n        return _this;\n    }\n    /**\n     * @abstract\n     * @param {import(\"../render/EventType.js\").default} type Event type.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    MapRenderer.prototype.dispatchRenderEvent = function (type, frameState) {\n        abstract();\n    };\n    /**\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @protected\n     */\n    MapRenderer.prototype.calculateMatrices2D = function (frameState) {\n        var viewState = frameState.viewState;\n        var coordinateToPixelTransform = frameState.coordinateToPixelTransform;\n        var pixelToCoordinateTransform = frameState.pixelToCoordinateTransform;\n        composeTransform(coordinateToPixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / viewState.resolution, -1 / viewState.resolution, -viewState.rotation, -viewState.center[0], -viewState.center[1]);\n        makeInverse(pixelToCoordinateTransform, coordinateToPixelTransform);\n    };\n    /**\n     * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {boolean} checkWrapped Check for wrapped geometries.\n     * @param {import(\"./vector.js\").FeatureCallback<T>} callback Feature callback.\n     * @param {S} thisArg Value to use as `this` when executing `callback`.\n     * @param {function(this: U, import(\"../layer/Layer.js\").default): boolean} layerFilter Layer filter\n     *     function, only layers which are visible and for which this function\n     *     returns `true` will be tested for features.  By default, all visible\n     *     layers will be tested.\n     * @param {U} thisArg2 Value to use as `this` when executing `layerFilter`.\n     * @return {T|undefined} Callback result.\n     * @template S,T,U\n     */\n    MapRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, checkWrapped, callback, thisArg, layerFilter, thisArg2) {\n        var result;\n        var viewState = frameState.viewState;\n        /**\n         * @param {boolean} managed Managed layer.\n         * @param {import(\"../Feature.js\").FeatureLike} feature Feature.\n         * @param {import(\"../layer/Layer.js\").default} layer Layer.\n         * @param {import(\"../geom/Geometry.js\").default} geometry Geometry.\n         * @return {T|undefined} Callback result.\n         */\n        function forEachFeatureAtCoordinate(managed, feature, layer, geometry) {\n            return callback.call(thisArg, feature, managed ? layer : null, geometry);\n        }\n        var projection = viewState.projection;\n        var translatedCoordinate = wrapX(coordinate.slice(), projection);\n        var offsets = [[0, 0]];\n        if (projection.canWrapX() && checkWrapped) {\n            var projectionExtent = projection.getExtent();\n            var worldWidth = getWidth(projectionExtent);\n            offsets.push([-worldWidth, 0], [worldWidth, 0]);\n        }\n        var layerStates = frameState.layerStatesArray;\n        var numLayers = layerStates.length;\n        var matches = /** @type {Array<HitMatch<T>>} */ ([]);\n        var tmpCoord = [];\n        for (var i = 0; i < offsets.length; i++) {\n            for (var j = numLayers - 1; j >= 0; --j) {\n                var layerState = layerStates[j];\n                var layer = layerState.layer;\n                if (layer.hasRenderer() &&\n                    inView(layerState, viewState) &&\n                    layerFilter.call(thisArg2, layer)) {\n                    var layerRenderer = layer.getRenderer();\n                    var source = layer.getSource();\n                    if (layerRenderer && source) {\n                        var coordinates = source.getWrapX()\n                            ? translatedCoordinate\n                            : coordinate;\n                        var callback_1 = forEachFeatureAtCoordinate.bind(null, layerState.managed);\n                        tmpCoord[0] = coordinates[0] + offsets[i][0];\n                        tmpCoord[1] = coordinates[1] + offsets[i][1];\n                        result = layerRenderer.forEachFeatureAtCoordinate(tmpCoord, frameState, hitTolerance, callback_1, matches);\n                    }\n                    if (result) {\n                        return result;\n                    }\n                }\n            }\n        }\n        if (matches.length === 0) {\n            return undefined;\n        }\n        var order = 1 / matches.length;\n        matches.forEach(function (m, i) { return (m.distanceSq += i * order); });\n        matches.sort(function (a, b) { return a.distanceSq - b.distanceSq; });\n        matches.some(function (m) {\n            return (result = m.callback(m.feature, m.layer, m.geometry));\n        });\n        return result;\n    };\n    /**\n     * @abstract\n     * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n     *     callback.\n     * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>): boolean} layerFilter Layer filter\n     *     function, only layers which are visible and for which this function\n     *     returns `true` will be tested for features.  By default, all visible\n     *     layers will be tested.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    MapRenderer.prototype.forEachLayerAtPixel = function (pixel, frameState, hitTolerance, callback, layerFilter) {\n        return abstract();\n    };\n    /**\n     * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {boolean} checkWrapped Check for wrapped geometries.\n     * @param {function(this: U, import(\"../layer/Layer.js\").default): boolean} layerFilter Layer filter\n     *     function, only layers which are visible and for which this function\n     *     returns `true` will be tested for features.  By default, all visible\n     *     layers will be tested.\n     * @param {U} thisArg Value to use as `this` when executing `layerFilter`.\n     * @return {boolean} Is there a feature at the given coordinate?\n     * @template U\n     */\n    MapRenderer.prototype.hasFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, checkWrapped, layerFilter, thisArg) {\n        var hasFeature = this.forEachFeatureAtCoordinate(coordinate, frameState, hitTolerance, checkWrapped, TRUE, this, layerFilter, thisArg);\n        return hasFeature !== undefined;\n    };\n    /**\n     * @return {import(\"../PluggableMap.js\").default} Map.\n     */\n    MapRenderer.prototype.getMap = function () {\n        return this.map_;\n    };\n    /**\n     * Render.\n     * @abstract\n     * @param {?import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    MapRenderer.prototype.renderFrame = function (frameState) {\n        abstract();\n    };\n    /**\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     * @protected\n     */\n    MapRenderer.prototype.scheduleExpireIconCache = function (frameState) {\n        if (iconImageCache.canExpireCache()) {\n            frameState.postRenderFunctions.push(expireIconCache);\n        }\n    };\n    return MapRenderer;\n}(Disposable));\n/**\n * @param {import(\"../PluggableMap.js\").default} map Map.\n * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n */\nfunction expireIconCache(map, frameState) {\n    iconImageCache.expire();\n}\nexport default MapRenderer;\n//# sourceMappingURL=Map.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/Composite\n */\nimport MapRenderer from './Map.js';\nimport ObjectEventType from '../ObjectEventType.js';\nimport RenderEvent from '../render/Event.js';\nimport RenderEventType from '../render/EventType.js';\nimport SourceState from '../source/State.js';\nimport { CLASS_UNSELECTABLE } from '../css.js';\nimport { checkedFonts } from '../render/canvas.js';\nimport { inView } from '../layer/Layer.js';\nimport { listen, unlistenByKey } from '../events.js';\nimport { replaceChildren } from '../dom.js';\n/**\n * @classdesc\n * Canvas map renderer.\n * @api\n */\nvar CompositeMapRenderer = /** @class */ (function (_super) {\n    __extends(CompositeMapRenderer, _super);\n    /**\n     * @param {import(\"../PluggableMap.js\").default} map Map.\n     */\n    function CompositeMapRenderer(map) {\n        var _this = _super.call(this, map) || this;\n        /**\n         * @type {import(\"../events.js\").EventsKey}\n         */\n        _this.fontChangeListenerKey_ = listen(checkedFonts, ObjectEventType.PROPERTYCHANGE, map.redrawText.bind(map));\n        /**\n         * @private\n         * @type {HTMLDivElement}\n         */\n        _this.element_ = document.createElement('div');\n        var style = _this.element_.style;\n        style.position = 'absolute';\n        style.width = '100%';\n        style.height = '100%';\n        style.zIndex = '0';\n        _this.element_.className = CLASS_UNSELECTABLE + ' ol-layers';\n        var container = map.getViewport();\n        container.insertBefore(_this.element_, container.firstChild || null);\n        /**\n         * @private\n         * @type {Array<HTMLElement>}\n         */\n        _this.children_ = [];\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.renderedVisible_ = true;\n        return _this;\n    }\n    /**\n     * @param {import(\"../render/EventType.js\").default} type Event type.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    CompositeMapRenderer.prototype.dispatchRenderEvent = function (type, frameState) {\n        var map = this.getMap();\n        if (map.hasListener(type)) {\n            var event_1 = new RenderEvent(type, undefined, frameState);\n            map.dispatchEvent(event_1);\n        }\n    };\n    CompositeMapRenderer.prototype.disposeInternal = function () {\n        unlistenByKey(this.fontChangeListenerKey_);\n        this.element_.parentNode.removeChild(this.element_);\n        _super.prototype.disposeInternal.call(this);\n    };\n    /**\n     * Render.\n     * @param {?import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    CompositeMapRenderer.prototype.renderFrame = function (frameState) {\n        if (!frameState) {\n            if (this.renderedVisible_) {\n                this.element_.style.display = 'none';\n                this.renderedVisible_ = false;\n            }\n            return;\n        }\n        this.calculateMatrices2D(frameState);\n        this.dispatchRenderEvent(RenderEventType.PRECOMPOSE, frameState);\n        var layerStatesArray = frameState.layerStatesArray.sort(function (a, b) {\n            return a.zIndex - b.zIndex;\n        });\n        var viewState = frameState.viewState;\n        this.children_.length = 0;\n        /**\n         * @type {Array<import(\"../layer/BaseVector.js\").default>}\n         */\n        var declutterLayers = [];\n        var previousElement = null;\n        for (var i = 0, ii = layerStatesArray.length; i < ii; ++i) {\n            var layerState = layerStatesArray[i];\n            frameState.layerIndex = i;\n            if (!inView(layerState, viewState) ||\n                (layerState.sourceState != SourceState.READY &&\n                    layerState.sourceState != SourceState.UNDEFINED)) {\n                continue;\n            }\n            var layer = layerState.layer;\n            var element = layer.render(frameState, previousElement);\n            if (!element) {\n                continue;\n            }\n            if (element !== previousElement) {\n                this.children_.push(element);\n                previousElement = element;\n            }\n            if ('getDeclutter' in layer) {\n                declutterLayers.push(\n                /** @type {import(\"../layer/BaseVector.js\").default} */ (layer));\n            }\n        }\n        for (var i = declutterLayers.length - 1; i >= 0; --i) {\n            declutterLayers[i].renderDeclutter(frameState);\n        }\n        replaceChildren(this.element_, this.children_);\n        this.dispatchRenderEvent(RenderEventType.POSTCOMPOSE, frameState);\n        if (!this.renderedVisible_) {\n            this.element_.style.display = '';\n            this.renderedVisible_ = true;\n        }\n        this.scheduleExpireIconCache(frameState);\n    };\n    /**\n     * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>, (Uint8ClampedArray|Uint8Array)): T} callback Layer\n     *     callback.\n     * @param {function(import(\"../layer/Layer.js\").default<import(\"../source/Source\").default>): boolean} layerFilter Layer filter\n     *     function, only layers which are visible and for which this function\n     *     returns `true` will be tested for features.  By default, all visible\n     *     layers will be tested.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    CompositeMapRenderer.prototype.forEachLayerAtPixel = function (pixel, frameState, hitTolerance, callback, layerFilter) {\n        var viewState = frameState.viewState;\n        var layerStates = frameState.layerStatesArray;\n        var numLayers = layerStates.length;\n        for (var i = numLayers - 1; i >= 0; --i) {\n            var layerState = layerStates[i];\n            var layer = layerState.layer;\n            if (layer.hasRenderer() &&\n                inView(layerState, viewState) &&\n                layerFilter(layer)) {\n                var layerRenderer = layer.getRenderer();\n                var data = layerRenderer.getDataAtPixel(pixel, frameState, hitTolerance);\n                if (data) {\n                    var result = callback(layer, data);\n                    if (result) {\n                        return result;\n                    }\n                }\n            }\n        }\n        return undefined;\n    };\n    return CompositeMapRenderer;\n}(MapRenderer));\nexport default CompositeMapRenderer;\n//# sourceMappingURL=Composite.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/ImageLayer\n */\nimport CanvasLayerRenderer from './Layer.js';\nimport ViewHint from '../../ViewHint.js';\nimport { ENABLE_RASTER_REPROJECTION } from '../../reproj/common.js';\nimport { assign } from '../../obj.js';\nimport { compose as composeTransform, makeInverse } from '../../transform.js';\nimport { containsExtent, intersects as intersectsExtent } from '../../extent.js';\nimport { fromUserExtent } from '../../proj.js';\nimport { getIntersection, isEmpty } from '../../extent.js';\nimport { toString as toTransformString } from '../../transform.js';\n/**\n * @classdesc\n * Canvas renderer for image layers.\n * @api\n */\nvar CanvasImageLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasImageLayerRenderer, _super);\n    /**\n     * @param {import(\"../../layer/Image.js\").default} imageLayer Image layer.\n     */\n    function CanvasImageLayerRenderer(imageLayer) {\n        var _this = _super.call(this, imageLayer) || this;\n        /**\n         * @protected\n         * @type {?import(\"../../ImageBase.js\").default}\n         */\n        _this.image_ = null;\n        return _this;\n    }\n    /**\n     * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n     */\n    CanvasImageLayerRenderer.prototype.getImage = function () {\n        return !this.image_ ? null : this.image_.getImage();\n    };\n    /**\n     * Determine whether render should be called.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    CanvasImageLayerRenderer.prototype.prepareFrame = function (frameState) {\n        var layerState = frameState.layerStatesArray[frameState.layerIndex];\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var viewResolution = viewState.resolution;\n        var imageSource = this.getLayer().getSource();\n        var hints = frameState.viewHints;\n        var renderedExtent = frameState.extent;\n        if (layerState.extent !== undefined) {\n            renderedExtent = getIntersection(renderedExtent, fromUserExtent(layerState.extent, viewState.projection));\n        }\n        if (!hints[ViewHint.ANIMATING] &&\n            !hints[ViewHint.INTERACTING] &&\n            !isEmpty(renderedExtent)) {\n            if (imageSource) {\n                var projection = viewState.projection;\n                if (!ENABLE_RASTER_REPROJECTION) {\n                    var sourceProjection = imageSource.getProjection();\n                    if (sourceProjection) {\n                        projection = sourceProjection;\n                    }\n                }\n                var image = imageSource.getImage(renderedExtent, viewResolution, pixelRatio, projection);\n                if (image && this.loadImage(image)) {\n                    this.image_ = image;\n                }\n            }\n            else {\n                this.image_ = null;\n            }\n        }\n        return !!this.image_;\n    };\n    /**\n     * Render the layer.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    CanvasImageLayerRenderer.prototype.renderFrame = function (frameState, target) {\n        var image = this.image_;\n        var imageExtent = image.getExtent();\n        var imageResolution = image.getResolution();\n        var imagePixelRatio = image.getPixelRatio();\n        var layerState = frameState.layerStatesArray[frameState.layerIndex];\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var viewCenter = viewState.center;\n        var viewResolution = viewState.resolution;\n        var size = frameState.size;\n        var scale = (pixelRatio * imageResolution) / (viewResolution * imagePixelRatio);\n        var width = Math.round(size[0] * pixelRatio);\n        var height = Math.round(size[1] * pixelRatio);\n        var rotation = viewState.rotation;\n        if (rotation) {\n            var size_1 = Math.round(Math.sqrt(width * width + height * height));\n            width = size_1;\n            height = size_1;\n        }\n        // set forward and inverse pixel transforms\n        composeTransform(this.pixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / pixelRatio, 1 / pixelRatio, rotation, -width / 2, -height / 2);\n        makeInverse(this.inversePixelTransform, this.pixelTransform);\n        var canvasTransform = toTransformString(this.pixelTransform);\n        this.useContainer(target, canvasTransform, layerState.opacity);\n        var context = this.context;\n        var canvas = context.canvas;\n        if (canvas.width != width || canvas.height != height) {\n            canvas.width = width;\n            canvas.height = height;\n        }\n        else if (!this.containerReused) {\n            context.clearRect(0, 0, width, height);\n        }\n        // clipped rendering if layer extent is set\n        var clipped = false;\n        var render = true;\n        if (layerState.extent) {\n            var layerExtent = fromUserExtent(layerState.extent, viewState.projection);\n            render = intersectsExtent(layerExtent, frameState.extent);\n            clipped = render && !containsExtent(layerExtent, frameState.extent);\n            if (clipped) {\n                this.clipUnrotated(context, frameState, layerExtent);\n            }\n        }\n        var img = image.getImage();\n        var transform = composeTransform(this.tempTransform, width / 2, height / 2, scale, scale, 0, (imagePixelRatio * (imageExtent[0] - viewCenter[0])) / imageResolution, (imagePixelRatio * (viewCenter[1] - imageExtent[3])) / imageResolution);\n        this.renderedResolution = (imageResolution * pixelRatio) / imagePixelRatio;\n        var dw = img.width * transform[0];\n        var dh = img.height * transform[3];\n        assign(context, this.getLayer().getSource().getContextOptions());\n        this.preRender(context, frameState);\n        if (render && dw >= 0.5 && dh >= 0.5) {\n            var dx = transform[4];\n            var dy = transform[5];\n            var opacity = layerState.opacity;\n            var previousAlpha = void 0;\n            if (opacity !== 1) {\n                previousAlpha = context.globalAlpha;\n                context.globalAlpha = opacity;\n            }\n            context.drawImage(img, 0, 0, +img.width, +img.height, Math.round(dx), Math.round(dy), Math.round(dw), Math.round(dh));\n            if (opacity !== 1) {\n                context.globalAlpha = previousAlpha;\n            }\n        }\n        this.postRender(context, frameState);\n        if (clipped) {\n            context.restore();\n        }\n        if (canvasTransform !== canvas.style.transform) {\n            canvas.style.transform = canvasTransform;\n        }\n        return this.container;\n    };\n    return CanvasImageLayerRenderer;\n}(CanvasLayerRenderer));\nexport default CanvasImageLayerRenderer;\n//# sourceMappingURL=ImageLayer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/VectorTileLayer\n */\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasExecutorGroup from '../../render/canvas/ExecutorGroup.js';\nimport CanvasTileLayerRenderer from './TileLayer.js';\nimport ReplayType from '../../render/canvas/BuilderType.js';\nimport TileState from '../../TileState.js';\nimport VectorTileRenderType from '../../layer/VectorTileRenderType.js';\nimport ViewHint from '../../ViewHint.js';\nimport { HIT_DETECT_RESOLUTION, createHitDetectionImageData, hitDetect, } from '../../render/canvas/hitdetect.js';\nimport { apply as applyTransform, create as createTransform, multiply, reset as resetTransform, scale, scale as scaleTransform, translate as translateTransform, } from '../../transform.js';\nimport { boundingExtent, buffer, containsExtent, equals, getIntersection, getTopLeft, intersects, } from '../../extent.js';\nimport { getSquaredTolerance as getSquaredRenderTolerance, renderFeature, } from '../vector.js';\nimport { getUid } from '../../util.js';\nimport { toSize } from '../../size.js';\nimport { wrapX } from '../../coordinate.js';\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas/BuilderType.js\").default>>}\n */\nvar IMAGE_REPLAYS = {\n    'image': [\n        ReplayType.POLYGON,\n        ReplayType.CIRCLE,\n        ReplayType.LINE_STRING,\n        ReplayType.IMAGE,\n        ReplayType.TEXT,\n    ],\n    'hybrid': [ReplayType.POLYGON, ReplayType.LINE_STRING],\n    'vector': [],\n};\n/**\n * @type {!Object<string, Array<import(\"../../render/canvas/BuilderType.js\").default>>}\n */\nvar VECTOR_REPLAYS = {\n    'hybrid': [ReplayType.IMAGE, ReplayType.TEXT, ReplayType.DEFAULT],\n    'vector': [\n        ReplayType.POLYGON,\n        ReplayType.CIRCLE,\n        ReplayType.LINE_STRING,\n        ReplayType.IMAGE,\n        ReplayType.TEXT,\n        ReplayType.DEFAULT,\n    ],\n};\n/**\n * @classdesc\n * Canvas renderer for vector tile layers.\n * @api\n */\nvar CanvasVectorTileLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasVectorTileLayerRenderer, _super);\n    /**\n     * @param {import(\"../../layer/VectorTile.js\").default} layer VectorTile layer.\n     */\n    function CanvasVectorTileLayerRenderer(layer) {\n        var _this = _super.call(this, layer) || this;\n        /** @private */\n        _this.boundHandleStyleImageChange_ = _this.handleStyleImageChange_.bind(_this);\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.dirty_ = false;\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedLayerRevision_;\n        /**\n         * @private\n         * @type {import(\"../../transform\").Transform}\n         */\n        _this.renderedPixelToCoordinateTransform_ = null;\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedRotation_;\n        /**\n         * @private\n         * @type {import(\"../../transform.js\").Transform}\n         */\n        _this.tmpTransform_ = createTransform();\n        return _this;\n    }\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {import(\"../../proj/Projection\").default} projection Projection.\n     * @return {boolean|undefined} Tile needs to be rendered.\n     */\n    CanvasVectorTileLayerRenderer.prototype.prepareTile = function (tile, pixelRatio, projection) {\n        var render;\n        var state = tile.getState();\n        if (state === TileState.LOADED || state === TileState.ERROR) {\n            this.updateExecutorGroup_(tile, pixelRatio, projection);\n            if (this.tileImageNeedsRender_(tile)) {\n                render = true;\n            }\n        }\n        return render;\n    };\n    /**\n     * @param {number} z Tile coordinate z.\n     * @param {number} x Tile coordinate x.\n     * @param {number} y Tile coordinate y.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {!import(\"../../Tile.js\").default} Tile.\n     */\n    CanvasVectorTileLayerRenderer.prototype.getTile = function (z, x, y, frameState) {\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var resolution = viewState.resolution;\n        var projection = viewState.projection;\n        var layer = this.getLayer();\n        var tile = layer.getSource().getTile(z, x, y, pixelRatio, projection);\n        var viewHints = frameState.viewHints;\n        var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n        if (hifi || !tile.wantedResolution) {\n            tile.wantedResolution = resolution;\n        }\n        var render = this.prepareTile(tile, pixelRatio, projection);\n        if (render &&\n            (hifi || Date.now() - frameState.time < 8) &&\n            layer.getRenderMode() !== VectorTileRenderType.VECTOR) {\n            this.renderTileImage_(tile, frameState);\n        }\n        return _super.prototype.getTile.call(this, z, x, y, frameState);\n    };\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @return {boolean} Tile is drawable.\n     */\n    CanvasVectorTileLayerRenderer.prototype.isDrawableTile = function (tile) {\n        var layer = this.getLayer();\n        return (_super.prototype.isDrawableTile.call(this, tile) &&\n            (layer.getRenderMode() === VectorTileRenderType.VECTOR\n                ? getUid(layer) in tile.executorGroups\n                : tile.hasContext(layer)));\n    };\n    /**\n     * @inheritDoc\n     */\n    CanvasVectorTileLayerRenderer.prototype.getTileImage = function (tile) {\n        return tile.getImage(this.getLayer());\n    };\n    /**\n     * Determine whether render should be called.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    CanvasVectorTileLayerRenderer.prototype.prepareFrame = function (frameState) {\n        var layerRevision = this.getLayer().getRevision();\n        if (this.renderedLayerRevision_ != layerRevision) {\n            this.renderedTiles.length = 0;\n        }\n        this.renderedLayerRevision_ = layerRevision;\n        return _super.prototype.prepareFrame.call(this, frameState);\n    };\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {import(\"../../proj/Projection.js\").default} projection Projection.\n     * @private\n     */\n    CanvasVectorTileLayerRenderer.prototype.updateExecutorGroup_ = function (tile, pixelRatio, projection) {\n        var layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n        var revision = layer.getRevision();\n        var renderOrder = layer.getRenderOrder() || null;\n        var resolution = tile.wantedResolution;\n        var builderState = tile.getReplayState(layer);\n        if (!builderState.dirty &&\n            builderState.renderedResolution === resolution &&\n            builderState.renderedRevision == revision &&\n            builderState.renderedRenderOrder == renderOrder) {\n            return;\n        }\n        var source = layer.getSource();\n        var declutter = layer.getDeclutter();\n        var sourceTileGrid = source.getTileGrid();\n        var tileGrid = source.getTileGridForProjection(projection);\n        var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n        var sourceTiles = source.getSourceTiles(pixelRatio, projection, tile);\n        var layerUid = getUid(layer);\n        delete tile.hitDetectionImageData[layerUid];\n        tile.executorGroups[layerUid] = [];\n        if (declutter) {\n            tile.declutterExecutorGroups[layerUid] = [];\n        }\n        var _loop_1 = function (t, tt) {\n            var sourceTile = sourceTiles[t];\n            if (sourceTile.getState() != TileState.LOADED) {\n                return \"continue\";\n            }\n            var sourceTileCoord = sourceTile.tileCoord;\n            var sourceTileExtent = sourceTileGrid.getTileCoordExtent(sourceTileCoord);\n            var sharedExtent = getIntersection(tileExtent, sourceTileExtent);\n            var builderExtent = buffer(sharedExtent, layer.getRenderBuffer() * resolution, this_1.tmpExtent);\n            var bufferedExtent = equals(sourceTileExtent, sharedExtent)\n                ? null\n                : builderExtent;\n            builderState.dirty = false;\n            var builderGroup = new CanvasBuilderGroup(0, builderExtent, resolution, pixelRatio);\n            var declutterBuilderGroup = declutter\n                ? new CanvasBuilderGroup(0, sharedExtent, resolution, pixelRatio)\n                : undefined;\n            var squaredTolerance = getSquaredRenderTolerance(resolution, pixelRatio);\n            /**\n             * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n             * @this {CanvasVectorTileLayerRenderer}\n             */\n            var render = function (feature) {\n                var styles;\n                var styleFunction = feature.getStyleFunction() || layer.getStyleFunction();\n                if (styleFunction) {\n                    styles = styleFunction(feature, resolution);\n                }\n                if (styles) {\n                    var dirty = this.renderFeature(feature, squaredTolerance, styles, builderGroup, declutterBuilderGroup);\n                    this.dirty_ = this.dirty_ || dirty;\n                    builderState.dirty = builderState.dirty || dirty;\n                }\n            };\n            var features = sourceTile.getFeatures();\n            if (renderOrder && renderOrder !== builderState.renderedRenderOrder) {\n                features.sort(renderOrder);\n            }\n            for (var i = 0, ii = features.length; i < ii; ++i) {\n                var feature = features[i];\n                if (!bufferedExtent ||\n                    intersects(bufferedExtent, feature.getGeometry().getExtent())) {\n                    render.call(this_1, feature);\n                }\n            }\n            var executorGroupInstructions = builderGroup.finish();\n            // no need to clip when the render tile is covered by a single source tile\n            var replayExtent = layer.getRenderMode() !== VectorTileRenderType.VECTOR &&\n                declutter &&\n                sourceTiles.length === 1\n                ? null\n                : sharedExtent;\n            var renderingReplayGroup = new CanvasExecutorGroup(replayExtent, resolution, pixelRatio, source.getOverlaps(), executorGroupInstructions, layer.getRenderBuffer());\n            tile.executorGroups[layerUid].push(renderingReplayGroup);\n            if (declutterBuilderGroup) {\n                var declutterExecutorGroup = new CanvasExecutorGroup(null, resolution, pixelRatio, source.getOverlaps(), declutterBuilderGroup.finish(), layer.getRenderBuffer());\n                tile.declutterExecutorGroups[layerUid].push(declutterExecutorGroup);\n            }\n        };\n        var this_1 = this;\n        for (var t = 0, tt = sourceTiles.length; t < tt; ++t) {\n            _loop_1(t, tt);\n        }\n        builderState.renderedRevision = revision;\n        builderState.renderedRenderOrder = renderOrder;\n        builderState.renderedResolution = resolution;\n    };\n    /**\n     * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n     * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    CanvasVectorTileLayerRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, matches) {\n        var resolution = frameState.viewState.resolution;\n        var rotation = frameState.viewState.rotation;\n        hitTolerance = hitTolerance == undefined ? 0 : hitTolerance;\n        var layer = this.getLayer();\n        var source = layer.getSource();\n        var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);\n        var hitExtent = boundingExtent([coordinate]);\n        buffer(hitExtent, resolution * hitTolerance, hitExtent);\n        /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n        var features = {};\n        /**\n         * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n         * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n         * @param {number} distanceSq The squared distance to the click position.\n         * @return {T|undefined} Callback result.\n         */\n        var featureCallback = function (feature, geometry, distanceSq) {\n            var key = feature.getId();\n            if (key === undefined) {\n                key = getUid(feature);\n            }\n            var match = features[key];\n            if (!match) {\n                if (distanceSq === 0) {\n                    features[key] = true;\n                    return callback(feature, layer, geometry);\n                }\n                matches.push((features[key] = {\n                    feature: feature,\n                    layer: layer,\n                    geometry: geometry,\n                    distanceSq: distanceSq,\n                    callback: callback,\n                }));\n            }\n            else if (match !== true && distanceSq < match.distanceSq) {\n                if (distanceSq === 0) {\n                    features[key] = true;\n                    matches.splice(matches.lastIndexOf(match), 1);\n                    return callback(feature, layer, geometry);\n                }\n                match.geometry = geometry;\n                match.distanceSq = distanceSq;\n            }\n            return undefined;\n        };\n        var renderedTiles = \n        /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (this.renderedTiles);\n        var found;\n        var _loop_2 = function (i, ii) {\n            var tile = renderedTiles[i];\n            var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n            if (!intersects(tileExtent, hitExtent)) {\n                return \"continue\";\n            }\n            var layerUid = getUid(layer);\n            var executorGroups = [tile.executorGroups[layerUid]];\n            var declutterExecutorGroups = tile.declutterExecutorGroups[layerUid];\n            if (declutterExecutorGroups) {\n                executorGroups.push(declutterExecutorGroups);\n            }\n            executorGroups.some(function (executorGroups) {\n                var declutteredFeatures = executorGroups === declutterExecutorGroups\n                    ? frameState.declutterTree.all().map(function (item) { return item.value; })\n                    : null;\n                for (var t = 0, tt = executorGroups.length; t < tt; ++t) {\n                    var executorGroup = executorGroups[t];\n                    found = executorGroup.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, featureCallback, declutteredFeatures);\n                    if (found) {\n                        return true;\n                    }\n                }\n            });\n        };\n        for (var i = 0, ii = renderedTiles.length; !found && i < ii; ++i) {\n            _loop_2(i, ii);\n        }\n        return found;\n    };\n    /**\n     * Asynchronous layer level hit detection.\n     * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n     * @return {Promise<Array<import(\"../../Feature\").default>>} Promise that resolves with an array of features.\n     */\n    CanvasVectorTileLayerRenderer.prototype.getFeatures = function (pixel) {\n        return new Promise(function (resolve, reject) {\n            var layer = \n            /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n            var layerUid = getUid(layer);\n            var source = layer.getSource();\n            var projection = this.renderedProjection;\n            var projectionExtent = projection.getExtent();\n            var resolution = this.renderedResolution;\n            var tileGrid = source.getTileGridForProjection(projection);\n            var coordinate = applyTransform(this.renderedPixelToCoordinateTransform_, pixel.slice());\n            var tileCoord = tileGrid.getTileCoordForCoordAndResolution(coordinate, resolution);\n            var tile;\n            for (var i = 0, ii = this.renderedTiles.length; i < ii; ++i) {\n                if (tileCoord.toString() === this.renderedTiles[i].tileCoord.toString()) {\n                    tile = this.renderedTiles[i];\n                    if (tile.getState() === TileState.LOADED) {\n                        var extent_1 = tileGrid.getTileCoordExtent(tile.tileCoord);\n                        if (source.getWrapX() &&\n                            projection.canWrapX() &&\n                            !containsExtent(projectionExtent, extent_1)) {\n                            wrapX(coordinate, projection);\n                        }\n                        break;\n                    }\n                    tile = undefined;\n                }\n            }\n            if (!tile || tile.loadingSourceTiles > 0) {\n                resolve([]);\n                return;\n            }\n            var extent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n            var corner = getTopLeft(extent);\n            var tilePixel = [\n                (coordinate[0] - corner[0]) / resolution,\n                (corner[1] - coordinate[1]) / resolution,\n            ];\n            var features = tile\n                .getSourceTiles()\n                .reduce(function (accumulator, sourceTile) {\n                return accumulator.concat(sourceTile.getFeatures());\n            }, []);\n            var hitDetectionImageData = tile.hitDetectionImageData[layerUid];\n            if (!hitDetectionImageData && !this.animatingOrInteracting_) {\n                var tileSize = toSize(tileGrid.getTileSize(tileGrid.getZForResolution(resolution)));\n                var rotation = this.renderedRotation_;\n                var transforms = [\n                    this.getRenderTransform(tileGrid.getTileCoordCenter(tile.wrappedTileCoord), resolution, 0, HIT_DETECT_RESOLUTION, tileSize[0] * HIT_DETECT_RESOLUTION, tileSize[1] * HIT_DETECT_RESOLUTION, 0),\n                ];\n                hitDetectionImageData = createHitDetectionImageData(tileSize, transforms, features, layer.getStyleFunction(), tileGrid.getTileCoordExtent(tile.wrappedTileCoord), tile.getReplayState(layer).renderedResolution, rotation);\n                tile.hitDetectionImageData[layerUid] = hitDetectionImageData;\n            }\n            resolve(hitDetect(tilePixel, features, hitDetectionImageData));\n        }.bind(this));\n    };\n    /**\n     * Perform action necessary to get the layer rendered after new fonts have loaded\n     */\n    CanvasVectorTileLayerRenderer.prototype.handleFontsChanged = function () {\n        var layer = this.getLayer();\n        if (layer.getVisible() && this.renderedLayerRevision_ !== undefined) {\n            layer.changed();\n        }\n    };\n    /**\n     * Handle changes in image style state.\n     * @param {import(\"../../events/Event.js\").default} event Image style change event.\n     * @private\n     */\n    CanvasVectorTileLayerRenderer.prototype.handleStyleImageChange_ = function (event) {\n        this.renderIfReadyAndVisible();\n    };\n    /**\n     * Render declutter items for this layer\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    CanvasVectorTileLayerRenderer.prototype.renderDeclutter = function (frameState) {\n        var context = this.context;\n        var alpha = context.globalAlpha;\n        context.globalAlpha = this.getLayer().getOpacity();\n        var viewHints = frameState.viewHints;\n        var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n        var tiles = \n        /** @type {Array<import(\"../../VectorRenderTile.js\").default>} */ (this.renderedTiles);\n        for (var i = 0, ii = tiles.length; i < ii; ++i) {\n            var tile = tiles[i];\n            var declutterExecutorGroups = tile.declutterExecutorGroups[getUid(this.getLayer())];\n            if (declutterExecutorGroups) {\n                for (var j = declutterExecutorGroups.length - 1; j >= 0; --j) {\n                    declutterExecutorGroups[j].execute(this.context, 1, this.getTileRenderTransform(tile, frameState), frameState.viewState.rotation, hifi, undefined, frameState.declutterTree);\n                }\n            }\n        }\n        context.globalAlpha = alpha;\n    };\n    CanvasVectorTileLayerRenderer.prototype.getTileRenderTransform = function (tile, frameState) {\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var center = viewState.center;\n        var resolution = viewState.resolution;\n        var rotation = viewState.rotation;\n        var size = frameState.size;\n        var width = Math.round(size[0] * pixelRatio);\n        var height = Math.round(size[1] * pixelRatio);\n        var source = this.getLayer().getSource();\n        var tileGrid = source.getTileGridForProjection(frameState.viewState.projection);\n        var tileCoord = tile.tileCoord;\n        var tileExtent = tileGrid.getTileCoordExtent(tile.wrappedTileCoord);\n        var worldOffset = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent)[0] - tileExtent[0];\n        var transform = multiply(scale(this.inversePixelTransform.slice(), 1 / pixelRatio, 1 / pixelRatio), this.getRenderTransform(center, resolution, rotation, pixelRatio, width, height, worldOffset));\n        return transform;\n    };\n    /**\n     * Render the layer.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    CanvasVectorTileLayerRenderer.prototype.renderFrame = function (frameState, target) {\n        var viewHints = frameState.viewHints;\n        var hifi = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n        _super.prototype.renderFrame.call(this, frameState, target);\n        this.renderedPixelToCoordinateTransform_ =\n            frameState.pixelToCoordinateTransform.slice();\n        this.renderedRotation_ = frameState.viewState.rotation;\n        var layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n        var renderMode = layer.getRenderMode();\n        var context = this.context;\n        var alpha = context.globalAlpha;\n        context.globalAlpha = layer.getOpacity();\n        var replayTypes = VECTOR_REPLAYS[renderMode];\n        var viewState = frameState.viewState;\n        var rotation = viewState.rotation;\n        var tiles = this.renderedTiles;\n        var clips = [];\n        var clipZs = [];\n        for (var i = tiles.length - 1; i >= 0; --i) {\n            var tile = /** @type {import(\"../../VectorRenderTile.js\").default} */ (tiles[i]);\n            var transform = this.getTileRenderTransform(tile, frameState);\n            var executorGroups = tile.executorGroups[getUid(layer)];\n            var clipped = false;\n            for (var t = 0, tt = executorGroups.length; t < tt; ++t) {\n                var executorGroup = executorGroups[t];\n                if (!executorGroup.hasExecutors(replayTypes)) {\n                    // sourceTile has no instructions of the types we want to render\n                    continue;\n                }\n                var currentZ = tile.tileCoord[0];\n                var currentClip = void 0;\n                if (!clipped) {\n                    currentClip = executorGroup.getClipCoords(transform);\n                    if (currentClip) {\n                        context.save();\n                        // Create a clip mask for regions in this low resolution tile that are\n                        // already filled by a higher resolution tile\n                        for (var j = 0, jj = clips.length; j < jj; ++j) {\n                            var clip = clips[j];\n                            if (currentZ < clipZs[j]) {\n                                context.beginPath();\n                                // counter-clockwise (outer ring) for current tile\n                                context.moveTo(currentClip[0], currentClip[1]);\n                                context.lineTo(currentClip[2], currentClip[3]);\n                                context.lineTo(currentClip[4], currentClip[5]);\n                                context.lineTo(currentClip[6], currentClip[7]);\n                                // clockwise (inner ring) for higher resolution tile\n                                context.moveTo(clip[6], clip[7]);\n                                context.lineTo(clip[4], clip[5]);\n                                context.lineTo(clip[2], clip[3]);\n                                context.lineTo(clip[0], clip[1]);\n                                context.clip();\n                            }\n                        }\n                    }\n                }\n                executorGroup.execute(context, 1, transform, rotation, hifi, replayTypes);\n                if (!clipped && currentClip) {\n                    context.restore();\n                    clips.push(currentClip);\n                    clipZs.push(currentZ);\n                    clipped = true;\n                }\n            }\n        }\n        context.globalAlpha = alpha;\n        return this.container;\n    };\n    /**\n     * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n     * @param {number} squaredTolerance Squared tolerance.\n     * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n     * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Replay group.\n     * @param {import(\"../../render/canvas/BuilderGroup.js\").default} [opt_declutterBuilderGroup] Builder group for decluttering.\n     * @return {boolean} `true` if an image is loading.\n     */\n    CanvasVectorTileLayerRenderer.prototype.renderFeature = function (feature, squaredTolerance, styles, builderGroup, opt_declutterBuilderGroup) {\n        if (!styles) {\n            return false;\n        }\n        var loading = false;\n        if (Array.isArray(styles)) {\n            for (var i = 0, ii = styles.length; i < ii; ++i) {\n                loading =\n                    renderFeature(builderGroup, feature, styles[i], squaredTolerance, this.boundHandleStyleImageChange_, undefined, opt_declutterBuilderGroup) || loading;\n            }\n        }\n        else {\n            loading = renderFeature(builderGroup, feature, styles, squaredTolerance, this.boundHandleStyleImageChange_, undefined, opt_declutterBuilderGroup);\n        }\n        return loading;\n    };\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @return {boolean} A new tile image was rendered.\n     * @private\n     */\n    CanvasVectorTileLayerRenderer.prototype.tileImageNeedsRender_ = function (tile) {\n        var layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n        if (layer.getRenderMode() === VectorTileRenderType.VECTOR) {\n            return false;\n        }\n        var replayState = tile.getReplayState(layer);\n        var revision = layer.getRevision();\n        var resolution = tile.wantedResolution;\n        return (replayState.renderedTileResolution !== resolution ||\n            replayState.renderedTileRevision !== revision);\n    };\n    /**\n     * @param {import(\"../../VectorRenderTile.js\").default} tile Tile.\n     * @param {import(\"../../PluggableMap\").FrameState} frameState Frame state.\n     * @private\n     */\n    CanvasVectorTileLayerRenderer.prototype.renderTileImage_ = function (tile, frameState) {\n        var layer = /** @type {import(\"../../layer/VectorTile.js\").default} */ (this.getLayer());\n        var replayState = tile.getReplayState(layer);\n        var revision = layer.getRevision();\n        var executorGroups = tile.executorGroups[getUid(layer)];\n        replayState.renderedTileRevision = revision;\n        var tileCoord = tile.wrappedTileCoord;\n        var z = tileCoord[0];\n        var source = layer.getSource();\n        var pixelRatio = frameState.pixelRatio;\n        var viewState = frameState.viewState;\n        var projection = viewState.projection;\n        var tileGrid = source.getTileGridForProjection(projection);\n        var tileResolution = tileGrid.getResolution(tile.tileCoord[0]);\n        var renderPixelRatio = (frameState.pixelRatio / tile.wantedResolution) * tileResolution;\n        var resolution = tileGrid.getResolution(z);\n        var context = tile.getContext(layer);\n        // Increase tile size when overzooming for low pixel ratio, to avoid blurry tiles\n        pixelRatio = Math.round(Math.max(pixelRatio, renderPixelRatio / pixelRatio));\n        var size = source.getTilePixelSize(z, pixelRatio, projection);\n        context.canvas.width = size[0];\n        context.canvas.height = size[1];\n        var renderScale = pixelRatio / renderPixelRatio;\n        if (renderScale !== 1) {\n            var canvasTransform = resetTransform(this.tmpTransform_);\n            scaleTransform(canvasTransform, renderScale, renderScale);\n            context.setTransform.apply(context, canvasTransform);\n        }\n        var tileExtent = tileGrid.getTileCoordExtent(tileCoord, this.tmpExtent);\n        var pixelScale = renderPixelRatio / resolution;\n        var transform = resetTransform(this.tmpTransform_);\n        scaleTransform(transform, pixelScale, -pixelScale);\n        translateTransform(transform, -tileExtent[0], -tileExtent[3]);\n        for (var i = 0, ii = executorGroups.length; i < ii; ++i) {\n            var executorGroup = executorGroups[i];\n            executorGroup.execute(context, renderScale, transform, 0, true, IMAGE_REPLAYS[layer.getRenderMode()]);\n        }\n        replayState.renderedTileResolution = tile.wantedResolution;\n    };\n    return CanvasVectorTileLayerRenderer;\n}(CanvasTileLayerRenderer));\nexport default CanvasVectorTileLayerRenderer;\n//# sourceMappingURL=VectorTileLayer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/TileLayer\n */\nimport CanvasLayerRenderer from './Layer.js';\nimport TileRange from '../../TileRange.js';\nimport TileState from '../../TileState.js';\nimport { apply as applyTransform, compose as composeTransform, makeInverse, } from '../../transform.js';\nimport { assign } from '../../obj.js';\nimport { createEmpty, equals, getIntersection, getTopLeft, } from '../../extent.js';\nimport { cssOpacity } from '../../css.js';\nimport { fromUserExtent } from '../../proj.js';\nimport { getUid } from '../../util.js';\nimport { numberSafeCompareFunction } from '../../array.js';\nimport { toString as toTransformString } from '../../transform.js';\n/**\n * @classdesc\n * Canvas renderer for tile layers.\n * @api\n */\nvar CanvasTileLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasTileLayerRenderer, _super);\n    /**\n     * @param {import(\"../../layer/Tile.js\").default|import(\"../../layer/VectorTile.js\").default} tileLayer Tile layer.\n     */\n    function CanvasTileLayerRenderer(tileLayer) {\n        var _this = _super.call(this, tileLayer) || this;\n        /**\n         * Rendered extent has changed since the previous `renderFrame()` call\n         * @type {boolean}\n         */\n        _this.extentChanged = true;\n        /**\n         * @private\n         * @type {?import(\"../../extent.js\").Extent}\n         */\n        _this.renderedExtent_ = null;\n        /**\n         * @protected\n         * @type {number}\n         */\n        _this.renderedPixelRatio;\n        /**\n         * @protected\n         * @type {import(\"../../proj/Projection.js\").default}\n         */\n        _this.renderedProjection = null;\n        /**\n         * @protected\n         * @type {number}\n         */\n        _this.renderedRevision;\n        /**\n         * @protected\n         * @type {!Array<import(\"../../Tile.js\").default>}\n         */\n        _this.renderedTiles = [];\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.newTiles_ = false;\n        /**\n         * @protected\n         * @type {import(\"../../extent.js\").Extent}\n         */\n        _this.tmpExtent = createEmpty();\n        /**\n         * @private\n         * @type {import(\"../../TileRange.js\").default}\n         */\n        _this.tmpTileRange_ = new TileRange(0, 0, 0, 0);\n        return _this;\n    }\n    /**\n     * @protected\n     * @param {import(\"../../Tile.js\").default} tile Tile.\n     * @return {boolean} Tile is drawable.\n     */\n    CanvasTileLayerRenderer.prototype.isDrawableTile = function (tile) {\n        var tileLayer = this.getLayer();\n        var tileState = tile.getState();\n        var useInterimTilesOnError = tileLayer.getUseInterimTilesOnError();\n        return (tileState == TileState.LOADED ||\n            tileState == TileState.EMPTY ||\n            (tileState == TileState.ERROR && !useInterimTilesOnError));\n    };\n    /**\n     * @param {number} z Tile coordinate z.\n     * @param {number} x Tile coordinate x.\n     * @param {number} y Tile coordinate y.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {!import(\"../../Tile.js\").default} Tile.\n     */\n    CanvasTileLayerRenderer.prototype.getTile = function (z, x, y, frameState) {\n        var pixelRatio = frameState.pixelRatio;\n        var projection = frameState.viewState.projection;\n        var tileLayer = this.getLayer();\n        var tileSource = tileLayer.getSource();\n        var tile = tileSource.getTile(z, x, y, pixelRatio, projection);\n        if (tile.getState() == TileState.ERROR) {\n            if (!tileLayer.getUseInterimTilesOnError()) {\n                // When useInterimTilesOnError is false, we consider the error tile as loaded.\n                tile.setState(TileState.LOADED);\n            }\n            else if (tileLayer.getPreload() > 0) {\n                // Preloaded tiles for lower resolutions might have finished loading.\n                this.newTiles_ = true;\n            }\n        }\n        if (!this.isDrawableTile(tile)) {\n            tile = tile.getInterimTile();\n        }\n        return tile;\n    };\n    /**\n     * @param {Object<number, Object<string, import(\"../../Tile.js\").default>>} tiles Lookup of loaded tiles by zoom level.\n     * @param {number} zoom Zoom level.\n     * @param {import(\"../../Tile.js\").default} tile Tile.\n     * @return {boolean|void} If `false`, the tile will not be considered loaded.\n     */\n    CanvasTileLayerRenderer.prototype.loadedTileCallback = function (tiles, zoom, tile) {\n        if (this.isDrawableTile(tile)) {\n            return _super.prototype.loadedTileCallback.call(this, tiles, zoom, tile);\n        }\n        return false;\n    };\n    /**\n     * Determine whether render should be called.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    CanvasTileLayerRenderer.prototype.prepareFrame = function (frameState) {\n        return !!this.getLayer().getSource();\n    };\n    /**\n     * Render the layer.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    CanvasTileLayerRenderer.prototype.renderFrame = function (frameState, target) {\n        var layerState = frameState.layerStatesArray[frameState.layerIndex];\n        var viewState = frameState.viewState;\n        var projection = viewState.projection;\n        var viewResolution = viewState.resolution;\n        var viewCenter = viewState.center;\n        var rotation = viewState.rotation;\n        var pixelRatio = frameState.pixelRatio;\n        var tileLayer = this.getLayer();\n        var tileSource = tileLayer.getSource();\n        var sourceRevision = tileSource.getRevision();\n        var tileGrid = tileSource.getTileGridForProjection(projection);\n        var z = tileGrid.getZForResolution(viewResolution, tileSource.zDirection);\n        var tileResolution = tileGrid.getResolution(z);\n        var extent = frameState.extent;\n        var layerExtent = layerState.extent && fromUserExtent(layerState.extent, projection);\n        if (layerExtent) {\n            extent = getIntersection(extent, fromUserExtent(layerState.extent, projection));\n        }\n        var tilePixelRatio = tileSource.getTilePixelRatio(pixelRatio);\n        // desired dimensions of the canvas in pixels\n        var width = Math.round(frameState.size[0] * tilePixelRatio);\n        var height = Math.round(frameState.size[1] * tilePixelRatio);\n        if (rotation) {\n            var size = Math.round(Math.sqrt(width * width + height * height));\n            width = size;\n            height = size;\n        }\n        var dx = (tileResolution * width) / 2 / tilePixelRatio;\n        var dy = (tileResolution * height) / 2 / tilePixelRatio;\n        var canvasExtent = [\n            viewCenter[0] - dx,\n            viewCenter[1] - dy,\n            viewCenter[0] + dx,\n            viewCenter[1] + dy,\n        ];\n        var tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z);\n        /**\n         * @type {Object<number, Object<string, import(\"../../Tile.js\").default>>}\n         */\n        var tilesToDrawByZ = {};\n        tilesToDrawByZ[z] = {};\n        var findLoadedTiles = this.createLoadedTileFinder(tileSource, projection, tilesToDrawByZ);\n        var tmpExtent = this.tmpExtent;\n        var tmpTileRange = this.tmpTileRange_;\n        this.newTiles_ = false;\n        for (var x = tileRange.minX; x <= tileRange.maxX; ++x) {\n            for (var y = tileRange.minY; y <= tileRange.maxY; ++y) {\n                var tile = this.getTile(z, x, y, frameState);\n                if (this.isDrawableTile(tile)) {\n                    var uid = getUid(this);\n                    if (tile.getState() == TileState.LOADED) {\n                        tilesToDrawByZ[z][tile.tileCoord.toString()] = tile;\n                        var inTransition = tile.inTransition(uid);\n                        if (!this.newTiles_ &&\n                            (inTransition || this.renderedTiles.indexOf(tile) === -1)) {\n                            this.newTiles_ = true;\n                        }\n                    }\n                    if (tile.getAlpha(uid, frameState.time) === 1) {\n                        // don't look for alt tiles if alpha is 1\n                        continue;\n                    }\n                }\n                var childTileRange = tileGrid.getTileCoordChildTileRange(tile.tileCoord, tmpTileRange, tmpExtent);\n                var covered = false;\n                if (childTileRange) {\n                    covered = findLoadedTiles(z + 1, childTileRange);\n                }\n                if (!covered) {\n                    tileGrid.forEachTileCoordParentTileRange(tile.tileCoord, findLoadedTiles, tmpTileRange, tmpExtent);\n                }\n            }\n        }\n        var canvasScale = tileResolution / viewResolution;\n        // set forward and inverse pixel transforms\n        composeTransform(this.pixelTransform, frameState.size[0] / 2, frameState.size[1] / 2, 1 / tilePixelRatio, 1 / tilePixelRatio, rotation, -width / 2, -height / 2);\n        var canvasTransform = toTransformString(this.pixelTransform);\n        this.useContainer(target, canvasTransform, layerState.opacity);\n        var context = this.context;\n        var canvas = context.canvas;\n        makeInverse(this.inversePixelTransform, this.pixelTransform);\n        // set scale transform for calculating tile positions on the canvas\n        composeTransform(this.tempTransform, width / 2, height / 2, canvasScale, canvasScale, 0, -width / 2, -height / 2);\n        if (canvas.width != width || canvas.height != height) {\n            canvas.width = width;\n            canvas.height = height;\n        }\n        else if (!this.containerReused) {\n            context.clearRect(0, 0, width, height);\n        }\n        if (layerExtent) {\n            this.clipUnrotated(context, frameState, layerExtent);\n        }\n        assign(context, tileSource.getContextOptions());\n        this.preRender(context, frameState);\n        this.renderedTiles.length = 0;\n        /** @type {Array<number>} */\n        var zs = Object.keys(tilesToDrawByZ).map(Number);\n        zs.sort(numberSafeCompareFunction);\n        var clips, clipZs, currentClip;\n        if (layerState.opacity === 1 &&\n            (!this.containerReused ||\n                tileSource.getOpaque(frameState.viewState.projection))) {\n            zs = zs.reverse();\n        }\n        else {\n            clips = [];\n            clipZs = [];\n        }\n        for (var i = zs.length - 1; i >= 0; --i) {\n            var currentZ = zs[i];\n            var currentTilePixelSize = tileSource.getTilePixelSize(currentZ, pixelRatio, projection);\n            var currentResolution = tileGrid.getResolution(currentZ);\n            var currentScale = currentResolution / tileResolution;\n            var dx_1 = currentTilePixelSize[0] * currentScale * canvasScale;\n            var dy_1 = currentTilePixelSize[1] * currentScale * canvasScale;\n            var originTileCoord = tileGrid.getTileCoordForCoordAndZ(getTopLeft(canvasExtent), currentZ);\n            var originTileExtent = tileGrid.getTileCoordExtent(originTileCoord);\n            var origin_1 = applyTransform(this.tempTransform, [\n                (tilePixelRatio * (originTileExtent[0] - canvasExtent[0])) /\n                    tileResolution,\n                (tilePixelRatio * (canvasExtent[3] - originTileExtent[3])) /\n                    tileResolution,\n            ]);\n            var tileGutter = tilePixelRatio * tileSource.getGutterForProjection(projection);\n            var tilesToDraw = tilesToDrawByZ[currentZ];\n            for (var tileCoordKey in tilesToDraw) {\n                var tile = /** @type {import(\"../../ImageTile.js\").default} */ (tilesToDraw[tileCoordKey]);\n                var tileCoord = tile.tileCoord;\n                // Calculate integer positions and sizes so that tiles align\n                var xIndex = originTileCoord[1] - tileCoord[1];\n                var nextX = Math.round(origin_1[0] - (xIndex - 1) * dx_1);\n                var yIndex = originTileCoord[2] - tileCoord[2];\n                var nextY = Math.round(origin_1[1] - (yIndex - 1) * dy_1);\n                var x = Math.round(origin_1[0] - xIndex * dx_1);\n                var y = Math.round(origin_1[1] - yIndex * dy_1);\n                var w = nextX - x;\n                var h = nextY - y;\n                var transition = z === currentZ;\n                var inTransition = transition && tile.getAlpha(getUid(this), frameState.time) !== 1;\n                if (!inTransition) {\n                    if (clips) {\n                        // Clip mask for regions in this tile that already filled by a higher z tile\n                        context.save();\n                        currentClip = [x, y, x + w, y, x + w, y + h, x, y + h];\n                        for (var i_1 = 0, ii = clips.length; i_1 < ii; ++i_1) {\n                            if (z !== currentZ && currentZ < clipZs[i_1]) {\n                                var clip = clips[i_1];\n                                context.beginPath();\n                                // counter-clockwise (outer ring) for current tile\n                                context.moveTo(currentClip[0], currentClip[1]);\n                                context.lineTo(currentClip[2], currentClip[3]);\n                                context.lineTo(currentClip[4], currentClip[5]);\n                                context.lineTo(currentClip[6], currentClip[7]);\n                                // clockwise (inner ring) for higher z tile\n                                context.moveTo(clip[6], clip[7]);\n                                context.lineTo(clip[4], clip[5]);\n                                context.lineTo(clip[2], clip[3]);\n                                context.lineTo(clip[0], clip[1]);\n                                context.clip();\n                            }\n                        }\n                        clips.push(currentClip);\n                        clipZs.push(currentZ);\n                    }\n                    else {\n                        context.clearRect(x, y, w, h);\n                    }\n                }\n                this.drawTileImage(tile, frameState, x, y, w, h, tileGutter, transition);\n                if (clips && !inTransition) {\n                    context.restore();\n                    this.renderedTiles.unshift(tile);\n                }\n                else {\n                    this.renderedTiles.push(tile);\n                }\n                this.updateUsedTiles(frameState.usedTiles, tileSource, tile);\n            }\n        }\n        this.renderedRevision = sourceRevision;\n        this.renderedResolution = tileResolution;\n        this.extentChanged =\n            !this.renderedExtent_ || !equals(this.renderedExtent_, canvasExtent);\n        this.renderedExtent_ = canvasExtent;\n        this.renderedPixelRatio = pixelRatio;\n        this.renderedProjection = projection;\n        this.manageTilePyramid(frameState, tileSource, tileGrid, pixelRatio, projection, extent, z, tileLayer.getPreload());\n        this.scheduleExpireCache(frameState, tileSource);\n        this.postRender(context, frameState);\n        if (layerState.extent) {\n            context.restore();\n        }\n        if (canvasTransform !== canvas.style.transform) {\n            canvas.style.transform = canvasTransform;\n        }\n        var opacity = cssOpacity(layerState.opacity);\n        var container = this.container;\n        if (opacity !== container.style.opacity) {\n            container.style.opacity = opacity;\n        }\n        return this.container;\n    };\n    /**\n     * @param {import(\"../../ImageTile.js\").default} tile Tile.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {number} x Left of the tile.\n     * @param {number} y Top of the tile.\n     * @param {number} w Width of the tile.\n     * @param {number} h Height of the tile.\n     * @param {number} gutter Tile gutter.\n     * @param {boolean} transition Apply an alpha transition.\n     */\n    CanvasTileLayerRenderer.prototype.drawTileImage = function (tile, frameState, x, y, w, h, gutter, transition) {\n        var image = this.getTileImage(tile);\n        if (!image) {\n            return;\n        }\n        var uid = getUid(this);\n        var alpha = transition ? tile.getAlpha(uid, frameState.time) : 1;\n        var alphaChanged = alpha !== this.context.globalAlpha;\n        if (alphaChanged) {\n            this.context.save();\n            this.context.globalAlpha = alpha;\n        }\n        this.context.drawImage(image, gutter, gutter, image.width - 2 * gutter, image.height - 2 * gutter, x, y, w, h);\n        if (alphaChanged) {\n            this.context.restore();\n        }\n        if (alpha !== 1) {\n            frameState.animate = true;\n        }\n        else if (transition) {\n            tile.endTransition(uid);\n        }\n    };\n    /**\n     * @return {HTMLCanvasElement} Image\n     */\n    CanvasTileLayerRenderer.prototype.getImage = function () {\n        var context = this.context;\n        return context ? context.canvas : null;\n    };\n    /**\n     * Get the image from a tile.\n     * @param {import(\"../../ImageTile.js\").default} tile Tile.\n     * @return {HTMLCanvasElement|HTMLImageElement|HTMLVideoElement} Image.\n     * @protected\n     */\n    CanvasTileLayerRenderer.prototype.getTileImage = function (tile) {\n        return tile.getImage();\n    };\n    /**\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {import(\"../../source/Tile.js\").default} tileSource Tile source.\n     * @protected\n     */\n    CanvasTileLayerRenderer.prototype.scheduleExpireCache = function (frameState, tileSource) {\n        if (tileSource.canExpireCache()) {\n            /**\n             * @param {import(\"../../source/Tile.js\").default} tileSource Tile source.\n             * @param {import(\"../../PluggableMap.js\").default} map Map.\n             * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n             */\n            var postRenderFunction = function (tileSource, map, frameState) {\n                var tileSourceKey = getUid(tileSource);\n                if (tileSourceKey in frameState.usedTiles) {\n                    tileSource.expireCache(frameState.viewState.projection, frameState.usedTiles[tileSourceKey]);\n                }\n            }.bind(null, tileSource);\n            frameState.postRenderFunctions.push(\n            /** @type {import(\"../../PluggableMap.js\").PostRenderFunction} */ (postRenderFunction));\n        }\n    };\n    /**\n     * @param {!Object<string, !Object<string, boolean>>} usedTiles Used tiles.\n     * @param {import(\"../../source/Tile.js\").default} tileSource Tile source.\n     * @param {import('../../Tile.js').default} tile Tile.\n     * @protected\n     */\n    CanvasTileLayerRenderer.prototype.updateUsedTiles = function (usedTiles, tileSource, tile) {\n        // FIXME should we use tilesToDrawByZ instead?\n        var tileSourceKey = getUid(tileSource);\n        if (!(tileSourceKey in usedTiles)) {\n            usedTiles[tileSourceKey] = {};\n        }\n        usedTiles[tileSourceKey][tile.getKey()] = true;\n    };\n    /**\n     * Manage tile pyramid.\n     * This function performs a number of functions related to the tiles at the\n     * current zoom and lower zoom levels:\n     * - registers idle tiles in frameState.wantedTiles so that they are not\n     *   discarded by the tile queue\n     * - enqueues missing tiles\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {import(\"../../source/Tile.js\").default} tileSource Tile source.\n     * @param {import(\"../../tilegrid/TileGrid.js\").default} tileGrid Tile grid.\n     * @param {number} pixelRatio Pixel ratio.\n     * @param {import(\"../../proj/Projection.js\").default} projection Projection.\n     * @param {import(\"../../extent.js\").Extent} extent Extent.\n     * @param {number} currentZ Current Z.\n     * @param {number} preload Load low resolution tiles up to 'preload' levels.\n     * @param {function(import(\"../../Tile.js\").default):void} [opt_tileCallback] Tile callback.\n     * @protected\n     */\n    CanvasTileLayerRenderer.prototype.manageTilePyramid = function (frameState, tileSource, tileGrid, pixelRatio, projection, extent, currentZ, preload, opt_tileCallback) {\n        var tileSourceKey = getUid(tileSource);\n        if (!(tileSourceKey in frameState.wantedTiles)) {\n            frameState.wantedTiles[tileSourceKey] = {};\n        }\n        var wantedTiles = frameState.wantedTiles[tileSourceKey];\n        var tileQueue = frameState.tileQueue;\n        var minZoom = tileGrid.getMinZoom();\n        var tileCount = 0;\n        var tile, tileRange, tileResolution, x, y, z;\n        for (z = minZoom; z <= currentZ; ++z) {\n            tileRange = tileGrid.getTileRangeForExtentAndZ(extent, z, tileRange);\n            tileResolution = tileGrid.getResolution(z);\n            for (x = tileRange.minX; x <= tileRange.maxX; ++x) {\n                for (y = tileRange.minY; y <= tileRange.maxY; ++y) {\n                    if (currentZ - z <= preload) {\n                        ++tileCount;\n                        tile = tileSource.getTile(z, x, y, pixelRatio, projection);\n                        if (tile.getState() == TileState.IDLE) {\n                            wantedTiles[tile.getKey()] = true;\n                            if (!tileQueue.isKeyQueued(tile.getKey())) {\n                                tileQueue.enqueue([\n                                    tile,\n                                    tileSourceKey,\n                                    tileGrid.getTileCoordCenter(tile.tileCoord),\n                                    tileResolution,\n                                ]);\n                            }\n                        }\n                        if (opt_tileCallback !== undefined) {\n                            opt_tileCallback(tile);\n                        }\n                    }\n                    else {\n                        tileSource.useTile(z, x, y, projection);\n                    }\n                }\n            }\n        }\n        tileSource.updateCacheSize(tileCount, projection);\n    };\n    return CanvasTileLayerRenderer;\n}(CanvasLayerRenderer));\n/**\n * @function\n * @return {import(\"../../layer/Tile.js\").default|import(\"../../layer/VectorTile.js\").default}\n */\nCanvasTileLayerRenderer.prototype.getLayer;\nexport default CanvasTileLayerRenderer;\n//# sourceMappingURL=TileLayer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/canvas/VectorLayer\n */\nimport CanvasBuilderGroup from '../../render/canvas/BuilderGroup.js';\nimport CanvasLayerRenderer from './Layer.js';\nimport ExecutorGroup from '../../render/canvas/ExecutorGroup.js';\nimport ViewHint from '../../ViewHint.js';\nimport { HIT_DETECT_RESOLUTION, createHitDetectionImageData, hitDetect, } from '../../render/canvas/hitdetect.js';\nimport { apply, makeInverse, makeScale, toString as transformToString, } from '../../transform.js';\nimport { buffer, containsExtent, createEmpty, getWidth, intersects as intersectsExtent, wrapX as wrapExtentX, } from '../../extent.js';\nimport { cssOpacity } from '../../css.js';\nimport { defaultOrder as defaultRenderOrder, getTolerance as getRenderTolerance, getSquaredTolerance as getSquaredRenderTolerance, renderFeature, } from '../vector.js';\nimport { equals } from '../../array.js';\nimport { fromUserExtent, getTransformFromProjections, getUserProjection, toUserExtent, toUserResolution, } from '../../proj.js';\nimport { getUid } from '../../util.js';\nimport { wrapX as wrapCoordinateX } from '../../coordinate.js';\n/**\n * @classdesc\n * Canvas renderer for vector layers.\n * @api\n */\nvar CanvasVectorLayerRenderer = /** @class */ (function (_super) {\n    __extends(CanvasVectorLayerRenderer, _super);\n    /**\n     * @param {import(\"../../layer/Vector.js\").default} vectorLayer Vector layer.\n     */\n    function CanvasVectorLayerRenderer(vectorLayer) {\n        var _this = _super.call(this, vectorLayer) || this;\n        /** @private */\n        _this.boundHandleStyleImageChange_ = _this.handleStyleImageChange_.bind(_this);\n        /**\n         * @type {boolean}\n         */\n        _this.animatingOrInteracting_;\n        /**\n         * @private\n         * @type {boolean}\n         */\n        _this.dirty_ = false;\n        /**\n         * @type {ImageData}\n         */\n        _this.hitDetectionImageData_ = null;\n        /**\n         * @type {Array<import(\"../../Feature.js\").default>}\n         */\n        _this.renderedFeatures_ = null;\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedRevision_ = -1;\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedResolution_ = NaN;\n        /**\n         * @private\n         * @type {import(\"../../extent.js\").Extent}\n         */\n        _this.renderedExtent_ = createEmpty();\n        /**\n         * @private\n         * @type {import(\"../../extent.js\").Extent}\n         */\n        _this.wrappedRenderedExtent_ = createEmpty();\n        /**\n         * @private\n         * @type {number}\n         */\n        _this.renderedRotation_;\n        /**\n         * @private\n         * @type {import(\"../../coordinate\").Coordinate}\n         */\n        _this.renderedCenter_ = null;\n        /**\n         * @private\n         * @type {import(\"../../proj/Projection\").default}\n         */\n        _this.renderedProjection_ = null;\n        /**\n         * @private\n         * @type {function(import(\"../../Feature.js\").default, import(\"../../Feature.js\").default): number|null}\n         */\n        _this.renderedRenderOrder_ = null;\n        /**\n         * @private\n         * @type {import(\"../../render/canvas/ExecutorGroup\").default}\n         */\n        _this.replayGroup_ = null;\n        /**\n         * A new replay group had to be created by `prepareFrame()`\n         * @type {boolean}\n         */\n        _this.replayGroupChanged = true;\n        /**\n         * @type {import(\"../../render/canvas/ExecutorGroup\").default}\n         */\n        _this.declutterExecutorGroup = null;\n        /**\n         * Clipping to be performed by `renderFrame()`\n         * @type {boolean}\n         */\n        _this.clipping = true;\n        return _this;\n    }\n    /**\n     * Get a rendering container from an existing target, if compatible.\n     * @param {HTMLElement} target Potential render target.\n     * @param {string} transform CSS Transform.\n     * @param {number} opacity Opacity.\n     */\n    CanvasVectorLayerRenderer.prototype.useContainer = function (target, transform, opacity) {\n        if (opacity < 1) {\n            target = null;\n        }\n        _super.prototype.useContainer.call(this, target, transform, opacity);\n    };\n    /**\n     * @param {ExecutorGroup} executorGroup Executor group.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {import(\"rbush\").default} [opt_declutterTree] Declutter tree.\n     */\n    CanvasVectorLayerRenderer.prototype.renderWorlds = function (executorGroup, frameState, opt_declutterTree) {\n        var extent = frameState.extent;\n        var viewState = frameState.viewState;\n        var center = viewState.center;\n        var resolution = viewState.resolution;\n        var projection = viewState.projection;\n        var rotation = viewState.rotation;\n        var projectionExtent = projection.getExtent();\n        var vectorSource = this.getLayer().getSource();\n        var pixelRatio = frameState.pixelRatio;\n        var viewHints = frameState.viewHints;\n        var snapToPixel = !(viewHints[ViewHint.ANIMATING] || viewHints[ViewHint.INTERACTING]);\n        var context = this.context;\n        var width = Math.round(frameState.size[0] * pixelRatio);\n        var height = Math.round(frameState.size[1] * pixelRatio);\n        var multiWorld = vectorSource.getWrapX() && projection.canWrapX();\n        var worldWidth = multiWorld ? getWidth(projectionExtent) : null;\n        var endWorld = multiWorld\n            ? Math.ceil((extent[2] - projectionExtent[2]) / worldWidth) + 1\n            : 1;\n        var world = multiWorld\n            ? Math.floor((extent[0] - projectionExtent[0]) / worldWidth)\n            : 0;\n        do {\n            var transform = this.getRenderTransform(center, resolution, rotation, pixelRatio, width, height, world * worldWidth);\n            executorGroup.execute(context, 1, transform, rotation, snapToPixel, undefined, opt_declutterTree);\n        } while (++world < endWorld);\n    };\n    /**\n     * Render declutter items for this layer\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     */\n    CanvasVectorLayerRenderer.prototype.renderDeclutter = function (frameState) {\n        if (this.declutterExecutorGroup) {\n            this.renderWorlds(this.declutterExecutorGroup, frameState, frameState.declutterTree);\n        }\n    };\n    /**\n     * Render the layer.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    CanvasVectorLayerRenderer.prototype.renderFrame = function (frameState, target) {\n        var pixelRatio = frameState.pixelRatio;\n        var layerState = frameState.layerStatesArray[frameState.layerIndex];\n        // set forward and inverse pixel transforms\n        makeScale(this.pixelTransform, 1 / pixelRatio, 1 / pixelRatio);\n        makeInverse(this.inversePixelTransform, this.pixelTransform);\n        var canvasTransform = transformToString(this.pixelTransform);\n        this.useContainer(target, canvasTransform, layerState.opacity);\n        var context = this.context;\n        var canvas = context.canvas;\n        var replayGroup = this.replayGroup_;\n        var declutterExecutorGroup = this.declutterExecutorGroup;\n        if ((!replayGroup || replayGroup.isEmpty()) &&\n            (!declutterExecutorGroup || declutterExecutorGroup.isEmpty())) {\n            return null;\n        }\n        // resize and clear\n        var width = Math.round(frameState.size[0] * pixelRatio);\n        var height = Math.round(frameState.size[1] * pixelRatio);\n        if (canvas.width != width || canvas.height != height) {\n            canvas.width = width;\n            canvas.height = height;\n            if (canvas.style.transform !== canvasTransform) {\n                canvas.style.transform = canvasTransform;\n            }\n        }\n        else if (!this.containerReused) {\n            context.clearRect(0, 0, width, height);\n        }\n        this.preRender(context, frameState);\n        var viewState = frameState.viewState;\n        var projection = viewState.projection;\n        // clipped rendering if layer extent is set\n        var clipped = false;\n        var render = true;\n        if (layerState.extent && this.clipping) {\n            var layerExtent = fromUserExtent(layerState.extent, projection);\n            render = intersectsExtent(layerExtent, frameState.extent);\n            clipped = render && !containsExtent(layerExtent, frameState.extent);\n            if (clipped) {\n                this.clipUnrotated(context, frameState, layerExtent);\n            }\n        }\n        if (render) {\n            this.renderWorlds(replayGroup, frameState);\n        }\n        if (clipped) {\n            context.restore();\n        }\n        this.postRender(context, frameState);\n        var opacity = cssOpacity(layerState.opacity);\n        var container = this.container;\n        if (opacity !== container.style.opacity) {\n            container.style.opacity = opacity;\n        }\n        if (this.renderedRotation_ !== viewState.rotation) {\n            this.renderedRotation_ = viewState.rotation;\n            this.hitDetectionImageData_ = null;\n        }\n        return this.container;\n    };\n    /**\n     * Asynchronous layer level hit detection.\n     * @param {import(\"../../pixel.js\").Pixel} pixel Pixel.\n     * @return {Promise<Array<import(\"../../Feature\").default>>} Promise that resolves with an array of features.\n     */\n    CanvasVectorLayerRenderer.prototype.getFeatures = function (pixel) {\n        return new Promise(\n        /**\n         * @param {function(Array<import(\"../../Feature\").default|import(\"../../render/Feature\").default>): void} resolve Resolver function.\n         * @this {CanvasVectorLayerRenderer}\n         */\n        function (resolve) {\n            if (!this.hitDetectionImageData_ && !this.animatingOrInteracting_) {\n                var size = [this.context.canvas.width, this.context.canvas.height];\n                apply(this.pixelTransform, size);\n                var center = this.renderedCenter_;\n                var resolution = this.renderedResolution_;\n                var rotation = this.renderedRotation_;\n                var projection = this.renderedProjection_;\n                var extent = this.wrappedRenderedExtent_;\n                var layer = this.getLayer();\n                var transforms = [];\n                var width = size[0] * HIT_DETECT_RESOLUTION;\n                var height = size[1] * HIT_DETECT_RESOLUTION;\n                transforms.push(this.getRenderTransform(center, resolution, rotation, HIT_DETECT_RESOLUTION, width, height, 0).slice());\n                var source = layer.getSource();\n                var projectionExtent = projection.getExtent();\n                if (source.getWrapX() &&\n                    projection.canWrapX() &&\n                    !containsExtent(projectionExtent, extent)) {\n                    var startX = extent[0];\n                    var worldWidth = getWidth(projectionExtent);\n                    var world = 0;\n                    var offsetX = void 0;\n                    while (startX < projectionExtent[0]) {\n                        --world;\n                        offsetX = worldWidth * world;\n                        transforms.push(this.getRenderTransform(center, resolution, rotation, HIT_DETECT_RESOLUTION, width, height, offsetX).slice());\n                        startX += worldWidth;\n                    }\n                    world = 0;\n                    startX = extent[2];\n                    while (startX > projectionExtent[2]) {\n                        ++world;\n                        offsetX = worldWidth * world;\n                        transforms.push(this.getRenderTransform(center, resolution, rotation, HIT_DETECT_RESOLUTION, width, height, offsetX).slice());\n                        startX -= worldWidth;\n                    }\n                }\n                this.hitDetectionImageData_ = createHitDetectionImageData(size, transforms, this.renderedFeatures_, layer.getStyleFunction(), extent, resolution, rotation);\n            }\n            resolve(hitDetect(pixel, this.renderedFeatures_, this.hitDetectionImageData_));\n        }.bind(this));\n    };\n    /**\n     * @param {import(\"../../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {import(\"../vector.js\").FeatureCallback<T>} callback Feature callback.\n     * @param {Array<import(\"../Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    CanvasVectorLayerRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, matches) {\n        var _this = this;\n        if (!this.replayGroup_) {\n            return undefined;\n        }\n        var resolution = frameState.viewState.resolution;\n        var rotation = frameState.viewState.rotation;\n        var layer = this.getLayer();\n        /** @type {!Object<string, import(\"../Map.js\").HitMatch<T>|true>} */\n        var features = {};\n        /**\n         * @param {import(\"../../Feature.js\").FeatureLike} feature Feature.\n         * @param {import(\"../../geom/SimpleGeometry.js\").default} geometry Geometry.\n         * @param {number} distanceSq The squared distance to the click position\n         * @return {T|undefined} Callback result.\n         */\n        var featureCallback = function (feature, geometry, distanceSq) {\n            var key = getUid(feature);\n            var match = features[key];\n            if (!match) {\n                if (distanceSq === 0) {\n                    features[key] = true;\n                    return callback(feature, layer, geometry);\n                }\n                matches.push((features[key] = {\n                    feature: feature,\n                    layer: layer,\n                    geometry: geometry,\n                    distanceSq: distanceSq,\n                    callback: callback,\n                }));\n            }\n            else if (match !== true && distanceSq < match.distanceSq) {\n                if (distanceSq === 0) {\n                    features[key] = true;\n                    matches.splice(matches.lastIndexOf(match), 1);\n                    return callback(feature, layer, geometry);\n                }\n                match.geometry = geometry;\n                match.distanceSq = distanceSq;\n            }\n            return undefined;\n        };\n        var result;\n        var executorGroups = [this.replayGroup_];\n        if (this.declutterExecutorGroup) {\n            executorGroups.push(this.declutterExecutorGroup);\n        }\n        executorGroups.some(function (executorGroup) {\n            return (result = executorGroup.forEachFeatureAtCoordinate(coordinate, resolution, rotation, hitTolerance, featureCallback, executorGroup === _this.declutterExecutorGroup\n                ? frameState.declutterTree.all().map(function (item) { return item.value; })\n                : null));\n        });\n        return result;\n    };\n    /**\n     * Perform action necessary to get the layer rendered after new fonts have loaded\n     */\n    CanvasVectorLayerRenderer.prototype.handleFontsChanged = function () {\n        var layer = this.getLayer();\n        if (layer.getVisible() && this.replayGroup_) {\n            layer.changed();\n        }\n    };\n    /**\n     * Handle changes in image style state.\n     * @param {import(\"../../events/Event.js\").default} event Image style change event.\n     * @private\n     */\n    CanvasVectorLayerRenderer.prototype.handleStyleImageChange_ = function (event) {\n        this.renderIfReadyAndVisible();\n    };\n    /**\n     * Determine whether render should be called.\n     * @param {import(\"../../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    CanvasVectorLayerRenderer.prototype.prepareFrame = function (frameState) {\n        var vectorLayer = this.getLayer();\n        var vectorSource = vectorLayer.getSource();\n        if (!vectorSource) {\n            return false;\n        }\n        var animating = frameState.viewHints[ViewHint.ANIMATING];\n        var interacting = frameState.viewHints[ViewHint.INTERACTING];\n        var updateWhileAnimating = vectorLayer.getUpdateWhileAnimating();\n        var updateWhileInteracting = vectorLayer.getUpdateWhileInteracting();\n        if ((!this.dirty_ && !updateWhileAnimating && animating) ||\n            (!updateWhileInteracting && interacting)) {\n            this.animatingOrInteracting_ = true;\n            return true;\n        }\n        this.animatingOrInteracting_ = false;\n        var frameStateExtent = frameState.extent;\n        var viewState = frameState.viewState;\n        var projection = viewState.projection;\n        var resolution = viewState.resolution;\n        var pixelRatio = frameState.pixelRatio;\n        var vectorLayerRevision = vectorLayer.getRevision();\n        var vectorLayerRenderBuffer = vectorLayer.getRenderBuffer();\n        var vectorLayerRenderOrder = vectorLayer.getRenderOrder();\n        if (vectorLayerRenderOrder === undefined) {\n            vectorLayerRenderOrder = defaultRenderOrder;\n        }\n        var center = viewState.center.slice();\n        var extent = buffer(frameStateExtent, vectorLayerRenderBuffer * resolution);\n        var renderedExtent = extent.slice();\n        var loadExtents = [extent.slice()];\n        var projectionExtent = projection.getExtent();\n        if (vectorSource.getWrapX() &&\n            projection.canWrapX() &&\n            !containsExtent(projectionExtent, frameState.extent)) {\n            // For the replay group, we need an extent that intersects the real world\n            // (-180° to +180°). To support geometries in a coordinate range from -540°\n            // to +540°, we add at least 1 world width on each side of the projection\n            // extent. If the viewport is wider than the world, we need to add half of\n            // the viewport width to make sure we cover the whole viewport.\n            var worldWidth = getWidth(projectionExtent);\n            var gutter = Math.max(getWidth(extent) / 2, worldWidth);\n            extent[0] = projectionExtent[0] - gutter;\n            extent[2] = projectionExtent[2] + gutter;\n            wrapCoordinateX(center, projection);\n            var loadExtent = wrapExtentX(loadExtents[0], projection);\n            // If the extent crosses the date line, we load data for both edges of the worlds\n            if (loadExtent[0] < projectionExtent[0] &&\n                loadExtent[2] < projectionExtent[2]) {\n                loadExtents.push([\n                    loadExtent[0] + worldWidth,\n                    loadExtent[1],\n                    loadExtent[2] + worldWidth,\n                    loadExtent[3],\n                ]);\n            }\n            else if (loadExtent[0] > projectionExtent[0] &&\n                loadExtent[2] > projectionExtent[2]) {\n                loadExtents.push([\n                    loadExtent[0] - worldWidth,\n                    loadExtent[1],\n                    loadExtent[2] - worldWidth,\n                    loadExtent[3],\n                ]);\n            }\n        }\n        if (!this.dirty_ &&\n            this.renderedResolution_ == resolution &&\n            this.renderedRevision_ == vectorLayerRevision &&\n            this.renderedRenderOrder_ == vectorLayerRenderOrder &&\n            containsExtent(this.wrappedRenderedExtent_, extent)) {\n            if (!equals(this.renderedExtent_, renderedExtent)) {\n                this.hitDetectionImageData_ = null;\n                this.renderedExtent_ = renderedExtent;\n            }\n            this.renderedCenter_ = center;\n            this.replayGroupChanged = false;\n            return true;\n        }\n        this.replayGroup_ = null;\n        this.dirty_ = false;\n        var replayGroup = new CanvasBuilderGroup(getRenderTolerance(resolution, pixelRatio), extent, resolution, pixelRatio);\n        var declutterBuilderGroup;\n        if (this.getLayer().getDeclutter()) {\n            declutterBuilderGroup = new CanvasBuilderGroup(getRenderTolerance(resolution, pixelRatio), extent, resolution, pixelRatio);\n        }\n        var userProjection = getUserProjection();\n        var userTransform;\n        if (userProjection) {\n            for (var i = 0, ii = loadExtents.length; i < ii; ++i) {\n                var extent_1 = loadExtents[i];\n                var userExtent_1 = toUserExtent(extent_1, projection);\n                vectorSource.loadFeatures(userExtent_1, toUserResolution(resolution, projection), userProjection);\n            }\n            userTransform = getTransformFromProjections(userProjection, projection);\n        }\n        else {\n            for (var i = 0, ii = loadExtents.length; i < ii; ++i) {\n                vectorSource.loadFeatures(loadExtents[i], resolution, projection);\n            }\n        }\n        var squaredTolerance = getSquaredRenderTolerance(resolution, pixelRatio);\n        var render = \n        /**\n         * @param {import(\"../../Feature.js\").default} feature Feature.\n         * @this {CanvasVectorLayerRenderer}\n         */\n        function (feature) {\n            var styles;\n            var styleFunction = feature.getStyleFunction() || vectorLayer.getStyleFunction();\n            if (styleFunction) {\n                styles = styleFunction(feature, resolution);\n            }\n            if (styles) {\n                var dirty = this.renderFeature(feature, squaredTolerance, styles, replayGroup, userTransform, declutterBuilderGroup);\n                this.dirty_ = this.dirty_ || dirty;\n            }\n        }.bind(this);\n        var userExtent = toUserExtent(extent, projection);\n        /** @type {Array<import(\"../../Feature.js\").default>} */\n        var features = vectorSource.getFeaturesInExtent(userExtent);\n        if (vectorLayerRenderOrder) {\n            features.sort(vectorLayerRenderOrder);\n        }\n        for (var i = 0, ii = features.length; i < ii; ++i) {\n            render(features[i]);\n        }\n        this.renderedFeatures_ = features;\n        var replayGroupInstructions = replayGroup.finish();\n        var executorGroup = new ExecutorGroup(extent, resolution, pixelRatio, vectorSource.getOverlaps(), replayGroupInstructions, vectorLayer.getRenderBuffer());\n        if (declutterBuilderGroup) {\n            this.declutterExecutorGroup = new ExecutorGroup(extent, resolution, pixelRatio, vectorSource.getOverlaps(), declutterBuilderGroup.finish(), vectorLayer.getRenderBuffer());\n        }\n        this.renderedResolution_ = resolution;\n        this.renderedRevision_ = vectorLayerRevision;\n        this.renderedRenderOrder_ = vectorLayerRenderOrder;\n        this.renderedExtent_ = renderedExtent;\n        this.wrappedRenderedExtent_ = extent;\n        this.renderedCenter_ = center;\n        this.renderedProjection_ = projection;\n        this.replayGroup_ = executorGroup;\n        this.hitDetectionImageData_ = null;\n        this.replayGroupChanged = true;\n        return true;\n    };\n    /**\n     * @param {import(\"../../Feature.js\").default} feature Feature.\n     * @param {number} squaredTolerance Squared render tolerance.\n     * @param {import(\"../../style/Style.js\").default|Array<import(\"../../style/Style.js\").default>} styles The style or array of styles.\n     * @param {import(\"../../render/canvas/BuilderGroup.js\").default} builderGroup Builder group.\n     * @param {import(\"../../proj.js\").TransformFunction} [opt_transform] Transform from user to view projection.\n     * @param {import(\"../../render/canvas/BuilderGroup.js\").default} [opt_declutterBuilderGroup] Builder for decluttering.\n     * @return {boolean} `true` if an image is loading.\n     */\n    CanvasVectorLayerRenderer.prototype.renderFeature = function (feature, squaredTolerance, styles, builderGroup, opt_transform, opt_declutterBuilderGroup) {\n        if (!styles) {\n            return false;\n        }\n        var loading = false;\n        if (Array.isArray(styles)) {\n            for (var i = 0, ii = styles.length; i < ii; ++i) {\n                loading =\n                    renderFeature(builderGroup, feature, styles[i], squaredTolerance, this.boundHandleStyleImageChange_, opt_transform, opt_declutterBuilderGroup) || loading;\n            }\n        }\n        else {\n            loading = renderFeature(builderGroup, feature, styles, squaredTolerance, this.boundHandleStyleImageChange_, opt_transform, opt_declutterBuilderGroup);\n        }\n        return loading;\n    };\n    return CanvasVectorLayerRenderer;\n}(CanvasLayerRenderer));\nexport default CanvasVectorLayerRenderer;\n//# sourceMappingURL=VectorLayer.js.map","var __extends = (this && this.__extends) || (function () {\n    var extendStatics = function (d, b) {\n        extendStatics = Object.setPrototypeOf ||\n            ({ __proto__: [] } instanceof Array && function (d, b) { d.__proto__ = b; }) ||\n            function (d, b) { for (var p in b) if (Object.prototype.hasOwnProperty.call(b, p)) d[p] = b[p]; };\n        return extendStatics(d, b);\n    };\n    return function (d, b) {\n        if (typeof b !== \"function\" && b !== null)\n            throw new TypeError(\"Class extends value \" + String(b) + \" is not a constructor or null\");\n        extendStatics(d, b);\n        function __() { this.constructor = d; }\n        d.prototype = b === null ? Object.create(b) : (__.prototype = b.prototype, new __());\n    };\n})();\n/**\n * @module ol/renderer/Layer\n */\nimport EventType from '../events/EventType.js';\nimport ImageState from '../ImageState.js';\nimport Observable from '../Observable.js';\nimport SourceState from '../source/State.js';\nimport { abstract } from '../util.js';\n/**\n * @template {import(\"../layer/Layer.js\").default} LayerType\n */\nvar LayerRenderer = /** @class */ (function (_super) {\n    __extends(LayerRenderer, _super);\n    /**\n     * @param {LayerType} layer Layer.\n     */\n    function LayerRenderer(layer) {\n        var _this = _super.call(this) || this;\n        /** @private */\n        _this.boundHandleImageChange_ = _this.handleImageChange_.bind(_this);\n        /**\n         * @protected\n         * @type {LayerType}\n         */\n        _this.layer_ = layer;\n        /**\n         * @type {import(\"../render/canvas/ExecutorGroup\").default}\n         */\n        _this.declutterExecutorGroup = null;\n        return _this;\n    }\n    /**\n     * Asynchronous layer level hit detection.\n     * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n     * @return {Promise<Array<import(\"../Feature\").default>>} Promise that resolves with\n     * an array of features.\n     */\n    LayerRenderer.prototype.getFeatures = function (pixel) {\n        return abstract();\n    };\n    /**\n     * Determine whether render should be called.\n     * @abstract\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     * @return {boolean} Layer is ready to be rendered.\n     */\n    LayerRenderer.prototype.prepareFrame = function (frameState) {\n        return abstract();\n    };\n    /**\n     * Render the layer.\n     * @abstract\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {HTMLElement} target Target that may be used to render content to.\n     * @return {HTMLElement} The rendered element.\n     */\n    LayerRenderer.prototype.renderFrame = function (frameState, target) {\n        return abstract();\n    };\n    /**\n     * @param {Object<number, Object<string, import(\"../Tile.js\").default>>} tiles Lookup of loaded tiles by zoom level.\n     * @param {number} zoom Zoom level.\n     * @param {import(\"../Tile.js\").default} tile Tile.\n     * @return {boolean|void} If `false`, the tile will not be considered loaded.\n     */\n    LayerRenderer.prototype.loadedTileCallback = function (tiles, zoom, tile) {\n        if (!tiles[zoom]) {\n            tiles[zoom] = {};\n        }\n        tiles[zoom][tile.tileCoord.toString()] = tile;\n        return undefined;\n    };\n    /**\n     * Create a function that adds loaded tiles to the tile lookup.\n     * @param {import(\"../source/Tile.js\").default} source Tile source.\n     * @param {import(\"../proj/Projection.js\").default} projection Projection of the tiles.\n     * @param {Object<number, Object<string, import(\"../Tile.js\").default>>} tiles Lookup of loaded tiles by zoom level.\n     * @return {function(number, import(\"../TileRange.js\").default):boolean} A function that can be\n     *     called with a zoom level and a tile range to add loaded tiles to the lookup.\n     * @protected\n     */\n    LayerRenderer.prototype.createLoadedTileFinder = function (source, projection, tiles) {\n        return (\n        /**\n         * @param {number} zoom Zoom level.\n         * @param {import(\"../TileRange.js\").default} tileRange Tile range.\n         * @return {boolean} The tile range is fully loaded.\n         * @this {LayerRenderer}\n         */\n        function (zoom, tileRange) {\n            var callback = this.loadedTileCallback.bind(this, tiles, zoom);\n            return source.forEachLoadedTile(projection, zoom, tileRange, callback);\n        }.bind(this));\n    };\n    /**\n     * @abstract\n     * @param {import(\"../coordinate.js\").Coordinate} coordinate Coordinate.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState Frame state.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @param {import(\"./vector.js\").FeatureCallback<T>} callback Feature callback.\n     * @param {Array<import(\"./Map.js\").HitMatch<T>>} matches The hit detected matches with tolerance.\n     * @return {T|undefined} Callback result.\n     * @template T\n     */\n    LayerRenderer.prototype.forEachFeatureAtCoordinate = function (coordinate, frameState, hitTolerance, callback, matches) {\n        return undefined;\n    };\n    /**\n     * @abstract\n     * @param {import(\"../pixel.js\").Pixel} pixel Pixel.\n     * @param {import(\"../PluggableMap.js\").FrameState} frameState FrameState.\n     * @param {number} hitTolerance Hit tolerance in pixels.\n     * @return {Uint8ClampedArray|Uint8Array} The result.  If there is no data at the pixel\n     *    location, null will be returned.  If there is data, but pixel values cannot be\n     *    returned, and empty array will be returned.\n     */\n    LayerRenderer.prototype.getDataAtPixel = function (pixel, frameState, hitTolerance) {\n        return null;\n    };\n    /**\n     * @return {LayerType} Layer.\n     */\n    LayerRenderer.prototype.getLayer = function () {\n        return this.layer_;\n    };\n    /**\n     * Perform action necessary to get the layer rendered after new fonts have loaded\n     * @abstract\n     */\n    LayerRenderer.prototype.handleFontsChanged = function () { };\n    /**\n     * Handle changes in image state.\n     * @param {import(\"../events/Event.js\").default} event Image change event.\n     * @private\n     */\n    LayerRenderer.prototype.handleImageChange_ = function (event) {\n        var image = /** @type {import(\"../Image.js\").default} */ (event.target);\n        if (image.getState() === ImageState.LOADED) {\n            this.renderIfReadyAndVisible();\n        }\n    };\n    /**\n     * Load the image if not already loaded, and register the image change\n     * listener if needed.\n     * @param {import(\"../ImageBase.js\").default} image Image.\n     * @return {boolean} `true` if the image is already loaded, `false` otherwise.\n     * @protected\n     */\n    LayerRenderer.prototype.loadImage = function (image) {\n        var imageState = image.getState();\n        if (imageState != ImageState.LOADED && imageState != ImageState.ERROR) {\n            image.addEventListener(EventType.CHANGE, this.boundHandleImageChange_);\n        }\n        if (imageState == ImageState.IDLE) {\n            image.load();\n            imageState = image.getState();\n        }\n        return imageState == ImageState.LOADED;\n    };\n    /**\n     * @protected\n     */\n    LayerRenderer.prototype.renderIfReadyAndVisible = function () {\n        var layer = this.getLayer();\n        if (layer.getVisible() && layer.getSourceState() == SourceState.READY) {\n            layer.changed();\n        }\n    };\n    return LayerRenderer;\n}(Observable));\nexport default LayerRenderer;\n//# sourceMappingURL=Layer.js.map"],"sourceRoot":""}